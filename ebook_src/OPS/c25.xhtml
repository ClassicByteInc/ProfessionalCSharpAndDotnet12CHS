<!-- 这行注释会存在于经过翻译的源文件中。除非您获得许可请不要删除这个注释。
    翻译由 ClassicByte Org 的 higashitani yume 完成
    使用工具 沉浸式翻译 智谱GLM模型
    您可以阅读这个源代码，也可以向他人分发此源代码，但是不得用于商业用途。
    您也可以自己将这些代码打包成epub分发给别人，但是不得用于商业用途。
    如果此源代码侵犯了您的权益，请联系我我将会删除侵权内容。
    您在阅读此源代码时，可能会看到一些英文内容，这些内容是原书的内容，可能是因为翻译不准确或者是因为原书的内容没有被翻译。
    如果您发现了错误，请联系我我会进行修正。
  -->
<!--This line of comments will exist in the translated source file. Do not delete this comment unless you have permission.
    Translation is done by ClassicByte Org's higashitani yume
    Usage Tools Immersive Translation Zhipu GLM Model
    You can read this source code or distribute it to others, but it may not be used for commercial purposes.
    You can also package these codes yourself into epub and distribute them to others, but they may not be used for commercial purposes.
    If this source code infringes your rights, please contact me and I will delete the infringing content.
    When you read this source code, you may see some English content, which is the content of the original book, which may be because the translation is inaccurate or because the content of the original book has not been translated.
    If you find an error, please contact me and I will correct it.
  -->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops"
    xmlns:svg="http://www.w3.org/2000/svg" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en"
    imt-state="dual" imt-trans-position="after">

<head>
    <title>25 服务 --- 25 Services</title>
    <link href="WileyTemplate_v5.5.css" rel="stylesheet" type="text/css" />
    <meta content="urn:uuid:e0000000-0000-0000-0000-000006715209" name="Adept.expected.resource" />
    <style data-id="immersive-translate-input-injected-css">
        .immersive-translate-input {
            position: absolute;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            z-index: 2147483647;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .immersive-translate-attach-loading::after {
            content: " ";

            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;

            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-2000%, -50%);
            z-index: 100;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .immersive-translate-input-loading {
            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;
        }

        @keyframes immersiveTranslateShadowRolling {
            0% {
                box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            12% {
                box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            25% {
                box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            36% {
                box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color),
                    100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
            }

            50% {
                box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color),
                    110px 0 var(--loading-color), 100px 0 var(--loading-color);
            }

            62% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color),
                    120px 0 var(--loading-color), 110px 0 var(--loading-color);
            }

            75% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    130px 0 var(--loading-color), 120px 0 var(--loading-color);
            }

            87% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
            }

            100% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
            }
        }

        .immersive-translate-toast {
            display: flex;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            right: 0;
            top: 1%;
            width: fit-content;
            padding: 12px 20px;
            margin: auto;
            overflow: auto;
            background: #fef6f9;
            box-shadow: 0px 4px 10px 0px rgba(0, 10, 30, 0.06);
            font-size: 15px;
            border-radius: 8px;
            color: #333;
        }

        .immersive-translate-toast-content {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .immersive-translate-toast-hidden {
            margin: 0 20px 0 72px;
            text-decoration: underline;
            cursor: pointer;
        }

        .immersive-translate-toast-close {
            color: #666666;
            font-size: 20px;
            font-weight: bold;
            padding: 0 10px;
            cursor: pointer;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-toast {
                top: 0;
                padding: 12px 0px 0 10px;
            }

            .immersive-translate-toast-content {
                flex-direction: column;
                text-align: center;
            }

            .immersive-translate-toast-hidden {
                margin: 10px auto;
            }
        }

        .immersive-translate-modal {
            display: none;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
            font-size: 15px;
        }

        .immersive-translate-modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 40px 24px 24px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 80%;
            max-width: 270px;
            font-family: system-ui, -apple-system, "Segoe UI", "Roboto", "Ubuntu",
                "Cantarell", "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
                "Segoe UI Symbol", "Noto Color Emoji";
            position: relative;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-content {
                margin: 50% auto !important;
            }
        }

        .immersive-translate-modal .immersive-translate-modal-content-in-input {
            max-width: 500px;
        }

        .immersive-translate-modal-content-in-input .immersive-translate-modal-body {
            text-align: left;
            max-height: unset;
        }

        .immersive-translate-modal-title {
            text-align: center;
            font-size: 16px;
            font-weight: 700;
            color: #333333;
        }

        .immersive-translate-modal-body {
            text-align: center;
            font-size: 14px;
            font-weight: 400;
            color: #333333;
            word-break: break-all;
            margin-top: 24px;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-body {
                max-height: 250px;
                overflow-y: auto;
            }
        }

        .immersive-translate-close {
            color: #666666;
            position: absolute;
            right: 16px;
            top: 16px;
            font-size: 20px;
            font-weight: bold;
        }

        .immersive-translate-close:hover,
        .immersive-translate-close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .immersive-translate-modal-footer {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        .immersive-translate-btn {
            width: fit-content;
            color: #fff;
            background-color: #ea4c89;
            border: none;
            font-size: 16px;
            margin: 0 8px;
            padding: 9px 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .immersive-translate-btn:hover {
            background-color: #f082ac;
        }

        .immersive-translate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .immersive-translate-btn:disabled:hover {
            background-color: #ea4c89;
        }

        .immersive-translate-cancel-btn {
            /* gray color */
            background-color: rgb(89, 107, 120);
        }

        .immersive-translate-cancel-btn:hover {
            background-color: hsl(205, 20%, 32%);
        }

        .immersive-translate-action-btn {
            background-color: transparent;
            color: #ea4c89;
            border: 1px solid #ea4c89;
        }

        .immersive-translate-btn svg {
            margin-right: 5px;
        }

        .immersive-translate-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #007bff;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-primary-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #ea4c89;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-modal input[type="radio"] {
            margin: 0 6px;
            cursor: pointer;
        }

        .immersive-translate-modal label {
            cursor: pointer;
        }

        .immersive-translate-close-action {
            position: absolute;
            top: 2px;
            right: 0px;
            cursor: pointer;
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5) !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 16px !important;
        }

        .imt-image-status img,
        .imt-image-status svg,
        .imt-img-loading {
            width: 28px !important;
            height: 28px !important;
            margin: 0 0 8px 0 !important;
            min-height: 28px !important;
            min-width: 28px !important;
            position: relative !important;
        }

        .imt-img-loading {
            background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAtFBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////oK74hAAAAPHRSTlMABBMIDyQXHwyBfFdDMSw+OjXCb+5RG51IvV/k0rOqlGRM6KKMhdvNyZBz9MaupmxpWyj437iYd/yJVNZeuUC7AAACt0lEQVRIx53T2XKiUBCA4QYOiyCbiAsuuGBcYtxiYtT3f6/pbqoYHVFO5r+iivpo6DpAWYpqeoFfr9f90DsYAuRSWkFnPO50OgR9PwiCUFcl2GEcx+N/YBh6pvKaefHlUgZd1zVe0NbYcQjGBfzrPE8Xz8aF+71D8gG6DHFPpc4a7xFiCDuhaWgKgGIJQ3d5IMGDrpS4S5KgpIm+en9f6PlAhKby4JwEIxlYJV9h5k5nee9GoxHJ2IDSNB0dwdad1NAxDJ/uXDHYmebdk4PdbkS58CIVHdYSUHTYYRWOJblWSyu2lmy3KNFVJNBhxcuGW4YBVCbYGRZwIooipHsNqjM4FbgOQqQqSKQQU9V8xmi1QlgHqQQ6DDBvRUVCDirs+EzGDGOQTCATgtYTnbCVLgsVgRE0T1QE0qHCFAht2z6dLvJQs3Lo2FQoDxWNUiBhaP4eRgwNkI+dAjVOA/kUrIDwf3CG8NfNOE0eiFotSuo+rBiq8tD9oY4Qzc6YJw99hl1wzpQvD7ef2M8QgnOGJfJw+EltQc+oX2yn907QB22WZcvlUpd143dqQu+8pCJZuGE4xCuPXJqqcs5sNpsI93Rmzym1k4Npk+oD1SH3/a3LOK/JpUBpWfqNySxWzCfNCUITuDG5dtuphrUJ1myeIE9bIsPiKrfqTai5WZxbhtNphYx6GEIHihyGFTI69lje/rxajdh0s0msZ0zYxyPLhYCb1CyHm9Qsd2H37Y3lugVwL9kNh8Ot8cha6fUNQ8nuXi5z9/ExsAO4zQrb/ev1yrCB7lGyQzgYDGuxq1toDN/JGvN+HyWNHKB7zEoK+PX11e12G431erGYzwmytAWU56fkMHY5JJnDRR2eZji3AwtIcrEV8Cojat/BdQ7XOwGV1e1hDjGGjXbdArm8uJZtCH5MbcctVX8A1WpqumJHwckAAAAASUVORK5CYII=");
            background-size: 28px 28px;
            animation: image-loading-rotate 1s linear infinite !important;
        }

        .imt-image-status span {
            color: var(--bg-2, #fff) !important;
            font-size: 14px !important;
            line-height: 14px !important;
            font-weight: 500 !important;
            font-family: "PingFang SC", Arial, sans-serif !important;
        }

        @keyframes image-loading-rotate {
            from {
                transform: rotate(360deg);
            }

            to {
                transform: rotate(0deg);
            }
        }
    </style>
    <style data-id="immersive-translate-default-injected-css">
        :root {
            --immersive-translate-theme-underline-borderColor: #72ece9;
            --immersive-translate-theme-nativeUnderline-borderColor: #72ece9;
            --immersive-translate-theme-nativeDashed-borderColor: #72ece9;
            --immersive-translate-theme-nativeDotted-borderColor: #72ece9;
            --immersive-translate-theme-highlight-backgroundColor: #ffff00;
            --immersive-translate-theme-dashed-borderColor: #59c1bd;
            --immersive-translate-theme-blockquote-borderColor: #cc3355;
            --immersive-translate-theme-thinDashed-borderColor: #ff374f;
            --immersive-translate-theme-dashedBorder-borderColor: #94a3b8;
            --immersive-translate-theme-dashedBorder-borderRadius: 0;
            --immersive-translate-theme-solidBorder-borderColor: #94a3b8;
            --immersive-translate-theme-solidBorder-borderRadius: 0;
            --immersive-translate-theme-dotted-borderColor: #94a3b8;
            --immersive-translate-theme-wavy-borderColor: #72ece9;
            --immersive-translate-theme-dividingLine-borderColor: #94a3b8;
            --immersive-translate-theme-grey-textColor: #2f4f4f;
            --immersive-translate-theme-marker-backgroundColor: #fbda41;
            --immersive-translate-theme-marker-backgroundColor-rgb: 251, 218, 65;
            --immersive-translate-theme-marker2-backgroundColor: #ffff00;
            --immersive-translate-theme-background-backgroundColor: #dbafaf;
            --immersive-translate-theme-background-backgroundColor-rgb: 219, 175, 175;
            --immersive-translate-theme-background-backgroundOpacity: 12;
            --immersive-translate-theme-opacity-opacity: 10;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pre-whitespace {
            white-space: pre-wrap !important;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container {
            position: absolute;
            background-color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
                sans-serif;
            top: 0;
            width: 600px;
            height: 100%;
            z-index: 2;
            line-height: 1.3;
            font-size: 16px;
        }

        [imt-state="dual"] .immersive-translate-target-wrapper[dir="rtl"] {
            text-align: right;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper {
            color: rgb(0, 0, 0);
            white-space: normal;
            position: absolute;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper font {
            color: inherit;
            white-space: inherit;
            position: unset;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper &gt;

        br {
            display: none;
        }

        [imt-state="translation"] .immersive-translate-target-translation-block-wrapper {
            margin: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper {
            margin: 8px 0 !important;
            display: inline-block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            display: block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            margin-top: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pdf-block-wrapper {
            margin: 0 !important;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-grey-inner {
            color: var(--immersive-translate-theme-grey-textColor);
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-underline-inner {
            border-bottom: 1px solid var(--immersive-translate-theme-underline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeUnderline-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeUnderline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDashed-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDashed-borderColor) !important;
            text-decoration-style: dashed !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-thinDashed-inner {
            border-bottom: 1px dashed var(--immersive-translate-theme-thinDashed-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dotted-inner {
            background-image: linear-gradient(to right,
                    var(--immersive-translate-theme-dotted-borderColor) 30%,
                    rgba(255, 255, 255, 0) 0%);
            background-position: bottom;
            background-size: 5px 1px;
            background-repeat: repeat-x;
            padding-bottom: 3px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDotted-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDotted-borderColor) !important;
            text-decoration-style: dotted !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-wavy-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-wavy-borderColor) !important;
            text-decoration-style: wavy !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dashed-inner {
            background: linear-gradient(to right,
                    var(--immersive-translate-theme-dashed-borderColor) 0%,
                    var(--immersive-translate-theme-dashed-borderColor) 50%,
                    transparent 50%,
                    transparent 100%) repeat-x left bottom;
            background-size: 8px 2px;
            padding-bottom: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            content: "";
            display: block;
            max-width: 80px;
            width: 10%;
            border-top: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            padding-top: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dividingLine::before {
            content: "";
            border-left: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            max-height: 16px;
            height: 16px;
            padding-left: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-highlight-inner {
            background: var(--immersive-translate-theme-highlight-backgroundColor);
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-marker {
            line-height: 1.5em;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker2-inner {
            font-weight: bold;
            text-shadow: 10px 0px 3px var(--immersive-translate-theme-marker2-backgroundColor),
                16px 3px 9px var(--immersive-translate-theme-marker2-backgroundColor),
                2px 0px 6px var(--immersive-translate-theme-marker2-backgroundColor),
                -12px 0px 12px var(--immersive-translate-theme-marker2-backgroundColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker-inner {
            /* TODO: add more texture */
            background: linear-gradient(to right,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.1),
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 3%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 35%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 70%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.8) 95%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.3));
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-weakening {
            opacity: 0.618 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-italic {
            font-style: italic !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-bold {
            font-weight: bold !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-paper {
            margin: 8px 0;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
            padding: 16px 32px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-blockquote {
            border-left: 4px solid var(--immersive-translate-theme-blockquote-borderColor) !important;
            padding-left: 12px !important;
            margin-top: 4px;
            margin-bottom: 4px;
            padding-top: 4px;
            padding-bottom: 4px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-mask-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        /* opacity theme start */

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner,
        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: none !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        /* opacity theme end */

        /* background theme start */
        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-background {
            margin: 8px 0;
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            border-radius: 4px;
            box-shadow: unset !important;
            padding: 12px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-background-inner {
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            padding-left: 6px;
            padding-right: 6px;
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper .immersive-translate-target-translation-theme-background-inner {
            background: unset;
            padding-left: unset;
            padding-right: unset;
        }

        /* background theme end */

        /* vertical css , please remain it in the last one. */
        .immersive-translate-target-translation-vertical-block-wrapper {
            margin: 0px 8px !important;
        }

        .immersive-translate-text {
            font-size: 15px !important;
        }

        .immersive-translate-error-toast {
            position: fixed;
            top: 5%;
            z-index: 99999999;
            left: 0;
            right: 0;
            margin: auto;
            max-width: 300px;
            padding: 16px;
            border-radius: 12px;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        @media all and (min-width: 750px) {
            .immersive-translate-error-toast {
                max-width: 400px;
            }
        }

        .immersive-translate-clickable-button {
            cursor: pointer;
        }

        .immersive-translate-help-button {
            cursor: pointer;
        }

        .immersive-translate-loading-text:before {
            content: "...";
        }

        /* dark mode for loading */

        @media only screen and (prefers-color-scheme: dark) {
            .immersive-translate-loading {
                border: 2px rgba(255, 255, 255, 0.25) solid !important;
                border-top: 2px rgba(255, 255, 255, 1) solid !important;
            }
        }

        .immersive-translate-error-wrapper {
            position: relative;
            display: inline-flex;
            padding: 6px;
            margin: 0 12px;
            white-space: nowrap;
            font-size: 0.9em;
        }

        [lang="zh-CN"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        [lang="zh-TW"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        .immersive-translate-tooltip {
            position: relative;
            display: inline-flex;
            /* little indicater to indicate it's hoverable */
        }

        .immersive-translate-tooltip-content {
            /* here's the magic */
            position: absolute;
            z-index: 100000000000;

            left: 50%;
            bottom: 0;
            transform: translate(-50%, 110%);
            line-height: 1;
            /* and add a small left margin */

            /* basic styles */
            width: max-content;
            max-width: 250px;
            word-wrap: break-word;
            white-space: pre-line;
            padding: 10px;
            border-radius: 10px;
            background: #000c;
            color: #fff;
            text-align: center;
            font-size: 14px;
            display: none;
            /* hide by default */
        }

        .immersive-translate-tooltip:hover .immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip:hover+.immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip-content-table {
            left: unset !important;
            bottom: unset !important;
            transform: translate(-10%, 50%) !important;
        }

        .immersive-translate-tooltip:hover:before {
            display: inline-block;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--bg-2, #fff);
            font-size: 14px;
        }
    </style>
    <style data-id="immersive-translate-user-custom-style">
        :root {

            .immersive-translate-target-inner {
                font-family: inherit;
            }


            .immersive-translate-target-inner {
                font-family: inherit;
            }
        }
    </style>
    <style data-id="immersive-translate-dynamic-injected-css">
        .immersive-translate-target-wrapper[dir='rtl'] {
            text-align: right;
        }

        .immersive-translate-target-wrapper[dir='rtl'] [data-immersive-translate-class-bak*='block-wrapper'] {
            display: block;
        }

        .immersive-translate-target-wrapper {
            word-break: break-word;
            user-select: text;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper[dir='rtl'] {
            display: inline-block;
        }

        [dir='rtl'] .immersive-translate-target-wrapper:not([dir]) {
            text-align: left;
        }

        [imt-state=dual] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            display: block;
        }

        [imt-trans-position=before] .immersive-translate-target-translation-block-wrapper {
            display: block !important;
        }

        [imt-state][data-immersive-translate_rtl] .immersive-translate-target-wrapper {
            display: block !important;
        }
    </style>
</head>

<body epub:type="bodymatter" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
    <section aria-labelledby="c25_1" epub:type="chapter" role="doc-chapter"
        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
        <header data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
            <h1 id="c25_1" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1"><span aria-label="714" epub:type="pagebreak" id="Page_714"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span><span id="c25"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span><span
                    class="chapterNumber"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">25</span><br /><span
                    class="chapterTitle"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Services</span></h1>
        </header>
        <section aria-label="chapter opening" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
            <span id="c25-sec-0001" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <aside data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                <div class="top hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <h3 data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                        data-immersive-translate-paragraph="1">WHAT'S IN THIS CHAPTER?<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章包含什么内容？</font>
                            </font>
                        </font>
                    </h3>
                    <ul class="check2" id="c25-list-0001"
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <li id="c25-li-0001" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1">Overview of the ASP.NET Core web API<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">ASP.NET Core Web API 概述
                                    </font>
                                </font>
                            </font>
                        </li>
                        <li id="c25-li-0002" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1">Creating web API controllers<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">创建 Web API 控制器</font>
                                </font>
                            </font>
                        </li>
                        <li id="c25-li-0003" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1">Creating .NET clients calling REST APIs<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">创建调用 REST API 的 .NET 客户端
                                    </font>
                                </font>
                            </font>
                        </li>
                        <li id="c25-li-0004" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1">Using Entity Framework Core with services<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用 Entity Framework Core
                                        与服务</font>
                                </font>
                            </font>
                        </li>
                        <li id="c25-li-0005" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1">Handling authorization and authentication with REST
                            Services<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用 REST 服务处理授权和认证</font>
                                </font>
                            </font>
                        </li>
                        <li id="c25-li-0006" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1">Creating gRPC services and clients<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">创建 gRPC 服务和客户端</font>
                                </font>
                            </font>
                        </li>
                        <li id="c25-li-0007" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1">Streaming with gRPC<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用 gRPC 进行流式传输</font>
                                </font>
                            </font>
                        </li>
                        <li id="c25-li-0008" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1">Implementing Azure functions<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">实现 Azure 函数</font>
                                </font>
                            </font>
                        </li>
                    </ul>
                    <div class="bottom hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <hr />
                    </div>
                </section>
            </aside>
            <aside data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                <div class="top hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span
                        id="c25-fea-0001" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                    <h3 id="head-2-228" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                        data-immersive-translate-paragraph="1">CODE DOWNLOADS FOR THIS CHAPTER<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章代码下载</font>
                            </font>
                        </font>
                    </h3>
                    <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span
                            id="c25-sec-0003"
                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                        <p id="c25-para-0003" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1">The source code for this chapter is available on the
                            book page at <code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="http://www.wiley.com">www.wiley.com</a></code>.
                            Click the Downloads link. The code can also be found at <code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                            in the directory <code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">3_Web/Services</code>.
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的源代码可在书籍页面 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="http://www.wiley.com">www.wiley.com</a></code>
                                        上找到。点击下载链接。代码也可以在目录 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">3_Web/Services</code>
                                        中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                                        找到。</font>
                                </font>
                            </font>
                        </p>
                        <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1">The code for this chapter is divided into the
                            following major examples:<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的代码分为以下主要示例：</font>
                                </font>
                            </font>
                        </p>
                        <ul class="check" id="c25-list-0002"
                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <li id="c25-li-0009" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">BooksApi</li>
                            <li id="c25-li-0010" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">BooksData</li>
                            <li id="c25-li-0011" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">BooksDataAndAuthentication</li>
                            <li id="c25-li-0012" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">GRPC</li>
                            <li id="c25-li-0013" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">AzureFunctions</li>
                        </ul>
                        <p id="c25-para-0005" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1">All the sample projects have <i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">nullable
                                reference types</i> enabled.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">所有示例项目都已启用可空引用类型。</font>
                                </font>
                            </font>
                        </p>
                    </section>
                    <div class="bottom hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <hr />
                    </div>
                </section>
            </aside>
        </section> <span aria-label="715" epub:type="pagebreak" id="Page_715" role="doc-pagebreak"
            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
        <section aria-labelledby="head-2-229" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
            <span id="c25-sec-0004" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <h2 id="head-2-229" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">UNDERSTANDING TODAY'S SERVICES<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">理解今天的这些服务</font>
                    </font>
                </font>
            </h2>
            <p id="c25-para-0006" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">Once upon a time, Windows Communication Foundation (WCF) tried to
                offer all functionality needed by services. You could create services returning XML or binary data,
                asynchronous communication was offered by message queuing, and UDP could be used as well, and it was all
                based on SOAP standards. Everything was possible, and you could configure every option. The issue with
                that situation was that even seemingly simple scenarios often became quite complex.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">从前，Windows Communication Foundation
                            (WCF) 尝试提供所有服务所需的功能。你可以创建返回 XML 或二进制数据的服务，消息队列提供异步通信，UDP 也可以使用，而且这一切都基于 SOAP
                            标准。一切皆有可能，你可以配置所有选项。但这种情况的问题是，即使是看似简单的场景也常常变得相当复杂。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">Today, we are back to many different options. Microservices can
                be implemented with different technologies. You can use a request/reply pattern or a disconnected
                scenario to send messages to a queue and process the job asynchronously. Microservices can communicate
                via JSON serialization or can send messages in a binary format. There are many options you can choose
                from, and many options are covered here and in following chapters:<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            如今，我们回到了许多不同的选项。微服务可以用不同的技术实现。你可以使用请求/回复模式或断开连接的场景将消息发送到队列并异步处理工作。微服务可以通过 JSON
                            序列化通信，或者以二进制格式发送消息。你可以选择许多选项，许多选项都在这里和接下来的章节中涵盖：</font>
                    </font>
                </font>
            </p>
            <ul class="check" id="c25-list-0003" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                <li id="c25-li-0014" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Web APIs with ASP.NET Core can be used to implement a
                    request/reply programming model based on the Representational State Transfer (REST) guidelines.
                    Usually, JSON data is passed and returned, but you can pass other data as well—for example, a PNG
                    image or XML data.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 ASP.NET Core 的 Web API
                                可以基于表示状态转移 (REST) 指南实现请求/回复编程模型。通常传递和返回的是 JSON 数据，但你也可以传递其他数据，例如 PNG 图像或 XML 数据。</font>
                        </font>
                    </font>
                </li>
                <li id="c25-li-0015" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">gRPC Remote Procedure Calls (gRPC) was initially developed by
                    Google and is a platform-independent technology that allows for binary communication based on
                    HTTP/2. ASP.NET Core has built-in support for gRPC.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">gRPC 远程过程调用（gRPC）最初由 Google
                                开发，是一种平台无关的技术，基于 HTTP/2 进行二进制通信。ASP.NET Core 内置了对 gRPC 的支持。</font>
                        </font>
                    </font>
                </li>
                <li id="c25-li-0016" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Azure Functions give you a consumption-based offering where
                    you pay only for the seconds you need CPU and memory. You can create a REST API with this technology
                    as well, but you also can create functions that are triggered on events other than HTTP requests.
                    The function can be started when messages arrive in a queue, when data is written to an Azure Cosmos
                    DB, or when an event is published to an Azure Event Grid.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">Azure Functions
                                为你提供基于消费的模式，你只需为你需要的 CPU 和内存时间付费。你也可以使用这项技术创建 REST API，但还可以创建在 HTTP
                                请求以外的其他事件上触发的函数。当消息到达队列、数据写入 Azure Cosmos DB 或事件发布到 Azure Event Grid 时，函数都可以被启动。</font>
                        </font>
                    </font>
                </li>
                <li id="c25-li-0017" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">SignalR gives an abstraction layer to WebSockets (but also
                    works if WebSockets is not available) and offers communication from the server to the client, which
                    is great for communication with a group of clients.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">SignalR 为 WebSockets 提供抽象层（即使
                                WebSockets 不可用也有效），并提供从服务器到客户端的通信，这对于与一组客户端进行通信非常理想。</font>
                        </font>
                    </font>
                </li>
            </ul>
            <p id="c25-para-0008" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">SignalR is covered in <a href="c28.xhtml"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter 28</a>, “SignalR.”
                All the other technologies mentioned are covered in this chapter.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">SignalR 在“SignalR”第 28
                            章中介绍。所有其他提到过的技术都在本章中介绍。</font>
                    </font>
                </font>
            </p>
        </section>
        <section aria-labelledby="head-2-230" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
            <span id="c25-sec-0005" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <h2 id="head-2-230" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">REST SERVICES WITH ASP.NET CORE<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用 ASP.NET CORE 的 REST 服务</font>
                    </font>
                </font>
            </h2>
            <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">REST is not a standard; it's a guideline. This guideline was
                defined by Roy Fielding in his 2000 PhD dissertation “Architectural Styles and the Design of
                Network-based Software Architectures” (<code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf">https://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf</a></code>).
                REST is based on these principles:<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">REST 不是一个标准，而是一份指南。这份指南由 Roy Fielding
                            在其 2000 年的博士论文《建筑风格与基于网络的软件架构设计》（ <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf">https://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf</a></code>
                            ）中定义。REST 基于以下原则：</font>
                    </font>
                </font>
            </p>
            <ul class="check" id="c25-list-0004" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                <li id="c25-li-0018" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Client-server architecture<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">客户端-服务器架构</font>
                        </font>
                    </font>
                </li>
                <li id="c25-li-0019" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Stateless communication, which allows for easy scaling of
                    services<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">无状态通信，这允许轻松扩展服务</font>
                        </font>
                    </font>
                </li>
                <li id="c25-li-0020" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Cacheable data so the client can keep data without the need
                    to request it again<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">可缓存的元数据，以便客户端可以保留数据而无需再次请求</font>
                        </font>
                    </font>
                </li>
                <li id="c25-li-0021" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">A uniform interface to access resources<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">统一的接口来访问资源</font>
                        </font>
                    </font>
                </li>
                <li id="c25-li-0022" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">A layered system that doesn't allow you to see beyond the
                    immediate layer where the communication is taking place<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">分层的系统，不允许你看到正在进行的通信层之外的层</font>
                        </font>
                    </font>
                </li>
                <li id="c25-li-0023" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Code on demand (optional), which allows you to download code
                    that the client can use with the received data<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">按需加载代码（可选），允许你下载客户端可以使用的数据的代码
                            </font>
                        </font>
                    </font>
                </li>
            </ul>
            <p id="c25-para-0010" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">The uniform interface is central to the REST guidelines and
                covers resources that can be identified (for example, by using a URI), manipulation of resources is
                possible with representations (for example, JSON, XML), messages are self-describing, and a key concept
                is hypermedia as the engine of application state (HATEOAS). With <span aria-label="716"
                    epub:type="pagebreak" id="Page_716" role="doc-pagebreak"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>HATEOAS, information
                about what to do with a resource is returned with a response—for example, different links for
                deposit/withdraw/transfer/close on a balance.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">REST 原则的核心在于统一接口，它涵盖了可识别的资源（例如通过 URI
                            识别）、使用表示（如 JSON、XML）进行资源操作、消息自描述性，以及一个关键概念——超媒体作为应用状态引擎（HATEOAS）。通过
                            HATEOAS，关于如何处理资源的操作信息会随响应返回——例如，在余额上提供存款/取款/转账/关闭的不同链接。</font>
                    </font>
                </font>
            </p>
            <p id="c25-para-0011" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">Not all services require all REST principles; that's why Leonard
                Richardson defined different REST levels (<code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://www.martinfowler.com/articles/richardsonMaturityModel.html">https://www.martinfowler.com/articles/richardsonMaturityModel.html</a></code>).
                Only REST level 3 supports all the guidelines, including HATEOAS. REST level 2 defines that a service
                supports different HTTP verbs (such as GET to read resources and POST to create new resources) and HTTP
                return codes (such as 201 for created). Microsoft Azure defines a level 2 REST API to create/update/read
                resources, such as resource groups, storage accounts, app services, and a lot more.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">并非所有服务都需要遵循所有 REST 原则；这就是 Leonard
                            Richardson 定义不同 REST 级别（ <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://www.martinfowler.com/articles/richardsonMaturityModel.html">https://www.martinfowler.com/articles/richardsonMaturityModel.html</a></code>
                            ）的原因。只有 REST 级别 3 支持所有这些指南，包括 HATEOAS。REST 级别 2 定义了服务支持不同的 HTTP 动词（如用 GET 读取资源和用 POST
                            创建新资源）以及 HTTP 返回代码（如 201 表示已创建）。Microsoft Azure 定义了一个级别 2 的 REST
                            API，用于创建/更新/读取资源，如资源组、存储账户、应用服务等，等等。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">Let's start with creating a web API using ASP.NET Core by using
                the following command:<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">让我们从使用以下命令开始，通过 ASP.NET Core 创建一个 Web
                            API：</font>
                    </font>
                </font>
            </p>
            <pre id="c25-code-0001"><code>&gt; dotnet new webapi -o BooksAPI</code></pre>
            <p id="c25-para-0013" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">With .NET 5, this template creates a new project with an API
                implementing a weather forecast service based on random values (isn't there some randomness with
                published weather forecast information?). With the sample code, you'll get rid of the weather forecast
                and instead implement a service to create and read information about book chapters. Using a database and
                authorization will be addressed in later sections.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用 .NET
                            5，此模板创建一个新项目，该项目包含一个实现基于随机值（难道发布的天气预报信息中就没有一些随机性吗？）的天气预报服务
                            API。通过示例代码，您将摆脱天气预报，而是实现一个创建和读取书籍章节信息的服务的功能。使用数据库和授权将在后续章节中讨论。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0006"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-470" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Defining a Model <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">定义模型 </font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">First, you need a type that represents the data to return and
                    change. To allow using the model both from the client and from the server, create a .NET 5 library
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Shared</code>
                    that contains the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code> record
                    (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/Books.Shared/BookChapter.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                首先，您需要一个表示要返回和更改的数据的类型。为了允许从客户端和服务器端同时使用模型，创建一个包含 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code>
                                记录的 .NET 5 库 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Shared</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/Books.Shared/BookChapter.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0002"><code>using System;</code>
<code> </code>
<code>namespace Books.Models</code>
<code>{</code>
<code>  public record BookChapter(Guid Id, int Number, string Title, int PageCount);</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0007"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-471" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Creating a Service <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建服务</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Next, you create a service interface and class offering the
                    functionality. The methods offered by the service are defined with the interface <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>—methods
                    to retrieve, add, and update book chapters. The methods are defined asynchronously to allow for
                    different implementations—for example, an implementation that calls another service (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Services/IBookChapterService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">接下来，你创建一个提供服务接口和类，提供相应功能。服务提供的接口方法
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>
                                定义了获取、添加和更新书籍章节的方法。这些方法定义为异步，以允许不同的实现方式——例如，一个调用其他服务的实现（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Services/IBookChapterService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0003"><code>public interface IBookChapterService</code>
<code>{</code>
<code>  Task AddAsync(BookChapter chapter);</code>
<code>  Task AddRangeAsync(IEnumerable&lt;BookChapter&gt; chapters);</code>
<code>  Task&lt;IEnumerable&lt;BookChapter&gt;&gt; GetAllAsync();</code>
<code>  Task&lt;BookChapter?&gt; FindAsync(Guid id);</code>
<code>  Task&lt;BookChapter?&gt; RemoveAsync(Guid id);</code>
<code>  Task&lt;BookChapter?&gt; UpdateAsync(BookChapter chapter);</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The implementation of the service is defined by the class
                    <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapterService</code>.
                    The book chapters are kept in a collection class. Because multiple tasks from different client
                    requests can access the collection concurrently, the type <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ConcurrentDictionary</code>
                    is used for the book chapters. This class is thread safe. The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Add</code>, <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Remove</code>, and <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Update</code> methods
                    make use of the collection to add, remove, and update book chapters (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Services/BookChaptersService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">服务的实现由类 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapterService</code>
                                定义。书籍章节保存在一个集合类中。由于来自不同客户端请求的多个任务可以同时访问该集合，因此使用类型 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ConcurrentDictionary</code>
                                来表示书籍章节。该类是线程安全的。方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Add</code> 、
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Remove</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Update</code>
                                利用该集合来添加、删除和更新书籍章节（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Services/BookChaptersService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0004"><code>public class BookChapterService : IBookChapterService</code>
<code>{<span aria-label="717" epub:type="pagebreak" id="Page_717" role="doc-pagebreak"></span></code>
<code>  private readonly ConcurrentDictionary&lt;Guid, BookChapter&gt; _chapters = new();</code>
<code> </code>
<code>  private BookChapter GetInitializedId(BookChapter chapter)</code>
<code>  {</code>
<code>    if (chapter.Id == Guid.Empty)</code>
<code>    {</code>
<code>      chapter = chapter with { Id = Guid.NewGuid() };</code>
<code>    }</code>
<code>    return chapter;</code>
<code>  }</code>
<code> </code>
<code>  public Task AddAsync(BookChapter chapter)</code>
<code>  {</code>
<code>    chapter = GetInitializedId(chapter);</code>
<code>    _chapters[chapter.Id] = chapter;</code>
<code>    return Task.CompletedTask;</code>
<code>  }</code>
<code> </code>
<code>  public Task AddRangeAsync(IEnumerable&lt;BookChapter&gt; chapters)</code>
<code>  {</code>
<code>    foreach (var c in chapters)</code>
<code>    {</code>
<code>      var chapter = GetInitializedId(c);</code>
<code>      _chapters[chapter.Id] = chapter;</code>
<code>    }</code>
<code>    return Task.CompletedTask;</code>
<code>  }</code>
<code> </code>
<code>  public Task&lt;BookChapter?&gt; FindAsync(Guid id)</code>
<code>  {</code>
<code>    _chapters.TryGetValue(id, out BookChapter? chapter);</code>
<code>    return Task.FromResult(chapter);</code>
<code>  }</code>
<code> </code>
<code>  public Task&lt;IEnumerable&lt;BookChapter&gt;&gt; GetAllAsync() =&gt;</code>
<code>    Task.FromResult&lt;IEnumerable&lt;BookChapter&gt;&gt;(_chapters.Values);</code>
<code> </code>
<code>  public Task&lt;BookChapter?&gt; RemoveAsync(Guid id)</code>
<code>  {</code>
<code>    _chapters.TryRemove(id, out BookChapter? removed);</code>
<code>    return Task.FromResult(removed);</code>
<code>  }</code>
<code> </code>
<code>  public async Task&lt;BookChapter?&gt; UpdateAsync(BookChapter chapter)</code>
<code>  {</code>
<code>    var existingChapter = await FindAsync(chapter.Id);</code>
<code>    if (existingChapter is null) return null;</code>
<code>    _chapters[chapter.Id] = chapter;</code>
<code>    return chapter;</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">So that some sample chapters are available when you first
                    access the service, the class <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SampleChapters</code>
                    fills the book chapter service with chapter information (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Services/SampleChapters.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了让您在首次访问服务时能有一些示例章节可用，类 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SampleChapters</code>
                                用章节信息填充了书籍章节服务（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Services/SampleChapters.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0005"><code>public class SampleChapters</code>
<code>{<span aria-label="718" epub:type="pagebreak" id="Page_718" role="doc-pagebreak"></span></code>
<code>  private readonly IBookChapterService _bookChaptersService;</code>
<code>  public SampleChapters(IBookChapterService bookChapterService) =&gt; </code>
<code>    _bookChaptersService = bookChapterService;</code>
<code> </code>
<code>  private string[] _sampleTitles = new[]</code>
<code>  {</code>
<code>    ".NET Application Architectures",</code>
<code>    "Core C#",</code>
<code>    "Classes, Structs, Tuples, and Records",</code>
<code>    "Object-Oriented Programming with C#",</code>
<code>    "Operators and Casts",</code>
<code>    "Arrays",</code>
<code>    "Delegates, Lambdas, and Events",</code>
<code>    "Collections",</code>
<code>    "ADO.NET and Transactions"</code>
<code>  };</code>
<code> </code>
<code>  private int[] _chapterNumbers = { 1, 2, 3, 4, 5, 6, 7, 8, 25 };</code>
<code> </code>
<code>  private int[] _pageCounts = { 35, 42, 33, 20, 24, 38, 20, 32, 44 };</code>
<code> </code>
<code>  public void CreateSampleChapters()</code>
<code>  {</code>
<code>    List&lt;BookChapter&gt; chapters = new();</code>
<code>    for (int i = 0; i &lt; 8; i++)</code>
<code>    {</code>
<code>      chapters.Add(new BookChapter(Guid.NewGuid(), _chapterNumbers[i], </code>
<code>        _sampleTitles[i], _pageCounts[i]));</code>
<code>    }</code>
<code>    _bookChaptersService.AddRangeAsync(chapters);</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Let's get into the configuration of the DI container, which
                    is shown with the following code snippet. From the ASP.NET Core web API template used, you can see
                    the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddControllers</code>
                    extension method. This method registers several services to be used with API controllers, such as
                    route handlers, pipeline filters, result handlers, and more. With the .NET 5 template, <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddSwaggerGen</code> is
                    invoked as well. This method is defined in the NuGet package <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Swashbuckle.AspNetCore</code>,
                    which implements the OpenAPI standard (originally known as Swagger) to generate a description for
                    the API services in the project. The description can be used to automatically create code for the
                    client. With Swashbuckle, a website is generated where you can test the API. (See <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://openapis.org">https://openapis.org</a></code>
                    for more information on this standard.) The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapterService</code>
                    and <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SampleChapters</code>
                    classes also are registered with the DI container, which allows the DI container to inject these
                    types. <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapterService</code>
                    is declared to be injected as singleton, which should keep state between invocations (code file
                    <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">让我们来看看依赖注入容器的配置，如下面的代码片段所示。从使用的
                                ASP.NET Core Web API 模板中，您可以看到 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddControllers</code>
                                扩展方法。此方法注册了多个用于 API 控制器的服务，例如路由处理器、管道过滤器、结果处理器等。在 .NET 5 模板中， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddSwaggerGen</code>
                                也被调用。该方法定义在 NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Swashbuckle.AspNetCore</code>
                                中，该包实现了 OpenAPI 标准（最初称为 Swagger），用于为项目中的 API 服务生成描述。该描述可用于自动为客户端创建代码。使用
                                Swashbuckle，会生成一个网站，您可以在其中测试 API。（有关此标准的更多信息，请参见 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://openapis.org">https://openapis.org</a></code>
                                。）类 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapterService</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SampleChapters</code>
                                也注册到了依赖注入容器中，这允许依赖注入容器注入这些类型。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapterService</code>
                                被声明为单例，这应该能在调用之间保持状态（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Startup.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0006"><code>public class Startup</code>
<code>{</code>
<code>  public Startup(IConfiguration configuration) =&gt; Configuration = configuration;</code>
<code> </code>
<code>  public IConfiguration Configuration { get; }</code>
<code> </code>
<code>  public void ConfigureServices(IServiceCollection services)</code>
<code>  {</code>
<code>    <b>services.AddControllers();</b></code>
<code>    <b>services.AddSwaggerGen(c =&gt;</b></code>
<code>    <b>{</b></code>
<code>      <b>c.SwaggerDoc("v3", new OpenApiInfo { Title = "BooksApi", Version = "v3" });</b><span aria-label="719" epub:type="pagebreak" id="Page_719" role="doc-pagebreak"></span></code>
<code>    <b>});</b></code>
<code> </code>
<code>    <b>services.AddSingleton&lt;IBookChapterService, BookChapterService&gt;();</b></code>
<code>    <b>services.AddScoped&lt;SampleChapters&gt;();</b></code>
<code>  }</code>
<code>  //…</code>
<code>}</code>
<code> </code></pre>
                <aside data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <div class="top hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <p id="c25-para-0020" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NOTE</b> <i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">If you add C#
                                documentation to the methods of the API (C# documentation is covered in <a
                                    href="c02.xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter
                                    2</a>, “Core C#”), after creating a documentation file, you can add this
                                documentation to the OpenAPI description by invoking the method </i> <code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IncludeXmlComments</code>
                            <i data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> with the options
                                of </i> <code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddSwaggerGen</code>
                            <i data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 如果你向 API 的方法添加
                                        C#文档（C#文档在第二章“核心 C#”中有介绍），在创建文档文件后，可以通过调用方法 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IncludeXmlComments</code>
                                        并使用选项 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddSwaggerGen</code>
                                        将此文档添加到 OpenAPI 描述中。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The middleware is configured in the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Configure</code> method.
                    If the application is running in the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Development</code>
                    environment, OpenAPI information is shown by invoking the methods <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UseSwagger</code> and
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UseSwaggerUI</code> to
                    configure the middleware for the OpenAPI definition and HTML page. In case you want other developers
                    to use your API when the application is running in production, you can move these methods outside of
                    the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IsDevelopment</code>
                    check to invoke it from all environments. Showing exceptions on the client (<code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UseDeveloperExceptionPage</code>)
                    should only ever be used in the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Development</code>
                    environment. With the endpoint routing configuration, <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">MapControllers</code> is
                    invoked to allow for attribute-based routing for the API controllers, as is shown in the next
                    section. To fill the sample chapters, a route to <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">/init</code> is also
                    defined, which uses an instance of the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SampleChapters</code>
                    class to fill the chapter service with sample chapters (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">中间件在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Configure</code>
                                方法中配置。如果应用程序在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Development</code>
                                环境中运行，通过调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UseSwagger</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UseSwaggerUI</code>
                                来配置 OpenAPI 定义和 HTML 页面的中间件，即可显示 OpenAPI 信息。如果你希望在应用程序处于生产环境时让其他开发者使用你的 API，可以将这些方法移出
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IsDevelopment</code>
                                检查，以便在所有环境中调用。仅在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Development</code>
                                环境中使用客户端显示异常（ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UseDeveloperExceptionPage</code>
                                ）。通过端点路由配置，调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">MapControllers</code>
                                以允许 API 控制器进行基于属性的路由，如下一节所示。为了填充示例章节，还定义了一个路由到 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">/init</code>
                                ，它使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SampleChapters</code>
                                类的实例来用示例章节填充章节服务（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Startup.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0007"><code>public void Configure(IApplicationBuilder app, IWebHostEnvironment env)</code>
<code>{</code>
<code>  if (env.IsDevelopment())</code>
<code>  {</code>
<code>    app.UseDeveloperExceptionPage();</code>
<code>    <b>app.UseSwagger();</b></code>
<code>    <b>app.UseSwaggerUI(c =&gt; c.SwaggerEndpoint("/swagger/v3/swagger.json", "BooksApi v3"));</b></code>
<code>  }</code>
<code> </code>
<code>  app.UseHttpsRedirection();</code>
<code> </code>
<code>  app.UseRouting();</code>
<code> </code>
<code>  app.UseAuthorization();</code>
<code> </code>
<code>  app.UseEndpoints(endpoints =&gt;</code>
<code>  {</code>
<code>    <b>endpoints.MapControllers();</b></code>
<code> </code>
<code>    <b>endpoints.MapGet("/init", async context =&gt;</b></code>
<code>    <b>{</b></code>
<code>      <b>var sampleChapters = context.RequestServices.GetRequiredService&lt;SampleChapters&gt;();</b></code>
<code>      <b>sampleChapters.CreateSampleChapters();</b></code>
<code>      <b>await context.Response.WriteAsync("sample chapters initialized");</b></code>
<code>    <b>});</b></code>
<code>  });</code>
<code>}</code></pre>
            </section> <span aria-label="720" epub:type="pagebreak" id="Page_720" role="doc-pagebreak"
                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0009"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-472" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Creating a Controller <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建控制器</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChaptersController</code>
                    class that implements an API controller is shown in the next code snippet. A controller that's
                    routed from the endpoint routing is a class with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Controller</code>
                    postfix. Optionally, a controller class can derive from the base class <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ControllerBase</code>.
                    The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ControllerBase</code>
                    class offers some practical methods and properties, such as the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpContext</code>, <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Request</code>, and <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Response</code>. These
                    properties are used to access the HTTP request and response as shown in the previous chapter. The
                    base class also offers methods that can be used to directly return a result. The route to the
                    controller is defined with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Route</code> attribute.
                    The route starts with <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">api</code> followed by
                    the name of the controller—which is the name of the controller class without the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Controller</code>
                    postfix. The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Produces</code> and <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ApiController</code>
                    attributes are of practical use for the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">OpenApi</code>
                    definition. The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Produces</code> attribute
                    gives information about the type of data returned from the controller. The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ApiController</code>
                    attribute defines some default behavior typical with API services. For example, with action method
                    parameters, you don't need to specify the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">FromBody</code> attribute
                    because it is now a default (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Controllers/BookChaptersController.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">实现 API 控制器的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChaptersController</code>
                                类在下一代码片段中显示。从端点路由派生的控制器是一个带有 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Controller</code>
                                后缀的类。控制器类可以选择从基础类 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ControllerBase</code>
                                继承。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ControllerBase</code>
                                类提供了一些实用方法和属性，例如 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpContext</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Request</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Response</code>
                                。这些属性用于访问 HTTP 请求和响应，如前一章节所示。基础类还提供了可以直接返回结果的方法。控制器的路由通过 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Route</code>
                                属性定义。路由以 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">api</code>
                                开头，后跟控制器名称——即不带 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Controller</code>
                                后缀的控制器类名。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Produces</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ApiController</code>
                                属性对于 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">OpenApi</code>
                                定义很有用。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Produces</code>
                                属性提供了关于控制器返回数据类型的信息。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ApiController</code>
                                属性定义了一些典型的 API 服务默认行为。例如，对于动作方法参数，您不需要指定 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">FromBody</code>
                                属性，因为它现在是默认的（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Controllers/BookChaptersController.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0008"><code>[Produces("application/json")]</code>
<code>[Route("api/[controller]")]</code>
<code>[ApiController]</code>
<code>public class BookChaptersController : ControllerBase</code>
<code>{</code>
<code>  private readonly IBookChapterService _chapterService;</code>
<code> </code>
<code>  public BookChaptersController(IBookChapterService chapterService) =&gt; </code>
<code>    _chapterService = chapterService;</code>
<code>  //…</code>
<code>}</code>
<code> </code></pre>
                <aside data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <div class="top hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <p id="c25-para-0024" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NOTE</b> <i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">With an ASP.NET
                                Core API controller, by default JSON information is returned. If you want to return XML,
                                you must add an XML serializer to the DI container with the </i> <code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IMvcBuilder</code>
                            <i data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> fluent API using
                                the </i> <code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddXmlSerializerFormatter</code>
                            <i data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> method. You also
                                must add the </i> <code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Produces</code>
                            <i data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> attribute that
                                the controller produces </i> <code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">application/xml</code>
                            <i data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">. This serializer
                                requires a parameterless constructor; thus, a nominal record cannot be used in such a
                                scenario. From the client application, you need to specify the accept header
                                accordingly.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：使用 ASP.NET Core API
                                        控制器时，默认返回 JSON 信息。若要返回 XML，必须使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IMvcBuilder</code>
                                        方法通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddXmlSerializerFormatter</code>
                                        fluent API 将 XML 序列化器添加到依赖注入容器中，同时还需要添加 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Produces</code>
                                        属性，表明控制器生成 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">application/xml</code>
                                        。该序列化器需要一个无参构造函数；因此，在这种情况下不能使用命名记录。从客户端应用程序，需要相应地指定 accept 头部。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Using the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpGet</code> attribute
                    with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapters</code>
                    method maps the HTTP GET request with the route specified with the controller class. The method
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetAllAsync</code> from
                    the injected service returns <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Task&lt;IEnumerable&lt;BookChapter&gt;&gt;</code>
                    that's directly returned from this action method. The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ProducesResponseType</code>
                    attribute specifies the HTTP status codes returned from an action method. This information is used
                    by the OpenAPI description (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Controllers/BookChaptersController.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpGet</code>
                                属性与 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapters</code>
                                方法将 HTTP GET 请求映射到控制器类中指定的路由。注入服务中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetAllAsync</code>
                                方法返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Task&lt;IEnumerable&lt;BookChapter&gt;&gt;</code>
                                ，该值直接来自此动作方法。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ProducesResponseType</code>
                                属性指定了动作方法返回的 HTTP 状态码。这些信息被 OpenAPI 描述（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Controllers/BookChaptersController.cs</code>
                                ）使用：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0009"><code>// GET api/bookchapters</code>
<code>[ProducesResponseType(StatusCodes.Status200OK)]</code>
<code>[HttpGet]</code>
<code>public Task&lt;IEnumerable&lt;BookChapter&gt;&gt; GetBookChapters() =&gt; </code>
<code> _chapterService.GetAllAsync();</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">To not return the complete list of books, you can specify a
                    parameter with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapters</code>
                    method similar to the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapterById</code>
                    method shown in the next code snippet. This method returns a single chapter based on the received
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Guid</code> parameter.
                    From the URL path, the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpGet</code> attribute
                    specifies the same name in the route. The route specified with the action method is attached to the
                    route defined with the class. In case the chapter is not found from the service, an HTTP 404 status
                    code is returned using the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NotFound</code> method
                    from the base class. <span aria-label="721" epub:type="pagebreak" id="Page_721" role="doc-pagebreak"
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>With a success, a
                    200 status code is returned from the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Ok</code> method. The
                    method is declared to return an <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ActionResult</code>,
                    which is flexible in what to return—either the resource specified with the generic parameter (<code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code>) or
                    just the error, such as 404 (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Controllers/BookChaptersController.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">如果您不想返回完整的书籍列表，可以使用与下一个代码片段中所示的
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapterById</code>
                                方法类似的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapters</code>
                                方法指定一个参数。此方法根据接收到的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Guid</code>
                                参数返回单个章节。从 URL 路径中， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpGet</code>
                                属性指定路由中的同名。使用操作方法指定的路由附加到类中定义的路由。如果服务中找不到章节，则使用基类中的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NotFound</code>
                                方法返回 HTTP 404 状态代码。成功时，从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Ok</code>
                                方法返回 200 状态代码。该方法声明为返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ActionResult</code>
                                ，这在返回内容上很灵活—无论是泛型参数指定的资源（ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code>
                                ）还是仅错误，例如 404（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Controllers/BookChaptersController.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0010"><code>// GET api/bookchapters/guid</code>
<code>[ProducesResponseType(StatusCodes.Status200OK)]</code>
<code>[ProducesResponseType(StatusCodes.Status404NotFound)]</code>
<code>[HttpGet("{id}", Name = nameof(GetBookChapterById))]</code>
<code>public async Task&lt;ActionResult&lt;BookChapter&gt;&gt; GetBookChapterById(Guid id)</code>
<code>{</code>
<code>  BookChapter? chapter = await _chapterService.FindAsync(id);</code>
<code>  if (chapter is null)</code>
<code>  {</code>
<code>    return NotFound();</code>
<code>  }</code>
<code>  else</code>
<code>  {</code>
<code>    return Ok(chapter);</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">On adding a new book chapter, the method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">PostBookChapter</code> is
                    added. This method receives a <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code> as
                    part of the HTTP body that is assigned to the method parameter after deserialization. In case the
                    parameter chapter is <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">null</code>, a <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BadRequest</code> (HTTP
                    error 400) is returned. When adding the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code>, this
                    method returns <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">CreatedAtRoute</code>.
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">CreatedAtRoute</code>
                    returns the HTTP status 201 (Created) with the object serialized. The returned header information
                    contains a link to the resource—that is, a link to the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapterById</code>
                    with the <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">id</code> set
                    to the identifier of the newly created object (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Controllers/BookChaptersController.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">添加新章节时，会添加 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">PostBookChapter</code>
                                方法。该方法作为 HTTP 体的部分接收 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code>
                                ，并在反序列化后将之分配给方法参数。如果参数 chapter 为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">null</code>
                                ，则返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BadRequest</code>
                                （HTTP 错误 400）。添加 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code>
                                时，该方法返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">CreatedAtRoute</code>
                                。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">CreatedAtRoute</code>
                                返回 HTTP 状态 201（已创建），并包含序列化的对象。返回的头部信息包含资源链接，即 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapterById</code>
                                链接，其中 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">id</code>
                                设置为新创建对象的标识符（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Controllers/BookChaptersController.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0011"><code>// POST api/bookchapters</code>
<code>[ProducesResponseType(StatusCodes.Status400BadRequest)]</code>
<code>[ProducesResponseType(StatusCodes.Status201Created)]</code>
<code>[HttpPost]</code>
<code>public async Task&lt;ActionResult&gt; PostBookChapter(BookChapter chapter)</code>
<code>{</code>
<code>  if (chapter is null)</code>
<code>  {</code>
<code>    return BadRequest();</code>
<code>  }</code>
<code>  await _chapterService.AddAsync(chapter);</code>
<code>  return CreatedAtRoute(nameof(GetBookChapterById), new { id = chapter.Id }, chapter);</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">You update items using an HTTP PUT request. The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">PutBookChapter</code>
                    method updates an existing item from the collection. In case the object is not yet in the
                    collection, <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NotFound</code> is
                    returned. If the object is found, it is updated, and a success result 204—no content with an empty
                    body—is returned (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Controllers/BookChaptersController.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">您使用 HTTP PUT 请求更新项目。 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">PutBookChapter</code>
                                方法更新集合中的现有项目。如果对象尚未在集合中，则返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NotFound</code>
                                。如果找到对象，则更新它，并返回一个成功结果 204—无内容且正文为空（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Controllers/BookChaptersController.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0012"><code>// PUT api/bookchapters/guid</code>
<code>[ProducesResponseType(StatusCodes.Status400BadRequest)]</code>
<code>[ProducesResponseType(StatusCodes.Status404NotFound)]</code>
<code>[ProducesResponseType(StatusCodes.Status204NoContent)]</code>
<code>[HttpPut("{id}")]</code>
<code>public async Task&lt;ActionResult&gt; PutBookChapter(Guid id, BookChapter chapter)</code>
<code>{</code>
<code>  if (chapter is null || id != chapter.Id)</code>
<code>  {<span aria-label="722" epub:type="pagebreak" id="Page_722" role="doc-pagebreak"></span></code>
<code>    return BadRequest();</code>
<code>  }</code>
<code>  var existingChapter = await _chapterService.FindAsync(id);</code>
<code> </code>
<code>  var c = await _chapterService.UpdateAsync(chapter);</code>
<code>  if (c is null)</code>
<code>  {</code>
<code>    return NotFound();</code>
<code>  }</code>
<code>  else</code>
<code>  {</code>
<code>    return NoContent();</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">With the HTTP DELETE request, book chapters are simply
                    removed from the dictionary (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Controllers/BookChaptersController.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 HTTP DELETE
                                请求，书章节会从字典中简单地删除（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BooksApi/Controllers/BookChaptersController.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0013"><code>[ProducesResponseType(StatusCodes.Status200OK)]</code>
<code>[HttpDelete("{id}")]</code>
<code>public async Task&lt;ActionResult&gt; Delete(Guid id)</code>
<code>{</code>
<code>  await _chapterService.RemoveAsync(id);</code>
<code>  return Ok();</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <div class="top hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <p id="c25-para-0031" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NOTE</b> <i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">With the sample
                                code, the </i><code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Delete</code><i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> method deletes
                                the book chapter if it's in the dictionary and does nothing if it's not there. An
                                alternative version would be to return a 404 (not found) status code. The Microsoft REST
                                API guidelines (</i><code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://github.com/Microsoft/api-guidelines/blob/master/Guidelines.md">https://github.com/Microsoft/api-guidelines/blob/master/Guidelines.md</a></code><i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">) specify the
                            </i><code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">DELETE</code><i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> request to be
                                idempotent, so it should return the same result with multiple requests. With default
                                implementations from the template accessing the database, 404 is returned if the data is
                                not available. You need to decide for your scenario if you agree with the guidelines or
                                need information if the resource is not found.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 在示例代码中， <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Delete</code>
                                        方法如果书章节在字典中则删除它，如果不在则什么也不做。一个替代版本可以是返回 404（未找到）状态码。Microsoft REST API 指南（ <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://github.com/Microsoft/api-guidelines/blob/master/Guidelines.md">https://github.com/Microsoft/api-guidelines/blob/master/Guidelines.md</a></code>
                                        ）指定 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">DELETE</code>
                                        请求应该是幂等的，因此它应该用多个请求返回相同的结果。使用模板默认的数据库访问实现时，如果数据不可用则返回
                                        404。你需要根据你的场景决定是否同意指南或需要信息来确认资源未找到。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p id="c25-para-0032" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">With the controller and Swagger configuration in place, it is
                    possible to do tests from the browser. You can see the OpenAPI definition at <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://localhost:5001/swagger/v3/swagger.json">https://localhost:5001/swagger/v3/swagger.json</a></code>.
                    The Swagger graphical UI (see <a href="#c25-fig-0001" id="R_c25-fig-0001"
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Figure 25-1</a>) is shown
                    at <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://localhost:5001/swagger/index.html">https://localhost:5001/swagger/index.html</a></code>.
                    With this page, you can run tests to your API from the browser.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">控制器和 Swagger
                                配置完成后，就可以从浏览器进行测试了。你可以在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://localhost:5001/swagger/v3/swagger.json">https://localhost:5001/swagger/v3/swagger.json</a></code>
                                处查看 OpenAPI 定义。Swagger 图形界面（见图 25-1）显示在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://localhost:5001/swagger/index.html">https://localhost:5001/swagger/index.html</a></code>
                                处。通过这个页面，你可以从浏览器运行 API 测试。</font>
                        </font>
                    </font>
                </p>
            </section>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0012"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-473" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Testing REST APIs<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">测试 REST API</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">For a command-line interface, you can install the .NET tool
                    <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">microsoft.dotnet-httprepl</code>
                    (<code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://aka.ms/http-repl-doc">https://aka.ms/http-repl-doc</a></code>).
                    The downloadable sample application has this tool defined as a local tool. You can install local
                    tools with <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">dotnet tool restore</code>.
                    When you run this tool, you can connect to a running service and send get, post, and put commands.
                    Using the post command, you can submit the content of a JSON file as shown here:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">对于命令行界面，你可以安装.NET 工具 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">microsoft.dotnet-httprepl</code>
                                （ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://aka.ms/http-repl-doc">https://aka.ms/http-repl-doc</a></code>
                                ）。可下载的示例应用程序将此工具定义为本地工具。你可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">dotnet tool restore</code>
                                安装本地工具。运行此工具时，你可以连接到正在运行的服务并发送 get、post 和 put 命令。使用 post 命令，你可以提交 JSON 文件的内容，如下所示：
                            </font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0014"><code>&gt; dotnet httprepl</code>
<code>(Disconnected)&gt; connect https://localhost:5001</code>
<code>https://localhost:5001/&gt; get api/BookChapters/</code>
<code>https://localhost:5001/&gt; get api/BookChapters/ "e89837d9-4392-450c-902b-4e34fb72344c"</code>
<code>https://localhost:5001/&gt; post api/BookChapters/ -f samplechapter.json</code></pre>
            </section> <span aria-label="723" epub:type="pagebreak" id="Page_723" role="doc-pagebreak"
                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <figure data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> <img
                    alt="Snapshot shows the parameters and responses of Swagger User interface." class="center"
                    src="images/c25f001.png" />
                <figcaption data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span class="figureLabel"
                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a
                                href="#R_c25-fig-0001" id="c25-fig-0001" role="doc-backlink"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><b
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                    data-immersive-translate-paragraph="1">FIGURE 25-1<font
                                        class="notranslate immersive-translate-target-wrapper"
                                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">
                                              </font>
                                        <font
                                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                            data-immersive-translate-translation-element-mark="1">
                                            <font
                                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                data-immersive-translate-translation-element-mark="1">图 25-1</font>
                                        </font>
                                    </font></b></a></span></p>
                </figcaption>
            </figure>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0013"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-474" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">REST Results and Status Codes<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">REST 结果和状态码 </font>
                        </font>
                    </font>
                </h3>
                <p id="c25-para-0034" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The following table summarizes the results a service returns
                    based on the HTTP methods:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">下表总结了服务根据 HTTP 方法返回的结果：</font>
                        </font>
                    </font>
                </p>
                <table border="1" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <thead data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <tr data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <th class="left bgcolor2" scope="col"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">HTTP METHOD<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">HTTP 方法</font>
                                    </font>
                                </font>
                            </th>
                            <th class="left bgcolor2" scope="col">DESCRIPTION</th>
                            <th class="left bgcolor2" scope="col"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">REQUEST BODY<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">请求体</font>
                                    </font>
                                </font>
                            </th>
                            <th class="left bgcolor2" scope="col"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">RESPONSE BODY<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">响应体</font>
                                    </font>
                                </font>
                            </th>
                        </tr>
                    </thead>
                    <tbody data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <tr data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <td class="left bgcolor3"><code>GET</code></td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">Returns a resource<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">返回资源</font>
                                    </font>
                                </font>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">Empty<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">空</font>
                                    </font>
                                </font>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">The resource<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">资源</font>
                                    </font>
                                </font>
                            </td>
                        </tr>
                        <tr data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <td class="left bgcolor3"><code>POST</code></td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">Adds a resource<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">添加资源</font>
                                    </font>
                                </font>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">The resource to add<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">要添加的资源</font>
                                    </font>
                                </font>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">The resource<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">该资源</font>
                                    </font>
                                </font>
                            </td>
                        </tr>
                        <tr data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <td class="left bgcolor3"><code>PUT</code></td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">Updates a resource<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">更新资源</font>
                                    </font>
                                </font>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">The resource to update<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">要更新的资源</font>
                                    </font>
                                </font>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">None<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">无</font>
                                    </font>
                                </font>
                            </td>
                        </tr>
                        <tr data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <td class="left bgcolor3"><code>DELETE</code></td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">Deletes a resource<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">删除资源</font>
                                    </font>
                                </font>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">Empty<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">空</font>
                                    </font>
                                </font>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">Empty<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">空</font>
                                    </font>
                                </font>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <p id="c25-para-0036" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The following table shows important HTTP status codes as well
                    as the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Controller</code> method
                    with the instantiated object that returns the status code. To return any HTTP status code, you can
                    return an <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpStatusCodeResult</code>
                    object that can be initialized with the status code you need.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">下表显示了重要的 HTTP 状态码以及使用实例化对象返回状态码的
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Controller</code>
                                方法。要返回任何 HTTP 状态码，你可以返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpStatusCodeResult</code>
                                对象，该对象可以用你需要的状态码进行初始化。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span aria-label="724"
                        epub:type="pagebreak" id="Page_724" role="doc-pagebreak"
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span></p>
                <table border="1" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <thead data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <tr data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <th class="left bgcolor2" scope="col"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">HTTP STATUS CODE<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">HTTP 状态码 </font>
                                    </font>
                                </font>
                            </th>
                            <th class="left bgcolor2" scope="col"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">CONTROLLER METHOD<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">控制器方法 </font>
                                    </font>
                                </font>
                            </th>
                            <th class="left bgcolor2" scope="col">TYPE</th>
                        </tr>
                    </thead>
                    <tbody data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <tr data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">200 OK</td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><code
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Ok</code>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><code
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">OkResult</code>
                            </td>
                        </tr>
                        <tr data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">201 Created</td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><code
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">CreatedAtRoute</code>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><code
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">CreatedAtRouteResult</code>
                            </td>
                        </tr>
                        <tr data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">204 No Content<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">204 无内容</font>
                                    </font>
                                </font>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><code
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NoContent</code>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><code
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NoContentResult</code>
                            </td>
                        </tr>
                        <tr data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">400 Bad Request<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">400 错误请求</font>
                                    </font>
                                </font>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><code
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BadRequest</code>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><code
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BadRequestResult</code>
                            </td>
                        </tr>
                        <tr data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">401 Unauthorized<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">401 未授权</font>
                                    </font>
                                </font>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><code
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Unauthorized</code>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><code
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UnauthorizedResult</code>
                            </td>
                        </tr>
                        <tr data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">404 Not Found<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">404 未找到</font>
                                    </font>
                                </font>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><code
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NotFound</code>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><code
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NotFoundResult</code>
                            </td>
                        </tr>
                        <tr data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                data-immersive-translate-paragraph="1">Any status code<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">任何状态码</font>
                                    </font>
                                </font>
                            </td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></td>
                            <td class="left bgcolor3"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><code
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">StatusCodeResult</code>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <p id="c25-para-0038" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">All success status codes start with 2; error status codes
                    start with 4. You can find a list of status codes in RFC 7231 at <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://tools.ietf.org/html/rfc7231#section-6.3">https://tools.ietf.org/html/rfc7231#section-6.3</a></code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">所有成功状态码以 2 开头；错误状态码以 4 开头。您可以在 RFC
                                7231 的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://tools.ietf.org/html/rfc7231#section-6.3">https://tools.ietf.org/html/rfc7231#section-6.3</a></code>
                                部分找到状态码列表。</font>
                        </font>
                    </font>
                </p>
            </section>
        </section>
        <section aria-labelledby="head-2-231" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
            <span id="c25-sec-0014" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <h2 id="head-2-231" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">CREATING A .NET CLIENT<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">创建.NET 客户端</font>
                    </font>
                </font>
            </h2>
            <p id="c25-para-0039" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">Using the browser to call the service is a simple way to handle
                testing. When creating JavaScript clients, you can use the Fetch API that is available with all modern
                browsers. In this book, a .NET client is created using the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code> API, and
                <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code> objects
                are created using the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code> factory.
                Read <a href="c19.xhtml" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter
                    19</a>, “Networking,” for more information about the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code> factory.
                The NuGet packages needed with this console application are <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Extensions.Hosting</code>
                (to use the <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Host</code>
                class), <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Extensions.Http</code>
                (to use the HttpClient factory), and <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">System.Net.Http.Json</code>
                (to use new .NET 5 extension methods for the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code> class for
                JSON serialization; using the JSON serializer is discussed in <a href="c18.xhtml"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter 18</a>, “Files and
                Streams”).<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用浏览器调用服务是一种简单的测试处理方式。在创建 JavaScript
                            客户端时，您可以使用所有现代浏览器都提供的 Fetch API。在本书中，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                            API 创建.NET 客户端，并使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                            工厂创建 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                            对象。有关 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                            工厂的更多信息，请阅读第 19 章“网络”。此控制台应用程序所需的 NuGet 包包括 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Extensions.Hosting</code>
                            （用于使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Host</code> 类）、
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Extensions.Http</code>
                            （用于使用 HttpClient 工厂）和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">System.Net.Http.Json</code>
                            （用于使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                            类的新.NET 5 扩展方法进行 JSON 序列化；使用 JSON 序列化在第 18 章“文件和流”中讨论）。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">In the sample application, with the configuration of the DI
                container, the factory for the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code> (<code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddHttpClient</code> method)
                is configured to use a typed client: the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApiClient</code> class.
                The factory configuration sets the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BaseAddress</code> property
                to retrieve the URL from the service from a configuration or a hard-coded string if it's not found in
                the configuration (code file <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/Program.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在示例应用程序中，通过依赖注入容器的配置， <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                            （ <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddHttpClient</code>
                            方法）的工厂被配置为使用一个类型化的客户端： <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApiClient</code>
                            类。工厂配置将 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BaseAddress</code>
                            属性设置为从服务中获取 URL，如果未在配置中找到，则从硬编码的字符串中获取（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/Program.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c25-code-0015"><code>using var host = Host.CreateDefaultBuilder(args)</code>
<code>  .ConfigureServices((context, services) =&gt;</code>
<code>  {</code>
<code>    var bookApiSettings = context.Configuration.GetSection("BooksService");</code>
<code>    services.Configure&lt;BooksApiClientOptions&gt;(bookApiSettings);</code>
<code>    <b>services.AddHttpClient&lt;BooksApiClient&gt;(config =&gt;</b></code>
<code>    <b>{</b></code>
<code>      <b>var baseAddress = context.Configuration.GetSection("BooksService")["BaseAddress"] ??</b> </code>
<code>        <b>"https://localhost:5001";</b></code>
<code>      <b>config.BaseAddress = new Uri(baseAddress);</b></code>
<code>    <b>});</b></code>
<code>  }).Build();</code>
<code> </code>
<code>Console.WriteLine("Client - press return to continue");</code>
<code>Console.ReadLine();</code>
<code> </code>
<code>using var scope = host.Services.CreateScope();</code>
<code> <span aria-label="725" epub:type="pagebreak" id="Page_725" role="doc-pagebreak"></span></code>
<code>var client = scope.ServiceProvider.GetRequiredService&lt;BooksApiClient&gt;();</code>
<code>await client.ReadChaptersAsync();</code>
<code>await client.ReadChapterAsync();</code>
<code>await client.ReadNotExistingChapterAsync();</code>
<code>await client.AddChapterAsync();</code>
<code>await client.UpdateChapterAsync();</code>
<code>await client.RemoveChapterAsync();</code></pre>
            <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">The <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApiClient</code> class
                uses <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApiClientOptions</code>
                to fill the link to the API. The <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code> class is
                injected with the constructor (code file <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BooksApiClient.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1"> <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApiClient</code>
                            类使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApiClientOptions</code>
                            来填充 API 的链接。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                            类通过构造函数注入（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BooksApiClient.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c25-code-0016"><code>public record BooksApiClientOptions</code>
<code>{</code>
<code>  public string? BooksApiUri { get; init; }</code>
<code>}</code>
<code> </code>
<code>public class BooksApiClient</code>
<code>{</code>
<code>  private readonly HttpClient _httpClient;</code>
<code>  private readonly string _booksApiUri;</code>
<code>  private readonly ILogger _logger;</code>
<code>  private Guid? _chapterId;</code>
<code> </code>
<code>  public BooksApiClient(HttpClient, IOptions&lt;BooksApiClientOptions&gt; options,</code>
<code>    ILogger&lt;BooksApiClient&gt; logger)</code>
<code>  {</code>
<code>    _httpClient = httpClient;</code>
<code>    _logger = logger;</code>
<code>    _booksApiUri = options.Value.BooksApiUri ?? "api/books";</code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">To have all the URLs needed in one place, they are configured
                with the .NET configuration (which you can override from command-line parameters and extend using the
                Azure App Configuration, as discussed in <a href="c15.xhtml"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter 15</a>, “Dependency
                Injection and Configuration” (configuration file <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/appsettings.json</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">为了将所有需要的 URL 集中在一个地方，它们通过.NET
                            配置进行配置（你可以从命令行参数中覆盖，并使用 Azure App Configuration 进行扩展，如第 15 章“依赖注入和配置”（配置文件 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/appsettings.json</code>
                            ）所述）：</font>
                    </font>
                </font>
            </p>
            <pre id="c25-code-0017"><code>{</code>
<code>  "BooksService": {</code>
<code>    "BaseAddress": "https://localhost:5001",</code>
<code>    "BooksApiUri": "api/BookChapters"</code>
<code>  },</code>
<code>  //…</code>
<code>}</code></pre>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0015"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-475" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Sending GET Requests<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">发送 GET 请求</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The server controller defines two methods with GET requests:
                    one method that returns all chapters and the other that returns just a single chapter but requires
                    the chapter's identifier with the URI. The method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadChaptersAsync</code>
                    invokes the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetFromJsonAsync</code>
                    method using the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                    instance. This method returns a task with an array of book chapters that is shown on the console.
                    The ID of the first chapter is remembered in the field <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">_firstChapterId</code>
                    because this will be used in other methods that follow (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BooksApiClient.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">服务器控制器定义了两个使用 GET
                                请求的方法：一个方法返回所有章节，另一个方法返回单个章节但需要通过 URI 传递章节的标识符。方法 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadChaptersAsync</code>
                                使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                                实例调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetFromJsonAsync</code>
                                方法。这个方法返回一个任务，其中包含书章节的数组，并在控制台中显示。第一个章节的 ID 保存在字段 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">_firstChapterId</code>
                                中，因为后续其他方法会使用它（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BooksApiClient.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0018"><code>public async Task ReadChaptersAsync()</code>
<code>{<span aria-label="726" epub:type="pagebreak" id="Page_726" role="doc-pagebreak"></span></code>
<code>  Console.WriteLine(nameof(ReadChapterAsync));</code>
<code>  <b>var chapters = await _httpClient.GetFromJsonAsync&lt;IEnumerable&lt;BookChapter&gt;&gt;(</b></code>
<code>    <b>_booksApiUri);</b></code>
<code>  if (chapters is null) return;</code>
<code>  foreach (var chapter in chapters)</code>
<code>  {</code>
<code>    Console.WriteLine($"{chapter.Number} {chapter.Title}");</code>
<code>  }</code>
<code>  _chapterId = chapters.FirstOrDefault()?.Id;</code>
<code>  Console.WriteLine();</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetFromJsonAsync</code>
                    is an extension method defined in the namespace <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">System.Net.Http.Json</code>,
                    which does the following:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">方法 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetFromJsonAsync</code>
                                是在命名空间 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">System.Net.Http.Json</code>
                                中定义的扩展方法，它执行以下操作：</font>
                        </font>
                    </font>
                </p>
                <ul class="check" id="c25-list-0005"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <li id="c25-li-0024" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                        data-immersive-translate-paragraph="1">It uses the <code
                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetAsync</code>
                        method of the <code
                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                        class to send a GET request.<font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">它使用 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                                    类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetAsync</code>
                                    方法发送 GET 请求。</font>
                            </font>
                        </font>
                    </li>
                    <li id="c25-li-0025" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                        data-immersive-translate-paragraph="1">It throws an exception if the request is not successful,
                        using the <code
                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">EnsureSuccessStatusCode</code>
                        method of the <code
                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpResponseMessage</code>
                        class.<font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">如果请求不成功，它使用 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpResponseMessage</code>
                                    类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">EnsureSuccessStatusCode</code>
                                    方法抛出异常。</font>
                            </font>
                        </font>
                    </li>
                    <li id="c25-li-0026" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                        data-immersive-translate-paragraph="1">It uses the <code
                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadAsStreamAsync</code>
                        method of the <code
                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpContent</code>
                        class to read the response stream.<font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">它使用 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadAsStreamAsync</code>
                                    类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpContent</code>
                                    方法来读取响应流。</font>
                            </font>
                        </font>
                    </li>
                </ul>
                <aside data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <div class="top hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <p id="c25-para-0045" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NOTE</b> <i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">The </i><code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpContent</code><i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> class also
                                offers the </i><code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadAsStringAsync</code><i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> method to read a
                                string from the HTTP response. However, this method should be used only with strings
                                shorter than 85,000 bytes. When you get data from API services, you might get long
                                strings (how long is the list returned?), which are put into the large object heap
                                (LOH). The large object heap is handled differently from the garbage collector because
                                of performance constraints. To avoid this issue, it's best to use streams that make use
                                of a byte array buffer that is reused. Read <a href="c13.xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter
                                    13</a>, “Managed and Unmanaged Memory,” for more information about the garbage
                                collector and the LOH.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 The <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpContent</code>
                                        类还提供了 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadAsStringAsync</code>
                                        方法来从 HTTP 响应中读取字符串。但是，此方法仅应用于长度小于 85,000 字节的情况。当您从 API
                                        服务获取数据时，可能会得到长字符串（返回的列表有多长？），这些字符串会被放入大型对象堆（LOH）。由于性能限制，大型对象堆的处理方式与垃圾回收器不同。为了避免这个问题，最好使用利用可重用字节数组缓冲区的流。有关垃圾回收器和
                                        LOH 的更多信息，请阅读第 13 章，“托管和非托管内存”。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">When you run the application, you need to start both the
                    service as well as the client app; remember to initialize the data by accessing the link <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://localhost:5001/init">https://localhost:5001/init</a></code>.
                    Invoking the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadChaptersAsync</code>
                    method shows the status code 200 and the titles from the chapters (the logging output is
                    simplified):<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                运行应用程序时，您需要同时启动服务和客户端应用程序；请记住通过访问链接 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://localhost:5001/init">https://localhost:5001/init</a></code>
                                初始化数据。调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadChaptersAsync</code>
                                方法显示状态码 200 和章节标题（日志输出已简化）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0019"><code>ReadChapterAsync</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[100]</code>
<code>      Sending HTTP request GET https://localhost:5001/api/BookChapters</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[101]</code>
<code>      Received HTTP response headers after 320.2596ms - 200</code>
<code>1 .NET Applications and Tools</code>
<code>2 Core C#</code>
<code>3 Classes, Structs, Tuples, and Records</code>
<code>4 Object-Oriented Programming with C#</code>
<code>5 Operators and Casts</code>
<code>6 Arrays</code>
<code>7 Delegates, Lambdas, and Events</code>
<code>8 Collections</code>
<code>25 Services</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadChapterAsync</code>
                    shows the GET request to retrieve a single chapter. With this, the identifier of a chapter is added
                    to the URI string (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BooksApiClient.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">方法 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadChapterAsync</code>
                                显示了用于检索单个章节的 GET 请求。通过这种方式，章节的标识符被添加到 URI 字符串中（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BooksApiClient.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0020"><code>public async Task ReadChapterAsync()</code>
<code>{<span aria-label="727" epub:type="pagebreak" id="Page_727" role="doc-pagebreak"></span></code>
<code>  Console.WriteLine(nameof(ReadChapterAsync));</code>
<code>  if (_firstChapterId is not null)</code>
<code>  {</code>
<code>    string uri = $"{_booksApiUri}/{_firstChapterId}";</code>
<code>    var chapter = await _httpClient.GetFromJsonAsync&lt;BookChapter&gt;(uri);</code>
<code>    if (chapter is not null)</code>
<code>    {</code>
<code>      Console.WriteLine($"{chapter.Number} {chapter.Title}");</code>
<code>    }</code>
<code>  }</code>
<code>  Console.WriteLine();            </code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The result of the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadChapterAsync</code>
                    method is shown here:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadChapterAsync</code>
                                方法的结果显示在这里：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0021"><code>ReadChapterAsync</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[100]</code>
<code>      Sending HTTP request GET https://localhost:5001/api/BookChapters/</code>
<code>44ecb858-86c6-4602-bd9c-e1357d6b5c4e</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[101]</code>
<code>      Received HTTP response headers after 72.0244ms - 200</code>
<code>1 .NET Applications and Tools</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">What if a GET request is sent with a nonexistent chapter
                    identifier? The method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadNotExistingChapterAsync</code>
                    shows how to deal with this. Calling the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetFromJsonAsync</code>
                    method works as in the previous code snippet, but an identifier that does not exist is added to the
                    URI. Remember from the implementation of the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetFromJsonAsync</code>
                    method implementation that the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">EnsureSuccessStatusCode</code>
                    method throws an exception. This exception is caught with a <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">try</code>
                    -
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">catch</code> block
                    looking for the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpRequestException</code>
                    type. Here, an exception filter is also used to handle only exception code 404 (not found) (code
                    file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BookChapterSampleRequest.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">如果发送了一个带有不存在的章节标识符的 GET 请求？方法
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadNotExistingChapterAsync</code>
                                展示了如何处理这种情况。调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetFromJsonAsync</code>
                                方法与之前的代码片段一样，但在 URI 中添加了一个不存在的标识符。回想一下 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetFromJsonAsync</code>
                                方法实现的实现， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">EnsureSuccessStatusCode</code>
                                方法会抛出异常。这个异常被一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">try</code> -
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">catch</code>
                                块捕获，该块查找 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpRequestException</code>
                                类型。这里还使用了异常过滤器来处理仅异常代码 404（未找到）（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BookChapterSampleRequest.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0022"><code>public async Task ReadNotExistingChapterAsync()</code>
<code>{</code>
<code>  Console.WriteLine(nameof(ReadNotExistingChapterAsync));</code>
<code>  string requestIdentifier = Guid.NewGuid().ToString();</code>
<code>  try</code>
<code>  {</code>
<code>    string uri = $"{_booksApiUri}/{requestIdentifier}";</code>
<code>    var chapter = await _httpClient.GetFromJsonAsync&lt;BookChapter&gt;(uri);</code>
<code>  }</code>
<code>  catch (HttpRequestException ex) when (ex.Message.Contains("404"))</code>
<code>  {</code>
<code>    _logger.LogError("book chapter with identifier {0} not found", requestIdentifier);</code>
<code>  }</code>
<code>  Console.WriteLine();</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <div class="top hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <p id="c25-para-0051" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NOTE</b> <i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Handling
                                exceptions and using exception filters is discussed in <a href="c10.xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter
                                    10</a>, “Errors and Exceptions.”</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：异常处理和使用异常过滤器在“错误和异常”章节第
                                        10 章中讨论。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The result of the method shows the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NotFound</code> result
                    from the service:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">该方法的结果显示了来自服务的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NotFound</code>
                                结果：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0023"><code>ReadNotExistingChapterAsync</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[100]</code>
<code>      Sending HTTP request GET https://localhost:5001/api/BookChapters/<span aria-label="728" epub:type="pagebreak" id="Page_728" role="doc-pagebreak"></span></code>
<code>532eae52-1bed-4fc5-b8c0-ca7ec3b41eb8</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[101]</code>
<code>      Received HTTP response headers after 37.3587ms - 404</code>
<code>fail: BookServiceClient.BooksApiClient[0]</code>
<code>      book chapter with identifier 532eae52-1bed-4fc5-b8c0-ca7ec3b41eb8 not found</code></pre>
            </section>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0018"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-476" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Sending POST Requests<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">发送 POST 请求 </font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Let's send new objects to the service using the HTTP POST
                    request. Unlike the GET request, with the POST request, a resource needs to be added to the HTTP
                    body in application/json format. This is done from the extension method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">PostAsJsonAsync</code>.
                    After the POST request is sent, the status code and the location are shown in the console. With the
                    implementation of the service controller, the header location is filled from the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">CreatedAtRoute</code>
                    method (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BooksApiClient.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">让我们使用 HTTP POST 请求向服务发送新对象。与 GET
                                请求不同，使用 POST 请求时，需要在 HTTP 主体中以 application/json 格式添加资源。这是通过扩展方法 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">PostAsJsonAsync</code>
                                完成的。发送 POST 请求后，控制台会显示状态码和位置。在服务控制器的实现中，头部位置是从 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">CreatedAtRoute</code>
                                方法填充的（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BooksApiClient.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0024"><code>public async Task AddChapterAsync()</code>
<code>{</code>
<code>  Console.WriteLine(nameof(AddChapterAsync));</code>
<code>  BookChapter chapter = new(Guid.NewGuid(), 25, "Services", 40);</code>
<code>  var response = await _httpClient.PostAsJsonAsync(_booksApiUri, chapter);</code>
<code>  Console.WriteLine($"status code: {response.StatusCode}");</code>
<code>  Console.WriteLine($"created at location: {response.Headers.Location?.AbsolutePath}");</code>
<code>  Console.WriteLine();</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The result of the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddChapterAsync</code>
                    method shows a successful run to create the object:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddChapterAsync</code>
                                方法的结果显示对象创建成功：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0025"><code>AddChapterAsync</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[100]</code>
<code>      Sending HTTP request POST https://localhost:5001/api/BookChapters</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[101]</code>
<code>      Received HTTP response headers after 151.0361ms - 201</code>
<code>status code: Created</code>
<code>created at location: /api/BookChapters/7f0b05c1-2277-4c98-bb09-48f195480b9c</code></pre>
            </section>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0019"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-477" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Sending PUT Requests<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">发送 PUT 请求</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The HTTP PUT request—which is used for updating a record—is
                    sent with the help of the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                    extension method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">PutAsJsonAsync</code>.
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">PutAsJsonAsync</code>
                    requires the URL to the service (including the identifier) in the first parameter, and the updated
                    content with the second parameter. With the following code snippet, the chapter with the title “.NET
                    Application Architectures” is updated to a new title (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BooksApiClient.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">用于更新记录的 HTTP PUT 请求是通过 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                                扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">PutAsJsonAsync</code>
                                发送的。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">PutAsJsonAsync</code>
                                的第一个参数需要服务 URL（包括标识符），第二个参数需要更新的内容。通过以下代码片段，标题为“.NET 应用架构”的章节被更新为新的标题（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BooksApiClient.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0026"><code>public async Task UpdateChapterAsync()</code>
<code>{</code>
<code>  Console.WriteLine(nameof(UpdateChapterAsync));</code>
<code> </code>
<code>  var chapters = await _httpClient.GetFromJsonAsync&lt;IEnumerable&lt;BookChapter&gt;&gt;(</code>
<code>    _booksApiUri);</code>
<code>  if (chapters is null) return;</code>
<code>  var chapter = chapters.SingleOrDefault(</code>
<code>    c =&gt; c.Title == ".NET Application Architectures");</code>
<code>  if (chapter is not null)</code>
<code>  {</code>
<code>    string uri = $"{_booksApiUri}/{chapter.Id}"; </code>
<code>    chapter = chapter with { Title = ".NET Applications and Tools" };</code>
<code>    var response = await _httpClient.PutAsJsonAsync(uri, chapter);<span aria-label="729" epub:type="pagebreak" id="Page_729" role="doc-pagebreak"></span></code>
<code>    if (response.IsSuccessStatusCode)</code>
<code>    {</code>
<code>      Console.WriteLine($"Status code: {response.StatusCode}");</code>
<code>      Console.WriteLine($"updated chapter {chapter.Title}");</code>
<code>    }</code>
<code>  }</code>
<code>  Console.WriteLine();</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The console output of the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UpdateChapterAsync</code>
                    method shows an HTTP <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NoContent</code> result
                    and the updated chapter title:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UpdateChapterAsync</code>
                                方法的控制台输出显示了一个 HTTP <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NoContent</code>
                                结果和更新的章节标题：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0027"><code>UpdateChapterAsync</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[100]</code>
<code>      Sending HTTP request GET https://localhost:5001/api/BookChapters</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[101]</code>
<code>      Received HTTP response headers after 35.1652ms - 200</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[100]</code>
<code>      Sending HTTP request PUT https://localhost:5001/api/BookChapters/</code>
<code>40cfc158-38b5-43ff-8964-57a0bbf95903</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[101]</code>
<code>      Received HTTP response headers after 7421.4237ms - 204</code>
<code>Status code: NoContent</code>
<code>Updated chapter .NET Applications and Tools</code></pre>
            </section>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0020"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-478" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Sending DELETE Requests<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">发送 DELETE 请求</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The last request shown with the sample client is the HTTP
                    DELETE request. When sending a <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">DELETE</code> request,
                    JSON information is not needed; only the identifier needs to be passed. Instead of using an
                    extension method, this time the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">DeleteAsync</code> method
                    from the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code> class
                    is used directly to delete the resource (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BooksApiClient.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">示例客户端中最后显示的请求是 HTTP DELETE 请求。当发送
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">DELETE</code>
                                请求时，不需要 JSON 信息；只需传递标识符即可。这次不是使用扩展方法，而是直接使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                                类中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">DeleteAsync</code>
                                方法来删除资源（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApi/BookServiceClient/BooksApiClient.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0028"><code>public async Task RemoveChapterAsync()</code>
<code>{</code>
<code>  Console.WriteLine(nameof(RemoveChapterAsync));</code>
<code>  var chapters = await _httpClient.GetFromJsonAsync&lt;IEnumerable&lt;BookChapter&gt;&gt;(</code>
<code>    _booksApiUri);</code>
<code>  if (chapters == null) return;</code>
<code> </code>
<code>  var chapter = chapters.SingleOrDefault(c =&gt; c.Title == "ADO.NET and Transactions");</code>
<code>  if (chapter != null)</code>
<code>  {</code>
<code>    string uri = $"{_booksApiUri}/{chapter.Id}";</code>
<code>    var response = await _httpClient.DeleteAsync(uri);</code>
<code>    if (response.IsSuccessStatusCode)</code>
<code>    {</code>
<code>      Console.WriteLine($"removed chapter {chapter.Title}");</code>
<code>    }</code>
<code>  }</code>
<code>  Console.WriteLine();</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">When you run the application, the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">RemoveChapterAsync</code>
                    method first shows the status of the HTTP GET method because a GET request is done to retrieve all
                    chapters. After this status information, the successful DELETE request is shown:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当你运行应用程序时， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">RemoveChapterAsync</code>
                                方法首先显示 HTTP GET 方法的状态，因为执行 GET 请求是为了获取所有章节。在此状态信息之后，显示成功的 DELETE 请求：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0029"><code>RemoveChapterAsync</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[100]<span aria-label="730" epub:type="pagebreak" id="Page_730" role="doc-pagebreak"></span></code>
<code>      Sending HTTP request GET https://localhost:5001/api/BookChapters</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[101]</code>
<code>      Received HTTP response headers after 36.4147ms - 200</code>
<code>https://localhost:5001/api/BookChapters/cefbfc7d-1b21-4851-94c0-1c4fe76d47e7</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[100]</code>
<code>      Sending HTTP request DELETE https://localhost:5001/api/BookChapters/</code>
<code>cefbfc7d-1b21-4851-94c0-1c4fe76d47e7</code>
<code>info: System.Net.Http.HttpClient.BooksApiClient.ClientHandler[101]</code>
<code>      Received HTTP response headers after 34.8404ms - 200</code>
<code>removed chapter ADO.NET and Transactions</code></pre>
            </section>
        </section>
        <section aria-labelledby="head-2-232" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
            <span id="c25-sec-0021" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <h2 id="head-2-232" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">USING EF CORE WITH SERVICES<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用服务中的 EF CORE</font>
                    </font>
                </font>
            </h2>
            <p id="c25-para-0059" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1"><a href="c21.xhtml"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter 21</a>, “Entity
                Framework Core,” introduces mapping objects to relations with Entity Framework Core (EF Core). A web API
                controller can easily use a <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">DbContext</code>. In the
                sample app, you don't need to change the controller at all; you just need to create and register a
                different repository for using EF Core. All the steps needed are described in this section.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">第 21 章，“Entity Framework Core”，介绍了如何使用
                            Entity Framework Core（EF Core）将对象映射到关系。Web API 控制器可以轻松使用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">DbContext</code>
                            。在示例应用程序中，您无需更改控制器；您只需为使用 EF Core 创建和注册不同的存储库。本节中描述了所有必要的步骤。</font>
                    </font>
                </font>
            </p>
            <p id="c25-para-0060" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">Let's start with the code accessing the database in a new .NET 5
                library named <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Data</code>. For using
                EF Core with SQL Server, the NuGet package <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.EntityFrameworkCore.SqlServer</code>
                needs to be added to the project that contains the services. The <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code> record and
                the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>
                interface were already defined earlier. With the new solution, the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code> record is
                defined in the shared library <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Shared</code>, which is
                used both from the client and from the server. The <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapter</code> interface
                is defined in the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Data</code> library,
                which is only used on the server.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">让我们从访问数据库的代码开始，该代码位于名为 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Data</code>
                            的新 .NET 5 库中。要使用 EF Core 与 SQL Server，需要在包含服务的项目中添加 NuGet 包 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.EntityFrameworkCore.SqlServer</code>
                            。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code>
                            记录和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>
                            接口之前已经定义好了。在新解决方案中， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code>
                            记录定义在共享库 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Shared</code>
                            中，该库既被客户端使用，也被服务器使用。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapter</code>
                            接口定义在 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Data</code>
                            库中，该库仅用于服务器。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">The <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksContext</code> class
                shown in the following code snippet defines the mapping of the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code> record to
                a database table. The <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Title</code> column is
                restricted to a maximum of 120 characters as specified with the model definition. For the controller to
                not have a strong dependency on the context, the BooksContext class implements the interface
                IBookChapterService
                <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></code>. Contrary to the
                previous implementation of this interface, now the members of the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">DbContext</code> base class
                are used to write the data to the database (code file <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksData/Books.Data/Models/BooksContext.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">以下代码片段中的 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksContext</code>
                            类定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code>
                            记录与数据库表的映射。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Title</code>
                            列被限制为最多 120 个字符，如模型定义中指定。为了让控制器不依赖于上下文，BooksContext 类实现了接口 IBookChapterService <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></code>
                            。与之前实现的该接口不同，现在使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">DbContext</code>
                            基类的成员将数据写入数据库（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksData/Books.Data/Models/BooksContext.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c25-code-0030"><code>public class BooksContext : DbContext, IBookChapterService, IDisposable</code>
<code>{</code>
<code>  public BooksContext(DbContextOptions&lt;BooksContext&gt; options)</code>
<code>    : base(options) </code>
<code>  {</code>
<code>    ChangeTracker.QueryTrackingBehavior = QueryTrackingBehavior.NoTracking;</code>
<code>  }</code>
<code> </code>
<code>  public DbSet&lt;BookChapter&gt; Chapters =&gt; Set&lt;BookChapter&gt;();</code>
<code> </code>
<code>  protected override void OnModelCreating(ModelBuilder modelBuilder)</code>
<code>  {</code>
<code>    modelBuilder.Entity&lt;BookChapter&gt;().Property(b =&gt; b.Title).HasMaxLength(120);</code>
<code>  }</code>
<code> </code>
<code>  public async Task AddAsync(BookChapter chapter)</code>
<code>  {</code>
<code>    await Chapters.AddAsync(chapter);</code>
<code>    await SaveChangesAsync();</code>
<code>  }</code>
<code> </code>
<code>  public async Task AddRangeAsync(IEnumerable&lt;BookChapter&gt; chapters)</code>
<code>  {<span aria-label="731" epub:type="pagebreak" id="Page_731" role="doc-pagebreak"></span></code>
<code>    await this.Chapters.AddRangeAsync(chapters);</code>
<code>    await SaveChangesAsync();</code>
<code>  }</code>
<code> </code>
<code>  public async Task&lt;IEnumerable&lt;BookChapter&gt;&gt; GetAllAsync()</code>
<code>  {</code>
<code>    var chapters = await Chapters.ToListAsync();</code>
<code>    return chapters;</code>
<code>  }</code>
<code> </code>
<code>  public async Task&lt;BookChapter?&gt; FindAsync(Guid id)</code>
<code>  {</code>
<code>    var chapter = await Chapters.FindAsync(id);</code>
<code>    return chapter;</code>
<code>  }</code>
<code> </code>
<code>  public async Task&lt;BookChapter?&gt; RemoveAsync(Guid id)</code>
<code>  {</code>
<code>    var chapter = await Chapters.FindAsync(id);</code>
<code>    Chapters.Remove(chapter);</code>
<code>    await SaveChangesAsync();</code>
<code>    return chapter;</code>
<code>  }</code>
<code> </code>
<code>  public async Task&lt;BookChapter?&gt; UpdateAsync(BookChapter chapter)</code>
<code>  {</code>
<code>    Chapters.Update(chapter);</code>
<code>    await SaveChangesAsync();</code>
<code>    return chapter;</code>
<code>  }</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">With the DI container, EF Core and SQL Server need to be added to
                invoke the extension methods <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddDbContext</code> and <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UseSqlServer</code>. When a
                service (or a controller in this case) requests the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>,
                now an instance of the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksContext</code> class is
                returned. The <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksContext</code> is added
                with the method <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddDbContext</code>. With the
                options of this method, the connection string is passed (code file <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksData/BooksApi/Startup.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用依赖注入容器时，需要添加 EF Core 和 SQL Server
                            才能调用扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddDbContext</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UseSqlServer</code>
                            。当服务（在本例中为控制器）请求 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>
                            时，现在会返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksContext</code>
                            类的一个实例。使用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddDbContext</code>
                            添加 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksContext</code>
                            。通过此方法的选项传递连接字符串（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksData/BooksApi/Startup.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c25-code-0031"><code>public void ConfigureServices(IServiceCollection services)</code>
<code>{</code>
<code>  services.AddDbContext&lt;IBookChapterService, BooksContext&gt;(options =&gt;</code>
<code>  {</code>
<code>    var connectionString = Configuration.GetConnectionString("BooksConnection");</code>
<code>      options.UseSqlServer(connectionString);</code>
<code>  });</code>
<code>  services.AddControllers();</code>
<code>  //…</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">The connection string itself is defined with the application
                settings in the host application project (configuration file <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksData/BooksApi/appsettings.json</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">连接字符串本身是在主机应用程序项目（配置文件 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksData/BooksApi/appsettings.json</code>
                            ）中的应用程序设置中定义的：</font>
                    </font>
                </font>
            </p>
            <pre id="c25-code-0032"><code>"ConnectionStrings": {</code>
<code>  "BooksConnection": "server=(localdb)\\mssqllocaldb;database=APIBooksSample;</code>
<code>  trusted_connection=true;"</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1"><span aria-label="732" epub:type="pagebreak" id="Page_732"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>To create and
                initialize the database with sample data, create a console application using the sample EF Core context
                class (referencing the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Data</code> library)
                and use the sample implementation for the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SampleChapters</code> class
                used previously. The following code snippet shows the top-level statements of the initializer
                application where the DI container is configured. Using the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksContext</code>, the
                database is created. Then chapters from the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SampleChapters</code> class
                are used to fill the database (code file <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksData/Books.Initializer/Program.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">要创建并初始化带有示例数据的数据库，请使用示例 EF Core
                            上下文类（引用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Data</code>
                            库）创建一个控制台应用程序，并使用之前使用的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SampleChapters</code>
                            类的示例实现。以下代码片段显示了初始化器应用程序的顶层语句，其中配置了依赖注入容器。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksContext</code>
                            ，创建数据库。然后使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SampleChapters</code>
                            类的章节填充数据库（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksData/Books.Initializer/Program.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c25-code-0033"><code>using Books.Data;</code>
<code>using Books.Services;</code>
<code>using Microsoft.EntityFrameworkCore;</code>
<code>using Microsoft.Extensions.Configuration;</code>
<code>using Microsoft.Extensions.DependencyInjection;</code>
<code>using Microsoft.Extensions.Hosting;</code>
<code> </code>
<code>using var host = Host.CreateDefaultBuilder(args)</code>
<code>  .ConfigureServices((context, services) =&gt;</code>
<code>  {</code>
<code>    string booksConnection = context.Configuration.GetConnectionString("BooksConnection");</code>
<code>    services.AddDbContext&lt;BooksContext&gt;(options =&gt;</code>
<code>    {</code>
<code>      options.UseSqlServer(booksConnection);</code>
<code>    });</code>
<code> </code>
<code>    services.AddTransient&lt;SampleChapters&gt;();</code>
<code>  })</code>
<code>  .Build();</code>
<code> </code>
<code>using var scope = host.Services.CreateScope();</code>
<code>var booksContext = scope.ServiceProvider.GetRequiredService&lt;BooksContext&gt;();</code>
<code>await booksContext.Database.EnsureCreatedAsync();</code>
<code> </code>
<code>var sampledata = scope.ServiceProvider.GetRequiredService&lt;SampleChapters&gt;();</code>
<code>var chapters = sampledata.GetSampleChapters();</code>
<code>await booksContext.Chapters.AddRangeAsync(chapters);</code>
<code>await booksContext.SaveChangesAsync();</code></pre>
            <aside data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                <div class="top hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <p id="c25-para-0066" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NOTE</b> <i
                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">EF Core also allows
                            creating databases using migrations. Read <a href="c21.xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter 21</a>
                            for information about how to implement migrations in the application.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意 EF Core
                                    也允许使用迁移创建数据库。有关如何在应用程序中实现迁移的信息，请阅读第 21 章。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <hr />
                    </div>
                </section>
            </aside>
            <p id="c25-para-0067" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">With the controller, no changes are required compared to the
                previous sample code. The controller class <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChaptersController</code>
                injects the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>.
                This sample solution contains a different implementation, but for the controller, the same contract is
                fulfilled, and now you can run both the client and the server using the database.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用控制器时，与之前的示例代码相比，无需进行任何更改。控制器类 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChaptersController</code>
                            注入了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>
                            。此示例解决方案包含不同的实现，但对于控制器，满足的是相同的契约，现在您可以使用数据库运行客户端和服务器。</font>
                    </font>
                </font>
            </p>
        </section>
        <section aria-labelledby="head-2-233" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
            <span id="c25-sec-0023" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <h2 id="head-2-233" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">AUTHENTICATION AND AUTHORIZATION WITH AZURE AD B2C<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用 Azure AD B2C 的身份验证和授权</font>
                    </font>
                </font>
            </h2>
            <p id="c25-para-0068" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">Authentication and authorization are important parts of
                developing services. Not every user or every application should be allowed to write data to the
                database, and probably more users should be allowed to read the data.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            身份验证和授权是开发服务的重要组成部分。并非每个用户或每个应用程序都应该被允许向数据库写入数据，而且可能应该允许更多用户读取数据。</font>
                    </font>
                </font>
            </p>
            <p id="c25-para-0069" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1"><span aria-label="733" epub:type="pagebreak" id="Page_733"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span><a href="c20.xhtml"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter 20</a>, “Security,”
                discusses authentication and authorization of ASP.NET Core web applications using the Azure Active
                Directory (AD). In this chapter, you use the Azure Active Directory Business-to-Consumer (B2C) to secure
                web APIs built with ASP.NET Core. The Azure Active Directory B2C includes all the features of an Azure
                Active Directory, but includes an extension app, which allows users to register with the AD, either
                using email and password or using their existing Twitter, Facebook, Google, Microsoft, or other OpenID
                Connect and OAuth accounts. You just need to register applications with the providers you would like to
                support.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">第 20 章，“安全”，讨论了使用 Azure Active
                            Directory（AD）对 ASP.NET Core Web 应用程序进行身份验证和授权。在本章中，你将使用 Azure Active Directory
                            Business-to-Consumer（B2C）来保护用 ASP.NET Core 构建的 Web API。Azure Active Directory B2C 包含 Azure
                            Active Directory 的所有功能，但包含一个扩展应用，该应用允许用户注册到 AD，可以使用电子邮件和密码，也可以使用他们现有的
                            Twitter、Facebook、Google、Microsoft 或其他 OpenID Connect 和 OAuth 账户。你只需要在你想支持的提供者那里注册应用程序。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c25-para-0070" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">After creating the Azure Active Directory B2C service, you can
                configure identity providers, as shown in <a href="#c25-fig-0002" id="R_c25-fig-0002"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Figure 25-2</a>. With each
                identity provider you select, you need to configure a client ID and client secret. User attributes
                enable you to collect information from users, such as the name, email address, city, country, and other
                values (see <a href="#c25-fig-0003" id="R_c25-fig-0003"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Figure 25-3</a>). In addition
                to the built-in user attributes, you can add custom attributes that you ask the user for when the user
                registers with the application or makes changes to their profile. To define what the user should be
                asked with the registration and what information should be sent to the API service, you create user
                flows. You can create different user flows for signing up and signing in, editing of the profile, and
                resetting the password. With a user flow, you define the identity providers used, the information that
                should be requested from the user, and what information should be sent to the application as claims
                within a token (see <a href="#c25-fig-0004" id="R_c25-fig-0004"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Figure 25-4</a>). After
                creating the flow, you can change the layout of the dialog and test it directly from the portal (see <a
                    href="#c25-fig-0005" id="R_c25-fig-0005"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Figure 25-5</a>).<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">创建 Azure Active Directory B2C
                            服务后，您可以配置身份提供者，如图 25-2 所示。对于每个您选择的身份提供者，您需要配置客户端 ID
                            和客户端密钥。用户属性使您能够收集用户信息，例如姓名、电子邮件地址、城市、国家和其他值（见图
                            25-3）。除了内置的用户属性外，您还可以添加自定义属性，这些属性是在用户注册应用程序或修改个人资料时向用户询问的。为了定义在注册时应向用户询问的内容以及应发送到 API
                            服务的信息，您创建用户流程。您可以为注册、登录、编辑个人资料和重置密码创建不同的用户流程。通过用户流程，您定义使用哪些身份提供者、应向用户请求哪些信息，以及应将哪些信息作为令牌中的声明发送到应用程序（见图
                            25-4）。创建流程后，您可以更改对话框的布局，并直接从门户进行测试（见图 25-5）。</font>
                    </font>
                </font>
            </p> <span aria-label="734" epub:type="pagebreak" id="Page_734" role="doc-pagebreak"
                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <figure data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> <img
                    alt="Snapshot shows the identity providers of azure." class="center" src="images/c25f002.png" />
                <figcaption data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span class="figureLabel"
                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a
                                href="#R_c25-fig-0002" id="c25-fig-0002" role="doc-backlink"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><b
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                    data-immersive-translate-paragraph="1">FIGURE 25-2<font
                                        class="notranslate immersive-translate-target-wrapper"
                                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">
                                              </font>
                                        <font
                                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                            data-immersive-translate-translation-element-mark="1">
                                            <font
                                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                data-immersive-translate-translation-element-mark="1">图 25-2</font>
                                        </font>
                                    </font></b></a></span></p>
                </figcaption>
            </figure>
            <figure data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> <img
                    alt="Snapshot shows the user attributes of azure AD." class="center" src="images/c25f003.png" />
                <figcaption data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span class="figureLabel"
                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a
                                href="#R_c25-fig-0003" id="c25-fig-0003" role="doc-backlink"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><b
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                    data-immersive-translate-paragraph="1">FIGURE 25-3<font
                                        class="notranslate immersive-translate-target-wrapper"
                                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">
                                              </font>
                                        <font
                                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                            data-immersive-translate-translation-element-mark="1">
                                            <font
                                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                data-immersive-translate-translation-element-mark="1">图 25-3</font>
                                        </font>
                                    </font></b></a></span></p>
                </figcaption>
            </figure>
            <p id="c25-para-0071" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">To allow the ASP.NET Core service to receive the token and access
                claims from the AD and to allow the console application to verify the user, you need to register these
                applications. With the service, register a web application, as shown in <a href="#c25-fig-0006"
                    id="R_c25-fig-0006" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Figure
                    25-6</a>. After registering the application, you can define scopes for the API. With the sample
                application, the scopes <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Read</code> and <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Write</code> are
                defined to differ between reading and writing book chapters. The client application needs to be
                registered as a public client/native (mobile and desktop) application. With the client application, you
                need to configure API permissions and select the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Read</code> and <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Write</code>
                permissions that were previously created.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">为了让 ASP.NET Core 服务能够从 AD
                            接收令牌和访问声明，并允许控制台应用程序验证用户，您需要注册这些应用程序。对于服务，注册一个 Web 应用程序，如图 25-6 所示。注册应用程序后，您可以定义 API
                            的作用域。在示例应用程序中，定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Read</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Write</code>
                            作用域以区分读取和写入书籍章节。客户端应用程序需要注册为公共客户端/原生（移动和桌面）应用程序。对于客户端应用程序，您需要配置 API 权限并选择先前创建的 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Read</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Write</code>
                            权限。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0024"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-479" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Creating and Configuring the Service <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建和配置服务</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The service using authentication via the AD B2C can be
                    created using the Azure CLI. Several options are available for configuration: <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--client-id</code> for
                    the client ID or application ID, <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--domain</code> for the
                    AD domain name, <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--tenant-id</code> to
                    pass the AD tenant ID, <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--susi-policy-id</code>
                    to pass the name of the flow, and more. You can change the configurations later in the code as well:
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">通过 AD B2C 进行身份验证的服务可以使用 Azure CLI
                                创建。配置有多种选项： <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--client-id</code>
                                用于客户端 ID 或应用程序 ID， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--domain</code>
                                用于 AD 域名， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--tenant-id</code>
                                用于传递 AD 租户 ID， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--susi-policy-id</code>
                                用于传递流程名称，等等。你也可以在代码中稍后更改这些配置：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0034"><code>&gt; dotnet new api --auth IndividualB2C -o BooksApi</code></pre>
                <figure data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> <img
                        alt="Snapshot of creating and configuring the service." class="center"
                        src="images/c25f004.png" />
                    <figcaption data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span
                                class="figureLabel"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a
                                    href="#R_c25-fig-0004" id="c25-fig-0004" role="doc-backlink"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><b
                                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                        data-immersive-translate-paragraph="1">FIGURE 25-4<font
                                            class="notranslate immersive-translate-target-wrapper"
                                            data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                            <font class="notranslate"
                                                data-immersive-translate-translation-element-mark="1">  </font>
                                            <font
                                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                                data-immersive-translate-translation-element-mark="1">
                                                <font
                                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                    data-immersive-translate-translation-element-mark="1">图 25-4</font>
                                            </font>
                                        </font></b></a></span></p>
                    </figcaption>
                </figure>
                <p id="c25-para-0073" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1"><span aria-label="735" epub:type="pagebreak" id="Page_735"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>When you're
                    changing the existing web API service, these NuGet packages need to be added: <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Identity.Web</code>,
                    <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.AspNetCore.Authentication.JwtBearer</code>,
                    and <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.AspNetCore.Authentication.OpenIdConnect</code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在更改现有的 Web API 服务时，需要添加这些 NuGet 包：
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Identity.Web</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.AspNetCore.Authentication.JwtBearer</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.AspNetCore.Authentication.OpenIdConnect</code>
                                。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">With the configuration file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">appsettings.json</code>,
                    you need to specify the values for the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AzureADB2C</code>
                    section. You get the values from the Azure AD B2C configuration (configuration file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataWithAuthentication/BooksApi/appsettings.json</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用配置文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">appsettings.json</code>
                                ，您需要在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AzureADB2C</code>
                                部分指定值。您从 Azure AD B2C 配置（配置文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataWithAuthentication/BooksApi/appsettings.json</code>
                                ）中获取这些值：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0035"><code>  "AzureAdB2C": {</code>
<code>    "Instance": "https://login.microsoftonline.com/tfp/",</code>
<code>    "ClientId": "11111111-1111-1111-11111111111111111",</code>
<code>    "Domain": "qualified.domain.name",</code>
<code>    "SignUpSignInPolicyId": ""</code>
<code>  },</code></pre>
                <figure data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> <img
                        alt="Snapshot of the login page for signing in with existing account." class="center"
                        src="images/c25f005.png" />
                    <figcaption data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span
                                class="figureLabel"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a
                                    href="#R_c25-fig-0005" id="c25-fig-0005" role="doc-backlink"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><b
                                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                        data-immersive-translate-paragraph="1">FIGURE 25-5<font
                                            class="notranslate immersive-translate-target-wrapper"
                                            data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                            <font class="notranslate"
                                                data-immersive-translate-translation-element-mark="1">  </font>
                                            <font
                                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                                data-immersive-translate-translation-element-mark="1">
                                                <font
                                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                    data-immersive-translate-translation-element-mark="1">图 25-5</font>
                                            </font>
                                        </font></b></a></span></p>
                    </figcaption>
                </figure>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1"><span aria-label="736" epub:type="pagebreak" id="Page_736"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>The DI container
                    needs some registration for the authentication. The method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddAuthentication</code>
                    registers the services needed for the authentication. For working with bearer tokens, the constant
                    <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">JwtBearerDefaults.AuthenticationScheme</code>
                    is used. The method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddAuthentication</code>
                    returns an <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AuthenticationBuilder</code>.
                    With this builder, the method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddMicrosoftIdentityWebApi</code>
                    is used. By default, this API uses the bearer scheme. The section where the configuration is read is
                    configured with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IConfigurationSection</code>
                    argument. Setting the argument <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">subscribeToJwtBearerMiddlewareDiagnosticsEvents</code>
                    to true adds logging information (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataAndAuthentication/BooksApi/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">依赖注入容器需要一些用于身份验证的注册。方法 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddAuthentication</code>
                                注册了身份验证所需的服务。对于使用访问令牌，使用常量 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">JwtBearerDefaults.AuthenticationScheme</code>
                                。方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddAuthentication</code>
                                返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AuthenticationBuilder</code>
                                。使用此构建器，使用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddMicrosoftIdentityWebApi</code>
                                。默认情况下，此 API 使用访问令牌方案。配置读取的部分通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IConfigurationSection</code>
                                参数进行配置。将参数 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">subscribeToJwtBearerMiddlewareDiagnosticsEvents</code>
                                设置为 true 会添加日志信息（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataAndAuthentication/BooksApi/Startup.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0036"><code>public void ConfigureServices(IServiceCollection services)</code>
<code>{</code>
<code>  <b>services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)</b></code>
<code>    <b>.AddMicrosoftIdentityWebApi(Configuration.GetSection("AzureAdB2C"),</b> </code>
<code>      <b>subscribeToJwtBearerMiddlewareDiagnosticsEvents: true);</b></code>
<code> </code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">To authorize the clients as well as authenticate them, the
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UseAuthorization</code>
                    method needs to be added to the middleware configuration in the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Configure</code> method
                    (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataAndAuthentication/BooksApi/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了授权客户端并验证它们，需要在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Configure</code>
                                方法中的中间件配置中添加 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UseAuthorization</code>
                                方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataAndAuthentication/BooksApi/Startup.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0037"><code>public void Configure(IApplicationBuilder app, IWebHostEnvironment env)</code>
<code>{</code>
<code>  if (env.IsDevelopment())</code>
<code>  {</code>
<code>    app.UseDeveloperExceptionPage();</code>
<code>    app.UseSwagger();</code>
<code>    app.UseSwaggerUI(c =&gt; c.SwaggerEndpoint("/swagger/v1/swagger.json", "BooksApi v1"));</code>
<code>  }</code>
<code> <span aria-label="737" epub:type="pagebreak" id="Page_737" role="doc-pagebreak"></span></code>
<code>  app.UseHttpsRedirection();</code>
<code> </code>
<code>  app.UseRouting();</code>
<code> </code>
<code>  app.UseAuthentication();</code>
<code>  app.UseAuthorization();</code>
<code> </code>
<code>  app.UseEndpoints(endpoints =&gt;</code>
<code>  {</code>
<code>    endpoints.MapControllers();</code>
<code>  });</code>
<code>}</code></pre>
                <figure data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> <img
                        alt="Snapshot of registering an application." class="center" src="images/c25f006.png" />
                    <figcaption data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span
                                class="figureLabel"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a
                                    href="#R_c25-fig-0006" id="c25-fig-0006" role="doc-backlink"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><b
                                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                                        data-immersive-translate-paragraph="1">FIGURE 25-6<font
                                            class="notranslate immersive-translate-target-wrapper"
                                            data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                            <font class="notranslate"
                                                data-immersive-translate-translation-element-mark="1">  </font>
                                            <font
                                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                                data-immersive-translate-translation-element-mark="1">
                                                <font
                                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                    data-immersive-translate-translation-element-mark="1">图 25-6</font>
                                            </font>
                                        </font></b></a></span></p>
                    </figcaption>
                </figure>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">With the controller, you need to add the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Authorize</code>
                    attribute not to allow anonymous invocations. To programmatically check for the scopes with
                    different API calls, you can invoke the extension method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">VerifyUserHasAcceptedScope</code>
                    to check whether the received token has the scopes on the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpContext</code>. If
                    the <span aria-label="738" epub:type="pagebreak" id="Page_738" role="doc-pagebreak"
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>user is not
                    authenticated, this method returns 401 (Unauthenticated). If the user is authenticated but the token
                    does not have the required scope, it returns 403 (Forbidden) (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataAndAuthentication/BooksApi/Controllers/BookChaptersController.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用控制器时，需要添加 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Authorize</code>
                                属性以禁止匿名调用。要通过不同的 API 调用程序设计性地检查范围，可以调用扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">VerifyUserHasAcceptedScope</code>
                                来检查接收到的令牌是否具有 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpContext</code>
                                上的范围。如果用户未通过身份验证，此方法返回 401（未通过身份验证）。如果用户已通过身份验证但令牌没有所需范围，它返回 403（禁止）（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataAndAuthentication/BooksApi/Controllers/BookChaptersController.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0038"><code>[Produces("application/json")]</code>
<code>[Route("api/[controller]")]</code>
<code><b>[Authorize]</b></code>
<code>[ApiController]</code>
<code>public class BookChaptersController : ControllerBase</code>
<code>{</code>
<code>  private readonly IBookChapterService _chapterService;</code>
<code>  <b>static readonly string[] readScopesRequired = { "Books.Read" };</b></code>
<code>  <b>static readonly string[] writeScopesRequired = { "Books.Write" };</b></code>
<code> </code>
<code>  public BookChaptersController(IBookChapterService chapterService)</code>
<code>  {</code>
<code>    _chapterService = chapterService;</code>
<code>  }</code>
<code> </code>
<code>  // GET api/bookchapters/guid</code>
<code>  [HttpGet]</code>
<code>  public Task&lt;IEnumerable&lt;BookChapter&gt;&gt; GetBookChapters()</code>
<code>  {</code>
<code>    <b>HttpContext.VerifyUserHasAnyAcceptedScope(readScopesRequired);</b></code>
<code> </code>
<code>    return _chapterService.GetAllAsync();</code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0025"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-480" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Adding Authentication to the Client Application <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">向客户端应用程序添加认证</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">With the client application, the user needs to log in, and
                    every invocation of the API service needs to have the access token header. The NuGet package needed
                    with the client is <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Identity.Client</code>.
                    For authentication with the Azure AD, an <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AzureAdB2C</code>
                    configuration section is added to <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">appsettings.json</code>
                    (config file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataWithAuthentication/BookServiceClient/appsettings.json</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在客户端应用程序中，用户需要登录，并且每次调用 API
                                服务都需要包含访问令牌头部。客户端需要的 NuGet 包是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Identity.Client</code>
                                。要与 Azure AD 进行认证，在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">appsettings.json</code>
                                （配置文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataWithAuthentication/BookServiceClient/appsettings.json</code>
                                ）中添加了一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AzureAdB2C</code>
                                配置部分：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0039"><code>  "AzureAdB2C": {</code>
<code>    "ClientId": "11111111-1111-1111-11111111111111111",</code>
<code>    "TenantId": "qualified.domain.name",</code>
<code>    "SignUpSignInPolicyId": ""</code>
<code>  },</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">To deal with the authentication of the user, the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ClientAuthentication</code>
                    class is defined to use the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">PublicClientApplicationBuilder</code>
                    class to create an <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IPublicClientApplication</code>
                    object. Check the code download and read <a href="c20.xhtml"
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter 20</a> for
                    information about using this class. What's important here for accessing the API is to use the
                    retrieved access token after logging in. With the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">LoginAsync</code> method
                    of the class <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ClientAuthentication</code>,
                    the access token is retrieved using the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AccessToken</code>
                    property of the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AuthenticationResult</code>.
                    The value is then written to the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">_accessToken</code>
                    field. The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetAccesstokenAsync</code>
                    method returns this access token value as shown in the following code snippet. In case the field
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">_accessToken</code> is
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">null</code> or the
                    refresh parameter is <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">true</code>, another
                    invocation to <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">LoginAsync</code> is done
                    to retrieve the access token. This token is then returned from the method (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataAndAuthentication/BookServiceClient/ClientAuthentication.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">处理用户认证时，定义了 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ClientAuthentication</code>
                                类来使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">PublicClientApplicationBuilder</code>
                                类创建 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IPublicClientApplication</code>
                                对象。有关使用该类的信息，请查看代码下载并阅读第 20 章。对于访问 API 来说，重要的是在登录后使用获取到的访问令牌。通过 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ClientAuthentication</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">LoginAsync</code>
                                方法，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AuthenticationResult</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AccessToken</code>
                                属性获取访问令牌，然后将值写入 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">_accessToken</code>
                                字段。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetAccesstokenAsync</code>
                                方法返回此访问令牌值，如下面的代码片段所示。如果字段 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">_accessToken</code>
                                为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">null</code>
                                或刷新参数为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">true</code>
                                ，则会再次调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">LoginAsync</code>
                                来获取访问令牌。然后从方法返回此令牌（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataAndAuthentication/BookServiceClient/ClientAuthentication.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0040"><code>private string? _accessToken;</code>
<code> </code>
<code>public async ValueTask&lt;string&gt; GetAccesstokenAsync(bool refresh = false)<span aria-label="739" epub:type="pagebreak" id="Page_739" role="doc-pagebreak"></span></code>
<code>{</code>
<code>  if (_accessToken is null || refresh)</code>
<code>  {</code>
<code>    await LoginAsync();</code>
<code>  }</code>
<code>  if (_accessToken is null)</code>
<code>  {</code>
<code>    throw new InvalidOperationException("No access token received!");</code>
<code>  }</code>
<code>  return _accessToken;</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The access token is used with a delegating handler <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AuthenticationMessageHandler</code>,
                    as shown in the following code snippet. To retrieve the token, the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ClientAuthentication</code>
                    service is injected in the constructor. With the implementation of the overridden method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SendAsync</code>, the
                    access token is retrieved from the authentication service and added to the request headers. Then the
                    request is sent to the service by invoking the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SendAsync</code> method.
                    In case an unauthorized or forbidden result is returned, the token is refreshed, and the request is
                    repeated (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataAndAuthentication/BookServiceClient/AuthenticationMessageHandler.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">访问令牌与委托处理器 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AuthenticationMessageHandler</code>
                                一起使用，如下面的代码片段所示。为了获取令牌，在构造函数中注入了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ClientAuthentication</code>
                                服务。通过重写的方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SendAsync</code>
                                实现，从认证服务中获取访问令牌并将其添加到请求头中。然后通过调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SendAsync</code>
                                方法将请求发送到服务。如果返回未授权或禁止的结果，则刷新令牌并重复请求（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataAndAuthentication/BookServiceClient/AuthenticationMessageHandler.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0041"><code>public class AuthenticationMessageHandler : DelegatingHandler</code>
<code>{</code>
<code>  private readonly ClientAuthentication _clientAuthentication;</code>
<code>  public AuthenticationMessageHandler(ClientAuthentication clientAuthentication)</code>
<code>  {</code>
<code>    _clientAuthentication = clientAuthentication;</code>
<code>  }</code>
<code> </code>
<code>  protected override async Task&lt;HttpResponseMessage&gt; SendAsync(HttpRequestMessage request, </code>
<code>    CancellationToken cancellationToken)</code>
<code>  {</code>
<code>    <b>string token = await _clientAuthentication.GetAccesstokenAsync();</b></code>
<code>    <b>request.Headers.Authorization = new AuthenticationHeaderValue("Bearer", token);</b></code>
<code>    <b>var response = await base.SendAsync(request, cancellationToken);</b></code>
<code>    if (response.StatusCode is HttpStatusCode.Unauthorized or HttpStatusCode.Forbidden)</code>
<code>    {</code>
<code>      token = await _clientAuthentication.GetAccesstokenAsync(refresh: true);</code>
<code>      request.Headers.Authorization = new AuthenticationHeaderValue("Bearer", token);</code>
<code>      response = await base.SendAsync(request, cancellationToken);</code>
<code>    }</code>
<code>    return response;</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">With the configuration of the DI container, the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ClientAuthentication</code>
                    service is registered as a singleton, and the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AuthenticationMessageHandler</code>
                    is added as a handler for the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code> factory
                    configuration for the typed client <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApiClient</code>
                    (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataAndAuthentication/BookServiceClient/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在依赖注入容器的配置下， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ClientAuthentication</code>
                                服务被注册为单例， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AuthenticationMessageHandler</code>
                                被添加为类型化客户端 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApiClient</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                                工厂配置的处理程序（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookDataAndAuthentication/BookServiceClient/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0042"><code>using var host = Host.CreateDefaultBuilder(args)</code>
<code>  .ConfigureServices((context, services) =&gt;</code>
<code>  {</code>
<code>    <b>var clientAuthenticationSettings = context.Configuration.GetSection("AzureAdB2C");</b></code>
<code>    <b>services.Configure&lt;ClientAuthenticationOptions&gt;(clientAuthenticationSettings);</b></code>
<code>    <b>services.AddSingleton&lt;ClientAuthentication&gt;();</b></code>
<code>    var bookApiSettings = context.Configuration.GetSection("BooksService");</code>
<code>    services.Configure&lt;BooksApiClientOptions&gt;(bookApiSettings);<span aria-label="740" epub:type="pagebreak" id="Page_740" role="doc-pagebreak"></span></code>
<code>    services.AddTransient&lt;AuthenticationMessageHandler&gt;();</code>
<code>    services.AddHttpClient&lt;BooksApiClient&gt;(config =&gt;</code>
<code>    {</code>
<code>      var baseAddress = context.Configuration.GetSection("BooksService")["BaseAddress"] </code>
<code>        ?? "https://localhost:5001";</code>
<code>      config.BaseAddress = new Uri(baseAddress);</code>
<code>    })<b>.AddHttpMessageHandler&lt;AuthenticationMessageHandler&gt;();</b></code>
<code>  }).Build();</code></pre>
                <p id="c25-para-0082" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">With this in place, the user is authenticated on starting the
                    application. The implementation of the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApiClient</code>
                    class can stay like before—with the message handler, every invocation of the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code> is
                    injected to add the access token.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">这样设置后，用户在启动应用程序时就会被认证。 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksApiClient</code>
                                类的实现可以保持原样——通过消息处理器，每次调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                                都会注入访问令牌。</font>
                        </font>
                    </font>
                </p>
            </section>
        </section>
        <section aria-labelledby="head-2-234" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
            <span id="c25-sec-0026" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <h2 id="head-2-234" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">IMPLEMENTING AND USING SERVICES WITH GRPC<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用 gRPC 实现和使用服务</font>
                    </font>
                </font>
            </h2>
            <p id="c25-para-0083" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">Sending JSON from a service is optimal with JavaScript clients.
                JavaScript objects can easily be created from a JSON tree. However, to reduce CPU time needed for the
                serialization, memory needs, and the bandwidth across the network (which also can decrease the cost),
                other options can be more useful. With the next solution, the same <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Shared</code> and <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Data</code> libraries
                are used, but the service and clients are implemented using gRPC.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">对于 JavaScript 客户端，从服务发送 JSON
                            是最优的。JavaScript 对象可以轻松地从 JSON 树创建。然而，为了减少序列化所需的 CPU
                            时间、内存需求以及网络带宽（这也可以降低成本），其他选项可能更有用。在下一个解决方案中，仍然使用相同的 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Shared</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Data</code>
                            库，但服务和客户端使用 gRPC 实现。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0027"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-481" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Creating a gRPC Project<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建 gRPC 项目</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The .NET SDK has built-in support for gRPC. You can create a
                    new gRPC service project with the .NET CLI:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">.NET SDK 对 gRPC 提供内置支持。您可以使用 .NET
                                CLI 创建一个新的 gRPC 服务项目：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0043"><code>&gt; dotnet new grpc -o GRPCService</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">A gRPC project is an ASP.NET Core project with just a few
                    additions. In the project file, you can see the NuGet package <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Grpc.AspNetCore</code>
                    referenced. This package has a dependency on <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Google.Protobuf</code>
                    and <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Grpc.Tools</code>.
                    Protocol buffers (Protobuf) are defined by Google for binary serialization (see <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://developers.google.com/protocol-buffers/">https://developers.google.com/protocol-buffers/</a></code>).
                    The .NET SDK includes a Protobuf compiler that creates classes based on definition files referenced
                    by the <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Protobuf</code>
                    element. Setting the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GrpcServices</code>
                    attribute to <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Server</code>, a stub for
                    the server is created. This stub receives the binary message, invokes a method with the service, and
                    returns a binary message to the caller (project file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/GRPCService.csproj</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">一个 gRPC 项目就是一个带有少量附加功能的 ASP.NET
                                Core 项目。在项目文件中，你可以看到引用了 NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Grpc.AspNetCore</code>
                                。这个包依赖于 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Google.Protobuf</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Grpc.Tools</code>
                                。协议缓冲区（Protobuf）是由 Google 定义的二进制序列化格式（参见 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://developers.google.com/protocol-buffers/">https://developers.google.com/protocol-buffers/</a></code>
                                ）。.NET SDK 包含一个 Protobuf 编译器，它根据 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Protobuf</code>
                                元素引用的定义文件创建类。将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GrpcServices</code>
                                属性设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Server</code>
                                ，就会创建一个服务器存根。这个存根接收二进制消息，通过服务调用方法，并将二进制消息返回给调用者（项目文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/GRPCService.csproj</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0044"><code>&lt;Project Sdk="Microsoft.NET.Sdk.Web"&gt;</code>
<code> </code>
<code>  &lt;PropertyGroup&gt;</code>
<code>    &lt;TargetFramework&gt;net5.0&lt;/TargetFramework&gt;</code>
<code>    &lt;Nullable&gt;enable&lt;/Nullable&gt;</code>
<code>  &lt;/PropertyGroup&gt;</code>
<code> </code>
<code>  &lt;ItemGroup&gt;</code>
<code>    &lt;None Remove="Protos\sensor.proto"/&gt;</code>
<code>  &lt;/ItemGroup&gt;</code>
<code> </code>
<code>  &lt;ItemGroup&gt;</code>
<code>    <b>&lt;Protobuf Include="Protos\sensor.proto" GrpcServices="Server" /&gt;</b></code>
<code>    <b>&lt;Protobuf Include="Protos\books.proto" GrpcServices="Server" /&gt;</b></code>
<code>  &lt;/ItemGroup&gt;</code>
<code> </code>
<code>  &lt;ItemGroup&gt;</code>
<code>    <b>&lt;PackageReference Include="Grpc.AspNetCore" Version="2.34.0" /&gt;</b></code>
<code>  &lt;/ItemGroup&gt;</code>
<code> <span aria-label="741" epub:type="pagebreak" id="Page_741" role="doc-pagebreak"></span></code>
<code>  &lt;ItemGroup&gt;</code>
<code>    &lt;ProjectReference Include="..\Books.Data\Books.Data.csproj"/&gt;</code>
<code>  &lt;/ItemGroup&gt;</code>
<code> </code>
<code>&lt;/Project&gt;</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">With the template-generated code, the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Program.cs</code> file
                    contains the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Main</code> method with
                    the <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Host</code> class
                    to configure the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Startup</code> class;
                    this code is not different compared to the ASP.NET Core projects you've seen so far, which is the
                    reason it's not repeated here. With the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Startup</code> class, the
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddGrpc</code> method
                    is used to configure the services used by gRPC in the DI container, as shown in the following code
                    snippet. The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddGrpc</code> method
                    returns an <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IGrpcServerBuilder</code>,
                    which allows further configuration of the gRPC service. In addition, the EF Core context is
                    configured as before (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">通过模板生成的代码， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Program.cs</code>
                                文件包含 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Main</code>
                                方法与 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Host</code>
                                类来配置 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Startup</code>
                                类；与您之前看到的 ASP.NET Core 项目相比，这段代码没有区别，因此这里不再重复。使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Startup</code>
                                类，通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddGrpc</code>
                                方法配置 DI 容器中 gRPC 使用的服务，如下面的代码片段所示。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddGrpc</code>
                                方法返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IGrpcServerBuilder</code>
                                ，允许进一步配置 gRPC 服务。此外，EF Core 上下文按之前的方式配置（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/Startup.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0045"><code>public void ConfigureServices(IServiceCollection services)</code>
<code>{</code>
<code>  <b>services.AddGrpc();</b></code>
<code>  services.AddDbContext&lt;IBookChapterService, BooksContext&gt;(options =&gt;</code>
<code>  {</code>
<code>    string connectionString = _configuration.GetConnectionString("BooksConnection");</code>
<code>    options.UseSqlServer(connectionString);</code>
<code>  });</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">With the configuration of the endpoint routing in the
                    middleware method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Configure</code>, <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">MapGrpcService</code> is
                    used to map the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksService</code> and
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SensorService</code>
                    classes to endpoints (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在中间件方法 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Configure</code>
                                的端点路由配置中，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">MapGrpcService</code>
                                将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksService</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SensorService</code>
                                类映射到端点（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/Startup.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0046"><code>app.UseEndpoints(endpoints =&gt;</code>
<code>{</code>
<code>  endpoints.MapGrpcService&lt;BooksService&gt;();</code>
<code>  endpoints.MapGrpcService&lt;SensorService&gt;();</code>
<code> </code>
<code>  endpoints.MapGet("/", async context =&gt;</code>
<code>  {</code>
<code>    await context.Response.WriteAsync("Use a gRPC client!");</code>
<code>  });</code>
<code>});</code></pre>
            </section>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0028"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-482" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Defining the Contract with Protobuf <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 Protobuf 定义契约</font>
                        </font>
                    </font>
                </h3>
                <p id="c25-para-0088" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Before implementing the service classes, the contracts need
                    to be specified with a <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">.proto</code> file. With
                    the sample application, <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">books.proto</code> in the
                    following code segment defines the contracts for the service that uses the database to read and
                    write book chapters. The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">syntax</code> element
                    defines the Protobuf version. The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">package</code> element is
                    used to prevent naming conflicts. If the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">csharp_namespace</code>
                    option is not specified, the package name defines the namespace of the generated C# classes. In the
                    sample code, <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">csharp_namespace</code>
                    is defined; thus, the generated namespace name is <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCService</code>. The
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">service</code> elements
                    specify the operations offered from the service. The sample code defines the operations <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapters</code>
                    and <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddBookChapter</code>.
                    Each operation requires information about the message that is sent to the service and the message
                    that is returned. <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapters</code>
                    returns a message defined with the name <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapterResponse</code>.
                    This operation doesn't require data to send to the service; thus, an <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Empty</code> message is
                    used. To make the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Empty</code> message
                    available, the file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">empty.proto</code> needs
                    to be imported.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在实现服务类之前，需要使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">.proto</code>
                                文件指定合约。在示例应用程序中，以下代码片段中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">books.proto</code>
                                定义了使用数据库读取和写入书籍章节的服务合约。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">syntax</code>
                                元素定义了 Protobuf 版本。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">package</code>
                                元素用于防止命名冲突。如果未指定 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">csharp_namespace</code>
                                选项，则包名定义生成的 C# 类的命名空间。在示例代码中定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">csharp_namespace</code>
                                ；因此，生成的命名空间名称是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCService</code>
                                。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">service</code>
                                元素指定了服务提供的服务操作。示例代码定义了操作 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapters</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddBookChapter</code>
                                。每个操作都需要有关发送到服务的消息和返回的消息的信息。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapters</code>
                                返回一个名为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapterResponse</code>
                                的消息。此操作不需要向服务发送数据；因此，使用了一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Empty</code>
                                消息。为了使 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Empty</code>
                                消息可用，需要导入文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">empty.proto</code>
                                。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">
                    <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapterResponse</code>
                    is defined with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">message</code> element.
                    This element nests another <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">message</code> element:
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter</code>.
                    Declaring a field with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">repeated</code> modifier,
                    the field can be repeated any number of times (which is the case with any number of book chapters
                    returned). The message <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter</code> specifies
                    all the members that are needed to read and write book chapter records from the database. The
                    numbers used with every field are unique tags for binary encoding. You can use Protobuf-specific
                    data types such as <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">string</code>, <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">int32</code>. These types
                    are <span aria-label="742" epub:type="pagebreak" id="Page_742" role="doc-pagebreak"
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>platform-independent
                    and map to C# data types such as <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">string</code> and <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">int</code> (proto file
                    <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/Protos/books.proto</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapterResponse</code>
                                是通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">message</code>
                                元素定义的。该元素嵌套了另一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">message</code>
                                元素： <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter</code>
                                。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">repeated</code>
                                修饰符声明字段，该字段可以重复任意次数（这与返回任意数量的书籍章节的情况相同）。消息 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter</code>
                                指定了所有需要从数据库中读取和写入书籍章节记录的成员。每个字段使用的数字是用于二进制编码的唯一标签。你可以使用 Protobuf 特定的数据类型，如 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">string</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">int32</code>
                                。这些类型是平台无关的，并映射到 C# 数据类型，如 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">string</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">int</code>
                                （proto 文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/Protos/books.proto</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0047"><code>syntax = "proto3";</code>
<code>package bookservice;</code>
<code>option csharp_namespace = "GRPCService";</code>
<code> </code>
<code>import "google/protobuf/empty.proto";</code>
<code> </code>
<code> </code>
<code>// The book service definition.</code>
<code>service GRPCBooks {</code>
<code>  rpc GetBookChapters (google.protobuf.Empty) returns (GetBookChapterResponse);</code>
<code>  rpc AddBookChapter (AddBookChapterRequest) returns (AddBookChapterResponse);</code>
<code>}</code>
<code> </code>
<code>message AddBookChapterRequest {</code>
<code>  Chapter Chapter = 1;</code>
<code>}</code>
<code> </code>
<code>message AddBookChapterResponse {</code>
<code>  Chapter Chapter = 1;</code>
<code>}</code>
<code> </code>
<code>message GetBookChapterResponse {</code>
<code>  repeated Chapter chapters = 1;</code>
<code>}</code>
<code> </code>
<code>message Chapter {</code>
<code>  string id = 1;</code>
<code>  int32 number = 2;</code>
<code>  string title = 3;</code>
<code>  int32 pageCount = 4;</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <div class="top hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <p id="c25-para-0091" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NOTE</b> <i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Protobuf is not
                                the only option for serialization with gRPC. Another option is Microsoft's Bond
                                framework (see </i><code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://github.com/microsoft/bond">https://github.com/microsoft/bond</a></code><i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">). Bond offers
                                multiplatform and multilanguage support like gRPC and Protobuf. To use Bond with gRPC,
                                see </i><code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://microsoft.github.io/bond/manual/bond_over_grpc.html">https://microsoft.github.io/bond/manual/bond_over_grpc.html</a></code><i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">. Although Bond
                                is often used within Microsoft, gRPC with Protobuf has more support from the
                                community.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 Protobuf 并非 gRPC
                                        序列化的唯一选项。另一个选项是微软的 Bond 框架（见 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://github.com/microsoft/bond">https://github.com/microsoft/bond</a></code>
                                        ）。Bond 提供类似 gRPC 和 Protobuf 的多平台和多语言支持。要在 gRPC 中使用 Bond，请见 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://microsoft.github.io/bond/manual/bond_over_grpc.html">https://microsoft.github.io/bond/manual/bond_over_grpc.html</a></code>
                                        。虽然 Bond 通常在微软内部使用，但使用 Protobuf 的 gRPC 得到了社区更多的支持。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0030"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-483" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Implementing a gRPC Service<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">实现 gRPC 服务</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The Protobuf compiler creates classes for every message
                    defined and classes for the services. Using the libraries to access the database, the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code> record
                    is defined. With the gRPC service, the corresponding <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter</code> class is
                    created by the Protobuf compiler. For an easy conversion between these two types, the application
                    defines the extension methods <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ToBookChapter</code> and
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ToGRPCChapter</code>
                    (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/Services/BooksService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">Protobuf
                                编译器为每个定义的消息创建类，并为服务创建类。使用库访问数据库时，定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BookChapter</code>
                                记录。通过 gRPC 服务，Protobuf 编译器创建了相应的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter</code>
                                类。为了在这两种类型之间轻松转换，应用程序定义了扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ToBookChapter</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ToGRPCChapter</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/Services/BooksService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0048"><code>static class ChapterExtensions</code>
<code>{</code>
<code>  public static BookChapter ToBookChapter(this Chapter chapter) =&gt;<span aria-label="743" epub:type="pagebreak" id="Page_743" role="doc-pagebreak"></span></code>
<code>    new BookChapter(</code>
<code>      Guid.Parse(chapter.Id),</code>
<code>      chapter.Number,</code>
<code>      chapter.Title,</code>
<code>      chapter.PageCount);</code>
<code> </code>
<code>  public static Chapter ToGRPCChapter(this BookChapter chapter) =&gt;</code>
<code>    new Chapter</code>
<code>    {</code>
<code>      Id = chapter.Id.ToString(),</code>
<code>      Number = chapter.Number,</code>
<code>      Title = chapter.Title,</code>
<code>      PageCount = chapter.PageCount</code>
<code>    };</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Because of the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">service</code> definition
                    in the proto file, a static class <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCBooks</code> with an
                    inner abstract base class is created: <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCBooks.GRPCBooksBase</code>.
                    The name of the outer class comes from the name of the service, and the name <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Base</code> is used as a
                    postfix for the inner class. The class <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCBooksBase</code>
                    defines the methods <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapters</code>
                    and <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddBookChapter</code>
                    that you need to override, as shown in the following code snippet. With the implementation of <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddBookChapter</code>,
                    the injected <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>
                    is used to add a book (after converting it from the gRPC class to the record) to the database. With
                    the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapters</code>,
                    the database is queried for all the book chapters, and the chapters are converted and added to the
                    response (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/Services/BooksService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">由于 proto 文件中的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">service</code>
                                定义，会创建一个静态类 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCBooks</code>
                                ，其中包含一个内部抽象基类： <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCBooks.GRPCBooksBase</code>
                                。外部类的名称来自服务的名称，而 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Base</code>
                                用作内部类的后缀。类 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCBooksBase</code>
                                定义了您需要重写的方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapters</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddBookChapter</code>
                                ，如下面的代码片段所示。通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddBookChapter</code>
                                的实现，注入的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>
                                用于将书籍（在从 gRPC 类转换为记录后）添加到数据库中。通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChapters</code>
                                ，数据库会查询所有书籍章节，并将章节转换后添加到响应中（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/Services/BooksService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0049"><code>public class BooksService : GRPCBooks.GRPCBooksBase</code>
<code>{</code>
<code>  private readonly IBookChapterService _bookChapterService;</code>
<code>  private readonly ILogger _logger;</code>
<code>  public BooksService(ILogger&lt;BooksService&gt; logger, </code>
<code>    IBookChapterService bookChapterService)</code>
<code>  {</code>
<code>    _logger = logger;</code>
<code>    _bookChapterService = bookChapterService;</code>
<code>  }</code>
<code> </code>
<code>  public override async Task&lt;AddBookChapterResponse&gt; AddBookChapter(</code>
<code>    AddBookChapterRequest request, ServerCallContext context)</code>
<code>  {</code>
<code>    var bookChapter = request.Chapter.ToBookChapter();</code>
<code>    await _bookChapterService.AddAsync(bookChapter);</code>
<code>    AddBookChapterResponse response = new()</code>
<code>    {</code>
<code>      Chapter = bookChapter.ToGRPCChapter()</code>
<code>    };</code>
<code>    return response;</code>
<code>  }</code>
<code> </code>
<code>  public override async Task&lt;GetBookChapterResponse&gt; GetBookChapters(</code>
<code>    Empty request, ServerCallContext context)</code>
<code>  {</code>
<code>    var bookChapters = await _bookChapterService.GetAllAsync();</code>
<code>    GetBookChapterResponse response = new();</code>
<code>    response.Chapters.AddRange(bookChapters.Select(bc =&gt; bc.ToGRPCChapter()).ToArray());</code>
<code>    return response;</code>
<code>  }</code>
<code>}</code></pre>
            </section> <span aria-label="744" epub:type="pagebreak" id="Page_744" role="doc-pagebreak"
                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0031"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-484" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Implementing a gRPC Client<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">实现 gRPC 客户端</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">To implement a gRPC client application, a .NET console
                    application is used. For adding the NuGet packages and the definitions to create the client-side
                    stub, with Visual Studio you can add a connected service to the gRPC service and reference the proto
                    file. Without using Visual Studio, you need to add the NuGet packages <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Google.Protobuf</code>,
                    <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Grpc.Net.ClientFactory</code>,
                    and <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Grpc.Tools</code>.
                    To use the <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Host</code>
                    class with the client, the NuGet package <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Extensions.Hosting</code>
                    needs to be added as well. To create the client-side proxy, the proto file from the server is
                    referenced using a <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Protobuf</code> element
                    with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GrpcServices</code>
                    attribute set to <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Client</code>. This
                    creates the stub for the client (project file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPC.BooksClient/GRPC.BooksClient.csproj</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要实现 gRPC 客户端应用程序，可以使用.NET
                                控制台应用程序。为了添加 NuGet 包和创建客户端端存根的定义，使用 Visual Studio 可以将连接服务添加到 gRPC 服务并引用 proto 文件。不使用
                                Visual Studio 时，需要添加 NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Google.Protobuf</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Grpc.Net.ClientFactory</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Grpc.Tools</code>
                                。要使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Host</code>
                                类与客户端一起使用，还需要添加 NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Extensions.Hosting</code>
                                。为了创建客户端端代理，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Protobuf</code>
                                元素并将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GrpcServices</code>
                                属性设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Client</code>
                                ，从服务器引用 proto 文件。这为客户端创建了存根（项目文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPC.BooksClient/GRPC.BooksClient.csproj</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0050"><code>&lt;Project Sdk="Microsoft.NET.Sdk"&gt;</code>
<code>  &lt;PropertyGroup&gt;</code>
<code>    &lt;OutputType&gt;Exe&lt;/OutputType&gt;</code>
<code>    &lt;TargetFramework&gt;net5.0&lt;/TargetFramework&gt;</code>
<code>    &lt;Nullable&gt;enable&lt;/Nullable&gt;</code>
<code>  &lt;/PropertyGroup&gt;</code>
<code> </code>
<code>  &lt;ItemGroup&gt;</code>
<code>    <b>&lt;PackageReference Include="Google.Protobuf" Version="3.15.6" /&gt;</b></code>
<code>    <b>&lt;PackageReference Include="Grpc.Net.ClientFactory" Version="2.36.0" /&gt;</b></code>
<code>    <b>&lt;PackageReference Include="Grpc.Tools" Version="2.36.4"&gt;</b></code>
<code>      &lt;PrivateAssets&gt;all&lt;/PrivateAssets&gt;</code>
<code>      &lt;IncludeAssets&gt;runtime; build; native; contentfiles; analyzers; </code>
<code>        buildtransitive&lt;/IncludeAssets&gt;</code>
<code>    &lt;/PackageReference&gt;</code>
<code>    &lt;PackageReference Include="Microsoft.Extensions.Hosting" Version="5.0.0"/&gt;</code>
<code>  &lt;/ItemGroup&gt;</code>
<code> </code>
<code>  &lt;ItemGroup&gt;</code>
<code>    &lt;ProjectReference Include="..\Books.Shared\Books.Shared.csproj"/&gt;</code>
<code>  &lt;/ItemGroup&gt;</code>
<code> </code>
<code>  <b>&lt;ItemGroup&gt;</b></code>
<code>    <b>&lt;Protobuf Include="..\GRPCService\Protos\books.proto" GrpcServices="Client"&gt;</b></code>
<code>      <b>&lt;Link&gt;Protos\books.proto&lt;/Link&gt;</b></code>
<code>    <b>&lt;/Protobuf&gt;</b></code>
<code>  <b>&lt;/ItemGroup&gt;</b></code>
<code> </code>
<code>  &lt;ItemGroup&gt;</code>
<code>    &lt;None Update="appsettings.json"&gt;</code>
<code>      &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;</code>
<code>    &lt;/None&gt;</code>
<code>  &lt;/ItemGroup&gt;</code>
<code> </code>
<code>&lt;/Project&gt;</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The stub that's created from the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">books.proto</code> file
                    has the name <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCBooks.GRPCBooksClient</code>.
                    The NuGet package <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Grpc.Net.ClientFactory</code>
                    offers a similar factory as you've seen with the HttpClient factory. As you can see in the following
                    code snippet, you can invoke the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddGrpcClient</code>
                    method and pass the generated stub class with the generic parameter. Using the options of type <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GrpcClientFactoryOptions</code>,
                    beside other configurations, you can specify the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Address</code> to the
                    service. <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GrpcChannelOptions</code>
                    allow you to specify the maximum message size, the number of retry attempts, buffer sizes, and
                    whether an <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">OperationCanceledException</code>
                    should be thrown on cancelation (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPC.BooksClient/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">从 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">books.proto</code>
                                文件创建的存根命名为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCBooks.GRPCBooksClient</code>
                                。NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Grpc.Net.ClientFactory</code>
                                提供了一个与 HttpClient 工厂类似的工厂。如以下代码片段所示，你可以调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddGrpcClient</code>
                                方法，并将生成的存根类作为泛型参数传递。使用类型为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GrpcClientFactoryOptions</code>
                                的选项，除了其他配置之外，你还可以指定 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Address</code>
                                给服务。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GrpcChannelOptions</code>
                                允许你指定最大消息大小、重试次数、缓冲区大小，以及取消操作时是否抛出 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">OperationCanceledException</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPC.BooksClient/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0051"><code>using GRPCService;</code>
<code>using Microsoft.Extensions.DependencyInjection;<span aria-label="745" epub:type="pagebreak" id="Page_745" role="doc-pagebreak"></span></code>
<code>using Microsoft.Extensions.Hosting;</code>
<code>using System;</code>
<code> </code>
<code>using var host = Host.CreateDefaultBuilder(args)</code>
<code>  .ConfigureServices((context, services) =&gt;</code>
<code>  {</code>
<code>    <b>services.AddGrpcClient&lt;GRPCBooks.GRPCBooksClient&gt;(options =&gt;</b></code>
<code>    <b>{</b></code>
<code>      <b>string grpcServiceUri = context.Configuration["GrpcServiceUri"]</b> </code>
<code>        <b>?? "https://localhost:5001";</b></code>
<code>      <b>options.Address = new Uri(grpcServiceUri);</b></code>
<code>      <b>options.ChannelOptionsActions.Add(options =&gt;</b></code>
<code>      <b>{</b></code>
<code>        <b>options.ThrowOperationCanceledOnCancellation = true;</b></code>
<code>      <b>});</b></code>
<code>    <b>});</b></code>
<code> </code>
<code>    services.AddSingleton&lt;Runner&gt;();</code>
<code>  })</code>
<code>  .Build();</code>
<code> </code>
<code>Console.WriteLine("press return to start");</code>
<code>Console.ReadLine();</code>
<code> </code>
<code>var runner = host.Services.GetRequiredService&lt;Runner&gt;();</code>
<code>await runner.RunAsync();</code>
<code> </code>
<code>Console.ReadLine();</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Runner</code> class makes
                    use of the gRPC client stub to invoke the service. The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCBooksGRPCBooksClient</code>
                    is injected in the constructor. Within the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">RunAsync</code> method,
                    the proxy methods <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddBookChaptersAsync</code>
                    and <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChaptersAsync</code>
                    are invoked to send messages to the services and receive the results (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPC.BooksClient/Runner.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Runner</code>
                                类使用 gRPC 客户端存根来调用服务。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCBooksGRPCBooksClient</code>
                                在构造函数中被注入。在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">RunAsync</code>
                                方法中，通过调用代理方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddBookChaptersAsync</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetBookChaptersAsync</code>
                                向服务发送消息并接收结果（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPC.BooksClient/Runner.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0052"><code>public class Runner</code>
<code>{</code>
<code>  private readonly GRPCBooks.GRPCBooksClient _booksClient;</code>
<code>  private readonly ILogger _logger;</code>
<code>  public Runner(<b>GRPCBooks.GRPCBooksClient booksClient</b>, ILogger&lt;Runner&gt; logger)</code>
<code>  {</code>
<code>    _booksClient = booksClient;</code>
<code>    _logger = logger;</code>
<code>  }</code>
<code> </code>
<code>  public async Task RunAsync()</code>
<code>  {</code>
<code>    CancellationTokenSource cts = new(10000); // cancel after 10 seconds</code>
<code> </code>
<code>    try</code>
<code>    {</code>
<code>      BookChapter bookChapter = new(Guid.NewGuid(), 43, "A new GPRC chapter", 20);</code>
<code>      AddBookChapterRequest request = new() </code>
<code>      { </code>
<code>        Chapter = bookChapter.ToGRPCChapter() </code>
<code>      };<span aria-label="746" epub:type="pagebreak" id="Page_746" role="doc-pagebreak"></span></code>
<code>      var addBookResponse = await _booksClient.AddBookChapterAsync(request);</code>
<code>      Console.WriteLine($"added a new book");</code>
<code> </code>
<code>      var getBookResponse = await _booksClient.GetBookChaptersAsync(new Empty());</code>
<code>      var bookChapters = getBookResponse.Chapters.Select(</code>
<code>        c =&gt; c.ToBookChapter()).ToArray();</code>
<code>      foreach (var chapter in bookChapters)</code>
<code>      {</code>
<code>        Console.WriteLine($"{chapter.Number}: {chapter.Title}");</code>
<code>      }</code>
<code>    }</code>
<code>    catch (Exception ex)</code>
<code>    {</code>
<code>      _logger.LogError(ex, ex.Message);</code>
<code>      throw;</code>
<code>    }</code>
<code>  }</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0032"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-485" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Streaming with gRPC<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 gRPC 进行流式传输</font>
                        </font>
                    </font>
                </h3>
                <p id="c25-para-0097" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">gRPC offers asynchronous streaming, as shown in the next
                    sample. Instead of using a request/reply scenario, a stream of data can be sent from the client to
                    the service or from the service to the client, or streams can be sent in both directions.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">gRPC
                                提供异步流式传输，如下一个示例所示。它不使用请求/回复场景，而是可以从客户端向服务端发送数据流，或从服务端向客户端发送数据流，或者可以在两个方向上发送流。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">To implement streaming, the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCService</code> is
                    enhanced with a simulation of a device that continuously sends sensor data to the client. With the
                    following <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">sensor.proto</code> file,
                    a stream of <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SensorData</code>
                    messages is returned to the client after a message is received to invoke the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetSensorData</code>
                    operation. The data that is sent is defined with the message <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SensorData</code>. This
                    message includes two <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">int32</code> values and a
                    timestamp. For the timestamp value, <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">google/protobuf/timestamp.proto</code>
                    needs to be imported. To pass a stream to the client, the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">rpc</code> operation
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetSensorData</code>
                    specifies to return a stream of <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SensorData</code>
                    messages with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">stream</code> modifier
                    (proto file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCSerivce/Protos/sensor.proto</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要实现流式传输， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPCService</code>
                                通过模拟一个持续向客户端发送传感器数据的设备得到增强。使用以下 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">sensor.proto</code>
                                文件，在接收到调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetSensorData</code>
                                操作的消息后，会向客户端返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SensorData</code>
                                消息的流。发送的数据由消息 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">SensorData</code>
                                定义。该消息包含两个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">int32</code>
                                值和一个时间戳。对于时间戳值，需要导入 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">google/protobuf/timestamp.proto</code>
                                。要将流传递给客户端，操作 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">rpc</code>
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetSensorData</code>
                                指定使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">stream</code>
                                修饰符（proto 文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCSerivce/Protos/sensor.proto</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0053"><code>syntax = "proto3";</code>
<code>package sensing;</code>
<code>option csharp_namespace = "GRPCService";</code>
<code> </code>
<code>import "google/protobuf/empty.proto";</code>
<code>import "google/protobuf/timestamp.proto";</code>
<code> </code>
<code>service Sensor {</code>
<code>  rpc GetSensorData (google.protobuf.Empty) returns (<b>stream SensorData</b>);</code>
<code>}</code>
<code> </code>
<code>message SensorData {</code>
<code>  google.protobuf.Timestamp timestamp = 1;</code>
<code>  int32 val1 = 2;</code>
<code>  int32 val2 = 3;</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">With this proto file, the method that needs to be overridden
                    is declared with an <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IServerStreamWriter&lt;SensorData&gt;</code>
                    parameter. With this, the stream of data can be sent by invoking the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">WriteAsync</code> method
                    (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/Services/SensorService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">通过这个 proto 文件，需要被重写的方法声明带有 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IServerStreamWriter&lt;SensorData&gt;</code>
                                参数。通过调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">WriteAsync</code>
                                方法，可以发送数据流（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPCService/Services/SensorService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0054"><code>public override async Task GetSensorData(Empty request, </code>
<code>  IServerStreamWriter&lt;SensorData&gt; responseStream, ServerCallContext context)<span aria-label="747" epub:type="pagebreak" id="Page_747" role="doc-pagebreak"></span></code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    Random = new();</code>
<code> </code>
<code>    while (!context.CancellationToken.IsCancellationRequested)</code>
<code>    {</code>
<code>      await Task.Delay(100, context.CancellationToken);</code>
<code>      SensorData data = new()</code>
<code>      {</code>
<code>        Timestamp = Timestamp.FromDateTime(DateTime.UtcNow),</code>
<code>        Val1 = random.Next(100),</code>
<code>        Val2 = random.Next(100)</code>
<code>      };</code>
<code>      Console.WriteLine($"returning data {data}");</code>
<code>      await responseStream.WriteAsync(data);</code>
<code>    }</code>
<code>  }</code>
<code>  catch (TaskCanceledException ex)</code>
<code>  {</code>
<code>    _logger.LogInformation(ex.Message);</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The client application is implemented in a similar way as
                    before; the difference is the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">sensor.proto</code> file.
                    When a return stream is declared, the stub-created method returns an object of <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AsyncServerStreamingCall&lt;SensorData&gt;</code>.
                    This object can be used to access the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ResponseStream</code> and
                    invoke the method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadAllAsync</code>.
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadAllAsync</code> is
                    an extension method for the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IAsyncStreamReader</code>
                    and returns <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IAsyncEnumerable</code>.
                    This interface can be used with <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">await foreach</code> to
                    asynchronously iterate through the stream (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPC.SensorClient/Runner.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">客户端应用程序的实现方式与之前类似；不同之处在于 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">sensor.proto</code>
                                文件。当声明返回流时，由存根创建的方法会返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AsyncServerStreamingCall&lt;SensorData&gt;</code>
                                对象。该对象可用于访问 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ResponseStream</code>
                                并调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadAllAsync</code>
                                。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadAllAsync</code>
                                是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IAsyncStreamReader</code>
                                的扩展方法，返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IAsyncEnumerable</code>
                                。此接口可用于与 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">await foreach</code>
                                一起异步迭代流（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GRPC/GRPC.SensorClient/Runner.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0055"><code>public async Task RunAsync()</code>
<code>{</code>
<code>  CancellationTokenSource cts = new(10000); // cancel after 10 seconds</code>
<code> </code>
<code>  try</code>
<code>  {</code>
<code>    <b>using var stream = _sensorClient.GetSensorData(new Empty());</b></code>
<code> </code>
<code>    <b>await foreach (var data in</b> </code>
<code>      <b>stream.ResponseStream.ReadAllAsync().WithCancellation(cts.Token))</b></code>
<code>    {</code>
<code>      Console.WriteLine($"data {data.Val1} {data.Val2} {data.Timestamp.ToDateTime():T}");</code>
<code>    }</code>
<code>  }</code>
<code>  catch (TaskCanceledException ex)</code>
<code>  {</code>
<code>    _logger.LogInformation(ex.Message);</code>
<code>  }</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <div class="top hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <p id="c25-para-0102" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NOTE</b> <i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Streaming with
                            </i> <code
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IAsyncEnumerable</code>
                            <i data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"> is shown in <a
                                    href="c11.xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter
                                    11</a>, “Tasks and Asynchronous Programming.”</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：使用 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IAsyncEnumerable</code>
                                        进行流式传输在第 11 章“任务和异步编程”中介绍。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1"><span aria-label="748" epub:type="pagebreak" id="Page_748"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>When you run both
                    the service and the client application, a stream is returned to the client until the cancelation is
                    requested after 10 seconds.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当你运行服务和客户端应用程序时，直到 10
                                秒后请求取消，才会向客户端返回一个流。</font>
                        </font>
                    </font>
                </p>
                <aside data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                    <div class="top hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                        <p id="c25-para-0104" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">NOTE</b> <i
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Besides gRPC,
                                streaming is also supported with SignalR. SignalR is covered in <a href="c28.xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter
                                    28</a>, “SignalR.”</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 除了 gRPC，SignalR
                                        也支持流传输。SignalR 在“SignalR”章节第 28 章中介绍。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
        </section>
        <section aria-labelledby="head-2-235" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
            <span id="c25-sec-0035" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <h2 id="head-2-235" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">USING AZURE FUNCTIONS<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用 Azure Functions</font>
                    </font>
                </font>
            </h2>
            <p id="c25-para-0105" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">When you create a REST API with ASP.NET Core, you can host it
                either with your own Windows server or with a Linux server, or you can use a platform-as-a-service
                (PaaS) offering and run it with Azure App Services—no matter whether you use Docker images or deploy the
                application directly. In all these cases, you have a virtual (or even physical) machine you pay for.
                Another option to create REST APIs is with Azure Functions. With this technology, you have
                consumption-based pricing as one option; you just pay for the seconds you need of the memory and CPU
                when the function is invoked. This consumption-based pricing is also known as the service offering <i
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">functions as a service</i>
                (FaaS) or by the term serverless. Of course, there's always a server in the backend, but the pricing
                model is different.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">当你使用 ASP.NET Core 创建 REST API
                            时，你可以选择在自己的 Windows 服务器或 Linux 服务器上部署，也可以使用平台即服务（PaaS）方案，通过 Azure App Services 运行——无论你使用
                            Docker 镜像还是直接部署应用程序。在所有这些情况下，你都需要为虚拟（甚至物理）机器付费。创建 REST API 的另一种选择是使用 Azure
                            Functions。这项技术提供按需付费的计价模式作为选项；你只需为函数被调用时所需的内存和 CPU
                            时间付费。这种按需付费的计价模式也被称为服务即函数（FaaS）或无服务器。当然，后台始终存在服务器，但计价模式不同。</font>
                    </font>
                </font>
            </p>
            <p id="c25-para-0106" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">Azure Functions already had several iterations with Microsoft
                Azure. The first version is based on the .NET Framework. Versions 2 and 3 of Azure Functions are based
                on .NET Core 2.1 and 3—the long-term supported versions of .NET Core. Now the next generation is
                available. With the new generation, Azure Functions can run in an isolated process mode that allows you
                to run the function's code in a different process than the hosting environment: <i
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">out of process</i>. This way,
                you are independent of the runtime that's available on the hosting platform and can use .NET 5. At the
                time of this writing, there are some limits with this version because you don't have a Visual Studio
                template to create this Azure Function, and you cannot create the function app in the Azure portal.
                Instead, you can use the Azure CLI and the <i
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Azure Functions Core
                    Tools</i>. (See <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local">https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local</a></code>
                for information on installing the Azure Functions Core Tools with Windows, macOS, and Linux.)<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">Azure Functions 已经与 Microsoft Azure
                            进行了多次迭代。第一个版本基于.NET Framework。Azure Functions 的 2 版和 3 版基于.NET Core 2.1 和 3——这是.NET Core
                            的长期支持版本。现在新一代已经可用。随着新一代的推出，Azure Functions
                            可以在隔离进程模式下运行，该模式允许你在不同于托管环境的进程中运行函数代码：进程外。这样，你就不依赖于托管平台上的运行时，并且可以使用.NET
                            5。在撰写本文时，这个版本存在一些限制，因为你没有用于创建此 Azure Function 的 Visual Studio 模板，并且无法在 Azure
                            门户中创建函数应用。相反，你可以使用 Azure CLI 和 Azure Functions Core Tools。（有关在 Windows、macOS 和 Linux 上安装
                            Azure Functions Core Tools 的信息，请参阅 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local">https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local</a></code>
                            。）</font>
                    </font>
                </font>
            </p>
            <p id="c25-para-0107" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">The sample application for the Azure Functions offers the same
                functionality as the ASP.NET Core web API and gRPC samples to read and create book chapters, using the
                same libraries as before. If you create the functionality of your applications independent of the
                hosting environment, you have the flexibility to choose and change technologies.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">Azure Functions 的示例应用程序提供了与 ASP.NET
                            Core Web API 和 gRPC 示例相同的功能，用于读取和创建书籍章节，并使用相同的库。如果您独立于托管环境创建应用程序的功能，您将拥有选择和更改技术的灵活性。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0036"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-486" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Creating an Azure Functions Project <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建 Azure Functions 项目</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">To create an Azure Function, create a new folder <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Function</code>,
                    and with the current directory set to this folder, use the Azure Functions command-line interface
                    and specify <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">dotnetIsolated</code>
                    with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--worker-runtime</code>
                    option and the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">init</code> action:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要创建 Azure Function，请创建一个新文件夹 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Function</code>
                                ，并将当前目录设置为该文件夹，然后使用 Azure Functions 命令行界面，并使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">dotnetIsolated</code>
                                选项和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--worker-runtime</code>
                                动作指定 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">init</code> 。
                            </font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0056"><code>&gt; func init --worker-runtime dotnetIsolated</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">This creates a .NET 5 console application with a project file
                    referencing the NuGet packages <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Azure.Functions.Worker.Sdk</code>
                    and <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Azure.Functions.Worker</code>,
                    <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">configuration files host.json</code>
                    and <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">local.settings.json</code>,
                    and the <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Program</code>
                    class using the .NET where the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Host</code> class is
                    created. However, this time, instead of <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">CreateDefaultBuilder</code>
                    to configure services, configuration, and logging, the method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ConfigureFunctionsWorkerDefaults</code>
                    is invoked as shown in the following code snippet. With the sample application, the projects <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Shared</code> and
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Data</code> are
                    referenced to use this existing functionality, and the EF Core context is configured with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ConfigureServices</code>
                    method as you've configured it previously. What's different is that the connection string is
                    retrieved from an environment variable instead of by using the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IConfiguration</code>
                    interface (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AzureFunctions/Books.Function/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">这会创建一个引用 NuGet 包 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Azure.Functions.Worker.Sdk</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Azure.Functions.Worker</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">configuration files host.json</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">local.settings.json</code>
                                以及使用 .NET 创建的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Host</code>
                                类的 .NET 5 控制台应用程序。然而，这次不是通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">CreateDefaultBuilder</code>
                                来配置服务、配置和日志记录，而是调用了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ConfigureFunctionsWorkerDefaults</code>
                                方法，如下面的代码片段所示。在示例应用程序中，引用了项目 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Shared</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Books.Data</code>
                                以使用现有功能，并且像之前配置的那样使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ConfigureServices</code>
                                方法配置了 EF Core 上下文。不同的是，连接字符串是从环境变量中获取的，而不是通过使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IConfiguration</code>
                                接口（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AzureFunctions/Books.Function/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0057"><span aria-label="749" epub:type="pagebreak" id="Page_749" role="doc-pagebreak"></span>
<code>using Books.Data;</code>
<code>using Books.Services;</code>
<code>using Microsoft.EntityFrameworkCore;</code>
<code>using Microsoft.Extensions.DependencyInjection;</code>
<code>using Microsoft.Extensions.Hosting;</code>
<code>using System;</code>
<code> </code>
<code>using var host = new HostBuilder()</code>
<code>  .ConfigureFunctionsWorkerDefaults()</code>
<code>  .ConfigureServices(services =&gt;</code>
<code>  {</code>
<code>    string? connectionString = Environment.GetEnvironmentVariable("BooksConnection");</code>
<code>    if (connectionString is null) </code>
<code>      throw new InvalidOperationException("Configure the BooksConnection");</code>
<code> </code>
<code>    services.AddDbContext&lt;IBookChapterService, BooksContext&gt;(options =&gt;</code>
<code>    {</code>
<code>      options.UseSqlServer(connectionString);</code>
<code>    });</code>
<code>  })</code>
<code>  .Build();</code>
<code> </code>
<code>await host.RunAsync();</code></pre>
                <p id="c25-para-0110" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The method <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ConfigureFunctionsWorkerDefaults</code>
                    customizes the JSON serializer to ignore casing, configures logging to integrate the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ILogger</code> with Azure
                    Functions logging, configures Azure Function binding middleware, and adds gRPC support.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">方法 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ConfigureFunctionsWorkerDefaults</code>
                                自定义 JSON 序列化器以忽略大小写，配置日志记录以集成 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ILogger</code>
                                与 Azure Functions 日志记录，配置 Azure Function 绑定中间件，并添加 gRPC 支持。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">local.settings.json</code>
                    is used for the Azure Functions configuration values when you run this locally on your system. This
                    file is not part of the Git repository and is not deployed to Microsoft Azure. The values configured
                    within the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Values</code> section are
                    put into environment variables from the Azure Functions host environment. Creating the Azure
                    Function with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">dotnetIsolated</code>
                    option specifies the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">dotnet-isolated</code>
                    worker runtime. Azure Functions require an Azure Storage account for storing the Azure Function as
                    well as for logging. To run the Azure Function locally, a simulation environment is used instead of
                    the real storage account. This is specified with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UseDevelopmentStorage</code>
                    setting. The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksConnection</code>
                    needs to be added to reference your SQL Server database:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">local.settings.json</code>
                                用于在本地系统上运行时 Azure Functions 的配置值。此文件不是 Git 仓库的一部分，也不会部署到 Microsoft Azure。在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Values</code>
                                部分配置的值会被放入 Azure Functions 主机环境的环境变量中。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">dotnetIsolated</code>
                                选项创建 Azure Function 指定了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">dotnet-isolated</code>
                                工作运行时。Azure Functions 需要一个 Azure Storage 账户来存储 Azure Function 以及用于日志记录。要在本地运行 Azure
                                Function，会使用模拟环境而不是真实存储账户。这通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">UseDevelopmentStorage</code>
                                设置指定。需要在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">BooksConnection</code>
                                中添加以引用您的 SQL Server 数据库：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0058"><code>{</code>
<code>  "IsEncrypted": false,</code>
<code>  "Values": {</code>
<code>    "AzureWebJobsStorage": "UseDevelopmentStorage=true",</code>
<code>    "FUNCTIONS_WORKER_RUNTIME": "dotnet-isolated",</code>
<code>    "BooksConnection": </code>
<code>      "server=(localdb)\\mssqllocaldb;database=BooksDatabase;trusted_connection=true"</code>
<code>  }</code>
<code>}</code></pre>
                <p id="c25-para-0112" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">You can customize the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Host</code> class to add
                    custom middleware as you've read in the previous chapter (using the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IFunctionsWorkerApplicationBuilder</code>
                    parameter of the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ConfigureFunctionsWorkerDefaults</code>
                    method), configuration providers (for example the Azure App Configuration provider introduced in <a
                        href="c15.xhtml" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter
                        15</a>), and custom services for DI injection.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">你可以自定义 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Host</code>
                                类，以添加自定义中间件（如前一章中所述，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ConfigureFunctionsWorkerDefaults</code>
                                方法的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IFunctionsWorkerApplicationBuilder</code>
                                参数）、配置提供程序（例如在第 15 章中介绍的 Azure App Configuration 提供程序）以及用于依赖注入的自定义服务。</font>
                        </font>
                    </font>
                </p>
            </section>
            <section data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><span id="c25-sec-0037"
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
                <h3 id="head-3-487" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">Adding HTTP Trigger Functions<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">添加 HTTP 触发函数</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">To add a function to the project, you use <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">func new</code> by
                    supplying the name of the template with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--template</code>
                    argument. With the sample application, the function will be triggered on HTTP requests; thus, the
                    <code data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Http Trigger</code>
                    template is used:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要向项目中添加函数，你使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">func new</code>
                                并提供模板名称作为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--template</code>
                                参数。在示例应用程序中，函数将在 HTTP 请求时被触发；因此，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Http Trigger</code>
                                模板：</font>
                        </font>
                    </font>
                </p>
                <pre
                    id="c25-code-0059"><code>&gt; func new --name BooksService --authlevel anonymous --template "Http Trigger"</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1"><span aria-label="750" epub:type="pagebreak" id="Page_750"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>The class that's
                    generated is defined as a static class with static methods. However, you can change that to an
                    instance class to use constructor injection. With the following code snippet, the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>
                    is injected with the constructor (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AzureFunctions/Books.Function/BooksService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                生成的类被定义为静态类，包含静态方法。但是，你可以将其更改为实例类以使用构造函数注入。通过以下代码片段， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>
                                通过构造函数被注入（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AzureFunctions/Books.Function/BooksService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0060"><code>public class BooksService</code>
<code>{</code>
<code>  private readonly IBookChapterService _bookChapterService;</code>
<code>  public BooksService(IBookChapterService bookChapterService)</code>
<code>  {</code>
<code>    if (bookChapterService is null) </code>
<code>      throw new ArgumentNullException(nameof(bookChapterService));</code>
<code>    _bookChapterService = bookChapterService;</code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">A function is declared with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Function</code>
                    attribute. The <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpTrigger</code>
                    attribute specified with the first parameter of the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetChaptersAsync</code>
                    method defines how the function is invoked. With the following declaration, the function is invoked
                    on an HTTP GET request with the route <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">chapters</code>. With
                    different trigger types, different parameter types are used. With the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpTrigger</code>, the
                    parameter needs to be of type <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpRequestData</code>.
                    This type is used to read the request from the caller and to send a response. With the sample
                    implementation, the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>
                    is used to get the chapter list, convert it to JSON with the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">WriteAsJsonAsync</code>
                    extension method (defined in the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Azure.Functions.Worker.Http</code>
                    namespace), create the JSON data, and write it to the response body (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AzureFunctions/Books.Function/BooksService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">一个函数被声明为带有 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Function</code>
                                属性。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">GetChaptersAsync</code>
                                方法的第一个参数指定的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpTrigger</code>
                                属性定义了函数的调用方式。在以下声明中，函数会在 HTTP GET 请求的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">chapters</code>
                                路径上被调用。根据不同的触发类型，会使用不同的参数类型。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpTrigger</code>
                                时，参数需要是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpRequestData</code>
                                类型。这种类型用于从调用者读取请求并发送响应。在示例实现中，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>
                                获取章节列表，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">WriteAsJsonAsync</code>
                                扩展方法（定义在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Microsoft.Azure.Functions.Worker.Http</code>
                                命名空间中）将其转换为 JSON，创建 JSON 数据，并将其写入响应体（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AzureFunctions/Books.Function/BooksService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0061"><code><b>[Function("GetChapters")]</b></code>
<code>public async Task&lt;HttpResponseData&gt; GetChaptersAsync(</code>
<code>  <b>[HttpTrigger(AuthorizationLevel.Anonymous, "get", Route = "chapters")]</b> </code>
<code>    <b>HttpRequestData req,</b></code>
<code>  FunctionContext executionContext)</code>
<code>{</code>
<code>  var logger = executionContext.GetLogger("BooksService");</code>
<code>  logger.LogInformation("Function GetChapters invoked.");</code>
<code> </code>
<code>  var response = req.CreateResponse(HttpStatusCode.OK);</code>
<code>  var chapters = _bookChapterService.GetAllAsync();</code>
<code>  await response.WriteAsJsonAsync(chapters);</code>
<code>  return response;</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">The function <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddChapterAsync</code> is
                    declared with an <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpTrigger</code> for an
                    HTTP POST request on the same route. Here, the HTTP body received is read using the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadFromJsonAsync</code>
                    extension method, and with the help of the <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>,
                    the book chapter is written to the database (code file <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AzureFunctions/Books.Function/BooksService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">函数 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AddChapterAsync</code>
                                被声明为处理同一路由上的 HTTP POST 请求。这里，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">ReadFromJsonAsync</code>
                                扩展方法读取收到的 HTTP 请求体，并借助 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">IBookChapterService</code>
                                将书章节写入数据库（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">AzureFunctions/Books.Function/BooksService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0062"><code>[Function("AddChapter")]</code>
<code>public async Task&lt;HttpResponseData&gt; AddChapterAsync(</code>
<code>  [HttpTrigger(AuthorizationLevel.Anonymous, "post", Route = "chapters")] </code>
<code>    HttpRequestData req,</code>
<code>  FunctionContext executionContext)</code>
<code>{</code>
<code>  var logger = executionContext.GetLogger("BooksService");</code>
<code>  logger.LogInformation("Function AddChapter invoked.");</code>
<code> </code>
<code>  var chapter = await req.ReadFromJsonAsync&lt;BookChapter&gt;();</code>
<code>  if (chapter is null)</code>
<code>  {<span aria-label="751" epub:type="pagebreak" id="Page_751" role="doc-pagebreak"></span></code>
<code>    logger.LogError("invalid chapter received");</code>
<code>    return req.CreateResponse(HttpStatusCode.BadRequest);</code>
<code>  }</code>
<code>  var response = req.CreateResponse(HttpStatusCode.OK);</code>
<code>  await _bookChapterService.AddAsync(chapter);</code>
<code>  await response.WriteAsJsonAsync(chapter);</code>
<code>  return response;</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">To run the Azure Function on your local system, you can't
                    start it from Visual Studio (at least at the time of this writing); you need to start it with the
                    Azure Functions Core Tools, giving you the host environment:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要在本地系统上运行 Azure Function，你不能从
                                Visual Studio 启动它（至少在撰写本文时是这样）；你需要使用 Azure Functions Core Tools 来启动它，这样你就能获得主机环境：</font>
                        </font>
                    </font>
                </p>
                <pre id="c25-code-0063"><code>&gt; func start</code></pre>
                <p id="c25-para-0118" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">By default, the Azure Function is available at port 7071. The
                    URL to send the GET and POST requests is <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="http://localhost:7071/api/chapters">http://localhost:7071/api/chapters</a></code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">默认情况下，Azure Function 在端口 7071
                                上可用。发送 GET 和 POST 请求的 URL 是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="http://localhost:7071/api/chapters">http://localhost:7071/api/chapters</a></code>
                                。</font>
                        </font>
                    </font>
                </p>
                <p id="c25-para-0119" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">To debug from Visual Studio, you can start the function with
                    the option <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--dotnet-isolated-debug</code>.
                    By setting this, the worker process waits until a debugger is attached.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要从 Visual Studio 进行调试，可以使用选项 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">--dotnet-isolated-debug</code>
                                启动函数。设置此选项后，工作进程会等待调试器连接。</font>
                        </font>
                    </font>
                </p>
                <p id="c25-para-0120" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                    data-immersive-translate-paragraph="1">To send HTTP requests, you can use <code
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">dotnet httprepl</code>
                    (which is explained in <a href="c24.xhtml"
                        data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">Chapter 24</a>, “ASP.NET
                    Core”) or customize the previously created client application.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要发送 HTTP 请求，可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">dotnet httprepl</code>
                                （在第 24 章“ASP.NET Core”中解释过）或自定义先前创建的客户应用程序。</font>
                        </font>
                    </font>
                </p>
            </section>
        </section>
        <section aria-labelledby="head-2-236" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
            <span id="c25-sec-0038" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <h2 id="head-2-236" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">MORE AZURE SERVICES<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">更多 Azure 服务</font>
                    </font>
                </font>
            </h2>
            <p id="c25-para-0121" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">More can be done with Azure Functions beyond implementing them to
                be triggered on HTTP requests. They also can be triggered when a message arrives in a queue of an Azure
                Storage account, with queues and tokens from the Azure Service Bus, when data is changed in an Azure
                Cosmos database, on events from Azure Event Grid or the Azure Event hub, or with a timer trigger. For
                creating small services, it's not always necessary to react to network events, such as invocations from
                REST APIs or RPC calls. Communication can also be done asynchronously.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">Azure Functions 除了可以实施在 HTTP
                            请求上触发之外，还能在 Azure 存储账户的队列中收到消息时触发，使用 Azure 服务总线中的队列和令牌，当 Azure Cosmos 数据库中的数据发生变化时，在 Azure
                            Event Grid 或 Azure Event hub 的事件上，或使用定时触发器。对于创建小型服务，并不总是需要响应网络事件，例如来自 REST API 或 RPC
                            调用的调用。通信也可以异步进行。</font>
                    </font>
                </font>
            </p>
            <p id="c25-para-0122" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">If your application now uses several APIs, you want to allow the
                client to use just one API layer that is then forwarded to the correct service with the correct version
                based on the request, and you want to implement throttling based on different subscriptions used by the
                client APIs, you might consider using Azure API management. This service gives you great options for
                these scenarios.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">如果你的应用程序现在使用多个 API，你希望允许客户端只使用一个 API
                            层，该层根据请求转发到正确的服务及其正确的版本，并且你希望根据客户端 API 使用的不同订阅实现速率限制，你可能需要考虑使用 Azure API
                            管理。这项服务为这些场景提供了很好的选择。</font>
                    </font>
                </font>
            </p>
            <p id="c25-para-0123" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">Check <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://github.com/ProfessionalCSharp/MoreSamples">https://github.com/ProfessionalCSharp/MoreSamples</a></code>
                for additional samples for these scenarios.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">查看 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"><a href="https://github.com/ProfessionalCSharp/MoreSamples">https://github.com/ProfessionalCSharp/MoreSamples</a></code>
                            以获取这些场景的更多示例。</font>
                    </font>
                </font>
            </p>
        </section>
        <section aria-labelledby="head-2-237" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">
            <span id="c25-sec-0039" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"></span>
            <h2 id="head-2-237" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">SUMMARY<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">摘要</font>
                    </font>
                </font>
            </h2>
            <p id="c25-para-0124" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">This chapter described the features of the web API using ASP.NET
                Core. This technology offers an easy way to create REST services that can be called from any client—be
                it JavaScript or a .NET client. With a .NET client, you saw how to use the <code
                    data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code> class that
                sends requests using different HTTP verbs, including the use of the new JSON extension methods to deal
                with sending and receiving JSON data.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本章介绍了使用 ASP.NET Core 构建的 Web API
                            的特点。这项技术提供了一种简便的方法来创建 REST 服务，这些服务可以从任何客户端调用——无论是 JavaScript 还是.NET 客户端。通过.NET 客户端，你了解了如何使用
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64">HttpClient</code>
                            类，该类使用不同的 HTTP 动词发送请求，包括使用新的 JSON 扩展方法来处理发送和接收 JSON 数据。</font>
                    </font>
                </font>
            </p>
            <p id="c25-para-0125" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">You've seen enhancements of the API sample to access a database
                with EF Core without big changes, and you’ve read about adding authentication and authorization both to
                the service and to the client application.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">你已经看到了 API 示例的增强，以便使用 EF Core
                            访问数据库，而无需进行大的改动，并且你阅读了如何为服务和客户端应用程序添加身份验证和授权。</font>
                    </font>
                </font>
            </p>
            <p id="c25-para-0126" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">This chapter also covered communication in a platform-independent
                form using gRPC and streaming with gRPC.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本章还涵盖了使用 gRPC 进行平台无关通信和使用 gRPC 进行流式传输。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c25-para-0127" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">Another option for implementing REST APIs is by using Azure
                Functions. With the advantage of a DI container, you could use the classes implemented earlier to offer
                the same functionality by using an Azure Function.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">实现 REST API 的另一种选择是使用 Azure
                            Functions。通过依赖注入容器的优势，你可以使用之前实现的类，通过 Azure Function 来提供相同的功能。</font>
                    </font>
                </font>
            </p>
            <p id="c25-para-0128" data-immersive-translate-walked="17b4819c-510a-494b-8273-822dd956cd64"
                data-immersive-translate-paragraph="1">The next chapter covers creating user interfaces with ASP.NET
                Core using Razor Pages and MVC.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">下一章将介绍如何使用 Razor Pages 和 MVC 在 ASP.NET
                            Core 中创建用户界面。</font>
                    </font>
                </font>
            </p>
        </section>
    </section>
</body>
<div id="immersive-translate-popup" style="all: initial"></div>

</html>