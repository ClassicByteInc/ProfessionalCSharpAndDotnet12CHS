<!-- 这行注释会存在于经过翻译的源文件中。除非您获得许可请不要删除这个注释。
    翻译由 ClassicByte Org 的 higashitani yume 完成
    使用工具 沉浸式翻译 智谱GLM模型
    您可以阅读这个源代码，也可以向他人分发此源代码，但是不得用于商业用途。
    您也可以自己将这些代码打包成epub分发给别人，但是不得用于商业用途。
    如果此源代码侵犯了您的权益，请联系我我将会删除侵权内容。
    您在阅读此源代码时，可能会看到一些英文内容，这些内容是原书的内容，可能是因为翻译不准确或者是因为原书的内容没有被翻译。
    如果您发现了错误，请联系我我会进行修正。
  -->
<!--This line of comments will exist in the translated source file. Do not delete this comment unless you have permission.
    Translation is done by ClassicByte Org's higashitani yume
    Usage Tools Immersive Translation Zhipu GLM Model
    You can read this source code or distribute it to others, but it may not be used for commercial purposes.
    You can also package these codes yourself into epub and distribute them to others, but they may not be used for commercial purposes.
    If this source code infringes your rights, please contact me and I will delete the infringing content.
    When you read this source code, you may see some English content, which is the content of the original book, which may be because the translation is inaccurate or because the content of the original book has not been translated.
    If you find an error, please contact me and I will correct it.
  -->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops"
    xmlns:svg="http://www.w3.org/2000/svg" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en"
    imt-state="dual" imt-trans-position="after">

<head>
    <title>19 Networking --- 19 Networking</title>
    <link href="WileyTemplate_v5.5.css" rel="stylesheet" type="text/css" />
    <meta content="urn:uuid:e0000000-0000-0000-0000-000006715209" name="Adept.expected.resource" />
    <style data-id="immersive-translate-input-injected-css">
        .immersive-translate-input {
            position: absolute;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            z-index: 2147483647;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .immersive-translate-attach-loading::after {
            content: " ";

            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;

            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-2000%, -50%);
            z-index: 100;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .immersive-translate-input-loading {
            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;
        }

        @keyframes immersiveTranslateShadowRolling {
            0% {
                box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            12% {
                box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            25% {
                box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            36% {
                box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color),
                    100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
            }

            50% {
                box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color),
                    110px 0 var(--loading-color), 100px 0 var(--loading-color);
            }

            62% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color),
                    120px 0 var(--loading-color), 110px 0 var(--loading-color);
            }

            75% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    130px 0 var(--loading-color), 120px 0 var(--loading-color);
            }

            87% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
            }

            100% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
            }
        }

        .immersive-translate-toast {
            display: flex;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            right: 0;
            top: 1%;
            width: fit-content;
            padding: 12px 20px;
            margin: auto;
            overflow: auto;
            background: #fef6f9;
            box-shadow: 0px 4px 10px 0px rgba(0, 10, 30, 0.06);
            font-size: 15px;
            border-radius: 8px;
            color: #333;
        }

        .immersive-translate-toast-content {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .immersive-translate-toast-hidden {
            margin: 0 20px 0 72px;
            text-decoration: underline;
            cursor: pointer;
        }

        .immersive-translate-toast-close {
            color: #666666;
            font-size: 20px;
            font-weight: bold;
            padding: 0 10px;
            cursor: pointer;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-toast {
                top: 0;
                padding: 12px 0px 0 10px;
            }

            .immersive-translate-toast-content {
                flex-direction: column;
                text-align: center;
            }

            .immersive-translate-toast-hidden {
                margin: 10px auto;
            }
        }

        .immersive-translate-modal {
            display: none;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
            font-size: 15px;
        }

        .immersive-translate-modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 40px 24px 24px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 80%;
            max-width: 270px;
            font-family: system-ui, -apple-system, "Segoe UI", "Roboto", "Ubuntu",
                "Cantarell", "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
                "Segoe UI Symbol", "Noto Color Emoji";
            position: relative;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-content {
                margin: 50% auto !important;
            }
        }

        .immersive-translate-modal .immersive-translate-modal-content-in-input {
            max-width: 500px;
        }

        .immersive-translate-modal-content-in-input .immersive-translate-modal-body {
            text-align: left;
            max-height: unset;
        }

        .immersive-translate-modal-title {
            text-align: center;
            font-size: 16px;
            font-weight: 700;
            color: #333333;
        }

        .immersive-translate-modal-body {
            text-align: center;
            font-size: 14px;
            font-weight: 400;
            color: #333333;
            word-break: break-all;
            margin-top: 24px;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-body {
                max-height: 250px;
                overflow-y: auto;
            }
        }

        .immersive-translate-close {
            color: #666666;
            position: absolute;
            right: 16px;
            top: 16px;
            font-size: 20px;
            font-weight: bold;
        }

        .immersive-translate-close:hover,
        .immersive-translate-close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .immersive-translate-modal-footer {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        .immersive-translate-btn {
            width: fit-content;
            color: #fff;
            background-color: #ea4c89;
            border: none;
            font-size: 16px;
            margin: 0 8px;
            padding: 9px 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .immersive-translate-btn:hover {
            background-color: #f082ac;
        }

        .immersive-translate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .immersive-translate-btn:disabled:hover {
            background-color: #ea4c89;
        }

        .immersive-translate-cancel-btn {
            /* gray color */
            background-color: rgb(89, 107, 120);
        }

        .immersive-translate-cancel-btn:hover {
            background-color: hsl(205, 20%, 32%);
        }

        .immersive-translate-action-btn {
            background-color: transparent;
            color: #ea4c89;
            border: 1px solid #ea4c89;
        }

        .immersive-translate-btn svg {
            margin-right: 5px;
        }

        .immersive-translate-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #007bff;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-primary-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #ea4c89;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-modal input[type="radio"] {
            margin: 0 6px;
            cursor: pointer;
        }

        .immersive-translate-modal label {
            cursor: pointer;
        }

        .immersive-translate-close-action {
            position: absolute;
            top: 2px;
            right: 0px;
            cursor: pointer;
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5) !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 16px !important;
        }

        .imt-image-status img,
        .imt-image-status svg,
        .imt-img-loading {
            width: 28px !important;
            height: 28px !important;
            margin: 0 0 8px 0 !important;
            min-height: 28px !important;
            min-width: 28px !important;
            position: relative !important;
        }

        .imt-img-loading {
            background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAtFBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////oK74hAAAAPHRSTlMABBMIDyQXHwyBfFdDMSw+OjXCb+5RG51IvV/k0rOqlGRM6KKMhdvNyZBz9MaupmxpWyj437iYd/yJVNZeuUC7AAACt0lEQVRIx53T2XKiUBCA4QYOiyCbiAsuuGBcYtxiYtT3f6/pbqoYHVFO5r+iivpo6DpAWYpqeoFfr9f90DsYAuRSWkFnPO50OgR9PwiCUFcl2GEcx+N/YBh6pvKaefHlUgZd1zVe0NbYcQjGBfzrPE8Xz8aF+71D8gG6DHFPpc4a7xFiCDuhaWgKgGIJQ3d5IMGDrpS4S5KgpIm+en9f6PlAhKby4JwEIxlYJV9h5k5nee9GoxHJ2IDSNB0dwdad1NAxDJ/uXDHYmebdk4PdbkS58CIVHdYSUHTYYRWOJblWSyu2lmy3KNFVJNBhxcuGW4YBVCbYGRZwIooipHsNqjM4FbgOQqQqSKQQU9V8xmi1QlgHqQQ6DDBvRUVCDirs+EzGDGOQTCATgtYTnbCVLgsVgRE0T1QE0qHCFAht2z6dLvJQs3Lo2FQoDxWNUiBhaP4eRgwNkI+dAjVOA/kUrIDwf3CG8NfNOE0eiFotSuo+rBiq8tD9oY4Qzc6YJw99hl1wzpQvD7ef2M8QgnOGJfJw+EltQc+oX2yn907QB22WZcvlUpd143dqQu+8pCJZuGE4xCuPXJqqcs5sNpsI93Rmzym1k4Npk+oD1SH3/a3LOK/JpUBpWfqNySxWzCfNCUITuDG5dtuphrUJ1myeIE9bIsPiKrfqTai5WZxbhtNphYx6GEIHihyGFTI69lje/rxajdh0s0msZ0zYxyPLhYCb1CyHm9Qsd2H37Y3lugVwL9kNh8Ot8cha6fUNQ8nuXi5z9/ExsAO4zQrb/ev1yrCB7lGyQzgYDGuxq1toDN/JGvN+HyWNHKB7zEoK+PX11e12G431erGYzwmytAWU56fkMHY5JJnDRR2eZji3AwtIcrEV8Cojat/BdQ7XOwGV1e1hDjGGjXbdArm8uJZtCH5MbcctVX8A1WpqumJHwckAAAAASUVORK5CYII=");
            background-size: 28px 28px;
            animation: image-loading-rotate 1s linear infinite !important;
        }

        .imt-image-status span {
            color: var(--bg-2, #fff) !important;
            font-size: 14px !important;
            line-height: 14px !important;
            font-weight: 500 !important;
            font-family: "PingFang SC", Arial, sans-serif !important;
        }

        @keyframes image-loading-rotate {
            from {
                transform: rotate(360deg);
            }

            to {
                transform: rotate(0deg);
            }
        }
    </style>
    <style data-id="immersive-translate-default-injected-css">
        :root {
            --immersive-translate-theme-underline-borderColor: #72ece9;
            --immersive-translate-theme-nativeUnderline-borderColor: #72ece9;
            --immersive-translate-theme-nativeDashed-borderColor: #72ece9;
            --immersive-translate-theme-nativeDotted-borderColor: #72ece9;
            --immersive-translate-theme-highlight-backgroundColor: #ffff00;
            --immersive-translate-theme-dashed-borderColor: #59c1bd;
            --immersive-translate-theme-blockquote-borderColor: #cc3355;
            --immersive-translate-theme-thinDashed-borderColor: #ff374f;
            --immersive-translate-theme-dashedBorder-borderColor: #94a3b8;
            --immersive-translate-theme-dashedBorder-borderRadius: 0;
            --immersive-translate-theme-solidBorder-borderColor: #94a3b8;
            --immersive-translate-theme-solidBorder-borderRadius: 0;
            --immersive-translate-theme-dotted-borderColor: #94a3b8;
            --immersive-translate-theme-wavy-borderColor: #72ece9;
            --immersive-translate-theme-dividingLine-borderColor: #94a3b8;
            --immersive-translate-theme-grey-textColor: #2f4f4f;
            --immersive-translate-theme-marker-backgroundColor: #fbda41;
            --immersive-translate-theme-marker-backgroundColor-rgb: 251, 218, 65;
            --immersive-translate-theme-marker2-backgroundColor: #ffff00;
            --immersive-translate-theme-background-backgroundColor: #dbafaf;
            --immersive-translate-theme-background-backgroundColor-rgb: 219, 175, 175;
            --immersive-translate-theme-background-backgroundOpacity: 12;
            --immersive-translate-theme-opacity-opacity: 10;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pre-whitespace {
            white-space: pre-wrap !important;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container {
            position: absolute;
            background-color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
                sans-serif;
            top: 0;
            width: 600px;
            height: 100%;
            z-index: 2;
            line-height: 1.3;
            font-size: 16px;
        }

        [imt-state="dual"] .immersive-translate-target-wrapper[dir="rtl"] {
            text-align: right;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper {
            color: rgb(0, 0, 0);
            white-space: normal;
            position: absolute;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper font {
            color: inherit;
            white-space: inherit;
            position: unset;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper &gt;

        br {
            display: none;
        }

        [imt-state="translation"] .immersive-translate-target-translation-block-wrapper {
            margin: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper {
            margin: 8px 0 !important;
            display: inline-block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            display: block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            margin-top: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pdf-block-wrapper {
            margin: 0 !important;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-grey-inner {
            color: var(--immersive-translate-theme-grey-textColor);
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-underline-inner {
            border-bottom: 1px solid var(--immersive-translate-theme-underline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeUnderline-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeUnderline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDashed-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDashed-borderColor) !important;
            text-decoration-style: dashed !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-thinDashed-inner {
            border-bottom: 1px dashed var(--immersive-translate-theme-thinDashed-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dotted-inner {
            background-image: linear-gradient(to right,
                    var(--immersive-translate-theme-dotted-borderColor) 30%,
                    rgba(255, 255, 255, 0) 0%);
            background-position: bottom;
            background-size: 5px 1px;
            background-repeat: repeat-x;
            padding-bottom: 3px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDotted-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDotted-borderColor) !important;
            text-decoration-style: dotted !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-wavy-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-wavy-borderColor) !important;
            text-decoration-style: wavy !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dashed-inner {
            background: linear-gradient(to right,
                    var(--immersive-translate-theme-dashed-borderColor) 0%,
                    var(--immersive-translate-theme-dashed-borderColor) 50%,
                    transparent 50%,
                    transparent 100%) repeat-x left bottom;
            background-size: 8px 2px;
            padding-bottom: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            content: "";
            display: block;
            max-width: 80px;
            width: 10%;
            border-top: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            padding-top: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dividingLine::before {
            content: "";
            border-left: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            max-height: 16px;
            height: 16px;
            padding-left: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-highlight-inner {
            background: var(--immersive-translate-theme-highlight-backgroundColor);
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-marker {
            line-height: 1.5em;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker2-inner {
            font-weight: bold;
            text-shadow: 10px 0px 3px var(--immersive-translate-theme-marker2-backgroundColor),
                16px 3px 9px var(--immersive-translate-theme-marker2-backgroundColor),
                2px 0px 6px var(--immersive-translate-theme-marker2-backgroundColor),
                -12px 0px 12px var(--immersive-translate-theme-marker2-backgroundColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker-inner {
            /* TODO: add more texture */
            background: linear-gradient(to right,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.1),
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 3%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 35%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 70%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.8) 95%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.3));
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-weakening {
            opacity: 0.618 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-italic {
            font-style: italic !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-bold {
            font-weight: bold !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-paper {
            margin: 8px 0;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
            padding: 16px 32px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-blockquote {
            border-left: 4px solid var(--immersive-translate-theme-blockquote-borderColor) !important;
            padding-left: 12px !important;
            margin-top: 4px;
            margin-bottom: 4px;
            padding-top: 4px;
            padding-bottom: 4px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-mask-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        /* opacity theme start */

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner,
        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: none !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        /* opacity theme end */

        /* background theme start */
        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-background {
            margin: 8px 0;
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            border-radius: 4px;
            box-shadow: unset !important;
            padding: 12px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-background-inner {
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            padding-left: 6px;
            padding-right: 6px;
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper .immersive-translate-target-translation-theme-background-inner {
            background: unset;
            padding-left: unset;
            padding-right: unset;
        }

        /* background theme end */

        /* vertical css , please remain it in the last one. */
        .immersive-translate-target-translation-vertical-block-wrapper {
            margin: 0px 8px !important;
        }

        .immersive-translate-text {
            font-size: 15px !important;
        }

        .immersive-translate-error-toast {
            position: fixed;
            top: 5%;
            z-index: 99999999;
            left: 0;
            right: 0;
            margin: auto;
            max-width: 300px;
            padding: 16px;
            border-radius: 12px;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        @media all and (min-width: 750px) {
            .immersive-translate-error-toast {
                max-width: 400px;
            }
        }

        .immersive-translate-clickable-button {
            cursor: pointer;
        }

        .immersive-translate-help-button {
            cursor: pointer;
        }

        .immersive-translate-loading-text:before {
            content: "...";
        }

        /* dark mode for loading */

        @media only screen and (prefers-color-scheme: dark) {
            .immersive-translate-loading {
                border: 2px rgba(255, 255, 255, 0.25) solid !important;
                border-top: 2px rgba(255, 255, 255, 1) solid !important;
            }
        }

        .immersive-translate-error-wrapper {
            position: relative;
            display: inline-flex;
            padding: 6px;
            margin: 0 12px;
            white-space: nowrap;
            font-size: 0.9em;
        }

        [lang="zh-CN"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        [lang="zh-TW"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        .immersive-translate-tooltip {
            position: relative;
            display: inline-flex;
            /* little indicater to indicate it's hoverable */
        }

        .immersive-translate-tooltip-content {
            /* here's the magic */
            position: absolute;
            z-index: 100000000000;

            left: 50%;
            bottom: 0;
            transform: translate(-50%, 110%);
            line-height: 1;
            /* and add a small left margin */

            /* basic styles */
            width: max-content;
            max-width: 250px;
            word-wrap: break-word;
            white-space: pre-line;
            padding: 10px;
            border-radius: 10px;
            background: #000c;
            color: #fff;
            text-align: center;
            font-size: 14px;
            display: none;
            /* hide by default */
        }

        .immersive-translate-tooltip:hover .immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip:hover+.immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip-content-table {
            left: unset !important;
            bottom: unset !important;
            transform: translate(-10%, 50%) !important;
        }

        .immersive-translate-tooltip:hover:before {
            display: inline-block;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--bg-2, #fff);
            font-size: 14px;
        }
    </style>
    <style data-id="immersive-translate-user-custom-style">
        :root {

            .immersive-translate-target-inner {
                font-family: inherit;
            }


            .immersive-translate-target-inner {
                font-family: inherit;
            }
        }
    </style>
    <style data-id="immersive-translate-dynamic-injected-css">
        .immersive-translate-target-wrapper[dir='rtl'] {
            text-align: right;
        }

        .immersive-translate-target-wrapper[dir='rtl'] [data-immersive-translate-class-bak*='block-wrapper'] {
            display: block;
        }

        .immersive-translate-target-wrapper {
            word-break: break-word;
            user-select: text;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper[dir='rtl'] {
            display: inline-block;
        }

        [dir='rtl'] .immersive-translate-target-wrapper:not([dir]) {
            text-align: left;
        }

        [imt-state=dual] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            display: block;
        }

        [imt-trans-position=before] .immersive-translate-target-translation-block-wrapper {
            display: block !important;
        }

        [imt-state][data-immersive-translate_rtl] .immersive-translate-target-wrapper {
            display: block !important;
        }
    </style>
</head>

<body epub:type="bodymatter" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
    <section aria-labelledby="c19_1" epub:type="chapter" role="doc-chapter"
        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
        <header data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
            <h1 id="c19_1" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1"><span aria-label="520" epub:type="pagebreak" id="Page_520"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span><span id="c19"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span><span
                    class="chapterNumber"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">19</span><br /><span
                    class="chapterTitle"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Networking</span></h1>
        </header>
        <section aria-label="chapter opening" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
            <span id="c19-sec-0001" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <h3 data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                        data-immersive-translate-paragraph="1">WHAT'S IN THIS CHAPTER?<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章包含什么内容？</font>
                            </font>
                        </font>
                    </h3>
                    <ul class="check2" id="c19-list-0001"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <li id="c19-li-0001" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1">Manipulating IP addresses and performing DNS lookups
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">操作 IP 地址和执行 DNS 查询</font>
                                </font>
                            </font>
                        </li>
                        <li id="c19-li-0002" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1">Using socket programming<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用套接字编程</font>
                                </font>
                            </font>
                        </li>
                        <li id="c19-li-0003" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1">Creating TCP and UDP clients and servers<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">创建 TCP 和 UDP 客户端及服务器
                                    </font>
                                </font>
                            </font>
                        </li>
                        <li id="c19-li-0004" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1">Using <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                    </font>
                                </font>
                            </font>
                        </li>
                        <li id="c19-li-0005" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1">Working with the <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            factory<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">与 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                        工厂合作</font>
                                </font>
                            </font>
                        </li>
                    </ul>
                    <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                </section>
            </aside>
            <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span
                        id="c19-fea-0001" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                    <h3 id="head-2-175" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                        data-immersive-translate-paragraph="1">CODE DOWNLOADS FOR THIS CHAPTER<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章代码下载</font>
                            </font>
                        </font>
                    </h3>
                    <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span
                            id="c19-sec-0003"
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                        <p id="c19-para-0003" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1">The source code for this chapter is available on the
                            book page at <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="http://www.wiley.com">www.wiley.com</a></code>.
                            Click the Downloads link. The code can also be found at <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                            in the directory
                            <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">2_Libs/Networking</code>.
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的源代码可在书籍页面 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="http://www.wiley.com">www.wiley.com</a></code>
                                        上找到。点击下载链接。代码也可以在目录 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">2_Libs/Networking</code>
                                        中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                                        找到。</font>
                                </font>
                            </font>
                        </p>
                        <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1">The code for this chapter is divided into the
                            following major examples:<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的代码分为以下主要示例：</font>
                                </font>
                            </font>
                        </p>
                        <ul class="check" id="c19-list-0002"
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <li id="c19-li-0006" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                data-immersive-translate-paragraph="1">Utilities<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">工具</font>
                                    </font>
                                </font>
                            </li>
                            <li id="c19-li-0007" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                data-immersive-translate-paragraph="1">Dns</li>
                            <li id="c19-li-0008" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                data-immersive-translate-paragraph="1">SocketServer</li>
                            <li id="c19-li-0009" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                data-immersive-translate-paragraph="1">SocketClient</li>
                            <li id="c19-li-0010" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                data-immersive-translate-paragraph="1">TcpServer</li>
                            <li id="c19-li-0011" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                data-immersive-translate-paragraph="1">TcpClientSample</li>
                            <li id="c19-li-0012" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                data-immersive-translate-paragraph="1">UdpReceiver</li>
                            <li id="c19-li-0013" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                data-immersive-translate-paragraph="1">UdpSender</li>
                            <li id="c19-li-0014" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                data-immersive-translate-paragraph="1">HttpServerSample</li>
                            <li id="c19-li-0015" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                data-immersive-translate-paragraph="1">HttpClientSample</li>
                        </ul>
                        <p id="c19-para-0005" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><span aria-label="521" epub:type="pagebreak"
                                id="Page_521" role="doc-pagebreak"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>Samples
                            from this chapter use the <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net</code>,
                            <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Sockets</code>,
                            <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Http</code>,
                            and <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.IO.Pipelines</code>
                            namespaces. Important NuGet packages used are <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.Extensions.Http</code>
                            and <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.Extensions.Hosting</code>.
                            All the samples have nullable reference types enabled.<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章中的示例使用 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net</code>
                                        、 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Sockets</code>
                                        、 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Http</code>
                                        和 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.IO.Pipelines</code>
                                        命名空间。重要的 NuGet 包是 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.Extensions.Http</code>
                                        和 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.Extensions.Hosting</code>
                                        。所有示例都启用了可空引用类型。</font>
                                </font>
                            </font>
                        </p>
                    </section>
                    <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                </section>
            </aside>
        </section>
        <section aria-labelledby="head-2-176" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
            <span id="c19-sec-0002" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <h2 id="head-2-176" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">OVERVIEW<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">概述</font>
                    </font>
                </font>
            </h2>
            <p id="c19-para-0006" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">This chapter takes a practical approach to networking by mixing
                examples with a discussion of relevant theory and networking concepts as appropriate. This chapter is
                not a guide to computer networking but an introduction to using .NET for network communication.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            本章通过将示例与相关的理论和网络概念讨论相结合，采用实际方法来讲解网络。本章不是计算机网络的指南，而是介绍如何使用 .NET 进行网络通信。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0007" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">This chapter shows you how to create both clients and servers
                using network protocols. It starts with utility classes such as <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code>, <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code>, and <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dns</code> before digging
                into programming with sockets. Here, sockets are used to show the functionality of communication via UDP
                and TCP.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本章展示了如何使用网络协议创建客户端和服务器。它从 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code>
                            、 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dns</code>
                            等工具类开始，然后深入到套接字编程。在这里，套接字用于展示通过 UDP 和 TCP 进行通信的功能。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0008" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">After you learn the foundation of network programming, we move to
                higher-level APIs by using the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpClient</code> and <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code> classes.
                These classes provide an abstraction layer to the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> class in which
                you don't have full control over sockets, but using TCP and UDP communication is easier.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在您学习了网络编程的基础知识后，我们将通过使用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpClient</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code>
                            类来转向更高级的 API。这些类为 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                            类提供了抽象层，您对套接字没有完全控制权，但使用 TCP 和 UDP 通信更容易。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0009" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">After this, we move to another abstraction layer: the HTTP
                protocol, which is the most used protocol in the Internet. The <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> class
                offers a modern asynchronous approach for creating HTTP requests. You'll use the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientFactory</code>
                class to manage <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> objects.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">此后，我们进入另一个抽象层：HTTP 协议，这是互联网中最常用的协议。
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            类提供了一种现代的异步方法来创建 HTTP 请求。您将使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientFactory</code>
                            类来管理 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            对象。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0010" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">The two namespaces of most interest for networking are <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net</code> and <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Sockets</code>.
                The <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net</code>
                namespace is generally concerned with higher-level operations, such as downloading and uploading files
                and making web requests using HTTP and other protocols, whereas <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Sockets</code>
                contains classes to perform lower-level operations. You will find these classes useful when you want to
                work directly with sockets or protocols, such as with TCP/IP. The methods in these classes closely mimic
                the Windows socket (Winsock) API functions derived from the Berkeley sockets interface. You will also
                find that some of the objects in the chapter are found in the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.IO</code> namespace.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">对于网络来说，最感兴趣的命名空间是 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Sockets</code>
                            。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net</code>
                            命名空间通常关注更高级的操作，例如下载和上传文件，以及使用 HTTP 和其他协议进行网络请求，而 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Sockets</code>
                            包含用于执行更低级操作的类。当您想要直接与套接字或协议（如 TCP/IP）工作时，您会发现这些类很有用。这些类中的方法与从伯克利套接字接口派生的 Windows
                            套接字（Winsock）API 函数非常相似。您还会发现本章中的一些对象位于 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.IO</code>
                            命名空间中。</font>
                    </font>
                </font>
            </p>
        </section>
        <section aria-labelledby="head-2-177" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
            <span id="c19-sec-8003" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <h2 id="head-2-177" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">WORKING WITH UTILITY CLASSES<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用实用工具类</font>
                    </font>
                </font>
            </h2>
            <p id="c19-para-0011" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">On the Internet, you identify servers as well as clients by IP
                address or host name (also referred to as a Domain Name System [DNS] name). Generally speaking, the <i
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">host name</i> is the
                human-friendly name that you type in a web browser window, such as <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="http://www.wrox.com">www.wrox.com</a></code>
                or <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="http://www.cninnovation.com">www.cninnovation.com</a></code>.
                An <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IP address</i> is the
                identifier that computers use to recognize each other. IP addresses are the identifiers used to ensure
                that web requests and responses reach the appropriate machines. It is even possible for a computer to
                have more than one IP address.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在互联网上，你通过 IP
                            地址或主机名（也称为域名系统[DNS]名称）来识别服务器和客户端。一般来说，主机名是你输入到网页浏览器窗口中的人友好名称，例如 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="http://www.wrox.com">www.wrox.com</a></code>
                            或 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="http://www.cninnovation.com">www.cninnovation.com</a></code>
                            。IP 地址是计算机用来识别彼此的标识符。IP 地址是用来确保网页请求和响应到达适当机器的标识符。一台计算机甚至可以拥有多个 IP 地址。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0012" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">An IP address can be a 32-bit or 128-bit value, depending on
                whether Internet Protocol version 4 (IPv4) or Internet Protocol version 6 (IPv6) is used. An example of
                a 32-bit IP address is <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">192.168.1.100</code>. Because
                there are now so many computers and other devices vying for a spot on the Internet, IPv6 was developed.
                IPv6 can potentially provide a maximum number of about 3 × 10<sup
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">38</sup> unique addresses.
                .NET enables your applications to work with both IPv4 and IPv6.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">IP 地址可以是 32 位或 128 位的值，这取决于使用的是互联网协议版本
                            4（IPv4）还是互联网协议版本 6（IPv6）。一个 32 位 IP 地址的例子是 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">192.168.1.100</code>
                            。由于现在有这么多计算机和其他设备争夺互联网上的位置，因此开发了 IPv6。IPv6 可以潜在地提供大约 3 × 10 <sup
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">38</sup>
                            个唯一地址。.NET 使你的应用程序能够同时与 IPv4 和 IPv6 协同工作。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0013" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">For host names to work, you must first send a network request to
                translate the host name into an IP address—a task that's carried out by one or more DNS servers. A <i
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DNS server</i> stores a table
                that maps host names to IP addresses for all the computers it knows about. For host names the DNS server
                doesn't know, it stores IP addresses of other DNS servers for lookups. Your local computer should always
                know about at least one DNS server. Network administrators configure this information when a computer is
                set up.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">要让主机名生效，你必须首先发送一个网络请求来将主机名翻译成 IP
                            地址——这项任务由一个或多个 DNS 服务器执行。DNS 服务器存储一个映射表，将主机名映射到它所知道的所有计算机的 IP 地址。对于 DNS 服务器不知道的主机名，它会存储其他
                            DNS 服务器的 IP 地址以供查询。你的本地计算机应该至少知道一个 DNS 服务器。网络管理员在计算机设置时配置这些信息。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0014" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">Before sending out a request, your computer first asks the DNS
                server to give it the IP address corresponding to the host name you have typed in. When it is armed with
                the correct IP address, the computer can address the <span aria-label="522" epub:type="pagebreak"
                    id="Page_522" role="doc-pagebreak"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>request and send it
                over the network. All this work normally happens behind the scenes while the user is browsing the Web.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在发送请求之前，你的计算机首先会请求 DNS
                            服务器提供与你输入的主机名对应的 IP 地址。当它获取到正确的 IP 地址后，计算机可以寻址请求并将其发送到网络上。所有这些工作通常在用户浏览网页时在后台完成。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0015" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">.NET supplies a number of classes that are able to assist with
                the process of looking up IP addresses and finding information about host computers.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">.NET 提供了一些类，能够协助查找 IP 地址和获取有关主机计算机的信息。
                        </font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0004"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-352" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">
                    <?span Start text-decoration:underline"?> URIs <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">URI</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Uri</code> and <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UriBuilder</code> are two
                    classes in the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System</code> namespace.
                    The <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Uri</code> class
                    represents a URI, and the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UriBuilder</code> class
                    makes it easy to create a URI using the different parts of a URI.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Uri</code> 和
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UriBuilder</code>
                                是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System</code>
                                命名空间中的两个类。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Uri</code>
                                类表示一个 URI，而 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UriBuilder</code>
                                类则使用 URI 的不同部分轻松创建 URI。</font>
                        </font>
                    </font>
                </p>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0017" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Both uniform
                                resource locators (URLs) and uniform resource identifiers (URIs) are used with web
                                technologies. A URL references a web address. This is defined with RFC 1738 (</i><code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://tools.ietf.org/html/rfc1938">https://tools.ietf.org/html/rfc1738</a></code><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">). A URI is a
                                superset of a URL and can identify anything, as defined by the Resource Description
                                Framework (RDF); see </i><code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://www.w3.org/RDF/">https://www.w3.org/RDF/</a></code><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意
                                        统一资源定位符（URL）和统一资源标识符（URI）都用于网络技术。URL 引用网络地址。这由 RFC 1738（ <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://tools.ietf.org/html/rfc1938">https://tools.ietf.org/html/rfc1738</a></code>
                                        ）定义。URI 是 URL 的超集，可以标识任何事物，如资源描述框架（RDF）所定义；参见 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://www.w3.org/RDF/">https://www.w3.org/RDF/</a></code>
                                        。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The following code snippet demonstrates features of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Uri</code> class. The
                    constructor allows passing relative and absolute URLs. This class defines several read-only
                    properties to access parts of a URL, such as the scheme, host name, port number, query strings, and
                    segments of a URL (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Utilities/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">以下代码片段展示了 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Uri</code>
                                类的功能。构造函数允许传递相对和绝对 URL。此类定义了多个只读属性来访问 URL 的各个部分，例如方案、主机名、端口号、查询字符串和 URL 的片段（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Utilities/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0001"><code>void UriSample(string uri)</code>
<code>{</code>
<code>  <b>Uri page = new(uri);</b></code>
<code>  Console.WriteLine($"scheme: {<b>page.Scheme</b>}"); </code>
<code>  Console.WriteLine($"host: {<b>page.Host</b>}, type: {<b>page.HostNameType</b>}, " +</code>
<code>    $"idn host: {<b>page.IdnHost</b>}");</code>
<code>  Console.WriteLine($"port: {<b>page.Port</b>}");</code>
<code>  Console.WriteLine($"path: {<b>page.AbsolutePath</b>}");</code>
<code>  Console.WriteLine($"query: {<b>page.Query</b>}");</code>
<code> </code>
<code>  foreach (var segment in <b>page.Segments</b>)</code>
<code>  {</code>
<code>    Console.WriteLine($"segment: {segment}");</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">When you run the application with the command <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">donet run -- uri --uri</code>
                    and pass the URL and string that contains a path and a query string <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://www.amazon.com/Professional-NET-Core-Christian-Nagel/dp/1119449278/ref=sr_1_1?dchild=1&amp;keywords=Professional+C%23">https://www.amazon.com/Professional-NET-Core-Christian-Nagel/dp/1119449278/ref=sr_1_1?dchild=1&amp;keywords=Professional+C%23</a></code>,
                    you get the following output:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当您使用命令 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">donet run -- uri --uri</code>
                                运行应用程序并传递包含路径和查询字符串的 URL 和字符串 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://www.amazon.com/Professional-NET-Core-Christian-Nagel/dp/1119449278/ref=sr_1_1?dchild=1&amp;keywords=Professional+C%23">https://www.amazon.com/Professional-NET-Core-Christian-Nagel/dp/1119449278/ref=sr_1_1?dchild=1&amp;keywords=Professional+C%23</a></code>
                                时，您将得到以下输出：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0002"><code>scheme: https</code>
<code>host: www.amazon.com, type: Dns, idn host: www.amazon.com</code>
<code>port: 443</code>
<code>path: /Professional-NET-Core-Christian-Nagel/dp/1119449278/ref=sr_1_1</code>
<code>query: ?dchild=1&amp;keywords=Professional+C%23</code>
<code>segment: /</code>
<code>segment: Professional-NET-Core-Christian-Nagel/</code>
<code>segment: dp/</code>
<code>segment: 1119449278/</code>
<code>segment: ref=sr_1_1</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1"><span aria-label="523" epub:type="pagebreak" id="Page_523"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>Unlike the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Uri</code> class, the
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UriBuilder</code>
                    defines read-write properties, as shown in the following code snippet. You can create a <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UriBuilder</code>
                    instance, assign these properties, and get a URL returned from the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Uri</code> property:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">与 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Uri</code>
                                类不同， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UriBuilder</code>
                                定义了读写属性，如下面的代码片段所示。您可以创建一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UriBuilder</code>
                                实例，分配这些属性，并通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Uri</code>
                                属性获取一个 URL：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0003"><code>void BuildUri()</code>
<code>{</code>
<code>  <b>UriBuilder builder = new();</b></code>
<code>  <b>builder.Scheme = "https";</b></code>
<code>  <b>builder.Host = "www.cninnovation.com";</b></code>
<code>  <b>builder.Port = 80;</b></code>
<code>  <b>builder.Path = "training/MVC";</b></code>
<code>  <b>Uri uri = builder.Uri;</b></code>
<code>  <b>Console.WriteLine(uri);</b></code>
<code>}</code></pre>
                <p id="c19-para-0021" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Instead of using properties with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UriBuilder</code>, this
                    class also offers several overloads of the constructor where the parts of a URL can be passed as
                    well.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">与其使用带 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UriBuilder</code>
                                的属性，这个类还提供了几个构造函数的重载版本，其中可以将 URL 的各个部分作为参数传递。</font>
                        </font>
                    </font>
                </p>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0006"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-353" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">
                    <?span Start text-decoration:underline"?> IPAddress
                </h3>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code>
                    represents an IP address. The address itself is available as a byte array using the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetAddressBytes</code>
                    property and may be converted to a dotted decimal format with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ToString</code> method.
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code> also
                    implements static <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Parse</code> and <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TryParse</code> methods
                    that effectively perform the reverse conversion of <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ToString</code>—converting
                    from a dotted decimal string to an <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code>. The
                    code sample also accesses the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddressFamily</code>
                    property and converts an IPv4 address to IPv6, and vice versa (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Utilities/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code>
                                表示一个 IP 地址。该地址本身可以通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetAddressBytes</code>
                                属性以字节数组的形式获取，并可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ToString</code>
                                方法将其转换为点分十进制格式。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code>
                                还实现了静态的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Parse</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TryParse</code>
                                方法，这些方法有效地执行 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ToString</code>
                                的反向转换——即将点分十进制字符串转换为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code>
                                。代码示例还访问了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddressFamily</code>
                                属性，并将 IPv4 地址转换为 IPv6 地址，反之亦然（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Utilities/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0004"><code>void IPAddressSample(string ipAddressString)</code>
<code>{</code>
<code>  <b>if (!IPAddress.TryParse(ipAddressString, out IPAddress? address))</b></code>
<code>  {</code>
<code>    Console.WriteLine($"cannot parse {ipAddressString}");</code>
<code>    return;</code>
<code>  }</code>
<code>  byte[] bytes = <b>address.GetAddressBytes();</b></code>
<code>  for (int i = 0; i &lt; bytes.Length; i++)</code>
<code>  {</code>
<code>    Console.WriteLine($"byte {i}: {bytes[i]:X}");</code>
<code>  }</code>
<code>  Console.WriteLine($"family: {<b>address.AddressFamily</b>}, " +</code>
<code>    $"map to ipv6: {<b>address.MapToIPv6</b>()}, map to ipv4: {<b>address.MapToIPv4</b>()}");</code>
<code>  // …</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Passing the address 65.52.128.33 to the method results in
                    this output:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">将地址 65.52.128.33 传递给该方法的结果如下：
                            </font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0005"><code>byte 0: 41</code>
<code>byte 1: 34</code>
<code>byte 2: 80</code>
<code>byte 3: 21</code>
<code>family: InterNetwork, map to ipv6: ::ffff:65.52.128.33, map to ipv4: 65.52.128.3</code>
<code>3</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code> class
                    also defines static properties to create special addresses such as loopback, broadcast, and anycast:
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code>
                                类还定义了静态属性来创建特殊地址，如回环地址、广播地址和任意播地址：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0006"><code>void IPAddressSample(string ipAddressString)</code>
<code>{</code>
<code>  //…</code>
<code>  Console.WriteLine($"IPv4 loopback address: {IPAddress.Loopback}");<span aria-label="524" epub:type="pagebreak" id="Page_524" role="doc-pagebreak"></span></code>
<code>  Console.WriteLine($"IPv6 loopback address: {IPAddress.IPv6Loopback}");</code>
<code>  Console.WriteLine($"IPv4 broadcast address: {IPAddress.Broadcast}");</code>
<code>  Console.WriteLine($"IPv4 any address: {IPAddress.Any}");</code>
<code>  Console.WriteLine($"IPv6 any address: {IPAddress.IPv6Any}");</code>
<code>}</code></pre>
                <p id="c19-para-0025" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">With a <i
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">loopback address</i>, the
                    network hardware is bypassed. This is the IP address that represents the host name localhost.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用回环地址时，网络硬件会被绕过。这是代表主机名 localhost
                                的 IP 地址。</font>
                        </font>
                    </font>
                </p>
                <p id="c19-para-0026" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <i
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">broadcast address</i> is
                    an address that addresses every node in a local network. Such an address is not available with IPv6
                    because this concept is not used with the newer version of the Internet Protocol. After the initial
                    definition of IPv4, multicasting was added for IPv6. With multicasting, a group of nodes is
                    addressed instead of all nodes. With IPv6, multicasting completely replaces broadcasting. Both
                    broadcast and multicast are shown in code samples later in this chapter in the “Using UDP” section.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                广播地址是一个能够寻址本地网络中所有节点的地址。由于这种概念在更新的互联网协议版本中未使用，因此 IPv6 中没有广播地址。在 IPv4 的初始定义之后，IPv6
                                增加了多播功能。通过多播，可以寻址一组节点而不是所有节点。在 IPv6 中，多播完全取代了广播。本章的“使用 UDP”部分后面将展示广播和多播的代码示例。</font>
                        </font>
                    </font>
                </p>
                <p id="c19-para-0027" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">With an <i
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">anycast</i>, one-to-many
                    routing is used as well, but the data stream is transmitted only to the node closest in the network.
                    This is useful for load balancing. With IPv4, the Border Gateway rotocol (BGP) routing protocol is
                    used to find the shortest path in the network; with IPv6, this feature is inherent.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                通过任意播，也使用一对多的路由，但数据流只传输到网络中最接近的节点。这对于负载均衡很有用。在 IPv4 中，使用边界网关协议（BGP）路由协议在网络中找到最短路径；在 IPv6
                                中，这一特性是固有的。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">When you run the application, you can see the following
                    addresses for IPv4 and IPv6:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">运行应用程序时，你可以看到以下 IPv4 和 IPv6 地址：
                            </font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0007"><code>IPv4 loopback address: 127.0.0.1</code>
<code>IPv6 loopback address: ::1</code>
<code>IPv4 broadcast address: 255.255.255.255</code>
<code>IPv4 any address: 0.0.0.0</code>
<code>IPv6 any address: ::</code></pre>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0007"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-354" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">
                    <?span Start text-decoration:underline"?> IPHostEntry
                </h3>
                <p id="c19-para-0029" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code> class
                    encapsulates information related to a particular host computer. This class makes the host name
                    available via the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HostName</code> property
                    (which returns a string), and the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddressList</code>
                    property returns an array of <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code> objects.
                    You are going to use the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code> class
                    in the next example.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code>
                                类封装了与特定主机计算机相关的信息。此类通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HostName</code>
                                属性（该属性返回一个字符串）提供主机名，而 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddressList</code>
                                属性返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code>
                                对象的数组。你将在下一个示例中使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code>
                                类。</font>
                        </font>
                    </font>
                </p>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0008"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-355" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">
                    <?span Start text-decoration:underline"?> DNS
                </h3>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dns</code> class can
                    communicate with your default DNS server to retrieve IP addresses. The sample application is
                    implemented as a console application that loops to ask the user for host names (you can add an IP
                    address instead) to get an <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code> via
                    <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dns.GetHostEntryAsync</code>.
                    From the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code>, the
                    address list is accessed using the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddressList</code>
                    property. All the addresses of the host, as well as the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddressFamily</code>, are
                    written to the console (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DnsLookup/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dns</code>
                                类可以与你的默认 DNS 服务器通信以获取 IP 地址。示例应用程序作为一个控制台应用程序实现，它会循环询问用户输入主机名（你可以输入一个 IP 地址代替）以通过 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dns.GetHostEntryAsync</code>
                                获取 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code>
                                。从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code>
                                中，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddressList</code>
                                属性访问地址列表。主机名的所有地址以及 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddressFamily</code>
                                都会写入控制台（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DnsLookup/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0008"><code>do</code>
<code>{</code>
<code>  Console.Write("Hostname:\t");</code>
<code>  string? hostname = Console.ReadLine();</code>
<code>  if (hostname is null || </code>
<code>    hostname.Equals("exit", StringComparison.CurrentCultureIgnoreCase))</code>
<code>  {</code>
<code>    Console.WriteLine("bye!");</code>
<code>    return;</code>
<code>  }</code>
<code> </code>
<code>  await OnLookupAsync(hostname);</code>
<code>  Console.WriteLine();</code>
<code>} while (true);</code>
<code> <span aria-label="525" epub:type="pagebreak" id="Page_525" role="doc-pagebreak"></span></code>
<code>async Task OnLookupAsync(string hostname)</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    <b>IPHostEntry ipHost = await Dns.GetHostEntryAsync(hostname);</b></code>
<code>    Console.WriteLine($"Hostname: {ipHost.HostName}");</code>
<code>    foreach (IPAddress address in ipHost.AddressList)</code>
<code>    {</code>
<code>      Console.WriteLine($"Address Family: {address.AddressFamily}");</code>
<code>      Console.WriteLine($"Address: {address}");</code>
<code>    }</code>
<code>  }</code>
<code>  catch (SocketException ex)</code>
<code>  {</code>
<code>    Console.WriteLine(ex.Message);</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Run the application and enter a few host names to see output
                    similar to what's shown in the following example. With the host name <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="http://www.wiley.com">www.wiley.com</a></code>,
                    you can see that this host name defines multiple IP addresses. <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="http://portal.azure.com">portal.azure.com</a></code>
                    returns with different host names and IP addresses depending on your region.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">运行应用程序并输入几个主机名，以查看类似于以下示例的输出。使用主机名
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="http://www.wiley.com">www.wiley.com</a></code>
                                ，可以看到该主机名定义了多个 IP 地址。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="http://portal.azure.com">portal.azure.com</a></code>
                                会根据你的地区返回不同的主机名和 IP 地址。</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0009"><code>Hostname: <b>www.cninnovation.com</b></code>
<code>Hostname: www.cninnovation.com</code>
<code>Address Family: InterNetwork, address: 65.52.128.33</code>
<code> </code>
<code>Hostname: www.wiley.com</code>
<code>Hostname: 1x6jqndp2gdqp.cloudfront.net</code>
<code>Address Family: InterNetwork, address: 13.32.2.108</code>
<code>Address Family: InterNetwork, address: 194.232.104.139</code>
<code>Address Family: InterNetwork, address: 13.32.2.25</code>
<code>Address Family: InterNetwork, address: 13.32.2.54</code>
<code>Address Family: InterNetwork, address: 13.32.2.51</code>
<code> </code>
<code>Hostname: <b>portal.azure.com</b></code>
<code>Hostname: portal-prod-germanywestcentral-02.germanywestcentral.cloudapp.azure.com</code>
<code>Address Family: InterNetwork, address: 51.116.144.197</code>
<code> </code>
<code>Hostname: exit</code>
<code>bye!</code></pre>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0033" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">The </i><code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dns</code><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> class is
                                somewhat limited. For example, you can't define using a server that's different than the
                                default DNS server. Also, the </i><code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Aliases</code><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> property of the
                            </i><code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> is not populated
                                from the method </i><code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHostEntryAsync</code><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">. It's populated
                                from the obsolete method </i><code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Resolve</code><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">, and this
                                doesn't populate this property fully. For full use of DNS lookups, it's better to use a
                                third-party library.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dns</code>
                                        类的功能有所限制。例如，你不能使用与默认 DNS 服务器不同的服务器进行定义。此外， <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code>
                                        的 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Aliases</code>
                                        属性不是通过方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHostEntryAsync</code>
                                        填充的。它通过过时的方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Resolve</code>
                                        填充，但这并不能完全填充此属性。若要完全使用 DNS 查询功能，最好使用第三方库。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p id="c19-para-0034" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Now it's time to move to a low-level API using the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> class.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">现在，是时候使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                                类迁移到低级 API 了。</font>
                        </font>
                    </font>
                </p>
            </section> <span aria-label="526" epub:type="pagebreak" id="Page_526" role="doc-pagebreak"
                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0010"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-356" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Configuring Sockets <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">配置套接字</font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0035" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">No matter what networking API you use, they are all based on
                    sockets. To configure sockets, you can use the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ServicePoint</code>. With
                    the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ServicePointManager</code>
                    class, you can get <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ServicePoint</code>
                    instances by invoking the static method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">FindServicePoint</code>
                    and passing a URI. Using this, you can specifically configure sockets for this address.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">无论你使用什么网络
                                API，它们都基于套接字。要配置套接字，你可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ServicePoint</code>
                                。通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ServicePointManager</code>
                                类，你可以通过调用静态方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">FindServicePoint</code>
                                并传递一个 URI 来获取 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ServicePoint</code>
                                实例。使用这种方式，你可以为该地址专门配置套接字。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">To configure all sockets, no matter which connection is used,
                    you can use static methods of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ServicePointManager</code>
                    class, such as by invoking the method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SetTcpKeepAlive</code>.
                    This method sets the keep-alive flag with the socket to stay informed when the connection is lost
                    and to keep the connection open in case of inactivity. With TCP keep-alive, probe packets are sent
                    where an acknowledge (ACK) message is expected. The sample code enables the keep-alive flag with a
                    message sent every second (<code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">keepAliveInterval</code>)
                    and a timeout of 60 seconds (<code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">keepAliveTime</code>). A
                    default setting is two hours for the timeout and one second for the interval:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要配置所有套接字，无论使用哪种连接，您都可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ServicePointManager</code>
                                类的静态方法，例如调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SetTcpKeepAlive</code>
                                。此方法设置套接字的保持活动标志，以便在连接丢失时获得通知，并在不活动的情况下保持连接打开。使用 TCP 保持活动功能时，会发送探测数据包，并期望收到确认 (ACK)
                                消息。示例代码通过每秒发送一条消息（ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">keepAliveInterval</code>
                                ）和 60 秒的超时（ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">keepAliveTime</code>
                                ）来启用保持活动标志。超时默认设置为两小时，间隔默认设置为 1 秒：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0010"><code>ServicePointManager.SetTcpKeepAlive(</code>
<code>  enabled: true, keepAliveTime: 600000, keepAliveInterval: 1000);</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Other settings you can specify with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ServicePointManager</code>
                    include the following:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">您还可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ServicePointManager</code>
                                指定以下设置：</font>
                        </font>
                    </font>
                </p>
                <ul class="check" id="c19-list-0003"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <li id="c19-li-0016" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                        data-immersive-translate-paragraph="1"><code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DefaultConnectionLimit</code>
                        specifies the maximum number of concurrent connections allowed by the application. With
                        non–ASP.NET Core applications, the default value is 2, so often there's the need to increase
                        this limit.<font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1"> <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DefaultConnectionLimit</code>
                                    指定应用程序允许的最大并发连接数。对于非 ASP.NET Core 应用程序，默认值是 2，因此通常需要增加此限制。</font>
                            </font>
                        </font>
                    </li>
                    <li id="c19-li-0017" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                        data-immersive-translate-paragraph="1"><code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EnableDnsRoundRobin</code>
                        enables DNS round-robin. By default, if the DNS name is accessible using multiple IP addresses
                        (as you've seen in the section DNS), always the first IP address is used. If you set this to
                        <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">true</code>, one
                        after another IP address is used with DNS lookups.<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1"> <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EnableDnsRoundRobin</code>
                                    启用 DNS 轮询。默认情况下，如果 DNS 名称可以使用多个 IP 地址访问（如 DNS 部分所述），则始终使用第一个 IP 地址。如果您将其设置为 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">true</code>
                                    ，则在使用 DNS 查询时按顺序使用一个 IP 地址。</font>
                            </font>
                        </font>
                    </li>
                    <li id="c19-li-0018" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                        data-immersive-translate-paragraph="1">The Nagle algorithm is used to reduce the sending of many
                        small packages. Packages are sent only when the buffer is full. If the buffer is not full, the
                        package is sent only when the receiver of the packages already acknowledged all packages that
                        have been sent so far. If you need a faster response—for example, when the user enters some data
                        that should be sent immediately—you can turn off this algorithm by setting <code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseNagleAlgorithm</code>
                        to <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">false</code>.
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">Nagle
                                    算法用于减少发送大量小数据包。只有当缓冲区满时才会发送数据包。如果缓冲区不满，数据包只有在接收方已确认所有已发送的数据包时才会发送。如果你需要更快的响应——例如，当用户输入一些应该立即发送的数据时——你可以通过将
                                    <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseNagleAlgorithm</code>
                                    设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">false</code>
                                    来关闭此算法。</font>
                            </font>
                        </font>
                    </li>
                    <li id="c19-li-0019" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                        data-immersive-translate-paragraph="1">If you define a custom implementation to check for
                        certificates, you can define a handler method of the delegate type <code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">RemoteCertificateValidationCallback</code>
                        and set it with the <code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ServerCertificateValidationCallback</code>
                        property.<font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">
                                    如果你定义了一个自定义的实现来检查证书，你可以定义一个委托类型 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">RemoteCertificateValidationCallback</code>
                                    的处理方法，并通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ServerCertificateValidationCallback</code>
                                    属性来设置它。</font>
                            </font>
                        </font>
                    </li>
                </ul>
            </section>
        </section>
        <section aria-labelledby="head-2-178" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
            <span id="c19-sec-0011" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <h2 id="head-2-178" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">USING SOCKETS<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用套接字</font>
                    </font>
                </font>
            </h2>
            <p id="c19-para-0038" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">The HTTP protocol is based on TCP (there's an exception: the
                upcoming HTTP/3 protocol is based on the QUIC protocol, which is an enhancement of UDP), and thus the
                <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpXX</code> classes offer
                an abstraction layer over the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpXX</code> classes. The
                <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpXX</code> classes,
                however, give you more control. You can even get more control than offered by the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpXX</code> or <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpXX</code> classes with the
                <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> class. With
                sockets, you can use different protocols, not only protocols based on TCP or UDP—for example, Internet
                Control Message Protocol (ICMP), Internet Datagram Protocol (IDP), and PARC Universal Packet Protocol
                (PUP). You can also create a protocol. What might be even more important is that you can have more
                control over TCP- or UDP-based protocols.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">HTTP 协议基于 TCP（有一个例外：即将推出的 HTTP/3 协议基于
                            QUIC 协议，QUIC 协议是 UDP 的增强版），因此 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpXX</code> 类在
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpXX</code>
                            类之上提供了抽象层。然而， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpXX</code>
                            类则提供了更多控制权。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                            类，你甚至可以获得比 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpXX</code> 或
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpXX</code>
                            类更多的控制权。通过套接字，你可以使用不同的协议，而不仅仅是基于 TCP 或 UDP 的协议——例如，互联网控制消息协议（ICMP）、互联网数据报协议（IDP）和 PARC
                            通用数据包协议（PUP）。你也可以创建自己的协议。更重要的是，你可以对基于 TCP 或 UDP 的协议进行更多控制。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0012"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-357" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">TCP Echo Sample Using Sockets<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用套接字的 TCP 回声示例</font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0039" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Let's start with a server that listens to incoming requests
                    and returns the received data to the client. This application is based on the TCP Echo protocol as
                    defined by RFC 862 (<code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://tools.ietf.org/html/rfc862">https://tools.ietf.org/html/rfc862</a></code>).
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">让我们从一个监听传入请求并返回接收数据的服务器开始。这个应用程序基于
                                RFC 862（ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://tools.ietf.org/html/rfc862">https://tools.ietf.org/html/rfc862</a></code>
                                ）定义的 TCP 回声协议。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1"><span aria-label="527" epub:type="pagebreak" id="Page_527"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>This sample
                    application makes use of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code> class defined
                    in the package <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.Extensions.Hosting</code>
                    to use the preconfigured dependency injection container, logging, and configuration options. You can
                    supply the application configuration values in the configuration file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">appsettings.json</code>
                    and override the configuration values passing parameters from the command line. This sample also
                    makes use of logging as supported by the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code> class.
                    Networking classes generate some logging output, as you can see with the samples from this chapter.
                    You can configure the logging level in the application configuration file as well.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">这个示例应用程序使用包 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.Extensions.Hosting</code>
                                中定义的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code>
                                类来使用预配置的依赖注入容器、日志记录和配置选项。您可以在配置文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">appsettings.json</code>
                                中提供应用程序配置值，并通过从命令行传递参数来覆盖配置值。这个示例还使用了由 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code>
                                类支持的日志记录功能。网络类会生成一些日志输出，正如本章的示例所示。您也可以在应用程序配置文件中配置日志级别。</font>
                        </font>
                    </font>
                </p>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0041" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Read <a
                                    href="c15.xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                                    15</a>, “Dependency Injection and Configuration,” for information on the </i><code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> class and using
                                .NET configuration, and <a href="c16.xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                                    16</a>, “Diagnostics and Metrics,” for more information on logging.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 有关 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code>
                                        类和使用 .NET 配置的信息，请参阅第 15 章“依赖注入和配置”，有关日志记录的更多信息，请参阅第 16 章“诊断和指标”。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">With the application configuration file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">appsettings.json</code>,
                    logging levels and the port number and timeout for the socket server are configured (configuration
                    file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketServer/appsettings.json</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用应用程序配置文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">appsettings.json</code>
                                ，配置了日志级别、套接字服务器的端口号和超时时间（配置文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketServer/appsettings.json</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0011"><code>{</code>
<code>  "Logging": {</code>
<code>    "Console": {</code>
<code>      "LogLevel": {</code>
<code>        "Default": "Trace",</code>
<code>        "EchoServer": "Trace"</code>
<code>      }</code>
<code>    },</code>
<code>    "LogLevel": {</code>
<code>      "Default": "Trace",</code>
<code>      "Microsoft": "Information",</code>
<code>      "EchoServer": "Warning"</code>
<code>    }</code>
<code>  },</code>
<code>  "Echoserver": {</code>
<code>    "Port": "8200",</code>
<code>    "Timeout": "5000"</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">With the top-level statements, the dependency injection (DI)
                    container is configured. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EchoService</code> class
                    is defined with the container. This class contains the major code for the application, the use of
                    the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                    class. The configuration for this is retrieved from the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EchoServer</code>
                    section, which is then accessed with the constructor of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EchoService</code> class
                    and passed via the DI container. After the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code> class is
                    configured, the socket listener is started by invoking the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">StartListenerAsync</code>
                    method of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EchoService</code> class.
                    In addition, the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">CancelKeyPress</code>
                    event of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Console</code> class is
                    assigned to react to the cancellation of the user to send a cancel via the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">CancellationToken</code>
                    (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketServer/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用顶层语句配置依赖注入（DI）容器。 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EchoService</code>
                                类通过容器定义。此类包含应用程序的主要代码，包括对 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                                类的使用。此配置从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EchoServer</code>
                                部分获取，然后通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EchoService</code>
                                类的构造函数访问，并通过 DI 容器传递。配置完 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code>
                                类后，通过调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EchoService</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">StartListenerAsync</code>
                                方法启动套接字监听器。此外，将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Console</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">CancelKeyPress</code>
                                事件分配给响应用户取消操作，通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">CancellationToken</code>
                                发送取消信号（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketServer/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0012"><code>using var host = Host.CreateDefaultBuilder(args)</code>
<code>  .ConfigureServices((context, services) =&gt;</code>
<code>  {</code>
<code>    var settings = context.Configuration;</code>
<code>    services.Configure&lt;EchoServiceOptions&gt;(settings.GetSection("Echoserver"));</code>
<code>    services.AddTransient&lt;EchoServer&gt;();</code>
<code>  })</code>
<code>  .Build();</code>
<code> </code>
<code>var logger = host.Services.GetRequiredService&lt;ILoggerFactory&gt;()<span aria-label="528" epub:type="pagebreak" id="Page_528" role="doc-pagebreak"></span></code>
<code>  .CreateLogger("EchoServer");</code>
<code> </code>
<code>CancellationTokenSource cancellationTokenSource = new();</code>
<code> </code>
<code>Console.CancelKeyPress += (sender, e) =&gt;</code>
<code>{</code>
<code>    logger.LogInformation("cancellation initiated by the user");</code>
<code>    cancellationTokenSource.Cancel();</code>
<code>};</code>
<code> </code>
<code>var service = host.Services.GetRequiredService&lt;EchoServer&gt;();</code>
<code>await service.StartListenerAsync(cancellationTokenSource.Token);</code>
<code> </code>
<code>Console.ReadLine();</code></pre>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0045" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Cancellation
                                tokens are explained in <a href="c11.xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                                    11</a>, “Tasks and Asynchronous Programming.”</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：取消令牌在第 11
                                        章“任务和异步编程”中解释。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">From the values configured with the application settings, the
                    port and timeout values are assigned to fields of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EchoServer</code> class
                    (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketServer/EchoServer.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">从应用程序设置配置的值中，端口和超时值被分配给 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EchoServer</code>
                                类的字段（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketServer/EchoServer.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0013"><code>record EchoServiceOptions</code>
<code>{</code>
<code>  public int Port { get; init; }</code>
<code>  public int Timeout { get; init; }</code>
<code>}</code>
<code> </code>
<code>class EchoServer</code>
<code>{</code>
<code>  private readonly int _port;</code>
<code>  private readonly ILogger _logger;</code>
<code>  private readonly int _timeout;</code>
<code>  public EchoServer(IOptions&lt;EchoServiceOptions&gt; options, ILogger&lt;EchoServer&gt; logger)</code>
<code>  {</code>
<code>    _port = options.Value.Port;</code>
<code>    _timeout = options.Value.Timeout;</code>
<code>    _logger = logger;</code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0015"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-358" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Creating a Listener <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建监听器</font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0047" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">In the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">StartListenerAsync</code>
                    method, a new <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> object is
                    created. With the constructor of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> class, you
                    can specify the communication type. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddressFamily</code> is a
                    large enumeration that offers many different networks. Examples are <i
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DECnet</i>, which was
                    released in 1975 by Digital Equipment and used as main network communication between PDP-11 systems;
                    Banyan VINES, which was used to connect client machines; and, of course, <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">InterNetwork</code> for
                    IPv4 and <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">InterNetworkV6</code> for
                    IPv6. As mentioned previously, you can use sockets for a large number of networking protocols. The
                    second parameter, <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketType</code>,
                    specifies the kind of socket. Examples are <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Stream</code> for <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TCP</code>, <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dgram</code> for <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UDP</code>, or <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Raw</code> for raw
                    sockets. The third parameter is an enumeration for the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ProtocolType</code>.
                    Examples are <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IP</code>,
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Ucmp</code>, <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Udp</code>, <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPv6</code>, and <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Raw</code>. The settings
                    you choose need to match. For <span aria-label="529" epub:type="pagebreak" id="Page_529"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>example, if you
                    use TCP with IPv4, the address family must be <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">InterNetwork</code>, the
                    socket type <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Stream</code>, and the
                    protocol type <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Tcp</code>. To create a
                    UDP communication with IPv4, the address family needs to be set to <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">InterNetwork</code>, the
                    socket type <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dgram</code>, and the
                    protocol type <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Udp</code>.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">StartListenerAsync</code>
                                方法中，会创建一个新的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                                对象。通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                                类的构造函数，可以指定通信类型。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddressFamily</code>
                                是一个包含多种不同网络的庞大枚举。例如，DECnet，由 Digital Equipment 于 1975 年发布，用于 PDP-11 系统之间的主要网络通信；Banyan
                                VINES，用于连接客户端机器；当然还有 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">InterNetwork</code>
                                用于 IPv4 和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">InterNetworkV6</code>
                                用于 IPv6。如前所述，你可以使用套接字来实现多种网络协议。第二个参数 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketType</code>
                                指定套接字的类型。例如， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Stream</code>
                                用于 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TCP</code> ，
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dgram</code>
                                用于 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UDP</code>
                                ，或者 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Raw</code>
                                用于原始套接字。第三个参数是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ProtocolType</code>
                                的枚举。例如， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IP</code> ，
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Ucmp</code> ，
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Udp</code> ，
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPv6</code> 和
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Raw</code>
                                。你选择的设置需要匹配。例如，如果你使用 IPv4 的 TCP，地址族必须是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">InterNetwork</code>
                                ，套接字类型必须是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Stream</code>
                                ，协议类型必须是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Tcp</code>
                                。要创建 IPv4 的 UDP 通信，地址族需要设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">InterNetwork</code>
                                ，套接字类型需要设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dgram</code>
                                ，协议类型需要设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Udp</code> 。
                            </font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The listener socket returned from the constructor is bound to
                    an IP address and port number. With the sample code, the listener is bound to all local IPv4
                    addresses, and the port number is specified with the argument. Calling the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Listen</code> method
                    starts the listening mode of the socket. The socket can now accept incoming connection requests.
                    Specifying the parameter with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Listen</code> method
                    defines the size of the backlog queue—how many clients can connect concurrently before their
                    connection is dealt with (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketServer/EchoServer.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">从构造函数返回的监听套接字绑定到 IP
                                地址和端口号。在示例代码中，监听器绑定到所有本地 IPv4 地址，端口号通过参数指定。调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Listen</code>
                                方法启动套接字的监听模式。现在套接字可以接受传入的连接请求。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Listen</code>
                                方法指定参数定义了后备队列的大小——在处理连接之前可以同时连接多少个客户端（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketServer/EchoServer.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0014"><code>public async Task StartListenerAsync(CancellationToken cancellationToken = default)</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    <b>using Socket listener = new(AddressFamily.InterNetwork,</b> </code>
<code>                                <b>SocketType.Stream,</b> </code>
<code>                                <b>ProtocolType.Tcp);</b></code>
<code>    listener.ReceiveTimeout = _timeout;</code>
<code>    listener.SendTimeout = _timeout;</code>
<code> </code>
<code>    <b>listener.Bind(new IPEndPoint(IPAddress.Any, _port));</b></code>
<code>    <b>listener.Listen(backlog: 15);</b></code>
<code> </code>
<code>    _logger.LogTrace("EchoListener started on port {0}", _port);</code>
<code>    //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Waiting for the client to connect happens in the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AcceptAsync</code> method
                    of the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                    class. This method continues after the await as soon as a client connects. After a client connects,
                    this method is invoked again to fulfill requests of other clients; this is why this method is called
                    within a <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">while</code>
                    loop. For the listening, a separate task, which can be canceled from the calling thread, is started.
                    The task to read and write using the socket happens within the method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ProcessClientJobAsync</code>.
                    This method receives the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> instance
                    that is bound to the client to read and write (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketServer/EchoServer.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">等待客户端连接发生在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AcceptAsync</code>
                                方法中。一旦客户端连接，该方法就会在 await 之后继续执行。客户端连接后，该方法再次被调用以处理其他客户端的请求；这就是该方法在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">while</code>
                                循环中调用的原因。对于监听，启动了一个单独的任务，该任务可以从调用线程中取消。使用套接字进行读写任务在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ProcessClientJobAsync</code>
                                方法中发生。该方法接收绑定到客户端以进行读写的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                                实例（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketServer/EchoServer.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0015"><code>public async Task StartListenerAsync(CancellationToken = default)</code>
<code>{</code>
<code>    //…</code>
<code>    while (true)</code>
<code>    {</code>
<code>      if (cancellationToken.IsCancellationRequested)</code>
<code>      {</code>
<code>        cancellationToken.ThrowIfCancellationRequested();</code>
<code>        break;</code>
<code>      }</code>
<code>      var socket = await listener.AcceptAsync();</code>
<code>      if (!socket.Connected)</code>
<code>      {</code>
<code>        _logger.LogWarning("Client not connected after accept");</code>
<code>        break;</code>
<code>      }</code>
<code> </code>
<code>      _logger.LogInformation("client connected, local {0}, remote {1}", </code>
<code>      socket.LocalEndPoint, socket.RemoteEndPoint);</code>
<code> </code>
<code>      Task _ = ProcessClientJobAsync(socket);</code>
<code>    }</code>
<code>  }<span aria-label="530" epub:type="pagebreak" id="Page_530" role="doc-pagebreak"></span></code>
<code>  catch (SocketException ex)</code>
<code>  {</code>
<code>    _logger.LogError(ex, ex.Message);</code>
<code>  }</code>
<code>  catch (Exception ex)</code>
<code>  {</code>
<code>    _logger.LogError(ex, ex.Message);</code>
<code>    throw;</code>
<code>  }</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0016"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-359" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Communication with Pipelines <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">与管道通信</font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0050" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">To communicate with the client, you can use receive and send
                    methods of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> class using
                    a memory buffer dealing with bytes. Another API that can be used with sockets is a <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code>.
                    This class derives from the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Stream</code> base class,
                    which allows reading and writing from the network and is mentioned in <a href="c18.xhtml"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter 18</a>, “Files
                    and Streams.” You can also use readers and writers, which are also covered in <a href="c18.xhtml"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter 18</a>. With all
                    these options, you need to manage the size of the memory buffer, which can be quite complex if done
                    efficiently, especially if the size of the data sent and received changes dynamically. You need to
                    adapt the buffer sizes and repeat reading and combining the data if you receive more data than can
                    fit into the buffer.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要与客户端通信，您可以使用处理字节的内存缓冲区的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                                类的接收和发送方法。另一个可用于套接字的 API 是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code>
                                。该类继承自 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Stream</code>
                                基类，允许从网络读写，并在第 18 章“文件和流”中提到。您还可以使用读取器和写入器，这些也在第 18
                                章中涵盖。有了所有这些选项，您需要管理内存缓冲区的大小，如果高效地完成，这可能相当复杂，特别是如果发送和接收的数据大小动态变化。您需要调整缓冲区大小，并在接收到的数据大于缓冲区可容纳大小的情况下重复读取和组合数据。
                            </font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The NuGet package <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.IO.Pipelines</code>
                    makes this job a lot easier. You don't need to allocate the buffer yourself; that's done using <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeReader</code> and
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeWriter</code> from
                    the namespace <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.IO.Pipelines</code>.
                    With the following implementation of the method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ProcessClientJobAsync</code>,
                    the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeReader</code>
                    and <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeWriter</code>
                    objects are created to pass the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code> to
                    the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Create</code>
                    method. There's no need to create a memory buffer before invoking the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsync</code> method
                    of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeReader</code>. The
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsync</code> method
                    returns a <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadResult</code>. This
                    struct contains a reference to the allocated buffer (the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Buffer</code> property).
                    This buffer is of type <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadOnlySequence&lt;byte&gt;</code>.
                    The buffer used by pipelines can be a list of multiple memory segments. <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadOnlySequence&lt;T&gt;</code>
                    contains an iterator that allows the program to walk through the segments. With the following code
                    snippet, the segments are iterated with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">foreach</code> statement
                    after the check that the sequence is not just a single segment (<code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IsSingleSegment</code>
                    property). If you just enter data from the keyboard to send it to the server, usually you'll see
                    just one segment. When passing the content of files, you can likely see multiple segments. With a
                    single segment, the content can be accessed with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">FirstSpan</code> property
                    of type <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadOnlySpan&lt;byte&gt;</code>.
                    With the echo service, the content read is encoded and returned to the caller with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">WriteAsync</code> method
                    of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeWriter</code>. Before
                    continuing the read on the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeReader</code>, you
                    need to advance the position of the reader by invoking the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AdvanceTo</code> method.
                    This method needs a <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SequencePosition</code>
                    that's returned from the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetPosition</code> method
                    of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadOnlySequence&lt;T&gt;</code>
                    (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketServer/EchoServer.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">NuGet 包 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.IO.Pipelines</code>
                                让这项工作变得简单得多。你不需要自己分配缓冲区；这是通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeReader</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeWriter</code>
                                在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.IO.Pipelines</code>
                                命名空间中完成的。通过以下 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ProcessClientJobAsync</code>
                                方法的实现，创建 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeReader</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeWriter</code>
                                对象来将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code>
                                传递给 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Create</code>
                                方法。在调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeReader</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsync</code>
                                方法之前，无需创建内存缓冲区。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsync</code>
                                方法返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadResult</code>
                                。这个结构体包含一个指向已分配缓冲区的引用（即 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Buffer</code>
                                属性）。这个缓冲区是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadOnlySequence&lt;byte&gt;</code>
                                类型的。管道使用的缓冲区可以是一个包含多个内存段的列表。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadOnlySequence&lt;T&gt;</code>
                                包含一个迭代器，允许程序遍历这些段。在以下代码片段中，在检查序列是否只是一个单一段（ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IsSingleSegment</code>
                                属性）之后，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">foreach</code>
                                语句迭代这些段。如果你只是从键盘输入数据发送到服务器，通常你会看到一个单一段。当传递文件内容时，你可能会看到多个段。对于单一段，可以通过 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">FirstSpan</code>
                                属性（类型为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadOnlySpan&lt;byte&gt;</code>
                                ）访问内容。 使用回声服务时，读取的内容会被编码并通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeWriter</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">WriteAsync</code>
                                方法返回给调用者。在继续对 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PipeReader</code>
                                进行读取之前，你需要通过调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AdvanceTo</code>
                                方法来移动读取器的位置。这个方法需要一个从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadOnlySequence&lt;T&gt;</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetPosition</code>
                                方法返回的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SequencePosition</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketServer/EchoServer.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0016"><code>private async Task ProcessClientJobAsync(Socket socket, </code>
<code>  CancellationToken cancellationToken = default)</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    <b>using NetworkStream stream = new(socket, ownsSocket: true);</b></code>
<code> </code>
<code>    <b>PipeReader reader = PipeReader.Create(stream);</b></code>
<code>    <b>PipeWriter writer = PipeWriter.Create(stream);</b></code>
<code> </code>
<code>    bool completed = false;</code>
<code>    do</code>
<code>    {</code>
<code>      <b>ReadResult result = await reader.ReadAsync(cancellationToken);</b></code>
<code> </code>
<code>      if (result.Buffer.Length == 0)</code>
<code>      {</code>
<code>        completed = true;<span aria-label="531" epub:type="pagebreak" id="Page_531" role="doc-pagebreak"></span></code>
<code>        _logger.LogInformation("received empty buffer, client closed");</code>
<code>      }</code>
<code>      ReadOnlySequence&lt;byte&gt; buffer = result.Buffer;</code>
<code>      if (buffer.IsSingleSegment)</code>
<code>      {</code>
<code>        string data = Encoding.UTF8.GetString(buffer.FirstSpan);</code>
<code>        _logger.LogTrace("received data {0} from the client {1}", </code>
<code>          data, socket.RemoteEndPoint);</code>
<code> </code>
<code>        // send the data back</code>
<code>        <b>await writer.WriteAsync(buffer.First, cancellationToken);</b></code>
<code>      }</code>
<code>      else</code>
<code>      {</code>
<code>        int segmentNumber = 0;</code>
<code>        foreach (<b>var item in buffer</b>)</code>
<code>        {</code>
<code>          segmentNumber++;</code>
<code>          string data = Encoding.UTF8.GetString(item.Span);</code>
<code>          _logger.LogTrace("received data {0} from the client {1} in the {2}. segment", </code>
<code>            data, socket.RemoteEndPoint, segmentNumber);</code>
<code> </code>
<code>          // send the data back</code>
<code>          <b>await writer.WriteAsync(item, cancellationToken);</b></code>
<code>        <b>}</b></code>
<code>      <b>}</b></code>
<code>      <b>SequencePosition nextPosition = result.Buffer.GetPosition(result.Buffer.Length);</b></code>
<code>      <b>reader.AdvanceTo(nextPosition);</b></code>
<code> </code>
<code>    } while (!completed);</code>
<code>  }</code>
<code>  catch (SocketException ex)</code>
<code>  {</code>
<code>    _logger.LogError(ex, ex.Message);</code>
<code>  }</code>
<code>  catch (IOException ex) when ((ex.InnerException is SocketException socketException) </code>
<code>    &amp;&amp; (socketException.ErrorCode is 10054))</code>
<code>  {</code>
<code>    logger.LogInformation("client {0} closed the connection", socket.RemoteEndPoint);</code>
<code>  }</code>
<code>  catch (Exception ex)</code>
<code>  {</code>
<code>    _logger.LogError(ex, "ex.Message with client {0}", socket.RemoteEndPoint);</code>
<code>    throw;</code>
<code>  }</code>
<code>  _logger.LogTrace("Closed stream and client socket {0}", socket.RemoteEndPoint);</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0053" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Check <a
                                    href="c13.xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                                    13</a>, “Managed and Unmanaged Memory,” for details on the </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Span&lt;T&gt;</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> type.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：有关 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Span&lt;T&gt;</code>
                                        类型的详细信息，请查看第 13 章“托管和非托管内存”。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section> <span aria-label="532" epub:type="pagebreak" id="Page_532" role="doc-pagebreak"
                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0018"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-360" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Implementing a Receiver <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">实现接收器</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The receiver application <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketClient</code> is
                    implemented as a console application as well. Similar to the server, the startup code with top-level
                    commands is done with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code> class to read
                    configuration values. With the client, properties of the class <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EchoClientOptions</code>
                    are filled from the configuration file or command-line arguments (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketClient/EchoClient.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">接收器应用程序 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketClient</code>
                                也实现为控制台应用程序。与服务器类似，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code>
                                类来读取配置值，并执行顶层命令的启动代码。对于客户端，类 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EchoClientOptions</code>
                                的属性从配置文件或命令行参数中填充（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketClient/EchoClient.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0017"><code>reccord EchoClientOptions</code>
<code>{</code>
<code>  public string? Hostname { get; init; }</code>
<code>  public int ServerPort { get; init; }</code>
<code>}</code>
<code> </code>
<code>class EchoClient</code>
<code>{</code>
<code>  private readonly string _hostname;</code>
<code>  private readonly int _serverPort;</code>
<code>  private readonly ILogger _logger;</code>
<code>  public EchoClient(IOptions&lt;EchoClientOptions&gt; options, ILogger&lt;EchoClient&gt; logger)</code>
<code>  {</code>
<code>    _hostname = options.Value.Hostname ?? "localhost";</code>
<code>    _serverPort = options.Value.ServerPort;</code>
<code>    _logger = logger;</code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAndReceiveAsync</code>
                    method uses DNS name resolution to get the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code> from
                    the hostname. This <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code> is
                    used to get an IPv4 address of the host. After the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> instance is
                    created (in the same way it was created for the server code), the address is used with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConnectAsync</code>
                    method to make a connection to the server. With TCP, before sending data, a connection needs to be
                    opened. Next, standard input and standard output from the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Console</code> class are
                    redirected to the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code>
                    that's associated with the socket. All the data you enter with the console is sent to the echo
                    server (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketClient/EchoClient.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAndReceiveAsync</code>
                                方法使用 DNS 名称解析来获取 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code>
                                ，从主机名中获取该 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code>
                                。这个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code>
                                用于获取主机的 IPv4 地址。在创建 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                                实例后（与服务器代码创建的方式相同），使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConnectAsync</code>
                                方法将地址用于连接服务器。使用 TCP 时，在发送数据之前需要打开连接。接下来，将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Console</code>
                                类的标准输入和标准输出重定向到与套接字关联的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code>
                                。你使用控制台输入的所有数据都会发送到回声服务器（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SocketClient/EchoClient.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0018"><code>public async Task SendAndReceiveAsync(CancellationToken cancellationToken)</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    var addresses = await Dns.GetHostAddressesAsync(_hostname);</code>
<code>    IPAddress ipAddress = addresses.Where(</code>
<code>      address =&gt; address.AddressFamily == AddressFamily.InterNetwork).First();</code>
<code>    if (ipAddress is null)</code>
<code>    {</code>
<code>      _logger.LogWarning("no IPv4 address");</code>
<code>      return;</code>
<code>    }</code>
<code> </code>
<code>    <b>Socket clientSocket = new(AddressFamily.InterNetwork, SocketType.Stream,</b> </code>
<code>      <b>ProtocolType.Tcp);</b></code>
<code>    <b>await clientSocket.ConnectAsync(ipAddress, _serverPort, cancellationToken);</b></code>
<code> </code>
<code>    _logger.LogInformation("client connected to echo service");</code>
<code>    <b>using NetworkStream stream = new(clientSocket, ownsSocket: true);</b></code>
<code> </code>
<code>    Console.WriteLine("enter text that is streamed to the server and returned");</code>
<code> <span aria-label="533" epub:type="pagebreak" id="Page_533" role="doc-pagebreak"></span></code>
<code>    // send the input to the network stream</code>
<code>    <b>Stream consoleInput = Console.OpenStandardInput();</b></code>
<code>    <b>Task sender = consoleInput.CopyToAsync(stream, cancellationToken);</b></code>
<code> </code>
<code>    // receive the output from the network stream</code>
<code>    <b>Stream consoleOutput = Console.OpenStandardOutput();</b></code>
<code>    <b>Task receiver = stream.CopyToAsync(consoleOutput, cancellationToken);</b></code>
<code> </code>
<code>    await Task.WhenAll(sender, receiver);</code>
<code>    _logger.LogInformation("sender and receiver completed");</code>
<code>  }</code>
<code>  catch (SocketException ex)</code>
<code>  {</code>
<code>    _logger.LogError(ex, ex.Message);</code>
<code>  }</code>
<code>  catch (OperationCanceledException ex)</code>
<code>  {</code>
<code>    _logger.LogInformation(ex.Message);</code>
<code>  }</code>
<code>}</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0057" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">If you change the
                                filtering of the address list to get an IPv6 address instead of an IPv4 address, you
                                also need to change the </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> invocation to
                                create a socket for the IPv6 address family.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 如果将地址列表的过滤方式更改为获取 IPv6
                                        地址而不是 IPv4 地址，你还需要更改 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                                        调用来创建 IPv6 地址族的套接字。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p id="c19-para-0058" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">When you run both the client and server, you can see
                    communication across TCP.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当你同时运行客户端和服务器时，可以看到 TCP 通信。</font>
                        </font>
                    </font>
                </p>
            </section>
        </section>
        <section aria-labelledby="head-2-179" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
            <span id="c19-sec-0020" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <h2 id="head-2-179" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">USING TCP CLASSES<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用 TCP 类</font>
                    </font>
                </font>
            </h2>
            <p id="c19-para-0059" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">The HTTP/1.1 and 2.0 protocols are based on the Transmission
                Control Protocol (TCP). With TCP, the client first needs to open a connection to the server before
                sending commands. This is the same behavior as you've seen with the previous sample opening a TCP
                connection with the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> type. With the
                <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> class, you
                had to specify the address family, socket type, and protocol. This is abstracted by using TCP classes,
                as described in this section.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">HTTP/1.1 和 2.0 协议基于传输控制协议（TCP）。使用 TCP
                            时，客户端首先需要先与服务器建立连接，然后才能发送命令。这与之前示例中通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                            类型打开 TCP 连接的行为相同。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                            类时，你需要指定地址族、套接字类型和协议。而通过 TCP 类，这些内容被抽象化了，正如本节所述。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0060" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">The TCP classes offer simple methods for connecting and sending
                data between two endpoints. An endpoint is the combination of an IP address and a port number. Existing
                protocols have well-defined port numbers—for example, HTTP uses port 80, whereas SMTP uses port 25. The
                Internet Assigned Numbers Authority, IANA (<code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="http://www.iana.org">www.iana.org</a></code>),
                assigns port numbers to these well-known services. Unless you are implementing a well-known service, you
                should select a port number higher than 1,024.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">TCP 类提供了在两个端点之间连接和发送数据的方法。端点是由 IP
                            地址和端口号的组合。现有协议有明确定义的端口号——例如，HTTP 使用 80 端口，而 SMTP 使用 25 端口。互联网号码分配 authority（IANA， <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="http://www.iana.org">www.iana.org</a></code>
                            ）为这些知名服务分配端口号。除非你正在实现一个知名服务，否则你应该选择一个大于 1024 的端口号。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0061" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">TCP traffic makes up the majority of traffic on the Internet
                today. It is often the protocol of choice because it offers guaranteed delivery, error correction, and
                buffering. The <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code> class
                encapsulates a TCP connection and provides properties to regulate the connection, including buffering,
                buffer size, and timeouts. Reading and writing are accomplished by requesting a <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code> object
                via the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetStream</code>
                method.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">TCP
                            流量构成了当今互联网上的主要流量。它通常是首选协议，因为它提供保证交付、错误纠正和缓冲功能。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code>
                            类封装了一个 TCP 连接，并提供属性来调节连接，包括缓冲、缓冲区大小和超时。读写操作通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetStream</code>
                            方法请求一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code>
                            对象来完成。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0021"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-361" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Creating a TCP Listener<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建 TCP 监听器</font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0062" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The sample application is based on the Quote of the Day
                    (QOTD) spec defined with RFC 865 (<code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://tools.ietf.org/html/rfc865">https://tools.ietf.org/html/rfc865</a></code>).
                    The QOTD service can be implemented with the TCP or UDP protocol. With TCP, as soon as the client
                    connects, the server returns a random quote that should not be longer than 512 bytes. After the
                    quote is sent, the server should close the connection.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">示例应用程序基于 RFC 865（ <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://tools.ietf.org/html/rfc865">https://tools.ietf.org/html/rfc865</a></code>
                                ）中定义的每日引言（QOTD）规范。QOTD 服务可以使用 TCP 或 UDP 协议实现。使用 TCP 时，一旦客户端连接，服务器就会返回一条随机引言，其长度不应超过 512
                                字节。发送引言后，服务器应关闭连接。</font>
                        </font>
                    </font>
                </p>
                <p id="c19-para-0063" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1"><span aria-label="534" epub:type="pagebreak" id="Page_534"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>Like the sample
                    application for the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> class, the
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code> class is
                    used for configuration and logging functionality.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">与 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                                类的示例应用程序类似， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code>
                                类用于配置和日志记录功能。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">QuoteServer</code> class
                    contains the code to read quotes from a file and returns a random quote as soon as a client
                    connects. In the constructor, the port number and the filename containing the quotes are set. In the
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">InitializeAsync</code>
                    method, the quotes file is read to fill the array referenced from the field <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">_quotes</code> (code file
                    <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpServer/QuotesServer.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">QuoteServer</code>
                                类包含从文件读取引言的代码，并在客户端连接后立即返回一条随机引言。在构造函数中，设置了端口号和包含引言的文件名。在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">InitializeAsync</code>
                                方法中，读取引言文件以填充通过字段 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">_quotes</code>
                                引用的数组（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpServer/QuotesServer.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0019"><code>public class QuotesServerOptions</code>
<code>{</code>
<code>  public string? QuotesFile { get; set; }</code>
<code>  public int Port { get; set; }</code>
<code>}</code>
<code> </code>
<code>public class QuotesServer</code>
<code>{</code>
<code>  private readonly int _port;</code>
<code>  private readonly ILogger _logger;</code>
<code>  private readonly string _quotesPath;</code>
<code>  private string[]? _quotes;</code>
<code>  private Random _random = new();</code>
<code> </code>
<code>  public QuotesServer(IOptions&lt;QuotesServerOptions&gt; options, ILogger&lt;QuotesServer&gt; logger)</code>
<code>  {</code>
<code>    _port = options.Value.Port;</code>
<code>    _quotesPath = options.Value.QuotesFile ?? "quotes.txt";</code>
<code>    _logger = logger;</code>
<code>  }</code>
<code> </code>
<code>  public async Task InitializeAsync(CancellationToken cancellationToken = default)</code>
<code>    =&gt; _quotes = await File.ReadAllLinesAsync(_quotesPath, cancellationToken);</code>
<code> </code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">When you use the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpListener</code> class
                    to create a listener for the TCP protocol, you don't need to specify the address family, the socket
                    type, and the protocol type; this configuration is clearly defined from the protocol supported with
                    this class. You just need to specify the IP address and port number. After invoking the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Start</code> method, the
                    socket is ready to receive connections. With an overload of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Start</code> method, you
                    can pass the size of the backlog queue, similarly to passing the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Listen</code> method with
                    the socket sample. If you need full control of the socket that's used by the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpListener</code> class,
                    you can access the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Server</code> property
                    and access all the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> members.
                    Invoking the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AcceptTcpClientAsync</code>
                    method returns a <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code> object
                    as soon as a client application opens a connection. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code> class
                    defines the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Client</code> property to
                    access the underlying <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> type. You
                    send the quote and close the connection as specified by the RFC with the invocation of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendQuoteAsync</code>
                    method (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpServer/QuotesServer.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当你使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpListener</code>
                                类来创建 TCP 协议的监听器时，无需指定地址族、套接字类型和协议类型；这些配置已经从该类支持的协议中明确定义。你只需要指定 IP 地址和端口号。调用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Start</code>
                                方法后，套接字就准备好接收连接了。通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Start</code>
                                方法的重载，你可以传递后端队列的大小，类似于在套接字示例中传递 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Listen</code>
                                方法。如果你需要完全控制 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpListener</code>
                                类使用的套接字，可以访问 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Server</code>
                                属性并访问所有 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                                成员。调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AcceptTcpClientAsync</code>
                                方法会在客户端应用程序打开连接时立即返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code>
                                对象。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code>
                                类定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Client</code>
                                属性来访问底层的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                                类型。你通过调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendQuoteAsync</code>
                                方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpServer/QuotesServer.cs</code>
                                ）来发送应答并关闭连接，这符合 RFC 的指定。</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0020"><code>public async Task RunServerAsync(CancellationToken cancellationToken = default)</code>
<code>{</code>
<code>  <b>TcpListener listener = new(IPAddress.Any, _port);</b></code>
<code>  _logger.LogInformation("Quotes listener started on port {0}", _port);</code>
<code>  <b>listener.Start();</b></code>
<code> </code>
<code>  while (true)</code>
<code>  {</code>
<code>    cancellationToken.ThrowIfCancellationRequested();</code>
<code>    <b>using TcpClient client = await listener.AcceptTcpClientAsync();</b></code>
<code>    _logger.LogInformation("Client connected with address and port: {0}",  <span aria-label="535" epub:type="pagebreak" id="Page_535" role="doc-pagebreak"></span></code>
<code>      client.Client.RemoteEndPoint);</code>
<code>    var _ = SendQuoteAsync(client, cancellationToken);</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">In the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendQuoteAsync</code>
                    method, properties of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code> class
                    are used to change the settings of the underlying socket. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">LingerState</code>
                    defines socket linger behavior to keep the socket open for the number of seconds set with the second
                    argument of the constructor after the socket is closed to allow it to finish processing. Setting the
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NoDelay</code> property
                    to <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">true</code> turns
                    off the Nagle algorithm. Remember, with the Nagle algorithm, messages are not sent if the buffer is
                    not full and the receiver didn't acknowledge outstanding packages. With the QOTD service, changing
                    the default behavior doesn't have an effect in this case because the connection is closed after
                    sending just one message. Invoking the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetStream</code> method
                    of the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code>
                    returns a <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code> that
                    allows sending and receiving data. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetStream</code> method
                    creates a <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code> that
                    has the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ownsSocket</code> flag
                    set to <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">true</code>.
                    Disposing of the stream (which is done from the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">using</code> declaration)
                    also closes the socket. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">WriteAsync</code> method
                    sends the quote to the client (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpServer/QuotesServer.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendQuoteAsync</code>
                                方法中，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code>
                                类的属性来更改底层套接字设置。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">LingerState</code>
                                定义套接字保持行为，在套接字关闭后，允许它完成处理，并保持打开状态，持续时间为构造函数第二个参数中设置的秒数。将 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NoDelay</code>
                                属性设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">true</code>
                                会关闭 Nagle 算法。记住，使用 Nagle 算法时，如果缓冲区不满且接收者未确认未处理的包，则不会发送消息。对于 QOTD
                                服务，更改默认行为在这种情况下无效，因为发送一条消息后连接就会关闭。调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetStream</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code>
                                方法会返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code>
                                ，用于发送和接收数据。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetStream</code>
                                方法创建一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code>
                                ，其 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ownsSocket</code>
                                标志设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">true</code>
                                。释放流（从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">using</code>
                                声明中完成）也会关闭套接字。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">WriteAsync</code>
                                方法将引用发送给客户端（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpServer/QuotesServer.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0021"><code>private async Task SendQuoteAsync(TcpClient client, </code>
<code>  CancellationToken cancellationToken = default)</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    client.LingerState = new LingerOption(true, 10);</code>
<code>    client.NoDelay = true;</code>
<code> </code>
<code>    <b>using var stream = client.GetStream();</b> // returns a stream that owns the socket</code>
<code>    var quote = GetRandomQuote();</code>
<code>    var buffer = Encoding.UTF8.GetBytes(quote).AsMemory();</code>
<code>    <b>await stream.WriteAsync(buffer, cancellationToken);</b></code>
<code>  }</code>
<code>  catch (IOException ex)</code>
<code>  {</code>
<code>    _logger.LogError(ex, ex.Message);</code>
<code>  }</code>
<code>  catch (SocketException ex)</code>
<code>  {</code>
<code>    _logger.LogError(ex, ex.Message);</code>
<code>  }</code>
<code>}</code>
<code> </code>
<code>private string GetRandomQuote()</code>
<code>{</code>
<code>  if (_quotes is null) throw new InvalidOperationException(</code>
<code>    $"Invoke InitializeAsync before calling {nameof(GetRandomQuote)}");</code>
<code>  return _quotes[_random.Next(_quotes.Length)];</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0022"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-362" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Creating a TCP Client<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建 TCP 客户端</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The client application is implemented with the console
                    application <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClientSample</code>.
                    To create a TCP connection to the server, a new instance of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code> class is
                    created. With the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConnectAsync</code>
                    method, the name and port of the server need to be specified. After a successful connection, the
                    content from the server is read using the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsync</code> method
                    of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code>
                    (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClientSample/QuotesClient.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">客户端应用程序使用控制台应用程序 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClientSample</code>
                                实现。要创建到服务器的 TCP 连接，需要创建 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code>
                                类的新实例。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConnectAsync</code>
                                方法需要指定服务器的名称和端口。连接成功后，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NetworkStream</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClientSample/QuotesClient.cs</code>
                                ）的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsync</code>
                                方法读取服务器内容：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0022"><code>public async Task SendAndReceiveAsync(CancellationToken cancellationToken = default)</code>
<code>{</code>
<code>  try<span aria-label="536" epub:type="pagebreak" id="Page_536" role="doc-pagebreak"></span></code>
<code>  {</code>
<code>    Memory&lt;byte&gt; buffer = new byte[4096].AsMemory();</code>
<code>    string? line;</code>
<code>    bool repeat = true;</code>
<code>    while (repeat)</code>
<code>    {</code>
<code>      Console.WriteLine(@"Press enter to read a quote, ""bye"" to exit");</code>
<code>      line = Console.ReadLine();</code>
<code>      if (line?.Equals("bye", StringComparison.CurrentCultureIgnoreCase) == true)</code>
<code>      {</code>
<code>        repeat = false;</code>
<code>      }</code>
<code>      else</code>
<code>      {</code>
<code>        <b>TcpClient client = new();</b>   </code>
<code>        <b>await client.ConnectAsync(_hostname, _serverPort, cancellationToken);</b></code>
<code>        <b>using var stream = client.GetStream();</b>           </code>
<code>        <b>int bytesRead = await stream.ReadAsync(buffer, cancellationToken);</b></code>
<code>        string quote = Encoding.UTF8.GetString(buffer.Span[..bytesRead]);</code>
<code>        buffer.Span[..bytesRead].Clear();</code>
<code>        Console.WriteLine(quote);</code>
<code>        Console.WriteLine();</code>
<code>      }</code>
<code>    };</code>
<code>  }</code>
<code>  catch (SocketException ex)</code>
<code>  {</code>
<code>    _logger.LogError(ex, ex.Message);</code>
<code>  }</code>
<code> </code>
<code>  Console.WriteLine("so long, and thanks for all the fish");</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">When you run the server and the client, you can see quotes
                    returned on the server:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">运行服务器和客户端时，可以看到服务器返回的引言：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0023"><code>Press enter to read a quote, "bye" to exit</code>
<code> </code>
<code>"Nuclear-powered vacuum cleaners will probably be a reality within ten years.", </code>
<code>Alex Lewyt, Lewyt vacuum company, 1955</code>
<code> </code>
<code>Press enter to read a quote, "bye" to exit</code>
<code> </code>
<code>"Television won't be able to hold on to any market it captures after the first six months. </code>
<code>People will soon get tired of staring at a plywood box every night.", Darryl Zanuck, </code>
<code>20th Century Fox, 1946</code>
<code> </code>
<code>Press enter to read a quote, "bye" to exit</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">On the server, you can see log output in the console,
                    including the ports used by the client:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在服务器上，控制台可以看到日志输出，包括客户端使用的端口：
                            </font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0024"><code>info: QuotesServer[0]</code>
<code>      Quotes listener started on port 1700</code>
<code>info: QuotesServer[0]</code>
<code>      Client connected with address and port: 127.0.0.1:52788</code>
<code>info: QuotesServer[0]</code>
<code>      Client connected with address and port: 127.0.0.1:52789</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span aria-label="537"
                        epub:type="pagebreak" id="Page_537" role="doc-pagebreak"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span></p>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0071" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Typical
                                implementations of the QOTD client just open a connection, receive and print the quote,
                                and end. With the implementation of the sample application, you can get quote after
                                quote. Because the server closes the connection after every quote sent, a new socket is
                                created with every request.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：QOTD
                                        客户端的典型实现通常只是打开一个连接，接收并打印引用内容，然后结束。通过使用示例应用程序的实现，你可以连续获取一个又一个的引用。因为服务器在发送每个引用后会关闭连接，所以每个请求都会创建一个新的套接字。
                                    </font>
                                </font>
                            </font>
                        </p>
                        <p id="c19-para-0072" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">As you'll read
                                later in this chapter, with the HttpClient factory, a better practice would be to use
                                the same socket for multiple requests. The underlying socket of the operating system
                                stays open for 20 seconds before it's released. You can monitor the state of the sockets
                                with the command</i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">netstat -a</code>.
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">正如你将在本章后面读到的，使用 HttpClient
                                        工厂，更好的做法是使用同一个套接字进行多个请求。操作系统底层的套接字在释放前会保持打开状态 20 秒。你可以使用命令 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">netstat -a</code>
                                        监控套接字的状态。</font>
                                </font>
                            </font>
                        </p>
                        <p id="c19-para-0073" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                data-immersive-translate-paragraph="1">Creating a QOTD server that does not close the
                                connection to keep communicating with the same socket would make the implementation
                                incompatible with existing clients and servers.<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">创建一个不关闭连接以保持与同一个套接字通信的
                                            QOTD 服务器，会使实现与现有的客户端和服务器不兼容。</font>
                                    </font>
                                </font></i></p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
        </section>
        <section aria-labelledby="head-2-180" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
            <span id="c19-sec-0024" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <h2 id="head-2-180" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">USING UDP<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用 UDP</font>
                    </font>
                </font>
            </h2>
            <p id="c19-para-0074" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">The next protocol covered is the User Datagram Protocol (UDP).
                UDP is a simple protocol with little overhead. Before sending and receiving data with TCP, a connection
                needs to be made. This is not necessary with UDP; you just start sending or receiving. Of course, that
                means that UDP has less overhead than TCP, but it is also more unreliable. When you send data with UDP,
                you don't get information when this data is received. UDP is often used for situations in which the
                speed and performance requirements outweigh the reliability requirements—for example, video streaming.
                UDP also offers broadcasting messages to a group of nodes. In contrast, TCP offers features to confirm
                the delivery of data. TCP provides error correction and retransmission in the case of lost or corrupted
                packets. Last, but not least, TCP buffers incoming and outgoing data and guarantees that a sequence of
                packets scrambled in transmission is reassembled before delivery to the application. Even with the extra
                overhead, TCP is the most widely used protocol across the Internet because of its high reliability.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">下一个介绍的是用户数据报协议（UDP）。UDP
                            是一个开销很小的简单协议。在使用 TCP 发送和接收数据之前，需要建立连接。而 UDP 则不需要这一步，你只需开始发送或接收即可。当然，这意味着 UDP 的开销比 TCP
                            小，但它也更不可靠。当你使用 UDP 发送数据时，你不会收到关于这些数据是否被接收的信息。UDP 通常用于速度和性能要求高于可靠性要求的情况——例如视频流。UDP
                            还提供向一组节点广播消息的功能。相比之下，TCP 提供确认数据交付的功能。TCP 在数据包丢失或损坏的情况下提供错误纠正和重传。最后但同样重要的是，TCP
                            缓冲输入和输出数据，并保证在交付给应用程序之前重新组装在传输中打乱顺序的数据包。尽管有额外的开销，但由于其高可靠性，TCP 是互联网上最广泛使用的协议。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0075" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">To demonstrate UDP, you create two console application projects
                that show various features of UDP: directly sending data to a host, broadcasting data to all hosts on
                the local network, and multicasting data to a group of nodes that belong to the same group.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">为了演示 UDP，您创建了两个控制台应用程序项目，这些项目展示了 UDP
                            的各种功能：直接向主机发送数据、向本地网络上的所有主机广播数据，以及向属于同一组的一组节点发送多播数据。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0025"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-363" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Building a UDP Receiver<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">构建 UDP 接收器</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Start with the receiving application. The downloadable sample
                    application uses command-line arguments where you can configure the port number and optional group
                    address with <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">appsettings.json</code>
                    or override it with command-line arguments. With the receiver, you can configure the port, an
                    optional group address, and a Boolean flag if broadcast should be used (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpReceiver/Receiver.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                从接收应用程序开始。可下载的示例应用程序使用命令行参数，您可以在其中配置端口号和可选的组地址（使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">appsettings.json</code>
                                ）或通过命令行参数覆盖它。使用接收器，您可以配置端口号、可选的组地址，以及一个布尔标志来指示是否使用广播（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpReceiver/Receiver.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0025"><code>public record ReceiverOptions</code>
<code>{</code>
<code>  public int Port { get; init; }</code>
<code>  public bool UseBroadcast { get; init; } = false;</code>
<code>  public string? GroupAddress { get; init; }</code>
<code>}</code>
<code> </code>
<code>public class Receiver</code>
<code>{</code>
<code>  private readonly ILogger _logger;</code>
<code>  <b>private readonly int _port;</b></code>
<code>  <b>private readonly string? _groupAddress;</b><span aria-label="538" epub:type="pagebreak" id="Page_538" role="doc-pagebreak"></span></code>
<code>  <b>private readonly bool _useBroadcast;</b></code>
<code>  public Receiver(IOptions&lt;ReceiverOptions&gt; options, ILogger&lt;Receiver&gt; logger)</code>
<code>  {</code>
<code>    _port = options.Value.Port;</code>
<code>    _groupAddress = options.Value.GroupAddress;</code>
<code>    _useBroadcast = options.Value.UseBroadcast;</code>
<code>    _logger = logger;</code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">RunAsync</code> method
                    creates a <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpClient</code> object
                    with the port number that's received with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReceiverOptions</code>
                    record. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReceiveAsync</code>
                    method waits until some data arrives. This data can be found with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpReceiveResult</code>
                    with the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Buffer</code>
                    property. After the data is encoded to a string, it's written to the console to continue the loop
                    and wait for the next data to receive (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpReceiver/Receiver.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">RunAsync</code>
                                方法使用通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReceiverOptions</code>
                                记录接收到的端口号创建一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpClient</code>
                                对象。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReceiveAsync</code>
                                方法等待直到某些数据到达。这些数据可以通过具有 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Buffer</code>
                                属性的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpReceiveResult</code>
                                找到。数据编码为字符串后，它被写入控制台以继续循环并等待接收下一个数据（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpReceiver/Receiver.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0026"><code>public async Task RunAsync()</code>
<code>{</code>
<code>  <b>using UdpClient client = new(_port);</b></code>
<code>  client.EnableBroadcast = _useBroadcast;</code>
<code> </code>
<code>  if (_groupAddress != null)</code>
<code>  {</code>
<code>    client.JoinMulticastGroup(IPAddress.Parse(_groupAddress));</code>
<code>      _logger.LogInformation("joining the multicast group {0}", </code>
<code>    IPAddress.Parse(_groupAddress));</code>
<code>  }</code>
<code> </code>
<code>  bool completed = false;</code>
<code>  do</code>
<code>  {</code>
<code>    _logger.LogInformation("Waiting to receive data");</code>
<code>    <b>UdpReceiveResult result = await client.ReceiveAsync();</b></code>
<code>    <b>byte[] datagram = result.Buffer;</b></code>
<code>    string dataReceived = Encoding.UTF8.GetString(datagram);</code>
<code>    _logger.LogInformation("Received {0} from {1}", dataReceived, result.RemoteEndPoint);</code>
<code>    if (dataReceived.Equals("bye", StringComparison.CurrentCultureIgnoreCase))</code>
<code>    {</code>
<code>      completed = true;</code>
<code>    }</code>
<code>  } while (!completed);</code>
<code>  _logger.LogInformation("Receiver closing");</code>
<code> </code>
<code>  if (_groupAddress != null)</code>
<code>  {</code>
<code>    client.DropMulticastGroup(IPAddress.Parse(_groupAddress));</code>
<code>  }</code>
<code>}</code></pre>
                <p id="c19-para-0078" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">When you start the application, it waits for a sender to send
                    data. The receiver ends the loop if it receives the string “bye.” For the time being, ignore the
                    multicast group because multicasting is discussed after you create the sender.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                当你启动应用程序时，它会等待发送者发送数据。接收者如果收到字符串“bye.”则会结束循环。暂时忽略多播组，因为多播是在你创建发送者之后讨论的。</font>
                        </font>
                    </font>
                </p>
            </section> <span aria-label="539" epub:type="pagebreak" id="Page_539" role="doc-pagebreak"
                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0026"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-364" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Creating a UDP Sender<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建 UDP 发送者</font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0079" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The UDP sender application also enables you to configure it
                    by passing command-line options. It has more options than the receiving application. Besides the
                    port number with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Port</code> element, the
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseBroadcast</code>
                    option can be set to broadcast the message to all nodes in the local subnet, and a <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Group-Address</code>
                    setting can be used to send messages to all nodes that registered to a multicast group. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPv6</code> setting
                    allows using the IPv6 protocol instead of IPv4.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">UDP
                                发送者应用程序也允许你通过传递命令行选项来配置它。它比接收应用程序拥有更多选项。除了带有 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Port</code>
                                元素的端口号， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseBroadcast</code>
                                选项可以设置为向本地子网中的所有节点广播消息，而 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Group-Address</code>
                                设置可用于向所有注册到多播组的节点发送消息。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPv6</code>
                                设置允许使用 IPv6 协议而不是 IPv4。</font>
                        </font>
                    </font>
                </p>
                <p id="c19-para-0080" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">To send data, you need an <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPEndPoint</code>.
                    Depending on the program arguments, you create this in different ways. With a broadcast, IPv4
                    defines the address 255.255.255.255 that is returned from <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress.Broadcast</code>.
                    There's no IPv6 address for broadcast because IPv6 doesn't support broadcasts. IPv6 replaces
                    broadcasts with multicasts. Multicasts have been added to IPv4 as well.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要发送数据，你需要一个 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPEndPoint</code>
                                。根据程序参数，你以不同的方式创建它。通过广播，IPv4 定义了地址 255.255.255.255，这是从 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress.Broadcast</code>
                                返回的。因为没有 IPv6 地址用于广播，因为 IPv6 不支持广播。IPv6 用多播代替了广播。多播也已经添加到 IPv4 中。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">When you're passing a host name, the host name is resolved
                    using DNS lookup using the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dns</code> class. The
                    method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHostEntryAsync</code>
                    returns an <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code> where
                    the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code>
                    can be retrieved from the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddressList</code>
                    property. Depending on whether IPv4 or IPv6 is used, a different <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code> is taken
                    from this list. Depending on your network environment, only one of these address types might work.
                    If a group address is passed to the method, the address is parsed using <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress.Parse</code>
                    (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpSender/Sender.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当传递主机名时，使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dns</code>
                                类通过 DNS 查询解析主机名。方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHostEntryAsync</code>
                                返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPHostEntry</code>
                                ，其中 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code>
                                可以从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddressList</code>
                                属性中获取。根据是否使用 IPv4 或 IPv6，从该列表中获取不同的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress</code>
                                。根据您的网络环境，可能只有这些地址类型中的一种可以工作。如果将组地址传递给方法，则使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IPAddress.Parse</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpSender/Sender.cs</code>
                                ）解析地址：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0027"><code>private async Task&lt;IPEndPoint?&gt; GetReceiverIPEndPointAsync()</code>
<code>{</code>
<code>  IPEndPoint? endpoint = null;</code>
<code>  try</code>
<code>  {</code>
<code>    if (_useBroadcast)</code>
<code>    {</code>
<code>      <b>endpoint = new IPEndPoint(IPAddress.Broadcast, _port);</b></code>
<code>    }</code>
<code>    else if (_hostName != null)</code>
<code>    {</code>
<code>      IPHostEntry hostEntry = await Dns.GetHostEntryAsync(_hostName);</code>
<code>      IPAddress? address = null;</code>
<code>      if (_useIpv6)</code>
<code>      {</code>
<code>        address = hostEntry.AddressList.Where(</code>
<code>          a =&gt; a.AddressFamily == AddressFamily.InterNetworkV6).FirstOrDefault();</code>
<code>      }</code>
<code>      else</code>
<code>      {</code>
<code>        address = hostEntry.AddressList.Where(</code>
<code>          a =&gt; a.AddressFamily == AddressFamily.InterNetwork).FirstOrDefault();</code>
<code>      }</code>
<code> </code>
<code>      if (address == null)</code>
<code>      {</code>
<code>        Func&lt;string&gt; ipversion = () =&gt; _useIpv6 ? "IPv6" : "IPv4";</code>
<code>        _logger.LogWarning($"no {ipversion()} address for {_hostName}");</code>
<code>        return null;</code>
<code>      }</code>
<code>      <b>endpoint = new IPEndPoint(address, _port);</b></code>
<code>    }</code>
<code>    else if (_groupAddress != null)</code>
<code>    {</code>
<code>      <b>endpoint = new IPEndPoint(IPAddress.Parse(_groupAddress), _port);</b></code>
<code>    }<span aria-label="540" epub:type="pagebreak" id="Page_540" role="doc-pagebreak"></span></code>
<code>    else</code>
<code>    {</code>
<code>      throw new InvalidOperationException($"{nameof(_hostName)}, " + </code>
<code>        $"{nameof(_useBroadcast)}, or {nameof(_groupAddress)} must be set");</code>
<code>    }</code>
<code>  }</code>
<code>  catch (SocketException ex)</code>
<code>  {</code>
<code>    _logger.LogError(ex, ex.Message);</code>
<code>  }</code>
<code>  return endpoint;</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Now, regarding the UDP protocol, the most important part of
                    the sender follows. After creating a <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpClient</code> instance
                    and converting a string to a byte array, data is sent using the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code> method.
                    Note that neither the receiver needs to listen, nor the sender needs to connect. UDP is really
                    simple. However, in a case in which the sender sends the data to nowhere—nobody receives the
                    data—you also don't get any error messages (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpSender/Sender.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">现在，关于 UDP 协议，发送者最重要的部分如下。在创建 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpClient</code>
                                实例并将字符串转换为字节数组后，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code>
                                方法发送数据。请注意，接收者不需要监听，发送者也不需要连接。UDP 非常简单。然而，在发送者将数据发送到无处可去的情况——没有人接收数据时——您也不会收到任何错误消息（代码文件
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpSender/Sender.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0028"><code>public async Task RunAsync()</code>
<code>{</code>
<code>  IPEndPoint? endpoint = await GetReceiverIPEndPointAsync();</code>
<code>  if (endpoint is null) return;</code>
<code> </code>
<code>  try</code>
<code>  {</code>
<code>    string localhost = Dns.GetHostName();</code>
<code>    using UdpClient client = new(); </code>
<code>    client.EnableBroadcast = _useBroadcast;</code>
<code>    if (_groupAddress != null)</code>
<code>    {</code>
<code>      client.JoinMulticastGroup(IPAddress.Parse(_groupAddress));</code>
<code>    }</code>
<code> </code>
<code>    bool completed = false;</code>
<code>    do</code>
<code>    {</code>
<code>      Console.WriteLine(@$"{Environment.NewLine}Enter a message or ""bye"" to exit");</code>
<code>      string? input = Console.ReadLine();</code>
<code>      if (input is null) continue;</code>
<code>      Console.WriteLine();</code>
<code>      completed = input.Equals("bye", StringComparison.CurrentCultureIgnoreCase);</code>
<code> </code>
<code>      byte[] datagram = Encoding.UTF8.GetBytes(input);</code>
<code>      int sent = await client.SendAsync(datagram, datagram.Length, endpoint);</code>
<code>      _logger.LogInformation("Sent datagram using local EP {0} to {1}" </code>
<code>        client.Client.LocalEndPoint, endpoint);</code>
<code>    } while (!completed);</code>
<code> </code>
<code>    if (_groupAddress != null)</code>
<code>    {</code>
<code>      client.DropMulticastGroup(IPAddress.Parse(_groupAddress));</code>
<code>    }</code>
<code>  }<span aria-label="541" epub:type="pagebreak" id="Page_541" role="doc-pagebreak"></span></code>
<code>  catch (SocketException ex)</code>
<code>  {</code>
<code>    _logger.LogError(ex, ex.Message);</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Now you can start the receiver and the sender. With the
                    sender, you can see output similar to the one shown. The sender also successfully sends data when
                    the receiver is not running:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                现在你可以启动接收器和发送器。使用发送器时，你可以看到类似下面显示的输出。即使接收器未运行，发送器也能成功发送数据：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0029"><code>Enter a message or "bye" to exit</code>
<code>message 1</code>
<code>info: Sender[0]</code>
<code>      Sent datagram using local EP 0.0.0.0:54446 to 127.0.0.1:8600</code>
<code> </code>
<code>Enter a message or "bye" to exit</code>
<code>message 2</code>
<code> </code>
<code>Enter a message or "bye" to exit</code>
<code>info: Sender[0]</code>
<code>      Sent datagram using local EP 0.0.0.0:54446 to 127.0.0.1:8600</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The receiver shows the data received and the port and address
                    where this message is coming from:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">接收器显示接收到的数据以及消息来源的端口和地址：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0030"><code>info: Receiver[0]</code>
<code>      Waiting to receive data</code>
<code>info: Receiver[0]</code>
<code>      Received message 1 from 127.0.0.1:54446</code>
<code>info: Receiver[0]</code>
<code>      Waiting to receive data</code>
<code>info: Receiver[0]</code>
<code>      Received message 2 from 127.0.0.1:54446</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Without changing the configuration file, you can pass a
                    different port number starting with the receiver:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">无需更改配置文件，你可以从接收器处指定不同的端口号：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0031"><code>&gt; dotnet run -- UdpReceiver:Port=5400</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">and with the sender:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">和发送者：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0032"><code>&gt; dotnet run -- UdpSender:ReceiverPort=5400</code></pre>
                <p id="c19-para-0087" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">You can enter data in the sender that will arrive in the
                    receiver. If you stop the receiver, you can go on sending without detecting any error. You can also
                    try to use a host name instead of localhost and run the receiver on a different system.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                您可以在发送者中输入数据，这些数据将到达接收者。如果您停止接收者，您可以继续发送而不会检测到任何错误。您还可以尝试使用主机名代替
                                localhost，并在不同的系统上运行接收者。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">With the sender, you can set the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpSender:UseBroadcast=true</code>
                    option to send a broadcast to all nodes listening to the specified port on the same network:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用发送者，您可以设置 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpSender:UseBroadcast=true</code>
                                选项，向同一网络中监听指定端口的所有节点发送广播：</font>
                        </font>
                    </font>
                </p>
                <pre
                    id="c19-code-0033"><code>&gt; dotnet run -- UdpSender:ReceiverPort=5400 UdpSender:UseBroadcast=true</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">With the output of the sender, you can see the message is
                    sent to the IPv4 broadcast address:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">通过发送者的输出，可以看到消息被发送到了 IPv4 广播地址：
                            </font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0034"><code>info: Sender[0]</code>
<code>      Sent datagram using local EP 0.0.0.0:50695 to 255.255.255.255:5400</code></pre>
                <p id="c19-para-0090" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Be aware that broadcasts don't cross most routers, and of
                    course, you can't use broadcasts on the Internet. This situation is different with multicasts, which
                    are discussed next.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                请注意，广播通常不会跨越大多数路由器，当然，您也不能在互联网上使用广播。这种情况与多播不同，多播将在下文中讨论。</font>
                        </font>
                    </font>
                </p>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0027"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-365" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Using Multicasts <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用组播</font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0091" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Broadcasts don't cross routers, but multicasts can.
                    Multicasts have been invented to send messages to a group of systems—all nodes that belong to the
                    same group. With IPv4, specific IP addresses are reserved for multicast use. <span aria-label="542"
                        epub:type="pagebreak" id="Page_542" role="doc-pagebreak"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>The addresses
                    start with 224.0.0.0 and go to 239.255.255.253. Many of these addresses are reserved for specific
                    protocols—for example, for routers—but 239.0.0.0/8 can be used privately within an organization.
                    This is similar to IPv6, which has well-known IPv6 multicast addresses for different routing
                    protocols. Addresses f::/16 are local within an organization; addresses ffxe::/16 have global scope
                    and can be routed over public Internet.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                广播不会穿越路由器，但组播可以。组播是为了向一组系统发送消息而发明的——所有属于同一组的节点。在 IPv4 中，特定的 IP 地址被保留用于组播使用。这些地址从
                                224.0.0.0 开始，到 239.255.255.253 结束。其中许多地址被保留用于特定协议——例如用于路由器——但 239.0.0.0/8 可以在组织内部私有使用。这与
                                IPv6 类似，IPv6 为不同的路由协议有众所周知的 IPv6 组播地址。地址 f::/16 在组织内部是局部的；地址 ffxe::/16
                                具有全局范围，并且可以在公共互联网上路由。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">For a sender or receiver to use multicasts, it must join a
                    multicast group by invoking the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">JoinMulticastGroup</code>
                    method of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpClient</code>
                    :<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要使发送者或接收者使用组播，它必须通过调用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UdpClient</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">JoinMulticastGroup</code>
                                方法加入组播组：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0035"><code>client.JoinMulticastGroup(IPAddress.Parse(groupAddress));</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">To leave the group again, you can invoke the method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DropMulticastGroup</code>
                    :<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要再次离开该组，你可以调用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DropMulticastGroup</code>
                                方法：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0036"><code>client.DropMulticastGroup(IPAddress.Parse(groupAddress));</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">When you start both the receiver and sender with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GroupAddress</code> set,
                    you can send messages to the group with the same IP address and port number:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当你同时以 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GroupAddress</code>
                                设置启动接收者和发送者时，你可以使用相同的 IP 地址和端口号向该组发送消息：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0037"><code>&gt; dotnet run -- UdpSender:ReceiverPort=5400 UdpSender:GroupAddress=230.0.0.1</code>
<code>&gt; dotnet run -- UdpReceiver:Port=5400 UdpReceiver:GroupAddress=230.0.0.1</code>
<code> </code></pre>
                <p id="c19-para-0095" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">As with broadcasting, you can start multiple receivers and
                    multiple senders. Depending on the quality of the network and the network load, the receivers will
                    receive nearly all messages from each sender.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                和广播一样，你可以启动多个接收器和多个发送器。根据网络质量和网络负载，接收器将几乎收到每个发送器的所有消息。</font>
                        </font>
                    </font>
                </p>
            </section>
        </section>
        <section aria-labelledby="head-2-181" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
            <span id="c19-sec-0028" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <h2 id="head-2-181" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">USING WEB SERVERS<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用 Web 服务器</font>
                    </font>
                </font>
            </h2>
            <p id="c19-para-0096" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">Using Internet Information Services (IIS) on Windows and Apache
                or NGINX on Linux are great options for using a web server. A lightweight option with .NET is the
                Kestrel server. This server was created by the ASP.NET Core team and is available on Windows and Linux.
                When you use IIS and Apache or NGINX with ASP.NET Core, Kestrel is always used behind the scenes. From
                IIS, a request is forwarded to the Kestrel server.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在 Windows 上使用 Internet Information
                            Services (IIS)，在 Linux 上使用 Apache 或 NGINX 是使用 Web 服务器的绝佳选择。对于.NET 的一个轻量级选项是 Kestrel
                            服务器。该服务器由 ASP.NET Core 团队创建，并在 Windows 和 Linux 上可用。当你使用 IIS 和 Apache 或 NGINX 与 ASP.NET Core
                            一起使用时，Kestrel 总是在后台使用。从 IIS，请求会被转发到 Kestrel 服务器。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0097" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">To create an application hosting the Kestrel server, you can
                create an empty web application with the .NET CLI: <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">dotnet new web</code>.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">要创建一个托管 Kestrel 服务器的应用程序，你可以使用.NET CLI
                            创建一个空白的 Web 应用程序： <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">dotnet new web</code>
                            。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">Contrary to a simple console application, this project type has
                the SDK <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.NET.Sdk.Web</code>
                referenced. With this setting, not only are more build tools needed for web development available, but a
                reference to <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.AspNetCore.App</code>
                is included implicitly (configuration file <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/HttpServerSample.csproj</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">与简单的控制台应用程序不同，这个项目类型引用了 SDK <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.NET.Sdk.Web</code>
                            。通过这个设置，不仅为 Web 开发提供了更多构建工具，还隐式地包含了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.AspNetCore.App</code>
                            的引用（配置文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/HttpServerSample.csproj</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c19-code-0038"><code><b>&lt;Project Sdk="Microsoft.NET.Sdk.Web"&gt;</b></code>
<code> </code>
<code>  &lt;PropertyGroup&gt;</code>
<code>    &lt;TargetFramework&gt;net5.0&lt;/TargetFramework&gt;</code>
<code>    &lt;Nullable&gt;enable&lt;/Nullable&gt;</code>
<code>  &lt;/PropertyGroup&gt;</code>
<code> </code>
<code>&lt;/Project&gt;</code></pre>
            <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">The generated <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Program.cs</code> file
                contains the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Main</code>
                method with the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code>
                class to configure the dependency injection container, logging, and configuration. In addition to what
                you've used with the simple console applications, the extension method <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureWebHostDefaults</code>,
                which is defined in the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.AspNetCore</code>
                package, is used. Here the type to be used that contains startup methods is defined with the generic
                parameter of the method <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseStartup</code>. Typically,
                this class has the name <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Startup</code> (code file
                <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/Program.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">生成的 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Program.cs</code>
                            文件包含 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Main</code>
                            方法，其中使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Host</code>
                            类来配置依赖注入容器、日志记录和配置。除了您在简单控制台应用程序中使用的内容外，还使用了在 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.AspNetCore</code>
                            包中定义的扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureWebHostDefaults</code>
                            。这里使用方法的泛型参数 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseStartup</code>
                            定义了包含启动方法的那类型。通常，这个类命名为 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Startup</code>
                            （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/Program.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c19-code-0039"><code>public class Program</code>
<code>{</code>
<code>  public static void Main(string[] args)<span aria-label="543" epub:type="pagebreak" id="Page_543" role="doc-pagebreak"></span></code>
<code>  {</code>
<code>    CreateHostBuilder(args).Build().Run();</code>
<code>  }</code>
<code> </code>
<code>  public static IHostBuilder CreateHostBuilder(string[] args) =&gt;</code>
<code>    Host.CreateDefaultBuilder(args)</code>
<code>      <b>.ConfigureWebHostDefaults(webBuilder =&gt;</b></code>
<code>      <b>{</b></code>
<code>        <b>webBuilder.UseStartup&lt;Startup&gt;();</b></code>
<code>      <b>});</b></code>
<code><b>}</b></code></pre>
            <p id="c19-para-0100" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">With a simple console application, you configured your services
                with the dependency injection container in the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureServices</code>
                extension method. With web applications, you configure the services in the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureServices</code>
                method of the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Startup</code> class. In
                addition, you configure middleware in the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Startup</code> class with the
                method <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Configure</code>.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在简单控制台应用程序中，您在 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureServices</code>
                            扩展方法中配置了服务。在 Web 应用程序中，您在 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Startup</code> 类的
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureServices</code>
                            方法中配置服务。此外，您使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Configure</code>
                            方法在 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Startup</code>
                            类中配置中间件。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0029"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-366" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Configuring Kestrel <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">配置 Kestrel</font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0101" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IWebHostBuilder</code>
                    interface parameter of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureWebHostDefaults</code>
                    method allows configuring the hosting server and the HTTP and HTTP/2 options. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureKestrel</code>
                    extension method allows setting <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">KestrelServerOptions</code>—for
                    example, limits on the HTTP protocol. <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">KestrelServerLimits</code>
                    allows you to specify timeout values, maximum sizes for the headers and the body size, maximum
                    number of concurrent connections, maximum number of connections upgraded to WebSockets, as well as
                    HTTP/2 and HTTP/3 limits. An advantage of HTTP/2 is to have multiple concurrent streams using the
                    same connection. You can limit the maximum number of concurrent streams with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Http2Limits</code> type
                    with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">MaxStreamsPerConnection</code>
                    setting. The default setting is 100.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IWebHostBuilder</code>
                                方法的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureWebHostDefaults</code>
                                接口参数允许配置托管服务器以及 HTTP 和 HTTP/2 选项。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureKestrel</code>
                                扩展方法允许设置 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">KestrelServerOptions</code>
                                —例如，HTTP 协议的限制。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">KestrelServerLimits</code>
                                允许您指定超时值、请求头和正文的最大大小、最大并发连接数、升级到 WebSockets 的最大连接数，以及 HTTP/2 和 HTTP/3 的限制。HTTP/2
                                的一个优势是可以在同一连接上使用多个并发流。您可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Http2Limits</code>
                                类型通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">MaxStreamsPerConnection</code>
                                设置来限制最大并发流数。默认设置为 100。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">In the following code snippet, the Kestrel server is
                    configured to use ports 5020 and 5021, is set to return the HTTP Server header with every response,
                    allows compression of HTTP headers, and specifies some limits (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在以下代码片段中，Kestrel 服务器被配置为使用端口 5020
                                和 5021，设置为在每次响应中返回 HTTP Server 头部，允许压缩 HTTP 头部，并指定了一些限制（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0040"><code>public static IHostBuilder CreateHostBuilder(string[] args) =&gt;</code>
<code>  Host.CreateDefaultBuilder(args)</code>
<code>    .ConfigureWebHostDefaults(webBuilder =&gt;</code>
<code>    {</code>
<code>      webBuilder.UseStartup&lt;Startup&gt;()</code>
<code>        <b>.ConfigureKestrel(kestrelOptions =&gt;</b></code>
<code>        <b>{</b></code>
<code>          <b>kestrelOptions.AddServerHeader = true;</b></code>
<code>          <b>kestrelOptions.AllowResponseHeaderCompression = true;</b></code>
<code>          <b>kestrelOptions.Limits.Http2.MaxStreamsPerConnection = 10;</b></code>
<code>          <b>kestrelOptions.Limits.MaxConcurrentConnections = 20;</b></code>
<code>        <b>})</b></code>
<code>        <b>.UseUrls("http://localhost:5020", "https://localhost:5021");</b>                       </code>
<code>      });</code></pre>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0104" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">With .NET 5,
                                Kestrel by default is configured to support HTTP/1.1 and HTTP/2. To define a specific
                                version, invoke one of the </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ListenXXX</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> methods, such as
                            </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ListenLocalhost</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">, in the </i>
                            <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureKestrel</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> method. With the
                            </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Protocols</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> property, you can
                                specify one of the </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpProtocols</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> enum values.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：在 .NET 5 中，Kestrel
                                        默认配置为支持 HTTP/1.1 和 HTTP/2。要定义特定版本，请在 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureKestrel</code>
                                        方法中调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ListenXXX</code>
                                        方法之一，例如 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ListenLocalhost</code>
                                        。通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Protocols</code>
                                        属性，您可以指定 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpProtocols</code>
                                        枚举值之一。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span aria-label="544"
                        epub:type="pagebreak" id="Page_544" role="doc-pagebreak"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span></p>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0105" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">One feature the
                                Kestrel server does not support is Windows authentication. The Kestrel server supports
                                authentication via OAuth 2.0 and OpenID Connect. If you need Windows authentication in
                                your environment, you can use IIS and the Http.sys web server. With the </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IWebBuilder</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">, you can invoke
                            </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseHttpSys</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">, which changes
                                the configuration to use Http.sys. This is only available on Windows.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 Kestrel 服务器不支持 Windows
                                        身份验证。Kestrel 服务器支持通过 OAuth 2.0 和 OpenID Connect 进行身份验证。如果您需要在环境中使用 Windows
                                        身份验证，可以使用 IIS 和 Http.sys Web 服务器。通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IWebBuilder</code>
                                        ，您可以调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseHttpSys</code>
                                        ，这将更改配置以使用 Http.sys。这仅在 Windows 上可用。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0032"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-367" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Startup <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创业公司</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">In the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Startup</code> class, the
                    dependency injection container and middleware are configured. In the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureServices</code>
                    method, the custom service classes <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GenerateHtml</code> and
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Formula1</code> are
                    registered. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GenerateHtml</code> class
                    is used to return HTML code. When an HTTP request is received, the application returns a response
                    including HTTP header information. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Formula1</code> class is
                    used with a web API to return Formula 1 champions in JSON format to the client (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Startup</code>
                                类中，配置了依赖注入容器和中间件。在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureServices</code>
                                方法中，注册了自定义服务类 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GenerateHtml</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Formula1</code>
                                。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GenerateHtml</code>
                                类用于返回 HTML 代码。当收到 HTTP 请求时，应用程序返回包含 HTTP 头信息的响应。 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Formula1</code>
                                类与 Web API 配合使用，以 JSON 格式向客户端返回 F1 冠军（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/Startup.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0041"><code>public class Startup</code>
<code>{</code>
<code>  public void ConfigureServices(IServiceCollection services)</code>
<code>  {</code>
<code>    <b>services.AddScoped&lt;GenerateHtml&gt;();</b></code>
<code>    <b>services.AddSingleton&lt;Formula1&gt;();</b></code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Configure</code> method
                    of the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Startup</code>
                    class configures the middleware. Endpoints for the server are configured within the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseEndpoints</code>
                    method. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">MapGet</code> method maps
                    HTTP GET requests. The first invocation of <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">MapGet</code> maps the
                    link <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">/api/racers</code>
                    and returns JSON information with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">WriteAsJsonAsync</code>
                    method. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Formula1</code> class
                    method that's injected with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Configure</code> method
                    defines the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetChampions</code>
                    method and returns a list of Formula 1 champions. The second invocation of <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">MapGet</code> maps the
                    root path to invoke the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHtmlContent</code>
                    method of the injected <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GenerateHtml</code>
                    class. This method receives the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpRequest</code> as a
                    parameter to return HTML information showing the request (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Startup</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Configure</code>
                                方法配置了中间件。服务器端点在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseEndpoints</code>
                                方法中配置。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">MapGet</code>
                                方法映射 HTTP GET 请求。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">MapGet</code>
                                的第一次调用映射链接 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">/api/racers</code>
                                并使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">WriteAsJsonAsync</code>
                                方法返回 JSON 信息。被 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Configure</code>
                                方法注入的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Formula1</code>
                                类方法定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetChampions</code>
                                方法，并返回 F1 冠军列表。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">MapGet</code>
                                的第二次调用映射根路径以调用注入的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GenerateHtml</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHtmlContent</code>
                                方法。此方法接收 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpRequest</code>
                                作为参数以返回显示请求的 HTML 信息（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/Startup.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0042"><code>public class Startup</code>
<code>{</code>
<code>  public void Configure(IApplicationBuilder app, IWebHostEnvironment env, </code>
<code>    GenerateHtml generateHtml, Formula1 formula1)</code>
<code>  {</code>
<code>    if (env.IsDevelopment())</code>
<code>    {</code>
<code>      app.UseDeveloperExceptionPage();</code>
<code>    }</code>
<code> </code>
<code>    app.UseRouting();</code>
<code> </code>
<code>    app.UseEndpoints(endpoints =&gt;</code>
<code>    {</code>
<code>      <b>endpoints.MapGet("/api/racers", async context =&gt;</b></code>
<code>      <b>{</b></code>
<code>        <b>await context.Response.WriteAsJsonAsync(formula1.GetChampions());</b></code>
<code>      <b>});</b><span aria-label="545" epub:type="pagebreak" id="Page_545" role="doc-pagebreak"></span></code>
<code>      <b>endpoints.MapGet("/", async context =&gt;</b></code>
<code>      <b>{</b></code>
<code>        <b>string content = generateHtml.GetHtmlContent(context.Request);</b></code>
<code>        <b>context.Response.ContentType = "text/html";</b></code>
<code>        <b>await context.Response.WriteAsync(Encoding.UTF8.GetString(content));</b></code>
<code>      <b>});</b></code>
<code>    });</code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0109" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ASP.NET Core,
                                including details on middleware, is covered in <a href="c24.xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                                    24</a>, “ASP.NET Core.”</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：ASP.NET
                                        Core，包括中间件的详细信息，在“ASP.NET Core”章节（第 24 章）中介绍。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0110" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">The </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">WriteAsJsonAsync</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> method is
                                implemented in the </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.AspNetCore.Http.Extensions</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> NuGet package and
                                allows creating simple REST APIs. This makes use of the JSON serializer covered in <a
                                    href="c18.xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                                    18</a>. Read <a href="c25.xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                                    25</a>, “Services,” for more information about REST APIs.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">WriteAsJsonAsync</code>
                                        方法在 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.AspNetCore.Http.Extensions</code>
                                        NuGet 包中实现，并允许创建简单的 REST API。这使用了第 18 章中介绍的 JSON 序列化器。有关 REST API 的更多信息，请阅读第 25
                                        章，“服务”。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0035"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-368" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">HTTP Headers<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">HTTP 标头</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The sample code returns an HTML file that is retrieved using
                    the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHtmlContent</code>
                    method. This method makes use of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">htmlFormat</code> format
                    string with two placeholders in the heading and the body. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHtmlContent</code>
                    method fills in the placeholders using the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">string.Format</code>
                    method. To fill the HTML body, two helper methods are used that retrieve the header information from
                    the request and all the property values of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Request</code> object—
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHeaderInfo</code>
                    and <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetRequestInfo</code>
                    (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/GenerateHtml.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">示例代码返回一个 HTML 文件，该文件使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHtmlContent</code>
                                方法获取。此方法使用了包含两个占位符的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">htmlFormat</code>
                                格式字符串，分别用于标题和正文。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHtmlContent</code>
                                方法使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">string.Format</code>
                                方法填充占位符。为了填充 HTML 正文，使用了两个辅助方法，它们从请求中获取头部信息，并获取 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Request</code>
                                对象的所有属性值—— <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHeaderInfo</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetRequestInfo</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/GenerateHtml.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0043"><code>private static string s_htmlFormat =</code>
<code>  "&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;{0}&lt;/title&gt;&lt;/head&gt;" +</code>
<code>    "&lt;body&gt;{1}&lt;/body&gt;&lt;/html&gt;";</code>
<code> </code>
<code>public string GetHtmlContent(HttpRequest request)</code>
<code>{</code>
<code>  string title = "Sample Listener using Kestrel";</code>
<code> </code>
<code>  string content = $"&lt;h1&gt;Hello from the server&lt;/h1&gt;" +</code>
<code>    $"&lt;h2&gt;Header Info&lt;/h2&gt;" +</code>
<code>    $"{string.Join(' ', GetHeaderInfo(request.Headers))}" +</code>
<code>    $"&lt;h2&gt;Request Object Information&lt;/h2&gt;" +</code>
<code>    $"{string.Join(' ', GetRequestInfo(request))}";</code>
<code> </code>
<code>  return string.Format(s_htmlFormat, title, content);</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHeaderInfo</code>
                    method retrieves the keys and values from the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IHeaderDictionary</code>
                    to return a <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">div</code>
                    element that contains every key and value (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/GenerateHtml.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHeaderInfo</code>
                                方法从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IHeaderDictionary</code>
                                中检索键和值，以返回一个包含所有键和值的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">div</code>
                                元素（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/GenerateHtml.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0044"><span aria-label="546" epub:type="pagebreak" id="Page_546" role="doc-pagebreak"></span>
<code>private IEnumerable&lt;string&gt; GetHeaderInfo(IHeaderDictionary headers)</code>
<code>{</code>
<code>  List&lt;(string Key, string Value)&gt; values = new();</code>
<code>  var keys = headers.Keys;</code>
<code>  foreach (var key in keys)</code>
<code>  {</code>
<code>    if (headers.TryGetValue(key, out var value))</code>
<code>    {</code>
<code>      values.Add((key, value));</code>
<code>    }</code>
<code>  }</code>
<code>  return values.Select(v =&gt; $"&lt;div&gt;{v.Key}: {v.Value}&lt;/div&gt;");</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetRequestInfo</code>
                    method makes use of reflection to get all the properties of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Request</code> type and
                    returns the property names as well as their values (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/GenerateHtml.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetRequestInfo</code>
                                方法利用反射获取 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Request</code>
                                类型的所有属性，并返回属性名称及其值（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpServerSample/GenerateHtml.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0045"><code>private IEnumerable&lt;string&gt; GetRequestInfo(HttpRequest request)</code>
<code>{</code>
<code>  var properties = request.GetType().GetProperties();</code>
<code>  List&lt;(string Key, string Value)&gt; values = new();</code>
<code>  foreach (var property in properties)</code>
<code>  {</code>
<code>    try</code>
<code>    {</code>
<code>      string? value = property.GetValue(request)?.ToString();</code>
<code>      if (value != null)</code>
<code>      {</code>
<code>        values.Add((property.Name, value));</code>
<code>      }</code>
<code>    }</code>
<code>    catch (TargetInvocationException ex)</code>
<code>    {</code>
<code>      _logger.LogInformation("{0}: {1}", property.Name, ex.Message);</code>
<code>      if (ex.InnerException != null)</code>
<code>      {</code>
<code>        _logger.LogInformation("\t{0}", ex.InnerException.Message);</code>
<code>      }</code>
<code>    }</code>
<code>  }</code>
<code>  return values.Select(v =&gt; $"&lt;div&gt;{v.Key}: {v.Value}&lt;/div&gt;");</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0115" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">The </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHeaderInfo</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> and </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetRequestInfo</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> methods make use
                                of expression-bodied member functions, LINQ, and reflection. Expression-bodied member
                                functions are explained in <a href="c03.xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                                    3</a>, “Classes, Records, Structs, and Tuples.” <a href="c09.xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                                    9</a>, “Language Integrated Query,” explains LINQ. <a href="c12.xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                                    12</a>, “Reflection, Metadata, and Source Generators,” includes reflection as an
                                important topic.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetHeaderInfo</code>
                                        和 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetRequestInfo</code>
                                        方法使用了表达式主体成员函数、LINQ 和反射。表达式主体成员函数在第三章“类、记录、结构和元组”中解释。第九章“语言集成查询”解释了
                                        LINQ。第十二章“反射、元数据和源生成器”将反射作为一个重要主题进行介绍。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p id="c19-para-0116" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Running the server and using a browser such as Microsoft Edge
                    to access the server using a URL such as <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://localhost:5021/">https://localhost:5021/</a></code>
                    results in output as shown in <a href="#c19-fig-0001" id="R_c19-fig-0001"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Figure 19-1</a>. <a
                        href="#c19-fig-0002" id="R_c19-fig-0002"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Figure 19-2</a> shows the
                    output from <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">/api/racers</code> with
                    the Formula 1 champions.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">运行服务器并使用 Microsoft Edge 等浏览器通过
                                URL（如 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://localhost:5021/">https://localhost:5021/</a></code>
                                ）访问服务器，将得到如图 19-1 所示的输出。图 19-2 显示了使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">/api/racers</code>
                                和一级方程式冠军的输出。</font>
                        </font>
                    </font>
                </p>
                <span aria-label="547" epub:type="pagebreak" id="Page_547" role="doc-pagebreak"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <figure data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> <img
                        alt="Snapshot of a webpage displays the header information and request object information."
                        class="center" src="images/c19f001.png" />
                    <figcaption data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span
                                class="figureLabel"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a
                                    href="#R_c19-fig-0001" id="c19-fig-0001" role="doc-backlink"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><b
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                        data-immersive-translate-paragraph="1">FIGURE 19-1<font
                                            class="notranslate immersive-translate-target-wrapper"
                                            data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                            <font class="notranslate"
                                                data-immersive-translate-translation-element-mark="1">  </font>
                                            <font
                                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                                data-immersive-translate-translation-element-mark="1">
                                                <font
                                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                    data-immersive-translate-translation-element-mark="1">图 19-1</font>
                                            </font>
                                        </font></b></a></span></p>
                    </figcaption>
                </figure>
                <figure data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> <img
                        alt="Snapshot of a webpage displays the header information and request object information."
                        class="center" src="images/c19f002.png" />
                    <figcaption data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span
                                class="figureLabel"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a
                                    href="#R_c19-fig-0002" id="c19-fig-0002" role="doc-backlink"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><b
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                        data-immersive-translate-paragraph="1">FIGURE 19-2<font
                                            class="notranslate immersive-translate-target-wrapper"
                                            data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                            <font class="notranslate"
                                                data-immersive-translate-translation-element-mark="1">  </font>
                                            <font
                                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                                data-immersive-translate-translation-element-mark="1">
                                                <font
                                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                    data-immersive-translate-translation-element-mark="1">图 19-2</font>
                                            </font>
                                        </font></b></a></span></p>
                    </figcaption>
                </figure>
            </section>
        </section>
        <span aria-label="548" epub:type="pagebreak" id="Page_548" role="doc-pagebreak"
            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
        <section aria-labelledby="head-2-182" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
            <span id="c19-sec-0037" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <h2 id="head-2-182" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">THE HTTPCLIENT CLASS<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">HTTPCLIENT 类</font>
                    </font>
                </font>
            </h2>
            <p id="c19-para-0117" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">Let's get to the client side so we can use the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> class to
                make HTTP requests. This class is defined in the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Http</code>
                namespace. The classes in the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Http</code>
                namespace help make it easy to consume web services.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">让我们进入客户端，以便使用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            类来发起 HTTP 请求。这个类定义在 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Http</code>
                            命名空间中。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Http</code>
                            命名空间中的类有助于轻松消费 Web 服务。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0118" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">The <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> class
                derives from the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpMessageInvoker</code>
                class. This base class implements the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code> method. The
                <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code> method is
                the workhorse of the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> class. As
                you’ll see later in this section, there are several derivatives of this method to use. As the name
                implies, the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code> method call
                is asynchronous.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1"> <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            类继承自 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpMessageInvoker</code>
                            类。这个基类实现了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code>
                            方法。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code>
                            方法是 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            类的核心工作方法。正如本节后面将要看到的，这个方法有几个派生版本可供使用。从名称可以推断， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code>
                            方法的调用是异步的。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">The sample application makes use of the HttpClient factory from
                the NuGet package <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.Extensions.Http</code>.
                With the container configuration, the generic method <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code> is
                invoked. The generic parameter is of type <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSamples</code>
                where the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                object is injected. The <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> can be
                configured with the delegate parameter of the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code> method.
                Here, the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">BaseAddress</code> property
                is specified (code file <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">示例应用程序使用了 NuGet 包 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.Extensions.Http</code>
                            中的 HttpClient 工厂。通过容器配置，调用了泛型方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                            。泛型参数的类型是 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSamples</code>
                            ，其中注入了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            对象。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            可以通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                            方法的 delegate 参数进行配置。这里指定了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">BaseAddress</code>
                            属性（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c19-code-0046"><code>IHostBuilder GetHostBuilder() =&gt;</code>
<code>  Host.CreateDefaultBuilder()</code>
<code>  .ConfigureServices((context, services) =&gt;</code>
<code>  {</code>
<code>    var httpClientSettings = context.Configuration.GetSection("HttpClient");</code>
<code>    services.Configure&lt;HttpClientSamplesOptions&gt;(httpClientSettings);</code>
<code>    <b>services.AddHttpClient&lt;HttpClientSamples&gt;(httpClient =&gt;</b></code>
<code>    <b>{</b></code>
<code>      <b>httpClient.BaseAddress = new Uri(httpClientSettings["Url"]);</b></code>
<code>    <b>});</b></code>
<code>    //…</code>
<code>  });</code></pre>
            <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">The configuration file that's read with the setup of the DI
                container has the URL to the server created previously configured. When you run the client application,
                make sure to have this server running as well. You can also change the link in the configuration file to
                any other available server to see what's returned from there (configuration file <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/appsettings.json</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">用于配置依赖注入容器的配置文件中配置了先前创建的服务器
                            URL。运行客户端应用程序时，请确保该服务器也在运行。你也可以更改配置文件中的链接到其他可用服务器，以查看从那里返回的内容（配置文件 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/appsettings.json</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c19-code-0047"><code>{</code>
<code>  "HttpClient": {</code>
<code>    "Url": "https://localhost:5021",</code>
<code>    "InvalidUrl": "https://localhost1:5021"</code>
<code>  },</code>
<code>  "RateLimit": {</code>
<code>    "LimitCalls": 5</code>
<code>  }</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">With the constructor of the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSamples</code>
                class, the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> is injected
                along with the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSamplesOptions</code>
                configuration that's coming from the configuration file via the configuration in the dependency
                injection container (code file <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/HttpClientSamples.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">通过 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSamples</code>
                            类的构造函数， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            被注入，同时从依赖注入容器的配置文件配置中获取 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSamplesOptions</code>
                            配置（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/HttpClientSamples.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c19-code-0048"><code>public record HttpClientSamplesOptions</code>
<code>{</code>
<code>    public string? Url { get; init; }</code>
<code>    public string? InvalidUrl { get; init; }</code>
<code>}</code>
<code> </code>
<code>public class HttpClientSamples</code>
<code>{</code>
<code>  private readonly ILogger _logger;<span aria-label="549" epub:type="pagebreak" id="Page_549" role="doc-pagebreak"></span></code>
<code>  private readonly HttpClient _httpClient;</code>
<code>  private readonly string _url;</code>
<code>  private readonly string _invalidUrl;</code>
<code> </code>
<code>  public HttpClientSamples(</code>
<code>    IOptions&lt;HttpClientSamplesOptions&gt; options, </code>
<code>    HttpClient httpClient, </code>
<code>    ILogger&lt;HttpClientSamples&gt; logger)</code>
<code>  {</code>
<code>    _url = options.Value.Url ?? "https://localhost:5020";</code>
<code>    _invalidUrl = options.Value.InvalidUrl ?? "https://localhost1:5020";</code>
<code>    _httpClient = httpClient;</code>
<code>    _logger = logger;</code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
            <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <p id="c19-para-0123" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">WARNING</b> <i
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">The </i><code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code><i
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> class implements the
                        </i><code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IDisposable</code><i
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> interface. As a
                            general guideline, objects implementing </i><code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IDisposable</code><i
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> should be disposed
                            of after their use. This is also true for the </i><code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code><i
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> class. However, the
                        </i><code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dispose</code><i
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> method of the
                        </i><code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code><i
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> does not immediately
                            release the associated socket; it is released after a timeout. This timeout can take 20
                            seconds. With this timeout, using many </i><code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code><i
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> object instances can
                            lead to the program running out of sockets. The solution: the </i><code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code><i
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> class is built for
                            reuse. You can use this class with many requests and not create a new instance every time.
                            Using the HttpClient factory takes away the need to create and dispose of </i><code
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code><i
                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> instances.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">警告： <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                    类实现了 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IDisposable</code>
                                    接口。通常情况下，实现 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IDisposable</code>
                                    的对象在使用后应进行释放。这对 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                    类同样适用。然而， <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                    的 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Dispose</code>
                                    方法不会立即释放相关套接字；它会在超时后才释放。这个超时可能长达 20 秒。由于这个超时，使用大量 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                    对象实例可能导致程序耗尽套接字。解决方案： <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                    类专为复用而设计。你可以使用这个类处理多个请求，而无需每次都创建新实例。使用 HttpClient 工厂可以避免创建和释放 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                    实例。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                </section>
            </aside>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0039"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-369" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Making an Asynchronous Get Request <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">发起异步 GET 请求</font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0124" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Invoking the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetAsync</code> makes an
                    HTTP GET request to the server. Because the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">BaseAddress</code> is
                    already specified with the configuration of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> class
                    that's injected with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSamples</code>
                    class, only the relative address needs to be passed to the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetAsync</code> method.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">调用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetAsync</code>
                                会向服务器发起 HTTP GET 请求。由于 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">BaseAddress</code>
                                已经通过配置 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                类（该类被注入 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSamples</code>
                                类中）指定，因此只需将相对地址传递给 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetAsync</code>
                                方法。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The call to <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetAsync</code> returns
                    an <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpResponseMessage</code>
                    object. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpResponseMessage</code>
                    class represents a response including headers, status, and content. Checking the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IsSuccessfulStatusCode</code>
                    property of the response tells you whether the request was successful. With a successful call, the
                    content returned is retrieved as a string using the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsStringAsync</code>
                    method (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/HttpClientSamples.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">调用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetAsync</code>
                                会返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpResponseMessage</code>
                                对象。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpResponseMessage</code>
                                类表示包含头部、状态和内容的响应。检查响应的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IsSuccessfulStatusCode</code>
                                属性可以判断请求是否成功。如果调用成功，可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsStringAsync</code>
                                方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/HttpClientSamples.cs</code>
                                ）将返回的内容获取为字符串：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0049"><code>public async Task SimpleGetRequestAsync()</code>
<code>{</code>
<code>  <b>HttpResponseMessage response = await _httpClient.GetAsync("/");</b></code>
<code>  if <b>(response.IsSuccessStatusCode)</b></code>
<code>  {</code>
<code>    Console.WriteLine($"Response Status Code: {(int)response.StatusCode} " +</code>
<code>      $"{response.ReasonPhrase}");</code>
<code>    <b>string responseBodyAsText = await (response.Content?.ReadAsStringAsync()</b> </code>
<code>      ?? Task.FromResult(string.Empty));</code>
<code>    Console.WriteLine($"Received payload of {responseBodyAsText.Length} characters");</code>
<code>    Console.WriteLine();</code>
<code>    Console.WriteLine(responseBodyAsText[0..50]);</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1"><span aria-label="550" epub:type="pagebreak" id="Page_550"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>Executing this
                    code with the command-line argument <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">simple</code> should
                    produce the following output, including the log output from the source <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Http.HttpClient</code>
                    :<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用命令行参数 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">simple</code>
                                执行此代码应产生以下输出，包括来自源 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net.Http.HttpClient</code>
                                的日志输出：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0050"><code>info: System.Net.Http.HttpClient.HttpClientSamples.LogicalHandler[100]</code>
<code>      Start processing HTTP request GET https://localhost:5021/</code>
<code>info: System.Net.Http.HttpClient.HttpClientSamples.ClientHandler[100]</code>
<code>      Sending HTTP request GET https://localhost:5021/</code>
<code>info: System.Net.Http.HttpClient.HttpClientSamples.ClientHandler[101]</code>
<code>      Received HTTP response headers after 312.8412ms - 200</code>
<code>info: System.Net.Http.HttpClient.HttpClientSamples.LogicalHandler[101]</code>
<code>      End processing HTTP request after 328.6248ms - 200</code>
<code>Response Status Code: 200 OK</code>
<code>Received payload of 1008 characters</code>
<code> </code>
<code>&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Sample Listener</code></pre>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0128" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">When checking for
                                success, do not check the </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">StatusCode</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> property and
                                compare it with 200 or </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpStatusCode.OK</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">. 200 is not the
                                only success status code; all 2xx status codes indicate success. Instead, the </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IsSuccessStatusCode</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> property returns
                                a Boolean value if the call was successful or not. You can also throw an exception if a
                                failure occurs, as shown in the next section.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：在检查成功时，不要检查 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">StatusCode</code>
                                        属性并与 200 或 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpStatusCode.OK</code>
                                        进行比较。200 不是唯一成功的状态码；所有 2xx 状态码都表示成功。相反， <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IsSuccessStatusCode</code>
                                        属性会返回一个布尔值，指示调用是否成功。如果发生失败，你也可以像下一节所示抛出异常。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0041"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-370" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Throwing Exceptions from Errors <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">从错误中抛出异常</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Invoking the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetAsync</code> method of
                    the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                    class by default doesn't generate an exception if the method fails. This could be easily changed by
                    invoking the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EnsureSuccessStatusCode</code>
                    method with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpResponseMessage</code>.
                    This method checks whether <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IsSuccessStatusCode</code>
                    is <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">false</code> and
                    throws an exception otherwise (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/HttpClientSamples.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">默认情况下，通过调用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetAsync</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                方法如果方法失败不会生成异常。这可以通过使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">EnsureSuccessStatusCode</code>
                                方法轻松更改。此方法检查 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IsSuccessStatusCode</code>
                                是否为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">false</code>
                                ，否则抛出异常（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/HttpClientSamples.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0051"><code>public async Task ThrowExceptionAsync()</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    HttpResponseMessage response = await _httpClient.GetAsync(_invalidUrl);</code>
<code>    <b>response.EnsureSuccessStatusCode();</b></code>
<code> </code>
<code>    Console.WriteLine($"Response Status Code: {(int)response.StatusCode} " +</code>
<code>      $"{response.ReasonPhrase}");</code>
<code>    string responseBodyAsText = await (response.Content?.ReadAsStringAsync() </code>
<code>      ?? Task.FromResult(string.Empty));</code>
<code>    Console.WriteLine($"Received payload of {responseBodyAsText.Length} characters");</code>
<code>    Console.WriteLine();</code>
<code>    Console.WriteLine(responseBodyAsText[..50]);</code>
<code>  }</code>
<code>  catch &lt;?b Start?&gt;(<b>HttpRequestException ex</b>)&lt;?b End?&gt;</code>
<code>  {</code>
<code>    _logger.LogError(ex, ex.Message);</code>
<code>  }</code>
<code>}</code></pre>
            </section> <span aria-label="551" epub:type="pagebreak" id="Page_551" role="doc-pagebreak"
                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0042"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-371" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Creating an HttpRequestMessage<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建 HttpRequestMessage</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetAsync</code> method
                    makes an HTTP GET request to the server. You can create POST requests with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PostAsync</code> method
                    and PUT requests with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PutAsync</code> method.
                    <a href="c25.xhtml" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                        25</a> shows details for how to invoke REST services using the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>. All
                    these methods are extension methods that invoke the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code> method
                    and pass an <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpRequestMessage</code>
                    as shown in the following code snippet. When you use the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpRequestMessage</code>,
                    you have more options—for example, using other HTTP methods such as HEAD and TRACE (method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseHttpRequestMessageAsync</code>
                    in the code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/HttpClientSamples.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetAsync</code>
                                方法向服务器发起 HTTP GET 请求。你可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PostAsync</code>
                                方法创建 POST 请求，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">PutAsync</code>
                                方法创建 PUT 请求。第 25 章展示了如何使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                调用 REST 服务的详细信息。所有这些方法都是扩展方法，它们调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code>
                                方法并传递一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpRequestMessage</code>
                                ，如下面的代码片段所示。当你使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpRequestMessage</code>
                                时，你拥有更多选项——例如，使用其他 HTTP 方法，如 HEAD 和 TRACE（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/HttpClientSamples.cs</code>
                                中的方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseHttpRequestMessageAsync</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0052"><code>HttpRequestMessage request = new(HttpMethod.Get, "/");</code>
<code>HttpResponseMessage response = await _httpClient.SendAsync(request);</code></pre>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0132" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">The </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpRequestMessage</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> specifies a
                                version property that you can use to make requests with HTTP/2.0, passing </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">new Version(</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">"</i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">2.0</code> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">"</i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">)</code> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">. With the </i>
                            <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> class, you can
                                set the property </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DefaultRequestVersion</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">, which you can
                                also configure with the HttpClient factory. By setting the </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DefaultVersionPolicy</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">, you can specify
                                to use exactly the specified version (</i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">RequestVersionExact</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">) or communicate
                                with the server on versions available (</i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">RequestVersionOrHigher</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> or </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">RequestVersionOrLower</code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">).</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpRequestMessage</code>
                                        指定了一个版本属性，你可以使用它来通过 HTTP/2.0 发送请求，传递 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">new Version(</code>
                                        " <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">2.0</code>
                                        " <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">)</code>
                                        。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                        类，你可以设置属性 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DefaultRequestVersion</code>
                                        ，你也可以通过 HttpClient 工厂来配置它。通过设置 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DefaultVersionPolicy</code>
                                        ，你可以指定使用指定的版本（ <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">RequestVersionExact</code>
                                        ）或与服务器在可用的版本上通信（ <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">RequestVersionOrHigher</code>
                                        或 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">RequestVersionOrLower</code>
                                        ）。</font>
                                </font>
                            </font>
                        </p>
                        <p id="c19-para-0133" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                data-immersive-translate-paragraph="1">HTTP/1.0 was specified in 1996 and was followed
                                by 1.1 just a few years later. With 1.0, the connection was always closed after the
                                server returned the data; with 1.1, a keep-alive header was added where the client was
                                able to put their wish to keep the connection alive as the client might make more
                                requests to receive not only the HTML code but also CSS and JavaScript files and images.
                                After HTTP/1.1 was defined in 1999, it took 16 years until HTTP/2 was done in the year
                                2015.<font class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">HTTP/1.0 于 1996
                                            年发布，几年后就被 1.1 版本取代。在 1.0 版本中，服务器返回数据后连接总是关闭；在 1.1
                                            版本中，添加了保持活动状态的头部，客户端可以表达希望保持连接的愿望，因为客户端可能会发送更多请求来接收不仅限于 HTML 代码，还包括
                                            CSS、JavaScript 文件和图片。HTTP/1.1 于 1999 年定义后，直到 2015 年 HTTP/2 才完成，中间间隔了 16 年。
                                        </font>
                                    </font>
                                </font></i></p>
                        <p id="c19-para-0134" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                                data-immersive-translate-paragraph="1">What are the advantages of version 2? HTTP/2
                                allows multiple concurrent requests on the same connection, header information is
                                compressed, the client can define which of the resources is more important, and the
                                server can send resources to the client via server push. HTTP/2 is supported in all
                                modern browsers—with the exception of server push. Because server push is not used
                                often, and when it is used, usually more data than needed is pushed to the client, the
                                current plan is to remove this feature from Chromium-based browsers.<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">版本 2 有哪些优势？HTTP/2
                                            允许在同一连接上进行多个并发请求，头信息被压缩，客户端可以定义哪些资源更重要，服务器可以通过服务器推送将资源发送给客户端。HTTP/2
                                            在所有现代浏览器中都有支持——除了服务器推送。由于服务器推送不常用，而且当使用时，通常发送给客户端的数据多于所需，因此目前的计划是从基于
                                            Chromium 的浏览器中移除这一功能。</font>
                                    </font>
                                </font></i></p>
                        <p id="c19-para-0135" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HTTP/3 is
                                currently a working draft (</i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://quicwg.org/base-drafts/draft-ietf-quic-http.html">https://quicwg.org/base-drafts/draft-ietf-quic-http.html</a></code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">), but a lot of
                                work is in progress to support this protocol with Windows, .NET, and the Kestrel server.
                                HTTP/3 is based on the QUIC transport protocol instead of TCP. The original meaning of
                                QUIC was QUICK UDP Internet Connections (see </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://www.afasterweb.com/2019/04/30/some-quic-benefits-of-http/3/">https://www.afasterweb.com/2019/04/30/some-quic-benefits-of-http/3/</a></code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">). QUIC solves
                                some issues with TCP, which helps with faster connections and multiplexing. Read the
                                paper at the previous link for more information. See </i> <code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://github.com/dotnet/aspnetcore/issues/15271">https://github.com/dotnet/aspnetcore/issues/15271</a></code>
                            <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> for the status of
                                the HTTP/3 support of ASP.NET Core.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">HTTP/3 目前仍处于工作草案阶段（ <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://quicwg.org/base-drafts/draft-ietf-quic-http.html">https://quicwg.org/base-drafts/draft-ietf-quic-http.html</a></code>
                                        ），但大量工作正在进行中，以支持 Windows、.NET 和 Kestrel 服务器使用该协议。HTTP/3 基于的是 QUIC 传输协议，而非
                                        TCP。QUIC 的原始含义是 QUICK UDP Internet Connections（参见 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://www.afasterweb.com/2019/04/30/some-quic-benefits-of-http/3/">https://www.afasterweb.com/2019/04/30/some-quic-benefits-of-http/3/</a></code>
                                        ）。QUIC 解决了 TCP 的一些问题，有助于实现更快的连接和复用。通过前一个链接中的论文了解更多信息。有关 ASP.NET Core 对 HTTP/3
                                        的支持状态，请参见 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://github.com/dotnet/aspnetcore/issues/15271">https://github.com/dotnet/aspnetcore/issues/15271</a></code>
                                        。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0044"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-372" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Passing Headers <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">传递头部信息</font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0136" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpRequestMessage</code>
                    class has a property <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Headers</code> where you
                    can specify HTTP headers to be sent to the server. This can also be done directly with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> class.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpRequestMessage</code>
                                类有一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Headers</code>
                                属性，你可以在其中指定要发送给服务器的 HTTP 头部信息。这也可以直接通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                类完成。</font>
                        </font>
                    </font>
                </p>
                <p id="c19-para-0137" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">An example of where an HTTP header might be needed is to
                    specify accepted return formats where the server can decide to return specific formatted data.
                    ASP.NET Core 5.0 Web APIs return JSON data by default. You can add XML serializers as described in
                    <a href="c25.xhtml" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                        25</a>. Then, you need to ask the server to return XML. This can be done by setting an <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Accept</code> header to
                    <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">"application/xml"</code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">一个可能需要 HTTP
                                头部的例子是指定可接受的返回格式，服务器可以根据需要返回特定格式的数据。ASP.NET Core 5.0 Web API 默认返回 JSON 数据。你可以按照第 25
                                章的描述添加 XML 序列化器。然后，你需要请求服务器返回 XML。这可以通过设置 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Accept</code>
                                头部为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">"application/xml"</code>
                                来完成。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">A generic way to set HTTP headers (besides the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Headers</code> property
                    of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpRequestMessage</code>)
                    is the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DefaultRequestHeaders</code>
                    property of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> class:
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">设置 HTTP 头部的通用方法（除了 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Headers</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpRequestMessage</code>
                                属性）是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DefaultRequestHeaders</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                属性：</font>
                        </font>
                    </font>
                </p>
                <pre
                    id="c19-code-0053"><code>_httpClient.DefaultRequestHeaders.Add("Accept", "application/xml, */*");</code></pre>
                <p id="c19-para-0139" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1"><span aria-label="552" epub:type="pagebreak" id="Page_552"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>Instead of setting
                    this property before making the request to the server, you can also configure the headers with the
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                    configuration in the DI container.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在向服务器发起请求之前，你也可以使用 DI 容器中的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                配置来配置头部。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">To pass multiple <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Accept</code> values, you
                    can use an overload of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Add</code> method to pass
                    multiple accepted formats:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要传递多个 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Accept</code>
                                值，你可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Add</code>
                                方法的重载来传递多个可接受的格式：</font>
                        </font>
                    </font>
                </p>
                <pre
                    id="c19-code-0054"><code>_httpClient.DefaultRequestHeaders.Add("Accept", new[] { "application/xml", "*/*" });</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Because the HTTP <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Accept</code> header is
                    commonly used, the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> class
                    also defines an <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Accept</code> property to
                    pass all the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Accept</code> headers
                    (method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpHeadersAsync</code>
                    in the code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/HttpClientSamples.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">由于 HTTP <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Accept</code>
                                头部信息常用， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                类还定义了一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Accept</code>
                                属性来传递所有 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Accept</code>
                                头部信息（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/HttpClientSamples.cs</code>
                                中的方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpHeadersAsync</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0055"><code>_httpClient.DefaultRequestHeaders.Accept.Add(</code>
<code>  new MediaTypeWithQualityHeaderValue("application/xml"));</code>
<code>_httpClient.DefaultRequestHeaders.Accept.Add(</code>
<code>  new MediaTypeWithQualityHeaderValue("*/*"));</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The downloadable code sample defines the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ShowHeaders</code> method
                    to display all the headers that are sent to the server and received from the server on the console
                    (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Utilities.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">可下载的代码示例定义了 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ShowHeaders</code>
                                方法，用于在控制台上显示发送到服务器和从服务器接收的所有头部信息（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Utilities.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0056"><code>static class Utilities</code>
<code>{</code>
<code>  public static void ShowHeaders(string title, HttpHeaders headers)</code>
<code>  {</code>
<code>    Console.WriteLine(title);</code>
<code>    foreach (var header in headers)</code>
<code>    {</code>
<code>      string value = string.Join(" ", header.Value);</code>
<code>      Console.WriteLine($"Header: {header.Key} Value: {value}");</code>
<code>    }</code>
<code>    Console.WriteLine();</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">This method is invoked with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpHeadersAsync</code>
                    method (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/HttpClientSamples.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">这个方法通过 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpHeadersAsync</code>
                                方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/HttpClientSamples.cs</code>
                                ）被调用：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0057"><code>public async Task AddHttpHeadersAsync()</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    _httpClient.DefaultRequestHeaders.Accept.Add(</code>
<code>      new MediaTypeWithQualityHeaderValue("application/xml"));</code>
<code>    _httpClient.DefaultRequestHeaders.Accept.Add(</code>
<code>      new MediaTypeWithQualityHeaderValue("*/*"));</code>
<code>    Utilities.ShowHeaders("Request Headers:", _httpClient.DefaultRequestHeaders);</code>
<code> </code>
<code>    HttpResponseMessage response = await _httpClient.GetAsync("/");</code>
<code>    response.EnsureSuccessStatusCode();</code>
<code> </code>
<code>    Utilities.ShowHeaders("Response Headers:", response.Headers);</code>
<code>    Console.WriteLine();</code>
<code>  }</code>
<code>  catch (HttpRequestException ex)</code>
<code>  {</code>
<code>    Console.WriteLine($"{ex.Message}");</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1"><span aria-label="553" epub:type="pagebreak" id="Page_553"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>When you run the
                    application with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">headers</code> argument,
                    you can see the headers sent and received. Remember with the Kestrel server created previously, it
                    was turned on to return the Server header:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当你使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">headers</code>
                                参数运行应用程序时，你可以看到发送和接收的头部信息。记得之前创建的 Kestrel 服务器已经设置为返回 Server 头部：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0058"><code>Request Headers:</code>
<code>Header: Accept Value: application/xml</code>
<code>Response Headers:</code>
<code>Header: Date Value: Mon, 01 Feb 2021 19:23:30 GMT</code>
<code>Header: Server Value: Kestrel</code>
<code>Header: Transfer-Encoding Value: chunked</code></pre>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0045"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-373" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Accessing the Content <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">访问内容</font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0145" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The previous code snippets have shown you how to access the
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Content</code> property
                    to retrieve a string. The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Content</code> property
                    in the response returns an <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpContent</code>
                    object. To get the data from the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpContent</code>
                    object, you need to use one of the methods supplied. In the example, the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsStringAsync</code>
                    method was used. It returns a string representation of the content. As the name implies, this is an
                    async call. Instead of using the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">async</code> keyword, the
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Result</code> property
                    could be used as well. Calling the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Result</code> property
                    blocks the call until it's finished and then continues with execution.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">之前的代码片段已经展示了如何通过访问 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Content</code>
                                属性来获取字符串。响应中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Content</code>
                                属性返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpContent</code>
                                对象。要从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpContent</code>
                                对象中获取数据，你需要使用其中提供的一种方法。在示例中，使用了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsStringAsync</code>
                                方法。它返回内容的字符串表示。顾名思义，这是一个异步调用。除了使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">async</code>
                                关键字，也可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Result</code>
                                属性。调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Result</code>
                                属性会阻塞调用直到完成，然后继续执行。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Other methods to get the data from the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpContent</code> object
                    are <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsByteArrayAsync</code>,
                    which returns a byte array of the data, and <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsStreamAsync</code>,
                    which returns a stream. You can also load the content into a memory buffer using <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">LoadIntoBufferAsync</code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">从 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpContent</code>
                                对象获取数据的其他方法有 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsByteArrayAsync</code>
                                ，它返回数据的字节数组，以及 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ReadAsStreamAsync</code>
                                ，它返回一个流。你也可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">LoadIntoBufferAsync</code>
                                将内容加载到内存缓冲区中。</font>
                        </font>
                    </font>
                </p>
                <aside data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                    <div class="top hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                        <p id="c19-para-0147" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NOTE</b> <i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Streams are
                                explained in <a href="c18.xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                                    18</a>. Check <a href="c25.xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter
                                    25</a> on receiving streams with the </i><code
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code><i
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"> class. For
                                receiving large content, streams should be preferred to strings. Large strings are
                                stored in the large object heap, which can lead to memory issues.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：流在 18 章中解释。检查 25
                                        章了解如何使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                        类接收流。对于接收大内容，应优先使用流而不是字符串。大字符串存储在大对象堆中，这可能导致内存问题。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0047"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-374" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Customizing Requests with HttpMessageHandler<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 HttpMessageHandler 自定义请求</font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0148" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> class
                    can take an <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpMessageHandler</code>
                    as a parameter to its constructor. This makes it possible for you to customize the request. You can
                    pass an instance of a class derived from <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DelegatingHandler</code>.
                    There are numerous ways to influence the request—for example, for monitoring, making calls to other
                    services, and so on. <a href="c27.xhtml"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter 27</a>, “Blazor,”
                    covers an ASP.NET technology where you can run .NET code in a WebAssembly (WASM) in the browser.
                    With Blazor WASM you can use the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> class
                    to make calls to services directly within the browser. However, the browser restricts what you can
                    do, and you can't make network requests without the browser. Using Blazor WASM you can still use the
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                    class. This is done using <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpMessageHandler</code>,
                    which in turn uses the Fetch API of the browser to make requests.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                类可以将其构造函数的参数设为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpMessageHandler</code>
                                。这使得您能够自定义请求。您可以传递一个从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">DelegatingHandler</code>
                                派生出的类的实例。有无数种方法可以影响请求——例如，用于监控、调用其他服务等等。第 27 章“Blazor”介绍了 ASP.NET 技术，您可以在其中通过浏览器中的
                                WebAssembly (WASM) 运行 .NET 代码。使用 Blazor WASM，您可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                类直接在浏览器中调用服务。然而，浏览器限制了您能做的事情，并且您无法在浏览器之外发起网络请求。使用 Blazor WASM，您仍然可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                类。这是通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpMessageHandler</code>
                                实现的，而 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpMessageHandler</code>
                                又使用浏览器的 Fetch API 发起请求。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">With the next code snippet, a <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">LimitCallsHandler</code>
                    is defined to be used with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                    factory. The method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                    returns an <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IHttpClientBuilder</code>.
                    With this you can use a fluent API to configure this factory. The generic parameter passed to the
                    extension method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpMessageHandler</code>
                    defines the type of the class that should be used with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpMessageHandler</code>.
                    In turn, the method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SetHandlerLifetime</code>
                    is used to specify the lifetime of this handler (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在下一个代码片段中，定义了一个 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">LimitCallsHandler</code>
                                用于与 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                工厂一起使用。方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                                返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IHttpClientBuilder</code>
                                。通过这种方式，您可以使用流畅的 API 来配置这个工厂。传递给扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpMessageHandler</code>
                                的泛型参数定义了应与 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpMessageHandler</code>
                                一起使用的类的类型。反过来，方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SetHandlerLifetime</code>
                                用于指定此处理程序的生存期（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0059"><code>services.Configure&lt;LimitCallsHandlerOptions&gt;(</code>
<code>  context.Configuration.GetSection("RateLimit"));</code>
<code>services.AddTransient&lt;LimitCallsHandler&gt;();</code>
<code>services.AddHttpClient&lt;HttpClientSampleWithMessageHandler&gt;(httpClient =&gt;</code>
<code>{</code>
<code>  httpClient.BaseAddress = new Uri(httpClientSettings["Url"]);</code>
<code><b>}).AddHttpMessageHandler&lt;LimitCallsHandler&gt;()</b></code>
<code>  <b>.SetHandlerLifetime(Timeout.InfiniteTimeSpan);</b></code>
<code> </code>
<code>private HttpClient _httpClientWithMessageHandler;</code>
<code>public HttpClient HttpClientWithMessageHandler =&gt; <span aria-label="554" epub:type="pagebreak" id="Page_554" role="doc-pagebreak"></span></code>
<code>  _httpClientWithMessageHandler ?? (_httpClientWithMessageHandler = </code>
<code>    new HttpClient(new SampleMessageHandler("error")));</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">The purpose of this handler type, <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">LimitCallsHandler</code>,
                    is to restrict the number of calls that can be done with the configured <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>. The
                    number of calls allowed is specified with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">LimitCalls</code>
                    property that's retrieved from the configuration file. The overridden method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code> is
                    invoked by the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>. With
                    the implementation, the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code> method
                    of the base class is invoked, but only as long as the limit is not reached. On reaching the limit,
                    the HTTP status code <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TooManyRequests</code>
                    (429) is returned. This way, this error is not returned from the server but from the client handler
                    (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/LimitCallsHandler.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">这种处理器类型 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">LimitCallsHandler</code>
                                的目的是限制使用配置的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                可以进行的调用次数。允许的调用次数通过从配置文件中获取的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">LimitCalls</code>
                                属性指定。被重写的方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code>
                                由 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                调用。在实现中，只有当限制未达到时，才会调用基类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SendAsync</code>
                                方法。达到限制时，会返回 HTTP 状态码 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TooManyRequests</code>
                                （429）。这样，这个错误不是从服务器返回，而是从客户端处理器返回（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/LimitCallsHandler.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0060"><code>public record LimitCallsHandlerOptions</code>
<code>{</code>
<code>  public int LimitCalls { get; init; }</code>
<code>}</code>
<code> </code>
<code>public class LimitCallsHandler : DelegatingHandler</code>
<code>{ </code>
<code>  private readonly ILogger _logger;</code>
<code>  private readonly int _limitCount;</code>
<code>  private int _numberCalls = 0;</code>
<code>  public LimitCallsHandler(IOptions&lt;RateLimitHandlerOptions&gt; options, </code>
<code>    ILogger&lt;LimitCallsHandler&gt; logger)</code>
<code>  {</code>
<code>    _limitCount = options.Value.LimitCalls;</code>
<code>    _logger = logger;</code>
<code>  }</code>
<code> </code>
<code>  protected override Task&lt;HttpResponseMessage&gt; SendAsync(HttpRequestMessage request, </code>
<code>    CancellationToken cancellationToken)</code>
<code>  {</code>
<code>    if (_numberCalls&gt;= _limitCount)</code>
<code>    {</code>
<code>      _logger.LogInformation("limit reached, returning too many requests");</code>
<code>      return Task.FromResult(new HttpResponseMessage(HttpStatusCode.TooManyRequests));</code>
<code>    }</code>
<code>    Interlocked.Increment(ref _numberCalls);</code>
<code>    _logger.LogTrace("SendAsync from within LimitCallsHandler");</code>
<code>    return base.SendAsync(request, cancellationToken);</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">With the sample application, in the class <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSampleWithMessageHandler</code>,
                    the <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                    using the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">LimitCallsHandler</code>
                    is injected. Invoking the method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseMessageHandlerAsync</code>
                    multiple times, you can see the handler’s limit in action, and the 429 error will be shown (code
                    file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用示例应用程序，在类 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSampleWithMessageHandler</code>
                                中，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">LimitCallsHandler</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                被注入。多次调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">UseMessageHandlerAsync</code>
                                ，可以看到处理器的限制在起作用，并会显示 429 错误（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0061"><code>var service = host.Services.GetRequiredService&lt;HttpClientSampleWithMessageHandler&gt;();</code>
<code>for (int i = 0; i &lt; 10; i++)</code>
<code>{</code>
<code>  await service.UseMessageHandlerAsync();</code>
<code>}</code></pre>
            </section>
        </section>
        <section aria-labelledby="head-2-183" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
            <span id="c19-sec-0048" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <h2 id="head-2-183" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">HTTPCLIENT FACTORY<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">HTTPCLIENT 工厂</font>
                    </font>
                </font>
            </h2>
            <p id="c19-para-0152" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">With the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample</code>
                application, you've already seen the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> factory in
                action—configured with the DI container. The factory keeps a cache of <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpMessageHandler</code>
                handler objects discussed in the previous section. The handler objects have a connection to the native
                operating system (OS) socket object. As more sockets <span aria-label="555" epub:type="pagebreak"
                    id="Page_555" role="doc-pagebreak"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>are needed for
                communication, the factory creates new ones. If they are not used for some time, the factory disposes of
                the objects. The default lifetime of the handler objects is two minutes. If they are not used for two
                minutes, they are disposed of. You can change the lifetime of these objects by invoking the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SetHandlerLifetime</code>
                method, as shown in the next section.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">通过 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample</code>
                            应用，你已经看到了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            工厂的作用——配置了依赖注入容器。该工厂缓存了上一节讨论的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpMessageHandler</code>
                            处理器对象。处理器对象与原生操作系统（OS）套接字对象相连。当需要更多套接字进行通信时，工厂会创建新的套接字。如果它们在一段时间内未被使用，工厂会释放这些对象。处理器对象的默认生命周期是两分钟。如果它们在两分钟内未被使用，就会被释放。你可以通过调用
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">SetHandlerLifetime</code>
                            方法来更改这些对象的生命周期，下一节将展示如何操作。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0049"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-375" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Typed Clients <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">类型化客户端</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Using the generic version of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                    method adds a <i data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">typed
                        client</i>. A typed client is a class that has an <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> as a
                    constructor parameter, and it's usually the preferred option on using the factory. The used overload
                    of this method has an <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Action&lt;HttpClient&gt;</code>
                    parameter that allows you to configure the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>—for
                    example, on specifying the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">BaseAddress</code>
                    property as shown here (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                                方法的泛型版本会添加一个类型化客户端。类型化客户端是一个将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                作为构造函数参数的类，通常在使用工厂时是首选选项。这个方法的重载版本有一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Action&lt;HttpClient&gt;</code>
                                参数，允许你配置 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                ——例如，通过指定这里的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">BaseAddress</code>
                                属性（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0062"><code>IHostBuilder GetHostBuilder() =&gt;</code>
<code>  Host.CreateDefaultBuilder()</code>
<code>    .ConfigureServices((context, services) =&gt;</code>
<code>    {</code>
<code>      var httpClientSettings = context.Configuration.GetSection("HttpClient");</code>
<code>      services.Configure&lt;HttpClientSamplesOptions&gt;(httpClientSettings);</code>
<code>      <b>services.AddHttpClient&lt;HttpClientSamples&gt;(httpClient =&gt;</b></code>
<code>      <b>{</b></code>
<code>        <b>httpClient.BaseAddress = new Uri(httpClientSettings["Url"]);</b></code>
<code>      <b>});</b></code>
<code>      services.Configure&lt;LimitCallsHandlerOptions&gt;(</code>
<code>        context.Configuration.GetSection("RateLimit"));</code>
<code>      services.AddTransient&lt;LimitCallsHandler&gt;();</code>
<code>      services.AddHttpClient&lt;HttpClientSampleWithMessageHandler&gt;(httpClient =&gt;</code>
<code>      {</code>
<code>        httpClient.BaseAddress = new Uri(httpClientSettings["Url"]);</code>
<code>      <b>}).AddHttpMessageHandler&lt;LimitCallsHandler&gt;()</b></code>
<code>        .SetHandlerLifetime(Timeout.InfiniteTimeSpan);</code>
<code>    });</code></pre>
                <p id="c19-para-0154" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Instead of using the generic parameter with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                    method to register a typed client, you can also invoke the method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddTypedClient</code> and
                    supply the type with the generic parameter. This way you can add multiple types to use the same
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                    configuration.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">不用通过 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                                方法使用泛型参数来注册类型化的客户端，你也可以调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddTypedClient</code>
                                方法并使用泛型参数来提供类型。这样你可以添加多个类型来使用相同的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                配置。</font>
                        </font>
                    </font>
                </p>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0050"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-376" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Named Clients <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">命名的客户端 </font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0155" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Using a typed client is one way to use the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                    factory. You can also define a name for the configured HTTP client and access HTTP clients from the
                    pool using this name.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用类型化的客户端是使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                工厂的一种方式。你也可以为配置的 HTTP 客户端定义一个名称，并使用这个名称从池中访问 HTTP 客户端。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">To specify a named client, several overloads exist with the
                    <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                    method. In the following sample code, a named client is specified with the name <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">racersClient</code>. This
                    time for the configuration of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> object,
                    the method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureHttpClient</code>
                    is used instead of passing a delegate as an argument of the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                    method. With named clients, you also have the option to supply the configuration with the argument.
                    Because the type where the named client should be used is not registered in the DI container on
                    configuring the HTTP client, you need to register this type as well. In the sample application, the
                    type using named clients is <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NamedClientSample</code>
                    (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要指定命名的客户端， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                                方法存在多个重载版本。在以下示例代码中，使用名称 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">racersClient</code>
                                指定了命名的客户端。这次在配置 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                对象时，使用的是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">ConfigureHttpClient</code>
                                方法而不是将委托作为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                                方法的参数传递。使用命名的客户端时，你也可以选择通过参数提供配置。由于在配置 HTTP
                                客户端时，命名的客户端应该使用的类型没有在依赖注入容器中注册，因此你也需要注册这个类型。在示例应用程序中，使用命名的客户端的类型是 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">NamedClientSample</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0063"><code>services.AddHttpClient("racersClient")</code>
<code>  .ConfigureHttpClient(httpClient =&gt;</code>
<code>  {</code>
<code>    httpClient.BaseAddress = new Uri(httpClientSettings["Url"]);</code>
<code>  });</code>
<code>services.AddTransient&lt;NamedClientSample&gt;();</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1"><span aria-label="556" epub:type="pagebreak" id="Page_556"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>To get a named
                    client instance, you can inject the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IHttpClientFactory</code>
                    with the constructor of the class where this instance is needed. By invoking the method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">CreateClient</code> to
                    pass the name, an object from the pool is returned. Then you can use this preconfigured client in
                    the same way as before (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/NamedClientSample.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                要获取一个命名的客户端实例，你可以将其注入到需要该实例的类的构造函数中。通过调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">CreateClient</code>
                                并传入名称，会从池中返回一个对象。然后你可以像之前一样使用这个预配置的客户端（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/NamedClientSample.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0064"><code>class NamedClientSample</code>
<code>{</code>
<code>  private readonly ILogger _logger;</code>
<code>  private readonly HttpClient _httpClient;</code>
<code>  private readonly string _url;</code>
<code> </code>
<code>  public NamedClientSample(</code>
<code>    IOptions&lt;HttpClientSamplesOptions&gt; options,</code>
<code>    IHttpClientFactory httpClientFactory,</code>
<code>    ILogger&lt;HttpClientSamples&gt; logger)</code>
<code>  {</code>
<code>    _logger = logger;</code>
<code>    _url = options.Value.InvalidUrl ?? "localhost:5052";</code>
<code>    _httpClient = httpClientFactory.CreateClient("racersClient");</code>
<code>  }</code>
<code>  //…</code>
<code>}</code>
<code> </code></pre>
            </section>
            <section data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><span id="c19-sec-0051"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
                <h3 id="head-3-377" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">Resilient HTTP Requests<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">弹性 HTTP 请求</font>
                        </font>
                    </font>
                </h3>
                <p id="c19-para-0158" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">When accessing servers over the network, many parts can fail.
                    Passing invalid data to the server that cannot be processed by the server is an error that cannot be
                    recovered by redoing the request. However, there are many errors that might be only transient. The
                    DNS server might not be accessible to resolve the server name. The wireless network itself might be
                    temporarily unavailable while you're switching networks. A router can have issues that might be
                    resolved in a moment. Some API services are restricted in the number of calls you are allowed to
                    make in a second.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                当通过网络访问服务器时，很多部分都可能失效。将无法被服务器处理的无效数据传递给服务器是一种重试请求也无法恢复的错误。然而，许多错误可能只是暂时的。DNS
                                服务器可能无法解析服务器名称。在切换网络时，无线网络本身可能暂时不可用。路由器可能存在问题，但可能很快就能解决。一些 API 服务对每秒允许的调用次数有限制。 </font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">With many of the transient errors, it can be worthwhile to
                    retry the call after a delay, and the issue might resolve silently for the user. You don't have to
                    create loops to repeat the invocation with maximum retry counts and different delays because there
                    are different options that don't change the logic of the main functionality where you invoke the
                    service. With the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                    factory, you just need to add another NuGet package: <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.Extensions.Http.Polly</code>.
                    <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.Extensions.Http.Polly</code>
                    has a dependency on the Polly library. Polly is a .NET resiliency and transient-fault-handling
                    library (<code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://github.com/App-vNext/Polly">https://github.com/App-vNext/Polly</a></code>)
                    that offers retry, circuit breakers, timeout, and fallback functionality that can be used in many
                    scenarios. To use it with <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                    s, you can configure a retry policy based on an HTTP status code, as shown in the following code
                    snippet. Here, the method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetRetryPolicy</code>
                    returns a policy that retries the invocation for a maximum of five attempts after 2, 4, 8, 16, and
                    32 seconds (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                对于许多临时错误，在延迟后重试调用可能是有益的，并且问题可能会对用户无声地解决。你不必创建循环来重复调用，并设置最大重试次数和不同的延迟，因为存在不同的选项，这些选项不会改变你调用服务的主要功能的逻辑。使用
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                工厂，你只需要添加另一个 NuGet 包： <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.Extensions.Http.Polly</code>
                                。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Microsoft.Extensions.Http.Polly</code>
                                依赖于 Polly 库。Polly 是一个 .NET 弹性和临时错误处理的库（ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"><a href="https://github.com/App-vNext/Polly">https://github.com/App-vNext/Polly</a></code>
                                ），它提供了重试、断路器、超时和回退功能，这些功能可以在许多场景中使用。要使用它与 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                ，你可以根据 HTTP 状态码配置重试策略，如下面的代码片段所示。在这里，方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">GetRetryPolicy</code>
                                返回一个策略，该策略在 2、4、8、16 和 32 秒后最多重试五次调用（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0065"><code>IAsyncPolicy&lt;HttpResponseMessage&gt; GetRetryPolicy()</code>
<code>  =&gt; HttpPolicyExtensions</code>
<code>    .HandleTransientHttpError()</code>
<code>    .OrResult(message =&gt; message.StatusCode == HttpStatusCode.TooManyRequests)</code>
<code>    .WaitAndRetryAsync(5, retryAttempt </code>
<code>      =&gt; TimeSpan.FromSeconds(Math.Pow(2, retryAttempt)));</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">This method returning the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IasyncPolicy</code> can
                    be invoked as the argument of the method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddPolicyHandler</code>.
                    This method configures the policy of the typed client specified with the <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                    method (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">这种返回 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">IasyncPolicy</code>
                                的方法可以作为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddPolicyHandler</code>
                                方法的参数调用。这个方法配置了使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddHttpClient</code>
                                方法指定的类型客户端的策略（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0066"><code>services.AddHttpClient&lt;FaultHandlingSample&gt;(httpClient =&gt;<span aria-label="557" epub:type="pagebreak" id="Page_557" role="doc-pagebreak"></span></code>
<code>{</code>
<code>  httpClient.BaseAddress = new Uri(httpClientSettings["InvalidUrl"]);</code>
<code>})<b>.AddPolicyHandler(GetRetryPolicy())</b></code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">With the method <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddTransientHttpErrorPolicy</code>,
                    a method is defined that is configured to handle predefined transient errors. You just need to
                    specify different time intervals with this method to handle network failures, HTTP 5xx status codes,
                    and HTTP 408 status codes (code file <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用方法 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">AddTransientHttpErrorPolicy</code>
                                ，定义了一个处理预定义临时错误的方法。您只需要用这个方法指定不同的时间间隔来处理网络故障、HTTP 5xx 状态码和 HTTP 408 状态码（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClientSample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0067"><code>services.AddHttpClient&lt;FaultHandlingSample&gt;(httpClient =&gt;</code>
<code>{</code>
<code>  httpClient.BaseAddress = new Uri(httpClientSettings["InvalidUrl"]);</code>
<code>}).AddTransientHttpErrorPolicy(</code>
<code>  policy =&gt; policy.WaitAndRetryAsync(</code>
<code>    new[] { TimeSpan.FromSeconds(1), TimeSpan.FromSeconds(3), TimeSpan.FromSeconds(5) }));</code></pre>
                <p data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                    data-immersive-translate-paragraph="1">With this in place, the code with the injected <code
                        data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> object
                    does not need any change to deal with these transient errors. Your exception handler is invoked only
                    after the retries. Of course, enabling logging shows the retries. As the error still persists after
                    the retries, the exception is thrown after the last retry:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">有了这个设置，注入了 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                                对象的代码无需任何更改来处理这些瞬态错误。只有在重试之后，你的异常处理器才会被调用。当然，启用日志功能会显示重试。由于重试后错误仍然存在，异常在最后一次重试后被抛出：
                            </font>
                        </font>
                    </font>
                </p>
                <pre id="c19-code-0068"><code>info: System.Net.Http.HttpClient.FaultHandlingSample.LogicalHandler[100]</code>
<code>      Start processing HTTP request GET https://localhost1:5021/</code>
<code>info: System.Net.Http.HttpClient.FaultHandlingSample.ClientHandler[100]</code>
<code>      <b>Sending HTTP request GET https://localhost1:5021/</b></code>
<code>info: System.Net.Http.HttpClient.FaultHandlingSample.ClientHandler[100]</code>
<code>      <b>Sending HTTP request GET https://localhost1:5021/</b></code>
<code>info: System.Net.Http.HttpClient.FaultHandlingSample.ClientHandler[100]</code>
<code>      <b>Sending HTTP request GET https://localhost1:5021/</b></code>
<code>info: System.Net.Http.HttpClient.FaultHandlingSample.ClientHandler[100]</code>
<code>      <b>Sending HTTP request GET https://localhost1:5021/</b></code>
<code>fail: HttpClientSamples[0]</code>
<code>      <b>No such host is known. (localhost1:5021)</b></code></pre>
            </section>
        </section>
        <section aria-labelledby="head-2-184" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">
            <span id="c19-sec-0052" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"></span>
            <h2 id="head-2-184" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">SUMMARY<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">摘要</font>
                    </font>
                </font>
            </h2>
            <p id="c19-para-0163" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">This chapter described the .NET classes available in the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net</code> namespace
                for communication across networks. You have seen some of the .NET base classes that deal with opening
                client connections on the network and the Internet, as well as how to send requests to and receive
                responses from servers.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本章介绍了 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net</code>
                            命名空间中用于网络通信的 .NET 类。你已经看到了一些处理网络和互联网上客户端连接打开的 .NET 基类，以及如何向服务器发送请求并接收响应。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0164" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">As a rule of thumb, when programming with classes in the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net</code> namespace,
                you should always try to use the most specific class possible. For instance, using the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code> class
                instead of the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code> class isolates
                your code from many of the lower-level socket details. Moving one step higher, the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> class is an
                easy way to use the HTTP protocol. Using the <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> factory,
                you don't need to instantiate and dispose of <code
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code> objects.
                You've also seen how to use Polly to deal with transient errors that can be configured in a central
                place of the application.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">一般来说，在用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">System.Net</code>
                            命名空间中的类编程时，你应该始终尝试使用最具体的类。例如，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">TcpClient</code>
                            类而不是 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Socket</code>
                            类可以将你的代码与许多底层套接字细节隔离开来。再往上一层， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            类是使用 HTTP 协议的一种简便方法。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            工厂，你无需实例化和释放 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">HttpClient</code>
                            对象。你还看到了如何使用 Polly 来处理可以在应用程序的中央位置配置的暂时性错误。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0165" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">This book covers much more networking than the core networking
                features you've seen in this chapter. <a href="c25.xhtml"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter 25</a> covers
                creating REST APIs with ASP.NET Core and Azure Functions, as well as gRPC for binary communication based
                on HTTP/2. In <a href="c28.xhtml"
                    data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">Chapter 28</a>, “SignalR,”
                you can read about real-time communication with SignalR to return information from the server to the
                client, which is based on WebSockets, as well as asynchronous streaming of data. WebSockets is a
                communication protocol which allows returning real-time information to the client.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">这本书涵盖的网络安全内容远超本章所见的核心网络安全特性。第 25
                            章介绍了如何使用 ASP.NET Core 和 Azure Functions 创建 REST API，以及基于 HTTP/2 的 gRPC 二进制通信。在第 28
                            章“SignalR”中，你可以了解到使用 SignalR 进行实时通信，将服务器信息返回给客户端，这基于 WebSockets，以及数据的异步流。WebSockets
                            是一种通信协议，允许向客户端返回实时信息。</font>
                    </font>
                </font>
            </p>
            <p id="c19-para-0166" data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611"
                data-immersive-translate-paragraph="1">In the next chapter, you’ll learn about security. You can see the
                <code data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">CryptoStream</code> in
                action for encrypting streams, no matter whether they are used with files or networking. You'll also see
                features on authentication that are often an important part of using networking APIs.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在下一章中，你将学习关于安全性。你可以看到 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d1f9c917-44ff-4ee9-976a-2e3ac9649611">CryptoStream</code>
                            在加密流方面的应用，无论这些流是与文件还是网络安全一起使用。你还将看到身份验证功能，这些功能通常是使用网络安全 API 的重要部分。</font>
                    </font>
                </font>
            </p>
        </section>
    </section>
</body>
<div id="immersive-translate-popup" style="all: initial"></div>

</html>