<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops"
    xmlns:svg="http://www.w3.org/2000/svg" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en"
    imt-state="dual" imt-trans-position="after">

<head>
    <title>28 SignalR --- 28 SignalR</title>
    <link href="WileyTemplate_v5.5.css" rel="stylesheet" type="text/css" />
    <meta content="urn:uuid:e0000000-0000-0000-0000-000006715209" name="Adept.expected.resource" />
    <style data-id="immersive-translate-input-injected-css">
        .immersive-translate-input {
            position: absolute;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            z-index: 2147483647;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .immersive-translate-attach-loading::after {
            content: " ";

            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;

            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-2000%, -50%);
            z-index: 100;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .immersive-translate-input-loading {
            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;
        }

        @keyframes immersiveTranslateShadowRolling {
            0% {
                box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            12% {
                box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            25% {
                box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            36% {
                box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color),
                    100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
            }

            50% {
                box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color),
                    110px 0 var(--loading-color), 100px 0 var(--loading-color);
            }

            62% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color),
                    120px 0 var(--loading-color), 110px 0 var(--loading-color);
            }

            75% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    130px 0 var(--loading-color), 120px 0 var(--loading-color);
            }

            87% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
            }

            100% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
            }
        }

        .immersive-translate-toast {
            display: flex;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            right: 0;
            top: 1%;
            width: fit-content;
            padding: 12px 20px;
            margin: auto;
            overflow: auto;
            background: #fef6f9;
            box-shadow: 0px 4px 10px 0px rgba(0, 10, 30, 0.06);
            font-size: 15px;
            border-radius: 8px;
            color: #333;
        }

        .immersive-translate-toast-content {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .immersive-translate-toast-hidden {
            margin: 0 20px 0 72px;
            text-decoration: underline;
            cursor: pointer;
        }

        .immersive-translate-toast-close {
            color: #666666;
            font-size: 20px;
            font-weight: bold;
            padding: 0 10px;
            cursor: pointer;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-toast {
                top: 0;
                padding: 12px 0px 0 10px;
            }

            .immersive-translate-toast-content {
                flex-direction: column;
                text-align: center;
            }

            .immersive-translate-toast-hidden {
                margin: 10px auto;
            }
        }

        .immersive-translate-modal {
            display: none;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
            font-size: 15px;
        }

        .immersive-translate-modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 40px 24px 24px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 80%;
            max-width: 270px;
            font-family: system-ui, -apple-system, "Segoe UI", "Roboto", "Ubuntu",
                "Cantarell", "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
                "Segoe UI Symbol", "Noto Color Emoji";
            position: relative;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-content {
                margin: 50% auto !important;
            }
        }

        .immersive-translate-modal .immersive-translate-modal-content-in-input {
            max-width: 500px;
        }

        .immersive-translate-modal-content-in-input .immersive-translate-modal-body {
            text-align: left;
            max-height: unset;
        }

        .immersive-translate-modal-title {
            text-align: center;
            font-size: 16px;
            font-weight: 700;
            color: #333333;
        }

        .immersive-translate-modal-body {
            text-align: center;
            font-size: 14px;
            font-weight: 400;
            color: #333333;
            word-break: break-all;
            margin-top: 24px;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-body {
                max-height: 250px;
                overflow-y: auto;
            }
        }

        .immersive-translate-close {
            color: #666666;
            position: absolute;
            right: 16px;
            top: 16px;
            font-size: 20px;
            font-weight: bold;
        }

        .immersive-translate-close:hover,
        .immersive-translate-close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .immersive-translate-modal-footer {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        .immersive-translate-btn {
            width: fit-content;
            color: #fff;
            background-color: #ea4c89;
            border: none;
            font-size: 16px;
            margin: 0 8px;
            padding: 9px 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .immersive-translate-btn:hover {
            background-color: #f082ac;
        }

        .immersive-translate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .immersive-translate-btn:disabled:hover {
            background-color: #ea4c89;
        }

        .immersive-translate-cancel-btn {
            /* gray color */
            background-color: rgb(89, 107, 120);
        }

        .immersive-translate-cancel-btn:hover {
            background-color: hsl(205, 20%, 32%);
        }

        .immersive-translate-action-btn {
            background-color: transparent;
            color: #ea4c89;
            border: 1px solid #ea4c89;
        }

        .immersive-translate-btn svg {
            margin-right: 5px;
        }

        .immersive-translate-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #007bff;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-primary-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #ea4c89;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-modal input[type="radio"] {
            margin: 0 6px;
            cursor: pointer;
        }

        .immersive-translate-modal label {
            cursor: pointer;
        }

        .immersive-translate-close-action {
            position: absolute;
            top: 2px;
            right: 0px;
            cursor: pointer;
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5) !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 16px !important;
        }

        .imt-image-status img,
        .imt-image-status svg,
        .imt-img-loading {
            width: 28px !important;
            height: 28px !important;
            margin: 0 0 8px 0 !important;
            min-height: 28px !important;
            min-width: 28px !important;
            position: relative !important;
        }

        .imt-img-loading {
            background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAtFBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////oK74hAAAAPHRSTlMABBMIDyQXHwyBfFdDMSw+OjXCb+5RG51IvV/k0rOqlGRM6KKMhdvNyZBz9MaupmxpWyj437iYd/yJVNZeuUC7AAACt0lEQVRIx53T2XKiUBCA4QYOiyCbiAsuuGBcYtxiYtT3f6/pbqoYHVFO5r+iivpo6DpAWYpqeoFfr9f90DsYAuRSWkFnPO50OgR9PwiCUFcl2GEcx+N/YBh6pvKaefHlUgZd1zVe0NbYcQjGBfzrPE8Xz8aF+71D8gG6DHFPpc4a7xFiCDuhaWgKgGIJQ3d5IMGDrpS4S5KgpIm+en9f6PlAhKby4JwEIxlYJV9h5k5nee9GoxHJ2IDSNB0dwdad1NAxDJ/uXDHYmebdk4PdbkS58CIVHdYSUHTYYRWOJblWSyu2lmy3KNFVJNBhxcuGW4YBVCbYGRZwIooipHsNqjM4FbgOQqQqSKQQU9V8xmi1QlgHqQQ6DDBvRUVCDirs+EzGDGOQTCATgtYTnbCVLgsVgRE0T1QE0qHCFAht2z6dLvJQs3Lo2FQoDxWNUiBhaP4eRgwNkI+dAjVOA/kUrIDwf3CG8NfNOE0eiFotSuo+rBiq8tD9oY4Qzc6YJw99hl1wzpQvD7ef2M8QgnOGJfJw+EltQc+oX2yn907QB22WZcvlUpd143dqQu+8pCJZuGE4xCuPXJqqcs5sNpsI93Rmzym1k4Npk+oD1SH3/a3LOK/JpUBpWfqNySxWzCfNCUITuDG5dtuphrUJ1myeIE9bIsPiKrfqTai5WZxbhtNphYx6GEIHihyGFTI69lje/rxajdh0s0msZ0zYxyPLhYCb1CyHm9Qsd2H37Y3lugVwL9kNh8Ot8cha6fUNQ8nuXi5z9/ExsAO4zQrb/ev1yrCB7lGyQzgYDGuxq1toDN/JGvN+HyWNHKB7zEoK+PX11e12G431erGYzwmytAWU56fkMHY5JJnDRR2eZji3AwtIcrEV8Cojat/BdQ7XOwGV1e1hDjGGjXbdArm8uJZtCH5MbcctVX8A1WpqumJHwckAAAAASUVORK5CYII=");
            background-size: 28px 28px;
            animation: image-loading-rotate 1s linear infinite !important;
        }

        .imt-image-status span {
            color: var(--bg-2, #fff) !important;
            font-size: 14px !important;
            line-height: 14px !important;
            font-weight: 500 !important;
            font-family: "PingFang SC", Arial, sans-serif !important;
        }

        @keyframes image-loading-rotate {
            from {
                transform: rotate(360deg);
            }

            to {
                transform: rotate(0deg);
            }
        }
    </style>
    <style data-id="immersive-translate-default-injected-css">
        :root {
            --immersive-translate-theme-underline-borderColor: #72ece9;
            --immersive-translate-theme-nativeUnderline-borderColor: #72ece9;
            --immersive-translate-theme-nativeDashed-borderColor: #72ece9;
            --immersive-translate-theme-nativeDotted-borderColor: #72ece9;
            --immersive-translate-theme-highlight-backgroundColor: #ffff00;
            --immersive-translate-theme-dashed-borderColor: #59c1bd;
            --immersive-translate-theme-blockquote-borderColor: #cc3355;
            --immersive-translate-theme-thinDashed-borderColor: #ff374f;
            --immersive-translate-theme-dashedBorder-borderColor: #94a3b8;
            --immersive-translate-theme-dashedBorder-borderRadius: 0;
            --immersive-translate-theme-solidBorder-borderColor: #94a3b8;
            --immersive-translate-theme-solidBorder-borderRadius: 0;
            --immersive-translate-theme-dotted-borderColor: #94a3b8;
            --immersive-translate-theme-wavy-borderColor: #72ece9;
            --immersive-translate-theme-dividingLine-borderColor: #94a3b8;
            --immersive-translate-theme-grey-textColor: #2f4f4f;
            --immersive-translate-theme-marker-backgroundColor: #fbda41;
            --immersive-translate-theme-marker-backgroundColor-rgb: 251, 218, 65;
            --immersive-translate-theme-marker2-backgroundColor: #ffff00;
            --immersive-translate-theme-background-backgroundColor: #dbafaf;
            --immersive-translate-theme-background-backgroundColor-rgb: 219, 175, 175;
            --immersive-translate-theme-background-backgroundOpacity: 12;
            --immersive-translate-theme-opacity-opacity: 10;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pre-whitespace {
            white-space: pre-wrap !important;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container {
            position: absolute;
            background-color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
                sans-serif;
            top: 0;
            width: 600px;
            height: 100%;
            z-index: 2;
            line-height: 1.3;
            font-size: 16px;
        }

        [imt-state="dual"] .immersive-translate-target-wrapper[dir="rtl"] {
            text-align: right;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper {
            color: rgb(0, 0, 0);
            white-space: normal;
            position: absolute;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper font {
            color: inherit;
            white-space: inherit;
            position: unset;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper &gt;

        br {
            display: none;
        }

        [imt-state="translation"] .immersive-translate-target-translation-block-wrapper {
            margin: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper {
            margin: 8px 0 !important;
            display: inline-block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            display: block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            margin-top: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pdf-block-wrapper {
            margin: 0 !important;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-grey-inner {
            color: var(--immersive-translate-theme-grey-textColor);
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-underline-inner {
            border-bottom: 1px solid var(--immersive-translate-theme-underline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeUnderline-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeUnderline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDashed-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDashed-borderColor) !important;
            text-decoration-style: dashed !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-thinDashed-inner {
            border-bottom: 1px dashed var(--immersive-translate-theme-thinDashed-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dotted-inner {
            background-image: linear-gradient(to right,
                    var(--immersive-translate-theme-dotted-borderColor) 30%,
                    rgba(255, 255, 255, 0) 0%);
            background-position: bottom;
            background-size: 5px 1px;
            background-repeat: repeat-x;
            padding-bottom: 3px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDotted-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDotted-borderColor) !important;
            text-decoration-style: dotted !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-wavy-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-wavy-borderColor) !important;
            text-decoration-style: wavy !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dashed-inner {
            background: linear-gradient(to right,
                    var(--immersive-translate-theme-dashed-borderColor) 0%,
                    var(--immersive-translate-theme-dashed-borderColor) 50%,
                    transparent 50%,
                    transparent 100%) repeat-x left bottom;
            background-size: 8px 2px;
            padding-bottom: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            content: "";
            display: block;
            max-width: 80px;
            width: 10%;
            border-top: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            padding-top: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dividingLine::before {
            content: "";
            border-left: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            max-height: 16px;
            height: 16px;
            padding-left: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-highlight-inner {
            background: var(--immersive-translate-theme-highlight-backgroundColor);
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-marker {
            line-height: 1.5em;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker2-inner {
            font-weight: bold;
            text-shadow: 10px 0px 3px var(--immersive-translate-theme-marker2-backgroundColor),
                16px 3px 9px var(--immersive-translate-theme-marker2-backgroundColor),
                2px 0px 6px var(--immersive-translate-theme-marker2-backgroundColor),
                -12px 0px 12px var(--immersive-translate-theme-marker2-backgroundColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker-inner {
            /* TODO: add more texture */
            background: linear-gradient(to right,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.1),
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 3%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 35%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 70%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.8) 95%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.3));
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-weakening {
            opacity: 0.618 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-italic {
            font-style: italic !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-bold {
            font-weight: bold !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-paper {
            margin: 8px 0;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
            padding: 16px 32px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-blockquote {
            border-left: 4px solid var(--immersive-translate-theme-blockquote-borderColor) !important;
            padding-left: 12px !important;
            margin-top: 4px;
            margin-bottom: 4px;
            padding-top: 4px;
            padding-bottom: 4px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-mask-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        /* opacity theme start */

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner,
        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: none !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        /* opacity theme end */

        /* background theme start */
        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-background {
            margin: 8px 0;
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            border-radius: 4px;
            box-shadow: unset !important;
            padding: 12px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-background-inner {
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            padding-left: 6px;
            padding-right: 6px;
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper .immersive-translate-target-translation-theme-background-inner {
            background: unset;
            padding-left: unset;
            padding-right: unset;
        }

        /* background theme end */

        /* vertical css , please remain it in the last one. */
        .immersive-translate-target-translation-vertical-block-wrapper {
            margin: 0px 8px !important;
        }

        .immersive-translate-text {
            font-size: 15px !important;
        }

        .immersive-translate-error-toast {
            position: fixed;
            top: 5%;
            z-index: 99999999;
            left: 0;
            right: 0;
            margin: auto;
            max-width: 300px;
            padding: 16px;
            border-radius: 12px;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        @media all and (min-width: 750px) {
            .immersive-translate-error-toast {
                max-width: 400px;
            }
        }

        .immersive-translate-clickable-button {
            cursor: pointer;
        }

        .immersive-translate-help-button {
            cursor: pointer;
        }

        .immersive-translate-loading-text:before {
            content: "...";
        }

        /* dark mode for loading */

        @media only screen and (prefers-color-scheme: dark) {
            .immersive-translate-loading {
                border: 2px rgba(255, 255, 255, 0.25) solid !important;
                border-top: 2px rgba(255, 255, 255, 1) solid !important;
            }
        }

        .immersive-translate-error-wrapper {
            position: relative;
            display: inline-flex;
            padding: 6px;
            margin: 0 12px;
            white-space: nowrap;
            font-size: 0.9em;
        }

        [lang="zh-CN"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        [lang="zh-TW"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        .immersive-translate-tooltip {
            position: relative;
            display: inline-flex;
            /* little indicater to indicate it's hoverable */
        }

        .immersive-translate-tooltip-content {
            /* here's the magic */
            position: absolute;
            z-index: 100000000000;

            left: 50%;
            bottom: 0;
            transform: translate(-50%, 110%);
            line-height: 1;
            /* and add a small left margin */

            /* basic styles */
            width: max-content;
            max-width: 250px;
            word-wrap: break-word;
            white-space: pre-line;
            padding: 10px;
            border-radius: 10px;
            background: #000c;
            color: #fff;
            text-align: center;
            font-size: 14px;
            display: none;
            /* hide by default */
        }

        .immersive-translate-tooltip:hover .immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip:hover+.immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip-content-table {
            left: unset !important;
            bottom: unset !important;
            transform: translate(-10%, 50%) !important;
        }

        .immersive-translate-tooltip:hover:before {
            display: inline-block;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--bg-2, #fff);
            font-size: 14px;
        }
    </style>
    <style data-id="immersive-translate-user-custom-style">
        :root {

            .immersive-translate-target-inner {
                font-family: inherit;
            }


            .immersive-translate-target-inner {
                font-family: inherit;
            }
        }
    </style>
    <style data-id="immersive-translate-dynamic-injected-css">
        .immersive-translate-target-wrapper[dir='rtl'] {
            text-align: right;
        }

        .immersive-translate-target-wrapper[dir='rtl'] [data-immersive-translate-class-bak*='block-wrapper'] {
            display: block;
        }

        .immersive-translate-target-wrapper {
            word-break: break-word;
            user-select: text;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper[dir='rtl'] {
            display: inline-block;
        }

        [dir='rtl'] .immersive-translate-target-wrapper:not([dir]) {
            text-align: left;
        }

        [imt-state=dual] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            display: block;
        }

        [imt-trans-position=before] .immersive-translate-target-translation-block-wrapper {
            display: block !important;
        }

        [imt-state][data-immersive-translate_rtl] .immersive-translate-target-wrapper {
            display: block !important;
        }
    </style>
</head>

<body epub:type="bodymatter" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
    <section aria-labelledby="c28_1" epub:type="chapter" role="doc-chapter"
        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
        <header data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
            <h1 id="c28_1" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1"><span aria-label="801" epub:type="pagebreak" id="Page_801"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span><span id="c28"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span><span
                    class="chapterNumber"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">28</span><br /><span
                    class="chapterTitle"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalR</span></h1>
        </header>
        <section aria-label="chapter opening" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
            <span id="c28-sec-0001" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
            <aside data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                <div class="top hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <h3 data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                        data-immersive-translate-paragraph="1">WHAT'S IN THIS CHAPTER?<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章包含什么内容？</font>
                            </font>
                        </font>
                    </h3>
                    <ul class="check2" id="c28-list-0001"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <li id="c28-li-0001" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                            data-immersive-translate-paragraph="1">Overview of SignalR<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">SignalR 概述</font>
                                </font>
                            </font>
                        </li>
                        <li id="c28-li-0002" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                            data-immersive-translate-paragraph="1">Creating a SignalR hub<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">创建 SignalR 中心</font>
                                </font>
                            </font>
                        </li>
                        <li id="c28-li-0003" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                            data-immersive-translate-paragraph="1">Creating a SignalR client with HTML and JavaScript
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用 HTML 和 JavaScript 创建
                                        SignalR 客户端</font>
                                </font>
                            </font>
                        </li>
                        <li id="c28-li-0004" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                            data-immersive-translate-paragraph="1">Creating a SignalR .NET client<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">创建 SignalR .NET 客户端</font>
                                </font>
                            </font>
                        </li>
                        <li id="c28-li-0005" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                            data-immersive-translate-paragraph="1">Using groups with SignalR<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用 SignalR 的组功能</font>
                                </font>
                            </font>
                        </li>
                        <li id="c28-li-0006" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                            data-immersive-translate-paragraph="1">Streaming with SignalR<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用 SignalR 进行流式传输</font>
                                </font>
                            </font>
                        </li>
                    </ul>
                    <div class="bottom hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <hr />
                    </div>
                </section>
            </aside>
            <aside data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                <div class="top hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span
                        id="c28-fea-0001" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
                    <h3 id="head-2-249" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                        data-immersive-translate-paragraph="1">CODE DOWNLOADS FOR THIS CHAPTER<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章代码下载</font>
                            </font>
                        </font>
                    </h3>
                    <section data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span
                            id="c28-sec-0003"
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
                        <p id="c28-para-0003" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                            data-immersive-translate-paragraph="1">The source code for this chapter is available on the
                            book page at <code
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a href="http://www.wiley.com">www.wiley.com</a></code>.
                            Click the Downloads link. The code can also be found at <code
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                            in the directory <code
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">3_Web/SignalR</code>.
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的源代码可在书籍页面 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a href="http://www.wiley.com">www.wiley.com</a></code>
                                        上找到。点击下载链接。代码也可以在目录 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">3_Web/SignalR</code>
                                        中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                                        找到。</font>
                                </font>
                            </font>
                        </p>
                        <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                            data-immersive-translate-paragraph="1">The code for this chapter is divided into the
                            following major examples:<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的代码分为以下主要示例：</font>
                                </font>
                            </font>
                        </p>
                        <ul class="check" id="c28-list-0002"
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                            <li id="c28-li-0007" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                                data-immersive-translate-paragraph="1">SignalRSample/ChatServer</li>
                            <li id="c28-li-0008" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                                data-immersive-translate-paragraph="1">SignalRSample/WinAppChatClient</li>
                            <li id="c28-li-0009" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                                data-immersive-translate-paragraph="1">SignalRStreaming</li>
                        </ul>
                        <p id="c28-para-0005" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                            data-immersive-translate-paragraph="1">The major namespace used is <code
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Microsoft.AspNetCore.SignalR</code>.
                            All the projects have nullable reference types enabled.<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">主要使用的命名空间是 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Microsoft.AspNetCore.SignalR</code>
                                        。所有项目都启用了可空引用类型。</font>
                                </font>
                            </font>
                        </p>
                    </section>
                    <div class="bottom hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <hr />
                    </div>
                </section>
            </aside>
        </section>
        <section aria-labelledby="head-2-250" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
            <span id="c28-sec-0004" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
            <h2 id="head-2-250" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">OVERVIEW<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">概述</font>
                    </font>
                </font>
            </h2>
            <p id="c28-para-0006" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">With .NET you can use events to get notifications. You can
                register an event handler method with an event, also known as <i
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">subscribing</i> to an event,
                and as soon as the event is fired from another place, your method gets invoked. Events cannot be used
                with web applications.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用 .NET
                            可以通过事件来获取通知。你可以将事件处理方法与事件关联，也称为订阅事件，一旦事件从其他地方触发，你的方法就会被调用。事件不能用于 Web 应用程序。</font>
                    </font>
                </font>
            </p>
            <p id="c28-para-0007" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1"><span aria-label="802" epub:type="pagebreak" id="Page_802"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>Previous chapters
                covered a lot about web applications and web services. What was common with these applications and
                services is that the request was always started from the client application. The client makes an HTTP
                request and receives a response.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">前几章主要介绍了大量关于 Web 应用程序和 Web
                            服务的内容。这些应用程序和服务有一个共同点，那就是请求总是由客户端应用程序发起。客户端发起 HTTP 请求并接收响应。</font>
                    </font>
                </font>
            </p>
            <p id="c28-para-0008" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">What if the server has some news to tell? There's nothing like
                events that you can subscribe to, or is there? With the web technologies you've seen so far, this can be
                resolved by the client polling for new information. The client has to make a request to the server to
                ask whether new information is available. Depending on the request interval defined, this way of
                communication results in either a high load of requests on the network that just results in “no new
                information is available,” or the actual information is already old by the time the client asks for it.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            如果服务器有一些消息要通知呢？有没有什么像事件可以订阅的东西？使用你目前所见的 Web
                            技术，可以通过客户端轮询新信息来解决这个问题。客户端需要向服务器发起请求，询问是否有新信息可用。根据定义的请求间隔，这种通信方式要么导致网络请求量过高，结果总是“没有新信息”，要么客户端请求时，实际信息已经过时了。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c28-para-0009" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">With clients behind a firewall, when using the HTTP protocol,
                there's no way for the server to initiate a connection to the client. The connection always needs to be
                started from the client side. Because HTTP connections are stateless and clients often can't connect to
                ports other than port 80 or 443, WebSockets can help. WebSockets are initiated with an HTTP request, but
                they're upgraded to a WebSocket connection where the connection stays open. When you use the WebSockets
                protocol, the server can send information to the client over the open connection as soon as the server
                has new information.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在防火墙后的客户端使用 HTTP
                            协议时，服务器无法主动发起与客户端的连接。连接总是需要从客户端端启动。由于 HTTP 连接是无状态的，且客户端通常无法连接到 80 或 443 端口以外的端口，因此 WebSocket
                            可以提供帮助。WebSocket 使用 HTTP 请求发起，但会升级为保持开启状态的 WebSocket 连接。当你使用 WebSocket
                            协议时，一旦服务器有新信息，就可以通过开启的连接将信息发送给客户端。</font>
                    </font>
                </font>
            </p>
            <p id="c28-para-0010" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">SignalR is an ASP.NET Core web technology that offers an easy
                abstraction over WebSockets. Using SignalR is a lot easier than programming using the sockets interface,
                and you get more features right out of the box.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">SignalR 是一种 ASP.NET Core 的 Web
                            技术，它提供了对 WebSocket 的简易抽象。使用 SignalR 比使用套接字接口编程要容易得多，并且你还能直接获得更多开箱即用的功能。</font>
                    </font>
                </font>
            </p>
        </section>
        <section aria-labelledby="head-2-251" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
            <span id="c28-sec-0005" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
            <h2 id="head-2-251" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">CREATING A SIMPLE CHAT USING SIGNALR<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用 SignalR 创建简单聊天</font>
                    </font>
                </font>
            </h2>
            <p id="c28-para-0011" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">SignalR is a technology based on WebSockets but can fall back to
                other options. If WebSockets are not available both on the client and on the server, polling is used
                from the client to continuously check for new data. Nowadays, all browsers and servers support
                WebSockets. However, they can be turned off, and you may have some issues when using proxies. If you
                deploy your web application with Azure App Services, WebSockets are turned off by default because you
                need more resources for WebSockets on the server to support the connection to the client that is kept
                open. With an Azure App Service, you need to explicitly enable WebSockets. Using proxies before your web
                application, you also need to think about support of WebSockets. For example, when you use Azure Front
                Door (<code
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a href="https://azure.microsoft.com/services/frontdoor/">https://azure.microsoft.com/services/frontdoor/</a></code>)
                for load balancing and protection, this service does not support WebSockets (at the time of this
                writing).<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">SignalR 是一种基于 WebSocket
                            的技术，但可以回退到其他选项。如果客户端和服务器都不支持 WebSocket，则客户端会使用轮询来持续检查新数据。如今，所有浏览器和服务器都支持
                            WebSocket。然而，它们可能会被关闭，并且在通过代理使用时可能会遇到一些问题。如果你使用 Azure App Services 部署你的 Web 应用，默认情况下
                            WebSocket 是关闭的，因为服务器需要更多资源来支持与客户端保持打开的连接。使用 Azure App Service 时，你需要显式启用 WebSocket。在 Web
                            应用之前使用代理时，你也需要考虑 WebSocket 的支持情况。例如，当你使用 Azure Front Door（ <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a href="https://azure.microsoft.com/services/frontdoor/">https://azure.microsoft.com/services/frontdoor/</a></code>
                            ）进行负载均衡和保护时，该服务不支持 WebSocket（截至本文写作时）。</font>
                    </font>
                </font>
            </p>
            <p id="c28-para-0012" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">The first SignalR sample application is a chat application, which
                is easy to create with SignalR. With this application, multiple clients can be started to communicate
                with each other via the SignalR hub (see <a href="#c28-fig-0001" id="R_c28-fig-0001"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Figure 28-1</a>). When one of
                the client applications sends a message, all the connected clients receive this message in turn.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">第一个 SignalR 示例应用程序是一个聊天应用程序，使用 SignalR
                            很容易创建。通过这个应用程序，可以启动多个客户端通过 SignalR 中心进行相互通信（见图 28-1）。当一个客户端应用程序发送消息时，所有连接的客户端会依次接收到这个消息。
                        </font>
                    </font>
                </font>
            </p>
            <figure data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                <img alt="Schematic illustration of creating a simple chat using signal R." class="center"
                    src="images/c28f001.png" />
                <figcaption data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span class="figureLabel"
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a
                                href="#R_c28-fig-0001" id="c28-fig-0001" role="doc-backlink"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><b
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                                    data-immersive-translate-paragraph="1">FIGURE 28-1<font
                                        class="notranslate immersive-translate-target-wrapper"
                                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">
                                              </font>
                                        <font
                                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                            data-immersive-translate-translation-element-mark="1">
                                            <font
                                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                data-immersive-translate-translation-element-mark="1">图 28-1</font>
                                        </font>
                                    </font></b></a></span></p>
                </figcaption>
            </figure>
            <p id="c28-para-0013" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">The server application is started as an empty ASP.NET Core web
                application. One of the clients is created with HTML and JavaScript, and the other client application is
                a Windows app that uses WinUI.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">服务器应用程序作为一个空的 ASP.NET Core Web
                            应用程序启动。其中一个客户端使用 HTML 和 JavaScript 创建，另一个客户端应用程序是一个使用 WinUI 的 Windows 应用程序。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span id="c28-sec-0006"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
                <h3 id="head-3-528" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">Creating a Hub<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建中心</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">The empty ASP.NET Core web project is named <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatServer</code>. After
                    you create the project, add a new class named <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatHub</code> to the
                    <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hubs</code> folder. The
                    main functionality of SignalR is defined with the hub. The hub is indirectly invoked by the clients,
                    and in turn the clients are called. The class <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatHub</code> derives
                    from the base class <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code> to get the
                    needed hub functionality. The method <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Send</code> is defined to
                    be invoked by the client applications sending a message to the other clients. You can use any method
                    name with any number of parameters. The client code just needs to match the method name as well as
                    the parameters. To send a message to the clients, the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Clients</code> property
                    of the <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code> class
                    is used. The <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Clients</code> property
                    returns an object that implements the interface <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IHubCallerClients</code>.
                    This interface allows you to send messages to specific clients or to all connected clients. To
                    return a message to just a single client, you can use the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Client</code> method to
                    pass a connection identifier. The sample code sends a message to all clients using the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">All</code> property. The
                    <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">All</code> property
                    returns an <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IClientProxy</code>.
                    <span aria-label="803" epub:type="pagebreak" id="Page_803" role="doc-pagebreak"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span><code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IClientProxy</code>
                    defines the method <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SendAsync</code> to
                    invoke a method within the client. The method invoked is the first parameter, which is the method
                    name. The <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SendAsync</code> method
                    is overloaded to allow passing up to 10 arguments to the client method. In case you have more than
                    10, an overload allows passing an object array. With the sample code, the method name defined is
                    <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">BroadcastMessage</code>,
                    and two string parameters—the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">name</code> and the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">message</code>
                    —are passed to this method (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/Hubs/ChatHub.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">空的 ASP.NET Core Web 项目命名为 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatServer</code>
                                。创建项目后，在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hubs</code>
                                文件夹中添加一个名为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatHub</code>
                                的新类。SignalR 的主要功能通过 hub 定义。客户端间接调用 hub，而 hub 反过来调用客户端。类 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatHub</code>
                                继承自基类 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code>
                                以获取所需的 hub 功能。方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Send</code>
                                被定义为由客户端应用程序调用，以向其他客户端发送消息。你可以使用任何方法名和任何数量的参数。客户端代码只需匹配方法名以及参数即可。要向客户端发送消息，使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code> 类的
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Clients</code>
                                属性。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Clients</code>
                                属性返回一个实现接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IHubCallerClients</code>
                                的对象。该接口允许你向特定客户端或所有已连接客户端发送消息。要向单个客户端返回消息，可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Client</code>
                                方法传递连接标识符。示例代码使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">All</code>
                                属性向所有客户端发送消息。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">All</code>
                                属性返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IClientProxy</code>
                                。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IClientProxy</code>
                                定义了方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SendAsync</code>
                                ，用于在客户端中调用方法。被调用的方法是第一个参数，即方法名。 第 16 个方法被重载，允许向客户端方法传递最多 10 个参数。如果你有超过 10
                                个，一个重载方法允许传递一个对象数组。在示例代码中，定义的方法名称是第 17 个，并且传递了两个字符串参数——第 18 个和第 19 个（代码文件第 20 个）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0001"><code>public class ChatHub: Hub</code>
<code>{</code>
<code>  public void Send(string name, string message) =&gt;</code>
<code>    Clients.All.BroadcastMessage(</code>
<code>      HttpUtility.HtmlEncode(name), </code>
<code>      HttpUtility.HtmlEncode(message));</code>
<code>}</code>
<code> </code></pre>
                <aside data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <div class="top hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <p id="c28-para-0016" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">NOTE</b> <i
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">With the</i>
                            <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatHub</code>
                            <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">class, before
                                returning the data that is received from the client, it is HTML-encoded. Otherwise, the
                                client could send HTML-formatted data or even JavaScript content—for example, to
                                redirect all users receiving the data to another website. Read <a href="c20.xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Chapter
                                    20</a>, “Security,” for security issues with web applications.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：使用 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatHub</code>
                                        类时，在将客户端接收到的数据返回之前，会进行 HTML 编码。否则，客户端可能会发送 HTML 格式化的数据，甚至 JavaScript
                                        内容——例如，将所有接收数据的使用者重定向到另一个网站。有关 Web 应用程序的安全问题，请阅读第 20 章“安全”。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">To use SignalR, the interfaces for SignalR need to be
                    registered with the dependency injection container. You do this in the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ConfigureServices</code>
                    method of the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Startup</code>
                    class—invoking the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddSignalR</code>
                    extension method for the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IServiceCollection</code>
                    interface (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要使用 SignalR，需要将 SignalR
                                的接口注册到依赖注入容器中。你可以在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ConfigureServices</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Startup</code>
                                方法中完成——调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IServiceCollection</code>
                                接口的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddSignalR</code>
                                扩展方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/Startup.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0002"><code>public class Startup</code>
<code>{</code>
<code>  public void ConfigureServices(IServiceCollection services)</code>
<code>  {</code>
<code>    <b>services.AddSignalR();</b></code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">With the configuration of the middleware in the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Configure</code> method,
                    SignalR needs to be mapped with the endpoint configuration. When you use the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">MapHub</code> extension
                    method of the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IEndpointRouteBuilder</code>,
                    you specify the class type for the hub (which needs to derive from the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code> class) and the
                    link to use this route. With an overload of the method, you can also specify options for the
                    underlying WebSockets (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Configure</code>
                                方法中的中间件配置下，SignalR 需要与端点配置进行映射。当你使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">MapHub</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IEndpointRouteBuilder</code>
                                扩展方法时，你需要指定用于 Hub 的类类型（该类需要继承自 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code>
                                类）以及使用此路由的链接。通过方法的重载，你也可以指定底层 WebSocket 的选项（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/Startup.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0003"><code>app.UseEndpoints(endpoints =&gt;</code>
<code>{</code>
<code>  <b>endpoints.MapHub&lt;ChatHub&gt;("/chat");</b></code>
<code>  //…</code>
<code>  endpoints.Map("/", async context =&gt;</code>
<code>  {</code>
<code>    StringBuilder sb = new();</code>
<code>    sb.Append("&lt;h1&gt;SignalR Sample&lt;/h1&gt;");</code>
<code>    sb.Append("&lt;div&gt;Open &lt;a href='/ChatWindow.html'&gt;ChatWindow&lt;/a&gt; " +</code>
<code>      "for communication&lt;/div&gt;");</code>
<code>    await context.Response.WriteAsync(sb.ToString());</code>
<code>  });</code>
<code>});</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span aria-label="804"
                        epub:type="pagebreak" id="Page_804" role="doc-pagebreak"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span></p>
                <aside data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <div class="top hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <p id="c28-para-0020" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">NOTE</b> <i
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">For serving the
                                HTML client from the same web server as the SignalR server, the extension method</i>
                            <code
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">UseStaticFiles</code>
                            <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">needs to be added
                                to the middleware pipeline, and the folder</i> <code
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">wwwroot</code> <i
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">needs to be
                                created.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 若要从与 SignalR 服务器相同的 Web
                                        服务器提供 HTML 客户端，需要在中间件管道中添加扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">UseStaticFiles</code>
                                        ，并创建文件夹 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">wwwroot</code>
                                        。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
            <section data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span id="c28-sec-0009"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
                <h3 id="head-3-529" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">Creating a Client with HTML and JavaScript<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 HTML 和 JavaScript 创建客户端</font>
                        </font>
                    </font>
                </h3>
                <p id="c28-para-0021" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">The previous version of SignalR included a JavaScript library
                    with jQuery extensions. At that time, nearly every website was using jQuery to access the DOM
                    elements of the HTML page. The ASP.NET Core version of the SignalR library doesn't have a dependency
                    on any other scripting library. All you need is a JavaScript file that you can retrieve from content
                    delivery network (CDN) servers. With the sample application, <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman</code> is used to
                    retrieve the JavaScript file and was introduced in <a href="c24.xhtml"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Chapter 24</a>, “ASP.NET
                    Core.”<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">之前的 SignalR 版本包含一个带有 jQuery 扩展的
                                JavaScript 库。当时，几乎每个网站都在使用 jQuery 来访问 HTML 页面的 DOM 元素。SignalR 的 ASP.NET Core
                                版本不依赖于任何其他脚本库。你只需要一个可以从内容分发网络（CDN）服务器获取的 JavaScript 文件。在示例应用程序中， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman</code>
                                用于获取 JavaScript 文件，并在第 24 章“ASP.NET Core”中介绍。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">To install <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman</code> as a tool
                    for the project, you need to create a tool manifest file and add <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman</code> to the
                    manifest file:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要将 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman</code>
                                作为项目工具安装，需要创建一个工具清单文件并将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman</code>
                                添加到清单文件中：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0004"><code>&gt; dotnet new tool-manifest</code>
<code>&gt; dotnet tool install microsoft.web.library.manager.cli</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">After this tool is installed, you can create a <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman.json</code>
                    configuration file using <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman init</code> and
                    add the JavaScript library with the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman install</code>
                    command. Be aware that the SignalR JavaScript library is not available at the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman</code>
                    -default CDN provider CDNJS, but it is available at the CDN server from Node (<code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a href="https://unpkg.com">https://unpkg.com</a></code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">安装此工具后，您可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman init</code>
                                创建一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman.json</code>
                                配置文件，并使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman install</code>
                                命令添加 JavaScript 库。请注意，SignalR JavaScript 库不可在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">libman</code>
                                -默认的 CDN 提供商 CDNJS 上获取，但可以在 Node 的 CDN 服务器上获取（ <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a href="https://unpkg.com">https://unpkg.com</a></code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0005"><code>&gt; dotnet libman init</code>
<code>&gt; dotnet libman install @microsoft/signalr@latest --provider unpkg </code>
<code>  --destination wwwroot/lib/signalr --files dist/browser/signalr.js </code>
<code>  --files dist/browser/signalr.min.js</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">For the HTML client, two input fields and a button are
                    defined to allow the user to enter a name and a message and then click a button to send the message
                    to the SignalR server. The messages received will be displayed in the output element (code file
                    <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/wwwroot/ChatWindow.html</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">对于 HTML
                                客户端，定义了两个输入字段和一个按钮，允许用户输入名称和消息，然后点击按钮将消息发送到 SignalR 服务器。接收到的消息将在输出元素中显示（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/wwwroot/ChatWindow.html</code>
                                ）。</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0006"><code>&lt;label for="name"&gt;Name:&lt;/label&gt;</code>
<code>&lt;input type="text" id="name"/&gt;</code>
<code>&lt;br/&gt;</code>
<code>&lt;label for="message"&gt;Message:&lt;/label&gt;</code>
<code>&lt;input type="text" id="message"/&gt;</code>
<code>&lt;br/&gt;</code>
<code>&lt;input id="sendButton" type="button" value="send"/&gt;</code>
<code>&lt;p/&gt;</code>
<code>&lt;output id="output"&gt;&lt;/output&gt;</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">The first script element references the JavaScript file from
                    the SignalR library. Remember to use the minified file for production. When the DOM tree of the HTML
                    file is loaded, a connection to the Chat server is created. When you use <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">connection.on</code>, you
                    define what should happen when a message arrives from the SignalR server. The first parameter is the
                    name of the method used when calling the proxy in the server except the casing changes from C#
                    Pascal casing (<code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">BroadcaseMessage</code>)
                    to JavaScript camel casing (<code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">broadcastMessage</code>).
                    With the second parameter, a function is defined that has the same number of parameters as are sent
                    from the server. When a message arrives, the content of the output element changes to include this
                    message. After registering to receive this event, the connection to the SignalR server is started by
                    invoking the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">start</code> function.
                    When the connection completes successfully, the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">then</code> function
                    defines what's next. Here, an event listener is assigned to the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">click</code> <span
                        aria-label="805" epub:type="pagebreak" id="Page_805" role="doc-pagebreak"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>event of the
                    button to send the message to the SignalR server. The method that is invoked with the SignalR server
                    is defined with the first parameter of the invoke function—
                    <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">send</code> in the
                    sample code—that's the same name as the method that is defined in the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatHub</code> (just the
                    casing differs). Again, the same number of arguments are used (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/wwwroot/ChatWindow.html</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">第一个 script 元素引用了 SignalR 库的
                                JavaScript 文件。记住在生产环境中使用压缩文件。当 HTML 文件的 DOM 树加载完成后，会创建与 Chat 服务器的连接。当你使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">connection.on</code>
                                时，你定义了当从 SignalR 服务器收到消息时应该发生什么。第一个参数是调用服务器端代理时使用的方法名称，除了大小写从 C#的 Pascal 大小写（ <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">BroadcaseMessage</code>
                                ）变为 JavaScript 的 camel 大小写（ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">broadcastMessage</code>
                                ）。使用第二个参数定义一个函数，该函数的参数数量与从服务器发送的参数数量相同。当消息到达时，输出元素的 内容会变为包含此消息。在注册接收此事件后，通过调用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">start</code>
                                函数启动与 SignalR 服务器的连接。当连接成功完成后， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">then</code>
                                函数定义了接下来要做什么。在这里，为按钮的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">click</code>
                                事件分配了一个事件监听器，用于向 SignalR 服务器发送消息。 使用 SignalR 服务器调用的方法是通过 invoke 函数的第一个参数定义的——示例代码中的
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">send</code>
                                ，它与 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatHub</code>
                                中定义的方法名称相同（只是大小写不同）。同样，使用相同数量的参数（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/wwwroot/ChatWindow.html</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0007"><code>&lt;script src="lib/signalr/dist/browser/signalr.min.js"&gt;&lt;/script&gt;</code>
<code>&lt;script&gt;</code>
<code>  document.addEventListener("DOMContentLoaded", function () {</code>
<code>    <b>const connection = new signalR.HubConnection('/chat');</b></code>
<code>    <b>connection.on('broadcastMessage', (name, message) =&gt; {</b></code>
<code>      console.log(message);</code>
<code>      document.getElementById('output').innerHTML += </code>
<code>        `message from ${name}: ${message}&lt;br/&gt;`;</code>
<code>    });</code>
<code> </code>
<code>    <b>connection.start()</b>.then(function () {</code>
<code>      document.getElementById('sendButton')</code>
<code>        .addEventListener('click', function () {</code>
<code>          let name = document.getElementById('name').value;</code>
<code>          let message = document.getElementById('message').value;</code>
<code> </code>
<code>          <b>connection.invoke('send', name, message);</b></code>
<code>        });</code>
<code>      });</code>
<code>    });</code>
<code>&lt;/script&gt;</code></pre>
                <p id="c28-para-0026" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">When you run the application, you can open multiple browser
                    windows—even using different browser applications—and you can enter names and messages for a chat
                    (see <a href="#c28-fig-0002" id="R_c28-fig-0002"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Figure 28-2</a>).<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                运行应用程序时，您可以打开多个浏览器窗口——即使使用不同的浏览器应用程序——并且可以输入聊天名称和消息（见图 28-2）。</font>
                        </font>
                    </font>
                </p>
                <figure data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <img alt="Snapshot of the details of a chat client." class="center" src="images/c28f002.png" />
                    <figcaption data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span
                                class="figureLabel"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a
                                    href="#R_c28-fig-0002" id="c28-fig-0002" role="doc-backlink"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><b
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                                        data-immersive-translate-paragraph="1">FIGURE 28-2<font
                                            class="notranslate immersive-translate-target-wrapper"
                                            data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                            <font class="notranslate"
                                                data-immersive-translate-translation-element-mark="1">  </font>
                                            <font
                                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                                data-immersive-translate-translation-element-mark="1">
                                                <font
                                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                    data-immersive-translate-translation-element-mark="1">图 28-2</font>
                                            </font>
                                        </font></b></a></span></p>
                    </figcaption>
                </figure>
                <p id="c28-para-0027" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">When you use the Microsoft Edge Developer Tools (press F12
                    while Microsoft Edge is open), you can use network monitoring to see the upgrade from the HTTP
                    protocol to the WebSocket protocol, as shown in <a href="#c28-fig-0003" id="R_c28-fig-0003"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Figure 28-3</a>.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 Microsoft Edge 开发者工具（在
                                Microsoft Edge 打开时按 F12），您可以使用网络监控查看从 HTTP 协议升级到 WebSocket 协议的过程，如图 28-3 所示。</font>
                        </font>
                    </font><span aria-label="806" epub:type="pagebreak" id="Page_806" role="doc-pagebreak"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span></p>
                <figure data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <img alt="Snapshot of creating signal R .net client." class="center" src="images/c28f003.png" />
                    <figcaption data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span
                                class="figureLabel"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a
                                    href="#R_c28-fig-0003" id="c28-fig-0003" role="doc-backlink"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><b
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                                        data-immersive-translate-paragraph="1">FIGURE 28-3<font
                                            class="notranslate immersive-translate-target-wrapper"
                                            data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                            <font class="notranslate"
                                                data-immersive-translate-translation-element-mark="1">  </font>
                                            <font
                                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                                data-immersive-translate-translation-element-mark="1">
                                                <font
                                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                    data-immersive-translate-translation-element-mark="1">图 28-3</font>
                                            </font>
                                        </font></b></a></span></p>
                    </figcaption>
                </figure>
            </section>
            <section data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span id="c28-sec-0010"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
                <h3 id="head-3-530" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">Creating SignalR .NET Clients<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建 SignalR .NET 客户端</font>
                        </font>
                    </font>
                </h3>
                <p id="c28-para-0028" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">The sample .NET client application to use the SignalR server
                    is a WinUI 3 app. The functionality is similar to the HTML/JavaScript application shown earlier.
                    Check the readme file of the downloadable code to see what's needed to build the application. NuGet
                    packages that need to be added are <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Microsoft.AspNetCore.SignalR.Client</code>
                    (the SignalR client library for .NET), <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Microsoft.Extensions.Hosting</code>
                    (for the DI container), and <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Microsoft.Toolkit.Mvvm</code>
                    (an MVVM library from Microsoft; see more about MVVM in <a href="c30.xhtml"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Chapter 30</a>, “Patterns
                    with XAML Apps”).<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">用于使用 SignalR 服务器的示例.NET 客户端应用程序是一个
                                WinUI 3 应用。其功能与之前展示的 HTML/JavaScript 应用程序相似。请查看可下载代码的 readme 文件，了解构建应用程序所需的条件。需要添加的
                                NuGet 包有 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Microsoft.AspNetCore.SignalR.Client</code>
                                （.NET 的 SignalR 客户端库）、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Microsoft.Extensions.Hosting</code>
                                （用于依赖注入容器），以及 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Microsoft.Toolkit.Mvvm</code>
                                （来自 Microsoft 的 MVVM 库；更多关于 MVVM 的内容请参考第 30 章“XAML 应用中的模式”）。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">The user interface of the Windows application defines two
                    <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">TextBox</code>
                    es, two <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Button</code>
                    s, and one <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ListBox</code> element to
                    enter the name and message, to connect to the service hub, and to show a list of received messages,
                    respectively (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/Views/ChatUC.xaml</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">Windows 应用程序的用户界面定义了两个 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">TextBox</code>
                                元素、两个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Button</code>
                                元素和一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ListBox</code>
                                元素，分别用于输入名称和消息、连接到服务枢纽以及显示接收到的消息列表（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/Views/ChatUC.xaml</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0008"><code>&lt;TextBox Header="Name" Text="{x:Bind ViewModel.Name, Mode=TwoWay}" </code>
<code>  Grid.Row="0" Grid.Column="0"/&gt;</code>
<code>&lt;TextBox Header="Message" Text="{x:Bind ViewModel.Message, Mode=TwoWay}" </code>
<code>  Grid.Row="1" Grid.Column="0"/&gt;</code>
<code>&lt;StackPanel Orientation="Vertical" Grid.Column="1" Grid.RowSpan="2"&gt;</code>
<code>  &lt;Button Content="Connect" Command="{x:Bind ViewModel.ConnectCommand}"/&gt;</code>
<code>  &lt;Button Content="Send" </code>
<code>    Command="{x:Bind ViewModel.SendCommand, Mode=OneTime}"/&gt;</code>
<code>&lt;/StackPanel&gt;</code>
<code>&lt;ListBox ItemsSource="{x:Bind ViewModel.Messages, Mode=OneWay}" Grid.Row="2" </code>
<code>  Grid.ColumnSpan="2" Margin="12"/&gt;</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1"><span aria-label="807" epub:type="pagebreak" id="Page_807"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>With the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">App</code> class of the
                    application, the DI container is configured as shown in the following code snippet. Here, services
                    are registered for showing a dialog (<code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">DialogService</code>) to
                    have a central place for the configuration for the service links (<code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">UrlService</code>) and
                    for the view models that are used with the application (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/App.xaml.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用应用程序的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">App</code>
                                类，依赖注入容器配置如下所示代码片段。在此处，为显示对话框（ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">DialogService</code>
                                ）注册了服务，以便为服务链接（ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">UrlService</code>
                                ）和应用程序使用的视图模型提供一个中央配置位置（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/App.xaml.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0009"><code>public App()</code>
<code>{</code>
<code>  this.InitializeComponent();</code>
<code>  _host = Host.CreateDefaultBuilder()</code>
<code>    .ConfigureServices(services =&gt;</code>
<code>    {</code>
<code>      services.AddScoped&lt;IDialogService, DialogService&gt;();</code>
<code>      services.AddScoped&lt;UrlService&gt;();</code>
<code>      services.AddScoped&lt;ChatViewModel&gt;();</code>
<code>      services.AddScoped&lt;GroupChatViewModel&gt;();</code>
<code>    }).Build();</code>
<code>}</code>
<code> </code>
<code>private IHost _host;</code>
<code> </code>
<code>internal IServiceProvider Services =&gt; _host.Services;</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">UrlService</code> class
                    that is registered with the DI container contains the URL addresses to the chat server. You need to
                    change the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">BaseUri</code> to the
                    address that is shown when starting your SignalR server (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/Services/UrlService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">注册到依赖注入容器的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">UrlService</code>
                                类包含了聊天服务器的 URL 地址。你需要将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">BaseUri</code>
                                更改为启动 SignalR 服务器时显示的地址（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/Services/UrlService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0010"><code>public class UrlService</code>
<code>{</code>
<code>  private string BaseUri = "https://localhost:5001/";</code>
<code>  public string ChatAddress =&gt; $"{BaseUri}/chat";</code>
<code>  public string GroupAddress =&gt; $"{BaseUri}/groupchat";</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">Within the code-behind file of the user control, the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatViewModel</code> is
                    assigned to the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ViewModel</code> property
                    using the DI container (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/Views/ChatUC.xaml.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在用户控件的后台代码文件中，使用依赖注入容器将 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatViewModel</code>
                                分配给 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ViewModel</code>
                                属性（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/Views/ChatUC.xaml.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0011"><code>public sealed partial class ChatUC : UserControl</code>
<code>{</code>
<code>  public ChatUC()</code>
<code>  {</code>
<code>    this.InitializeComponent();</code>
<code> </code>
<code>    if (Application.Current is App app)</code>
<code>    {</code>
<code>      _scope = app.Services.CreateScope();</code>
<code>      ViewModel = _scope.ServiceProvider.GetRequiredService&lt;ChatViewModel&gt;();</code>
<code>    }</code>
<code>    else</code>
<code>    {</code>
<code>      throw new InvalidOperationException("Application.Current is not App");</code>
<code>    }            </code>
<code>  }</code>
<code> </code>
<code>  private readonly IServiceScope? _scope;</code>
<code>  public ChatViewModel ViewModel { get; private set; }</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1"><span aria-label="808" epub:type="pagebreak" id="Page_808"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>The hub-specific
                    code is implemented in the class <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatViewModel</code>.
                    First, take a look at the bound properties and commands. The property <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Name</code> is bound to
                    enter the chat name and the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Message</code> property
                    to enter the message. The <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ConnectCommand</code>
                    property maps to the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnConnect</code> method
                    to initiate the connection to the server; the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SendCommand</code>
                    property maps to the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnSendMessage</code>
                    method to send a chat message (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/ChatViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">特定于 Hub 的代码实现在类 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatViewModel</code>
                                中。首先，查看绑定的属性和命令。属性 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Name</code>
                                用于输入聊天名称，属性 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Message</code>
                                用于输入消息。属性 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ConnectCommand</code>
                                映射到 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnConnect</code>
                                方法以初始化与服务器的连接；属性 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SendCommand</code>
                                映射到 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnSendMessage</code>
                                方法以发送聊天消息（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/ChatViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0012"><code>public sealed class ChatViewModel</code>
<code>{</code>
<code>  private readonly IDialogService _dialogService;</code>
<code>  private readonly UrlService _urlService;</code>
<code> </code>
<code>  public ChatViewModel(IDialogService dialogService, UrlService urlService)</code>
<code>  {</code>
<code>    _dialogService = dialogService;</code>
<code>    _urlService = urlService;</code>
<code> </code>
<code>    ConnectCommand = new RelayCommand(OnConnect);</code>
<code>    SendCommand = new RelayCommand(OnSendMessage);</code>
<code>  }</code>
<code> </code>
<code>  public string Name { get; set; }</code>
<code>  public string Message { get; set; }</code>
<code> </code>
<code>  public ObservableCollection&lt;string&gt; Messages { get; } =</code>
<code>    new ObservableCollection&lt;string&gt;();</code>
<code>  public RelayCommand SendCommand { get; }</code>
<code>  public RelayCommand ConnectCommand { get; }</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnConnect</code> method
                    initiates the connection to the server. You can create a <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubConnection</code> with
                    the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubConnectionBuilder</code>.
                    This builder uses a fluent API for its configuration. In the sample code, you can see the URL to the
                    server first configured with the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">WithUrl</code> method.
                    After the configuration is done, the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Build</code> method of
                    the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubConnectionBuilder</code>
                    creates a <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubConnection</code>. To
                    register with messages that are returned from the server, the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">On</code> method is
                    invoked. The first parameter passed to the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">On</code> method defines
                    the method name that is called by the server; the second parameter defines a delegate to the method
                    that is invoked. The method <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnMessageReceived</code>
                    has the parameters specified with the generic parameter arguments of the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">On</code> method: two
                    strings. To finally initiate the connection, the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">StartAsync</code> method
                    on the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubConnection</code>
                    instance is invoked to connect to the SignalR server (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/ChatViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnConnect</code>
                                方法初始化与服务器连接。您可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubConnection</code>
                                创建一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubConnectionBuilder</code>
                                。这个构建器使用流畅的 API 进行配置。在示例代码中，您首先使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">WithUrl</code>
                                方法配置服务器的 URL。配置完成后， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubConnectionBuilder</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Build</code>
                                方法创建一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubConnection</code>
                                。要注册接收服务器返回的消息，会调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">On</code>
                                方法。传递给 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">On</code>
                                方法的第一个参数定义了服务器调用的方法名；第二个参数定义了被调用的方法委托。方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnMessageReceived</code>
                                的参数使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">On</code>
                                方法的泛型参数参数指定：两个字符串。最后，通过调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubConnection</code>
                                实例上的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">StartAsync</code>
                                方法来连接 SignalR 服务器（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/ChatViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0013"><code>private HubConnection _hubConnection;</code>
<code> </code>
<code>public async void OnConnect()</code>
<code>{</code>
<code>  await CloseConnectionAsync();</code>
<code>  <b>_hubConnection = new HubConnectionBuilder()</b></code>
<code>    <b>.WithUrl(_urlService.ChatAddress)</b></code>
<code>    <b>.Build();</b></code>
<code> </code>
<code>  _hubConnection.Closed += HubConnectionClosed;</code>
<code>  <b>_hubProxy.On&lt;string, string&gt;("BroadcastMessage", OnMessageReceived);</b></code>
<code> </code>
<code>  try</code>
<code>  {<span aria-label="809" epub:type="pagebreak" id="Page_809" role="doc-pagebreak"></span></code>
<code>    <b>await _hubConnection.StartAsync();</b></code>
<code>    <b>await _dialogService.ShowMessageAsync("Client connected");</b></code>
<code>  }</code>
<code>  catch (Exception ex)</code>
<code>  {</code>
<code>    _dialogService.ShowMessage(ex.Message);</code>
<code>  }</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <div class="top hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <p id="c28-para-0036" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">NOTE</b> <i
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalR supports
                                both JSON and the MessagePack protocol (see</i> <code
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a href="https://msgpack.org">https://msgpack.org</a></code><i
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">). When you use
                                .NET clients, MessagePack has its advantages because it is more compact. To use
                                MessagePack, add the NuGet package</i> <code
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Microsoft.AspNetCore.SignalR.Protocols.MessagePack</code>
                            <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">and invoke the</i>
                            <code
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddMessagePackProtocol</code>
                            <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">method with the
                                configuration of the hub connection.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 SignalR 支持 JSON 和
                                        MessagePack 协议（见 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a href="https://msgpack.org">https://msgpack.org</a></code>
                                        ）。当您使用 .NET 客户端时，MessagePack 具有优势，因为它更紧凑。要使用 MessagePack，请添加 NuGet 包 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Microsoft.AspNetCore.SignalR.Protocols.MessagePack</code>
                                        ，并使用 hub 连接配置调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddMessagePackProtocol</code>
                                        方法。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">Sending messages to SignalR requires only calls to the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SendAsync</code> method
                    of the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubConnection</code>. The
                    first parameter is the name of the method that should be invoked by the server; the following
                    parameters are the parameters of the method on the server (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/ChatViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">向 SignalR 发送消息只需要调用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SendAsync</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubConnection</code>
                                方法。第一个参数是服务器应调用的方法名称；后续参数是服务器上该方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/ChatViewModel.cs</code>
                                ）的参数：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0014"><code>Public async void OnSendMessage()</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    <b>_hubConnection.SendAsync("Send", Name, Message);</b></code>
<code>  }</code>
<code>  catch (Exception ex)</code>
<code>  {</code>
<code>    await _dialogService.ShowMessageAsync(ex.Message);</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">When receiving a message, the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnMessageReceived</code>
                    method is invoked. The <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Messages</code> property
                    is an <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ObservableCollection</code>
                    class to immediately update the user interface when a message arrives (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/ChatViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">接收消息时，会调用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnMessageReceived</code>
                                方法。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Messages</code>
                                属性是一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ObservableCollection</code>
                                类，用于在消息到达时立即更新用户界面（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/ChatViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0015"><code>public async void OnMessageReceived(string name, string message)</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    Messages.Add($"{name}: {message}");</code>
<code>  }</code>
<code>  catch (Exception ex)</code>
<code>  {</code>
<code>    await _dialogService.ShowMessageAsync(ex.Message);</code>
<code>  }</code>
<code>}</code></pre>
                <p id="c28-para-0039" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">When you run the application, you can receive and send
                    messages from the Windows app client, as shown in <a href="#c28-fig-0004" id="R_c28-fig-0004"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Figure 28-4</a>. You can
                    also open the web page simultaneously and communicate between them.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">运行应用程序时，你可以从 Windows
                                应用客户端接收和发送消息，如图 28-4 所示。你也可以同时打开网页并在它们之间进行通信。</font>
                        </font>
                    </font><span aria-label="810" epub:type="pagebreak" id="Page_810" role="doc-pagebreak"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span></p>
                <figure data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <img alt="Snapshot of typing the name and message of the client." class="center"
                        src="images/c28f004.png" />
                    <figcaption data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span
                                class="figureLabel"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a
                                    href="#R_c28-fig-0004" id="c28-fig-0004" role="doc-backlink"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><b
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                                        data-immersive-translate-paragraph="1">FIGURE 28-4<font
                                            class="notranslate immersive-translate-target-wrapper"
                                            data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                            <font class="notranslate"
                                                data-immersive-translate-translation-element-mark="1">  </font>
                                            <font
                                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                                data-immersive-translate-translation-element-mark="1">
                                                <font
                                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                    data-immersive-translate-translation-element-mark="1">图 28-4</font>
                                            </font>
                                        </font></b></a></span></p>
                    </figcaption>
                </figure>
            </section>
        </section>
        <section aria-labelledby="head-2-252" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
            <span id="c28-sec-0012" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
            <h2 id="head-2-252" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">GROUPING CONNECTIONS<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">分组连接</font>
                    </font>
                </font>
            </h2>
            <p id="c28-para-0040" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">Usually, you don't want to communicate among all clients.
                Instead, you want to communicate among a group of clients. There's support out of the box for such a
                scenario with SignalR.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            通常情况下，你不需要在所有客户端之间进行通信，而是希望在客户端组之间进行通信。SignalR 提供了开箱即用的支持来处理这种场景。</font>
                    </font>
                </font>
            </p>
            <p id="c28-para-0041" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">In this section, you add another chat hub with grouping
                functionality and have a look at other options that are possible using SignalR hubs. The Windows app
                client application is extended to enter groups and send a message to a selected group.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在本节中，你将添加一个具有分组功能的聊天中心，并了解使用 SignalR
                            中心可以实现的其他选项。Windows 应用客户端应用程序被扩展以加入群组并向选定的群组发送消息。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span id="c28-sec-0013"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
                <h3 id="head-3-531" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">Extending the Hub with Groups<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">扩展中心以支持群组</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">To support a group chat, you create the class <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">GroupChatHub</code>. With
                    the previous hub, you saw how to use the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SendAsync</code> method
                    to define the message that is sent to the clients. Instead of using this method, you can also create
                    a custom interface, as shown in the following code snippet. This interface is used as a generic
                    parameter with the base class <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code> (code file
                    <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/Hubs/GroupChatHub.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了支持群组聊天，你创建了类 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">GroupChatHub</code>
                                。在之前的中心中，你看到了如何使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SendAsync</code>
                                方法来定义发送给客户端的消息。除了使用这个方法之外，你也可以创建一个自定义接口，如下面的代码片段所示。这个接口被用作基类 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/Hubs/GroupChatHub.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0016"><code>public interface IGroupClient</code>
<code>{</code>
<code>  Task MessageToGroup(string groupName, string name, string message);</code>
<code>}</code>
<code> </code>
<code>public class GroupChatHub: Hub&lt;IGroupClient&gt;</code>
<code>{</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">
                    <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddGroup</code> and
                    <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">LeaveGroup</code> are
                    methods defined to be called by the client. When you register the group, the client sends a group
                    name with the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddGroup</code> method.
                    The <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code> class
                    defines a <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Groups</code>
                    property where connections to groups can be registered. The <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Groups</code> property of
                    the generic <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code>
                    class returns <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IGroupManager</code>.
                    This interface defines two methods: <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddToGroupAsync</code>
                    and <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">RemoveFromGroupAsync</code>.
                    Both methods need a group name and a connection identifier to add or remove the specified connection
                    to the group. The connection identifier is a unique identifier associated with a client connection.
                    The client connection identifier—as well as other information about the client—can be accessed with
                    the <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Context</code>
                    property of the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code> class. The
                    following code snippet invokes the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddToGroupAsync</code>
                    method of the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IGroupManager</code> to
                    register a group with the connection, and it invokes the <span aria-label="811"
                        epub:type="pagebreak" id="Page_811" role="doc-pagebreak"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
                    <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">RemoveFromGroupAsync</code>
                    method to unregister a group (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/Hubs/GroupChatHub.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddGroup</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">LeaveGroup</code>
                                是定义供客户端调用的方法。当您注册组时，客户端通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddGroup</code>
                                方法发送组名。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code>
                                类定义了一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Groups</code>
                                属性，用于注册对组的连接。泛型 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code> 类的
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Groups</code>
                                属性返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IGroupManager</code>
                                。此接口定义了两个方法： <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddToGroupAsync</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">RemoveFromGroupAsync</code>
                                。这两个方法都需要一个组名和一个连接标识符，用于向组添加或移除指定的连接。连接标识符是与客户端连接相关联的唯一标识符。客户端连接标识符——以及其他有关客户端的信息——可以通过
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code> 类的
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Context</code>
                                属性访问。以下代码片段调用了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IGroupManager</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddToGroupAsync</code>
                                方法来注册一个组，并调用了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">RemoveFromGroupAsync</code>
                                方法来注销组（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/Hubs/GroupChatHub.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0017"><code>public Task AddGroup(string groupName) =&gt;</code>
<code>  <b>Groups.AddToGroupAsync(Context.ConnectionId, groupName);</b></code>
<code> </code>
<code>public Task LeaveGroup(string groupName) =&gt;</code>
<code>  <b>Groups.RemoveFromGroupAsync(Context.ConnectionId, groupName);</b></code></pre>
                <aside data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <div class="top hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <p id="c28-para-0045" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">NOTE</b> <i
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">The</i> <code
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Context</code> <i
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">property of
                                the</i> <code
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code> <i
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">class returns an
                                object of type</i> <code
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubCallerContext</code>
                            <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">. With this class,
                                not only can you access the connection identifier associated with the connection, but
                                you can access other information about the client, such as the user, but only if the
                                user is authorized.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code>
                                        类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Context</code>
                                        属性返回一个类型为 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">HubCallerContext</code>
                                        的对象。使用这个类，您不仅可以访问与连接相关联的连接标识符，还可以访问有关客户端的其他信息，例如用户，但只有当用户有权限时才能访问。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">Invoking the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Send</code> method—this
                    time with three parameters, including the group—sends information to all connections that are
                    associated with the group. The <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Clients</code> property
                    is now used to invoke the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Group</code> method. The
                    <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Group</code> method
                    accepts a group string to send the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">MessageToGroup</code>
                    message to all connections associated with the group name. With an overload of the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Group</code> method, you
                    can add connection IDs that should be excluded. Because the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code> implements the
                    interface <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IGroupClient</code>, the
                    <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Group</code> method
                    returns the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IGroupClient</code>. This
                    way, the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">MessageToGroup</code>
                    method can be invoked using compile-time support (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/Hubs/GroupChatHub.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">调用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Send</code>
                                方法——这次带有三个参数，包括组名——向与该组关联的所有连接发送信息。现在使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Clients</code>
                                属性来调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Group</code>
                                方法。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Group</code>
                                方法接受一个组名字符串，向与该组名关联的所有连接发送 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">MessageToGroup</code>
                                消息。通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Group</code>
                                方法的重载，你可以添加应该被排除的连接 ID。因为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code>
                                实现了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IGroupClient</code>
                                接口，所以 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Group</code>
                                方法返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IGroupClient</code>
                                。这样， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">MessageToGroup</code>
                                方法可以通过编译时支持（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/ChatServer/Hubs/GroupChatHub.cs</code>
                                ）来调用：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0018"><code>public Task Send(string group, string name, string message) =&gt;</code>
<code>  <b>Clients.Group(group).MessageToGroup(group, name, message);</b></code></pre>
                <p id="c28-para-0047" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">Several other extension methods are defined to send
                    information to a list of client connections. You've seen the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Group</code> method to
                    send messages to a group of connections that's specified by a group name. With this method, you can
                    exclude client connections. For example, the client who sent the message might not need to receive
                    it. The <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Groups</code>
                    method accepts a list of group names where a message should be sent. You've already seen the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">All</code> property to
                    send a message to all connected clients. Methods to exclude sending the message to the caller are
                    <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OthersInGroup</code>
                    and <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OthersInGroups</code>.
                    These methods send a message to one specific group excluding the caller, or a message to a list of
                    groups excluding the caller.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                定义了其他几个扩展方法用于向一组客户端连接发送信息。你已经看到了通过组名指定的一组连接发送消息的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Group</code>
                                方法。使用这个方法，你可以排除某些客户端连接。例如，发送消息的客户端可能不需要接收它。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Groups</code>
                                方法接受一个要发送消息的组名列表。你已经看到了用于向所有已连接客户端发送消息的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">All</code>
                                属性。排除向调用者发送消息的方法是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OthersInGroup</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OthersInGroups</code>
                                。这些方法向一个特定的组发送消息，排除调用者，或者向一个组名列表发送消息，排除调用者。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">You can also send messages to a customized group that's not
                    based on the built-in grouping functionality. Here, it helps to override the methods <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnConnectedAsync</code>
                    and <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnDisconnectedAsync</code>.
                    The <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnConnectedAsync</code>
                    method is invoked every time a client connects; the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnDisconnectedAsync</code>
                    method is invoked when a client disconnects. Within these methods, you can access the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Context</code> property
                    of the <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code> class
                    to access client information as well as the client-associated connection ID. Here, you can write the
                    connection information to a shared state to have your server scalable using multiple instances,
                    accessing the same shared state. You can also select clients based on your own business logic. For
                    example, your implementation can decide to send messages first to clients based on priorities.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">你还可以向基于内置分组功能自定义的群组发送消息。这里需要重写方法
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnConnectedAsync</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnDisconnectedAsync</code>
                                。方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnConnectedAsync</code>
                                在客户端每次连接时被调用；方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">OnDisconnectedAsync</code>
                                在客户端断开连接时被调用。在这些方法中，你可以访问 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Context</code>
                                类中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Hub</code>
                                属性来获取客户端信息以及与客户端关联的连接
                                ID。在这里，你可以将连接信息写入共享状态，以便你的服务器使用多个实例访问相同的共享状态，从而实现可扩展性。你也可以根据你自己的业务逻辑选择客户端。例如，你的实现可以决定首先根据优先级向客户端发送消息。
                            </font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0019"><code>public override Task OnConnectedAsync() =&gt;</code>
<code>  base.OnConnectedAsync();</code>
<code> </code>
<code>public override Task OnDisconnectedAsync(Exception exception) =&gt;</code>
<code>  base.OnDisconnected(exception);</code></pre>
            </section>
            <section data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span id="c28-sec-0015"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
                <h3 id="head-3-532" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">Extending the Windows Client App with Groups<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">扩展 Windows 客户端应用程序的群组功能</font>
                        </font>
                    </font>
                </h3>
                <p id="c28-para-0049" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">After readying the grouping functionality with the hub, you
                    can extend the Windows app client application. For the grouping features, another user control
                    associated with the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">GroupChatViewModel</code>
                    class is defined.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在准备好与中心节点的分组功能后，你可以扩展 Windows
                                应用程序客户端应用程序。对于分组功能，定义了另一个与 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">GroupChatViewModel</code>
                                类关联的用户控件。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1"><span aria-label="812" epub:type="pagebreak" id="Page_812"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>The <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">GroupChatViewModel</code>
                    class defines some more properties and commands compared to the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatViewModel</code>
                    defined earlier. The <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">NewGroup</code> property
                    defines the group the user registers to. The <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SelectedGroup</code>
                    property defines the group that is used with the continued communication, such as sending a message
                    to the group or leaving the group. The <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SelectedGroup</code>
                    property needs change notification to update the user interface on changing this property; that's
                    why the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">INotifyPropertyChanged</code>
                    interface is implemented with the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">GroupChatViewModel</code>
                    class, and the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">set</code> accessor of
                    the property <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SelectedGroup</code>
                    fires a notification. Commands to join and leave the group (the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">EnterGroupCommand</code>
                    and <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">LeaveGroupCommand</code>
                    properties, respectively) are defined as well (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/GroupChatViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">GroupChatViewModel</code>
                                类相比之前定义的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChatViewModel</code>
                                类定义了一些更多的属性和命令。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">NewGroup</code>
                                属性定义了用户注册的组。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SelectedGroup</code>
                                属性定义了用于持续通信的组，例如向该组发送消息或离开该组。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SelectedGroup</code>
                                属性需要变更通知来更新用户界面，因此 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">INotifyPropertyChanged</code>
                                接口通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">GroupChatViewModel</code>
                                类实现，并且属性 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">set</code>
                                的访问器会触发通知。加入和离开组的命令（分别为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">EnterGroupCommand</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">LeaveGroupCommand</code>
                                属性）也被定义了（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/GroupChatViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0020"><code>public sealed class GroupChatViewModel</code>
<code>{</code>
<code>  private readonly IDialogService _dialogService;</code>
<code>  private readonly UrlService _urlService;</code>
<code> </code>
<code>  public GroupChatViewModel(IDialogService dialogService, </code>
<code>    UrlService urlService)</code>
<code>  {</code>
<code>    _dialogService = dialogService;</code>
<code>    _urlService = urlService;</code>
<code> </code>
<code>    ConnectCommand = new RelayCommand(OnConnect);</code>
<code>    SendCommand = new RelayCommand (OnSendMessage);</code>
<code>    EnterGroupCommand = new RelayCommand (OnEnterGroup);</code>
<code>    LeaveGroupCommand = new RelayCommand (OnLeaveGroup);</code>
<code>  }</code>
<code> </code>
<code>  public string? Name { get; set; }</code>
<code>  public string? Message { get; set; }</code>
<code>  public string? NewGroup { get; set; }</code>
<code>  public string? SelectedGroup { get; set; }</code>
<code> </code>
<code>  public ObservableCollection&lt;string&gt; Messages { get; } =</code>
<code>    new ObservableCollection&lt;string&gt;();</code>
<code>  public ObservableCollection&lt;string&gt; Groups { get; } =</code>
<code>    new ObservableCollection&lt;string&gt;();</code>
<code>  public ICommand SendCommand { get; }</code>
<code>  public ICommand ConnectCommand { get; }</code>
<code>  public ICommand EnterGroupCommand { get; }</code>
<code>  public ICommand LeaveGroupCommand { get; }</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">The handler methods for the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">EnterGroupCommand</code>
                    and <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">LeaveGroupCommand</code>
                    commands are shown in the following code snippet. Here, the <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddGroup</code> and <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">RemoveGroup</code>
                    methods are called within the group hub (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/GroupChatViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">EnterGroupCommand</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">LeaveGroupCommand</code>
                                命令的处理方法在以下代码片段中显示。在这里， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">AddGroup</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">RemoveGroup</code>
                                方法在组中心内被调用（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/GroupChatViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0021"><code>public async void OnEnterGroup()</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    if (NewGroup is not null)</code>
<code>    {</code>
<code>      <b>await _hubConnection.InvokeAsync("AddGroup", NewGroup);</b></code>
<code>      Groups.Add(NewGroup);<span aria-label="813" epub:type="pagebreak" id="Page_813" role="doc-pagebreak"></span></code>
<code>      SelectedGroup = NewGroup;</code>
<code>    }</code>
<code>  }</code>
<code>  catch (Exception ex)</code>
<code>  {</code>
<code>    await _dialogService.ShowMessageAsync(ex.Message);</code>
<code>  }</code>
<code>}</code>
<code> </code>
<code>public async void OnLeaveGroup()</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    if (SelectedGroup is not null)</code>
<code>    {</code>
<code>      <b>await _hubConnection.InvokeAsync("LeaveGroup", SelectedGroup);</b></code>
<code>      Groups.Remove(SelectedGroup);</code>
<code>    }</code>
<code>  }</code>
<code>  catch (Exception ex)</code>
<code>  {</code>
<code>    _dialogService.ShowMessage(ex.Message);</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">Sending and receiving the messages is similar to the previous
                    sample. The difference is that the group information is added now (code file <code
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/GroupChatViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                发送和接收消息与之前的示例类似。不同之处在于现在添加了组信息（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRSample/WinAppChatClient/ViewModels/GroupChatViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c28-code-0022"><code>public async void OnSendMessage()</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    await _hubConnection.InvokeAsync("Send", SelectedGroup, Name, Message);</code>
<code>  }</code>
<code>  catch (Exception ex)</code>
<code>  {</code>
<code>    _dialogService.ShowMessage(ex.Message);</code>
<code>  }</code>
<code>}</code>
<code> </code>
<code>public void OnMessageReceived(string group, string name, string message)</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>      Messages.Add($"{group}-{name}: {message}");</code>
<code>  }</code>
<code>  catch (Exception ex)</code>
<code>  {</code>
<code>    await _dialogService.ShowMessageAsync(ex.Message);</code>
<code>  }</code>
<code>}</code></pre>
                <p id="c28-para-0053" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                    data-immersive-translate-paragraph="1">When you run the application, you can send messages for all
                    groups that have been joined and see received messages for all registered groups, as shown in <a
                        href="#c28-fig-0005" id="R_c28-fig-0005"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Figure 28-5</a>.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                运行应用程序时，您可以发送已加入的所有组的消息，并查看所有已注册组的接收消息，如图 28-5 所示。</font>
                        </font>
                    </font><span aria-label="814" epub:type="pagebreak" id="Page_814" role="doc-pagebreak"
                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span></p>
                <figure data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <img alt="Snapshot of choosing name, group, and message." class="center" src="images/c28f005.png" />
                    <figcaption data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span
                                class="figureLabel"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><a
                                    href="#R_c28-fig-0005" id="c28-fig-0005" role="doc-backlink"
                                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><b
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                                        data-immersive-translate-paragraph="1">FIGURE 28-5<font
                                            class="notranslate immersive-translate-target-wrapper"
                                            data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                            <font class="notranslate"
                                                data-immersive-translate-translation-element-mark="1">  </font>
                                            <font
                                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                                data-immersive-translate-translation-element-mark="1">
                                                <font
                                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                    data-immersive-translate-translation-element-mark="1">图 28-5</font>
                                            </font>
                                        </font></b></a></span></p>
                    </figcaption>
                </figure>
            </section>
        </section>
        <section aria-labelledby="head-2-253" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
            <span id="c28-sec-0016" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
            <h2 id="head-2-253" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">STREAMING WITH SIGNALR<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用 SignalR 进行流式传输</font>
                    </font>
                </font>
            </h2>
            <p id="c28-para-0054" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">SignalR supports streaming, including from the server to the
                client, from the client to the server, and simultaneously in both directions.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">SignalR
                            支持流式传输，包括从服务器到客户端、从客户端到服务器以及双向同时进行。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">The sample application returns a stream of simulated sensor data
                to the client. To implement this, create a new empty ASP.NET Core web application and add the
                configuration of SignalR similar to the previous sample. The hub class <code
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">StreamingHub</code> is now
                declared to return <code
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IAsyncEnumerable&lt;SensorData&gt;</code>.
                The hub passes 1,000 <code
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SensorData</code> values to
                the client unless the client sends a cancellation that is received with the <code
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">cancellationtoken</code>
                (code file <code
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRStreaming/Hubs/StreamingHub.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">示例应用程序向客户端返回模拟传感器数据的流。要实现这一点，创建一个新的空
                            ASP.NET Core Web 应用程序，并添加与先前示例类似的 SignalR 配置。现在声明了 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">StreamingHub</code>
                            中心类来返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IAsyncEnumerable&lt;SensorData&gt;</code>
                            。中心类向客户端传递 1,000 个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SensorData</code>
                            值，除非客户端发送取消请求，该请求通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">cancellationtoken</code>
                            接收（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">SignalRStreaming/Hubs/StreamingHub.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c28-code-0023"><code>public record SensorData(int Val1, int Val2, DateTime TimeStamp);</code>
<code> </code>
<code>public class StreamingHub : Hub</code>
<code>{</code>
<code>  public async IAsyncEnumerable&lt;SensorData&gt; GetSensorData(</code>
<code>    [EnumeratorCancellation] CancellationToken cancellationToken)</code>
<code>  {</code>
<code>    Random r = new();</code>
<code>    for (int i = 0; i &lt; 1000; i++)</code>
<code>    {</code>
<code>      yield return new SensorData(r.Next(20), r.Next(20), DateTime.Now);</code>
<code>      await Task.Delay(1000, cancellationToken);</code>
<code>    }</code>
<code>  }</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"><span aria-label="815"
                    epub:type="pagebreak" id="Page_815" role="doc-pagebreak"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span></p>
            <aside data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                <div class="top hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <p id="c28-para-0057" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">NOTE</b> <i
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Instead of using</i>
                        <code
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IAsyncEnumerable</code>
                        <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">for streaming, a
                            SignalR streaming hub can also return a</i> <code
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChannelReader</code>
                        <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">or a</i> <code
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChannelWriter</code>
                        <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">—depending on the
                            direction of the stream—from the namespace</i> <code
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">System.Threading.Channels</code>
                        <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">. Using</i> <code
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IAsyncEnumerable</code>
                        <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">is just the simpler
                            option to implement with the help of C# extensions with the</i> <code
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">yield</code> <i
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">statement and</i>
                        <code
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">await foreach</code>
                        <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">. The foundation of
                            async streams is covered in <a href="c11.xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Chapter 11</a>,
                            “Tasks and Asynchronous Programming.”</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意 除了使用 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IAsyncEnumerable</code>
                                    进行流式传输外，SignalR 流式传输中心也可以从 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">System.Threading.Channels</code>
                                    命名空间返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChannelReader</code>
                                    或 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChannelWriter</code>
                                    ——取决于流的传输方向。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IAsyncEnumerable</code>
                                    只是借助 C#扩展和 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">yield</code>
                                    语句以及 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">await foreach</code>
                                    的更简单的实现选项。异步流的基础在第 11 章“任务和异步编程”中介绍。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <hr />
                    </div>
                </section>
            </aside>
            <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">This time, the client application is created with a .NET console
                application template. The creation and starting of the hub connection is done in the same way as before.
                Now, the <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">StreamAsync</code>
                method is used to invoke the <code
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">GetSensorData</code> method.
                This method returns <code
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IAsyncEnumerable</code>,
                which can now be used with the <code
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">await foreach</code>
                statement. Passing the cancellation token to the service is done with the <code
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">WithCancellation</code>
                method; after 10 seconds, requesting the stream is canceled (code file <code
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">StreamingClient/Program.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">这次，客户端应用程序是使用.NET
                            控制台应用程序模板创建的。创建和启动中心连接的方式与之前相同。现在，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">StreamAsync</code>
                            方法来调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">GetSensorData</code>
                            方法。这个方法返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IAsyncEnumerable</code>
                            ，现在可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">await foreach</code>
                            语句。通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">WithCancellation</code>
                            方法将取消标记传递给服务；10 秒后，请求的流被取消（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">StreamingClient/Program.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c28-code-0024"><code>using Microsoft.AspNetCore.SignalR.Client;</code>
<code>using System;</code>
<code>using System.Threading;</code>
<code>using System.Threading.Tasks;</code>
<code> </code>
<code>Console.WriteLine($"Wait for service - press return to start");</code>
<code>Console.ReadLine();</code>
<code> </code>
<code><b>var connection = new HubConnectionBuilder()</b></code>
<code><b>  .WithUrl("https://localhost:5001/stream")</b></code>
<code><b>  .Build();</b></code>
<code> </code>
<code><b>await connection.StartAsync();</b></code>
<code> </code>
<code><b>CancellationTokenSource cts = new(10000);</b></code>
<code> </code>
<code>try</code>
<code>{</code>
<code>  <b>await foreach (var data in</b> </code>
<code>    <b>connection.StreamAsync&lt;SensorData&gt;("GetSensorData").WithCancellation(cts.Token))</b></code>
<code>  <b>{</b></code>
<code>    <b>Console.WriteLine(data);</b></code>
<code>  <b>}</b></code>
<code>}</code>
<code>catch (OperationCanceledException)</code>
<code>{</code>
<code>  Console.WriteLine("Canceled!");</code>
<code>}</code>
<code> </code>
<code>await connection.StopAsync();</code>
<code> </code>
<code>Console.WriteLine("Completed");</code>
<code> </code>
<code> </code>
<code>public record SensorData(int Val1, int Val2, DateTime TimeStamp);</code></pre>
            <p data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">When you run both the service and the client application, the
                stream of sensor data is shown in the client application until the cancellation happens after 10
                seconds.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">当运行服务和客户端应用程序时，客户端应用程序中会显示传感器数据的流，直到
                            10 秒后发生取消。</font>
                    </font>
                </font><span aria-label="816" epub:type="pagebreak" id="Page_816" role="doc-pagebreak"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span></p>
            <aside data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                <div class="top hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                    <p id="c28-para-0060" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">NOTE</b> <i
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Instead of invoking
                        </i>
                        <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">StreamAsync</code>
                        <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">on the client, you can
                            invoke the method </i>
                        <code
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">StreamAsChannelAsync</code>
                        <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">. This returns a </i>
                        <code
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChannelReader</code>
                        <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">, no matter whether
                            you returned a </i>
                        <code
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChannelReader</code>
                        <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">or </i>
                        <code
                            data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IAsyncEnumerable</code>
                        <i data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">with the service.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意 除了在客户端调用 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">StreamAsync</code>
                                    ，你还可以调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">StreamAsChannelAsync</code>
                                    。无论服务是否返回了 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChannelReader</code>
                                    或 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IAsyncEnumerable</code>
                                    ，这个方法都会返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">ChannelReader</code>
                                    。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
                        <hr />
                    </div>
                </section>
            </aside>
        </section>
        <section aria-labelledby="head-2-254" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">
            <span id="c28-sec-0019" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"></span>
            <h2 id="head-2-254" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">SUMMARY<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">摘要</font>
                    </font>
                </font>
            </h2>
            <p id="c28-para-0061" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">This chapter described communicating with multiple clients with
                ASP.NET Core SignalR. SignalR offers an easy way to use the WebSocket technology to keep the network
                connection open to allow passing continuous information from the server to the client. With SignalR you
                can also send information to all connected clients or a group of clients. The sample application
                demonstrated how you can implement clients to register for groups, and the server returns information
                from groups.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本章介绍了使用 ASP.NET Core SignalR
                            与多个客户端进行通信。SignalR 提供了一种便捷的方式，利用 WebSocket 技术保持网络连接开放，从而允许服务器向客户端持续传递信息。通过
                            SignalR，你还可以向所有已连接的客户端或特定客户端组发送信息。示例应用程序展示了如何实现客户端注册到组，以及服务器如何从组中返回信息。</font>
                    </font>
                </font>
            </p>
            <p id="c28-para-0062" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">With creating SignalR clients, you've seen using JavaScript as
                well as .NET clients. The API is similar for the different client libraries—just the naming of the hub
                methods differs.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在创建 SignalR 客户端的过程中，你看到了使用 JavaScript
                            以及.NET 客户端。不同的客户端库 API 相似——只是中心方法的命名有所不同。</font>
                    </font>
                </font>
            </p>
            <p id="c28-para-0063" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">You've seen how to implement streaming with SignalR using the
                <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">yield</code> statement to
                return <code
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IAsyncEnumerable</code> and
                using <code data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">await foreach</code>.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">你了解了如何使用 SignalR 实现流式传输，通过使用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">yield</code> 语句返回
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">IAsyncEnumerable</code>
                            ，以及使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">await foreach</code>
                            。</font>
                    </font>
                </font>
            </p>
            <p id="c28-para-0064" data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733"
                data-immersive-translate-paragraph="1">The next chapter is the start of <a href="p04.xhtml"
                    data-immersive-translate-walked="41e75109-d3ae-4849-ba1b-bf406355b733">Part IV</a> of the book and
                is the first chapter of several that cover how to use XAML to create Windows apps.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">下一章是本书第四部分的开端，也是涵盖如何使用 XAML 创建 Windows
                            应用程序的多个章节中的第一章。</font>
                    </font>
                </font>
            </p>
        </section>
    </section>
</body>
<div id="immersive-translate-popup" style="all: initial"></div>

</html>