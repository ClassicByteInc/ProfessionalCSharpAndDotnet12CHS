<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops"
    xmlns:svg="http://www.w3.org/2000/svg" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en"
    imt-state="dual" imt-trans-position="after">

<head>
    <title>《30 个 XAML 应用程序模式》 --- 30 Patterns with XAML Apps</title>
    <link href="WileyTemplate_v5.5.css" rel="stylesheet" type="text/css" />
    <meta content="urn:uuid:e0000000-0000-0000-0000-000006715209" name="Adept.expected.resource" />
    <style data-id="immersive-translate-input-injected-css">
        .immersive-translate-input {
            position: absolute;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            z-index: 2147483647;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .immersive-translate-attach-loading::after {
            content: " ";

            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;

            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-2000%, -50%);
            z-index: 100;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .immersive-translate-input-loading {
            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;
        }

        @keyframes immersiveTranslateShadowRolling {
            0% {
                box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            12% {
                box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            25% {
                box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            36% {
                box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color),
                    100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
            }

            50% {
                box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color),
                    110px 0 var(--loading-color), 100px 0 var(--loading-color);
            }

            62% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color),
                    120px 0 var(--loading-color), 110px 0 var(--loading-color);
            }

            75% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    130px 0 var(--loading-color), 120px 0 var(--loading-color);
            }

            87% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
            }

            100% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
            }
        }

        .immersive-translate-toast {
            display: flex;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            right: 0;
            top: 1%;
            width: fit-content;
            padding: 12px 20px;
            margin: auto;
            overflow: auto;
            background: #fef6f9;
            box-shadow: 0px 4px 10px 0px rgba(0, 10, 30, 0.06);
            font-size: 15px;
            border-radius: 8px;
            color: #333;
        }

        .immersive-translate-toast-content {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .immersive-translate-toast-hidden {
            margin: 0 20px 0 72px;
            text-decoration: underline;
            cursor: pointer;
        }

        .immersive-translate-toast-close {
            color: #666666;
            font-size: 20px;
            font-weight: bold;
            padding: 0 10px;
            cursor: pointer;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-toast {
                top: 0;
                padding: 12px 0px 0 10px;
            }

            .immersive-translate-toast-content {
                flex-direction: column;
                text-align: center;
            }

            .immersive-translate-toast-hidden {
                margin: 10px auto;
            }
        }

        .immersive-translate-modal {
            display: none;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
            font-size: 15px;
        }

        .immersive-translate-modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 40px 24px 24px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 80%;
            max-width: 270px;
            font-family: system-ui, -apple-system, "Segoe UI", "Roboto", "Ubuntu",
                "Cantarell", "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
                "Segoe UI Symbol", "Noto Color Emoji";
            position: relative;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-content {
                margin: 50% auto !important;
            }
        }

        .immersive-translate-modal .immersive-translate-modal-content-in-input {
            max-width: 500px;
        }

        .immersive-translate-modal-content-in-input .immersive-translate-modal-body {
            text-align: left;
            max-height: unset;
        }

        .immersive-translate-modal-title {
            text-align: center;
            font-size: 16px;
            font-weight: 700;
            color: #333333;
        }

        .immersive-translate-modal-body {
            text-align: center;
            font-size: 14px;
            font-weight: 400;
            color: #333333;
            word-break: break-all;
            margin-top: 24px;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-body {
                max-height: 250px;
                overflow-y: auto;
            }
        }

        .immersive-translate-close {
            color: #666666;
            position: absolute;
            right: 16px;
            top: 16px;
            font-size: 20px;
            font-weight: bold;
        }

        .immersive-translate-close:hover,
        .immersive-translate-close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .immersive-translate-modal-footer {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        .immersive-translate-btn {
            width: fit-content;
            color: #fff;
            background-color: #ea4c89;
            border: none;
            font-size: 16px;
            margin: 0 8px;
            padding: 9px 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .immersive-translate-btn:hover {
            background-color: #f082ac;
        }

        .immersive-translate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .immersive-translate-btn:disabled:hover {
            background-color: #ea4c89;
        }

        .immersive-translate-cancel-btn {
            /* gray color */
            background-color: rgb(89, 107, 120);
        }

        .immersive-translate-cancel-btn:hover {
            background-color: hsl(205, 20%, 32%);
        }

        .immersive-translate-action-btn {
            background-color: transparent;
            color: #ea4c89;
            border: 1px solid #ea4c89;
        }

        .immersive-translate-btn svg {
            margin-right: 5px;
        }

        .immersive-translate-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #007bff;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-primary-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #ea4c89;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-modal input[type="radio"] {
            margin: 0 6px;
            cursor: pointer;
        }

        .immersive-translate-modal label {
            cursor: pointer;
        }

        .immersive-translate-close-action {
            position: absolute;
            top: 2px;
            right: 0px;
            cursor: pointer;
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5) !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 16px !important;
        }

        .imt-image-status img,
        .imt-image-status svg,
        .imt-img-loading {
            width: 28px !important;
            height: 28px !important;
            margin: 0 0 8px 0 !important;
            min-height: 28px !important;
            min-width: 28px !important;
            position: relative !important;
        }

        .imt-img-loading {
            background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAtFBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////oK74hAAAAPHRSTlMABBMIDyQXHwyBfFdDMSw+OjXCb+5RG51IvV/k0rOqlGRM6KKMhdvNyZBz9MaupmxpWyj437iYd/yJVNZeuUC7AAACt0lEQVRIx53T2XKiUBCA4QYOiyCbiAsuuGBcYtxiYtT3f6/pbqoYHVFO5r+iivpo6DpAWYpqeoFfr9f90DsYAuRSWkFnPO50OgR9PwiCUFcl2GEcx+N/YBh6pvKaefHlUgZd1zVe0NbYcQjGBfzrPE8Xz8aF+71D8gG6DHFPpc4a7xFiCDuhaWgKgGIJQ3d5IMGDrpS4S5KgpIm+en9f6PlAhKby4JwEIxlYJV9h5k5nee9GoxHJ2IDSNB0dwdad1NAxDJ/uXDHYmebdk4PdbkS58CIVHdYSUHTYYRWOJblWSyu2lmy3KNFVJNBhxcuGW4YBVCbYGRZwIooipHsNqjM4FbgOQqQqSKQQU9V8xmi1QlgHqQQ6DDBvRUVCDirs+EzGDGOQTCATgtYTnbCVLgsVgRE0T1QE0qHCFAht2z6dLvJQs3Lo2FQoDxWNUiBhaP4eRgwNkI+dAjVOA/kUrIDwf3CG8NfNOE0eiFotSuo+rBiq8tD9oY4Qzc6YJw99hl1wzpQvD7ef2M8QgnOGJfJw+EltQc+oX2yn907QB22WZcvlUpd143dqQu+8pCJZuGE4xCuPXJqqcs5sNpsI93Rmzym1k4Npk+oD1SH3/a3LOK/JpUBpWfqNySxWzCfNCUITuDG5dtuphrUJ1myeIE9bIsPiKrfqTai5WZxbhtNphYx6GEIHihyGFTI69lje/rxajdh0s0msZ0zYxyPLhYCb1CyHm9Qsd2H37Y3lugVwL9kNh8Ot8cha6fUNQ8nuXi5z9/ExsAO4zQrb/ev1yrCB7lGyQzgYDGuxq1toDN/JGvN+HyWNHKB7zEoK+PX11e12G431erGYzwmytAWU56fkMHY5JJnDRR2eZji3AwtIcrEV8Cojat/BdQ7XOwGV1e1hDjGGjXbdArm8uJZtCH5MbcctVX8A1WpqumJHwckAAAAASUVORK5CYII=");
            background-size: 28px 28px;
            animation: image-loading-rotate 1s linear infinite !important;
        }

        .imt-image-status span {
            color: var(--bg-2, #fff) !important;
            font-size: 14px !important;
            line-height: 14px !important;
            font-weight: 500 !important;
            font-family: "PingFang SC", Arial, sans-serif !important;
        }

        @keyframes image-loading-rotate {
            from {
                transform: rotate(360deg);
            }

            to {
                transform: rotate(0deg);
            }
        }
    </style>
    <style data-id="immersive-translate-default-injected-css">
        :root {
            --immersive-translate-theme-underline-borderColor: #72ece9;
            --immersive-translate-theme-nativeUnderline-borderColor: #72ece9;
            --immersive-translate-theme-nativeDashed-borderColor: #72ece9;
            --immersive-translate-theme-nativeDotted-borderColor: #72ece9;
            --immersive-translate-theme-highlight-backgroundColor: #ffff00;
            --immersive-translate-theme-dashed-borderColor: #59c1bd;
            --immersive-translate-theme-blockquote-borderColor: #cc3355;
            --immersive-translate-theme-thinDashed-borderColor: #ff374f;
            --immersive-translate-theme-dashedBorder-borderColor: #94a3b8;
            --immersive-translate-theme-dashedBorder-borderRadius: 0;
            --immersive-translate-theme-solidBorder-borderColor: #94a3b8;
            --immersive-translate-theme-solidBorder-borderRadius: 0;
            --immersive-translate-theme-dotted-borderColor: #94a3b8;
            --immersive-translate-theme-wavy-borderColor: #72ece9;
            --immersive-translate-theme-dividingLine-borderColor: #94a3b8;
            --immersive-translate-theme-grey-textColor: #2f4f4f;
            --immersive-translate-theme-marker-backgroundColor: #fbda41;
            --immersive-translate-theme-marker-backgroundColor-rgb: 251, 218, 65;
            --immersive-translate-theme-marker2-backgroundColor: #ffff00;
            --immersive-translate-theme-background-backgroundColor: #dbafaf;
            --immersive-translate-theme-background-backgroundColor-rgb: 219, 175, 175;
            --immersive-translate-theme-background-backgroundOpacity: 12;
            --immersive-translate-theme-opacity-opacity: 10;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pre-whitespace {
            white-space: pre-wrap !important;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container {
            position: absolute;
            background-color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
                sans-serif;
            top: 0;
            width: 600px;
            height: 100%;
            z-index: 2;
            line-height: 1.3;
            font-size: 16px;
        }

        [imt-state="dual"] .immersive-translate-target-wrapper[dir="rtl"] {
            text-align: right;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper {
            color: rgb(0, 0, 0);
            white-space: normal;
            position: absolute;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper font {
            color: inherit;
            white-space: inherit;
            position: unset;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper &gt;

        br {
            display: none;
        }

        [imt-state="translation"] .immersive-translate-target-translation-block-wrapper {
            margin: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper {
            margin: 8px 0 !important;
            display: inline-block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            display: block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            margin-top: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pdf-block-wrapper {
            margin: 0 !important;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-grey-inner {
            color: var(--immersive-translate-theme-grey-textColor);
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-underline-inner {
            border-bottom: 1px solid var(--immersive-translate-theme-underline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeUnderline-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeUnderline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDashed-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDashed-borderColor) !important;
            text-decoration-style: dashed !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-thinDashed-inner {
            border-bottom: 1px dashed var(--immersive-translate-theme-thinDashed-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dotted-inner {
            background-image: linear-gradient(to right,
                    var(--immersive-translate-theme-dotted-borderColor) 30%,
                    rgba(255, 255, 255, 0) 0%);
            background-position: bottom;
            background-size: 5px 1px;
            background-repeat: repeat-x;
            padding-bottom: 3px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDotted-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDotted-borderColor) !important;
            text-decoration-style: dotted !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-wavy-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-wavy-borderColor) !important;
            text-decoration-style: wavy !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dashed-inner {
            background: linear-gradient(to right,
                    var(--immersive-translate-theme-dashed-borderColor) 0%,
                    var(--immersive-translate-theme-dashed-borderColor) 50%,
                    transparent 50%,
                    transparent 100%) repeat-x left bottom;
            background-size: 8px 2px;
            padding-bottom: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            content: "";
            display: block;
            max-width: 80px;
            width: 10%;
            border-top: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            padding-top: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dividingLine::before {
            content: "";
            border-left: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            max-height: 16px;
            height: 16px;
            padding-left: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-highlight-inner {
            background: var(--immersive-translate-theme-highlight-backgroundColor);
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-marker {
            line-height: 1.5em;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker2-inner {
            font-weight: bold;
            text-shadow: 10px 0px 3px var(--immersive-translate-theme-marker2-backgroundColor),
                16px 3px 9px var(--immersive-translate-theme-marker2-backgroundColor),
                2px 0px 6px var(--immersive-translate-theme-marker2-backgroundColor),
                -12px 0px 12px var(--immersive-translate-theme-marker2-backgroundColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker-inner {
            /* TODO: add more texture */
            background: linear-gradient(to right,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.1),
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 3%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 35%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 70%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.8) 95%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.3));
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-weakening {
            opacity: 0.618 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-italic {
            font-style: italic !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-bold {
            font-weight: bold !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-paper {
            margin: 8px 0;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
            padding: 16px 32px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-blockquote {
            border-left: 4px solid var(--immersive-translate-theme-blockquote-borderColor) !important;
            padding-left: 12px !important;
            margin-top: 4px;
            margin-bottom: 4px;
            padding-top: 4px;
            padding-bottom: 4px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-mask-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        /* opacity theme start */

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner,
        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: none !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        /* opacity theme end */

        /* background theme start */
        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-background {
            margin: 8px 0;
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            border-radius: 4px;
            box-shadow: unset !important;
            padding: 12px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-background-inner {
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            padding-left: 6px;
            padding-right: 6px;
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper .immersive-translate-target-translation-theme-background-inner {
            background: unset;
            padding-left: unset;
            padding-right: unset;
        }

        /* background theme end */

        /* vertical css , please remain it in the last one. */
        .immersive-translate-target-translation-vertical-block-wrapper {
            margin: 0px 8px !important;
        }

        .immersive-translate-text {
            font-size: 15px !important;
        }

        .immersive-translate-error-toast {
            position: fixed;
            top: 5%;
            z-index: 99999999;
            left: 0;
            right: 0;
            margin: auto;
            max-width: 300px;
            padding: 16px;
            border-radius: 12px;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        @media all and (min-width: 750px) {
            .immersive-translate-error-toast {
                max-width: 400px;
            }
        }

        .immersive-translate-clickable-button {
            cursor: pointer;
        }

        .immersive-translate-help-button {
            cursor: pointer;
        }

        .immersive-translate-loading-text:before {
            content: "...";
        }

        /* dark mode for loading */

        @media only screen and (prefers-color-scheme: dark) {
            .immersive-translate-loading {
                border: 2px rgba(255, 255, 255, 0.25) solid !important;
                border-top: 2px rgba(255, 255, 255, 1) solid !important;
            }
        }

        .immersive-translate-error-wrapper {
            position: relative;
            display: inline-flex;
            padding: 6px;
            margin: 0 12px;
            white-space: nowrap;
            font-size: 0.9em;
        }

        [lang="zh-CN"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        [lang="zh-TW"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        .immersive-translate-tooltip {
            position: relative;
            display: inline-flex;
            /* little indicater to indicate it's hoverable */
        }

        .immersive-translate-tooltip-content {
            /* here's the magic */
            position: absolute;
            z-index: 100000000000;

            left: 50%;
            bottom: 0;
            transform: translate(-50%, 110%);
            line-height: 1;
            /* and add a small left margin */

            /* basic styles */
            width: max-content;
            max-width: 250px;
            word-wrap: break-word;
            white-space: pre-line;
            padding: 10px;
            border-radius: 10px;
            background: #000c;
            color: #fff;
            text-align: center;
            font-size: 14px;
            display: none;
            /* hide by default */
        }

        .immersive-translate-tooltip:hover .immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip:hover+.immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip-content-table {
            left: unset !important;
            bottom: unset !important;
            transform: translate(-10%, 50%) !important;
        }

        .immersive-translate-tooltip:hover:before {
            display: inline-block;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--bg-2, #fff);
            font-size: 14px;
        }
    </style>
    <style data-id="immersive-translate-user-custom-style">
        :root {

            .immersive-translate-target-inner {
                font-family: inherit;
            }


            .immersive-translate-target-inner {
                font-family: inherit;
            }
        }
    </style>
    <style data-id="immersive-translate-dynamic-injected-css">
        .immersive-translate-target-wrapper[dir='rtl'] {
            text-align: right;
        }

        .immersive-translate-target-wrapper[dir='rtl'] [data-immersive-translate-class-bak*='block-wrapper'] {
            display: block;
        }

        .immersive-translate-target-wrapper {
            word-break: break-word;
            user-select: text;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper[dir='rtl'] {
            display: inline-block;
        }

        [dir='rtl'] .immersive-translate-target-wrapper:not([dir]) {
            text-align: left;
        }

        [imt-state=dual] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            display: block;
        }

        [imt-trans-position=before] .immersive-translate-target-translation-block-wrapper {
            display: block !important;
        }

        [imt-state][data-immersive-translate_rtl] .immersive-translate-target-wrapper {
            display: block !important;
        }
    </style>
</head>

<body epub:type="bodymatter" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
    <section aria-labelledby="c30_1" epub:type="chapter" role="doc-chapter"
        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
        <header data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
            <h1 id="c30_1" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1"><span aria-label="876" epub:type="pagebreak" id="Page_876"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span><span id="c30"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span><span
                    class="chapterNumber"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">30</span><br /><span
                    class="chapterTitle" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Patterns
                    with XAML Apps</span>
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">30 个 XAML 应用程序模式</font>
                    </font>
                </font>
            </h1>
        </header>
        <section aria-label="chapter opening" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
            <span id="c30-sec-0001" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
            <aside data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                <div class="top hr" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <h3 data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                        data-immersive-translate-paragraph="1">WHAT'S IN THIS CHAPTER?<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章包含什么内容？</font>
                            </font>
                        </font>
                    </h3>
                    <ul class="check2" id="c30-list-0001"
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                        <li id="c30-li-0001" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                            data-immersive-translate-paragraph="1">Sharing code<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">共享代码</font>
                                </font>
                            </font>
                        </li>
                        <li id="c30-li-0002" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                            data-immersive-translate-paragraph="1">Creating models<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">创建模型</font>
                                </font>
                            </font>
                        </li>
                        <li id="c30-li-0003" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                            data-immersive-translate-paragraph="1">Creating repositories<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">创建仓库</font>
                                </font>
                            </font>
                        </li>
                        <li id="c30-li-0004" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                            data-immersive-translate-paragraph="1">Creating view models<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">创建视图模型</font>
                                </font>
                            </font>
                        </li>
                        <li id="c30-li-0005" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                            data-immersive-translate-paragraph="1">Navigation between pages<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">页面间导航</font>
                                </font>
                            </font>
                        </li>
                        <li id="c30-li-0006" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                            data-immersive-translate-paragraph="1">Using an event aggregator<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用事件聚合器</font>
                                </font>
                            </font>
                        </li>
                    </ul>
                    <div class="bottom hr" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                        <hr />
                    </div>
                </section>
            </aside>
            <aside data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                <div class="top hr" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><span
                        id="c30-fea-0001" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
                    <h3 id="head-2-263" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                        data-immersive-translate-paragraph="1">CODE DOWNLOADS FOR THIS CHAPTER<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章代码下载</font>
                            </font>
                        </font>
                    </h3>
                    <section data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><span
                            id="c30-sec-0003"
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
                        <p id="c30-para-0003" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                            data-immersive-translate-paragraph="1">The source code for this chapter is available on the
                            book page at <code
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><a href="http://www.wiley.com">www.wiley.com</a></code>.
                            Click the Downloads link. The code can also be found at <code
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                            in the directory <code
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">4_Apps/Patterns</code>.
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的源代码可在书籍页面 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><a href="http://www.wiley.com">www.wiley.com</a></code>
                                        上找到。点击下载链接。代码也可以在目录 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">4_Apps/Patterns</code>
                                        中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                                        找到。</font>
                                </font>
                            </font>
                        </p>
                        <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                            data-immersive-translate-paragraph="1">The code for this chapter contains these WinUI and
                            library projects:<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的代码包含以下 WinUI 和库项目：
                                    </font>
                                </font>
                            </font>
                        </p>
                        <ul class="check" id="c30-list-0002"
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                            <li id="c30-li-0007" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                                data-immersive-translate-paragraph="1">BooksApp</li>
                            <li id="c30-li-0008" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                                data-immersive-translate-paragraph="1">BooksLib</li>
                            <li id="c30-li-0009" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                                data-immersive-translate-paragraph="1">GenericViewModels</li>
                        </ul>
                        <p id="c30-para-0005" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                            data-immersive-translate-paragraph="1">All the projects have nullable reference types
                            enabled.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">所有项目都启用了可空引用类型。 </font>
                                </font>
                            </font>
                        </p>
                    </section>
                    <div class="bottom hr" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                        <hr />
                    </div>
                </section>
            </aside>
        </section>
        <section aria-labelledby="head-2-264" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
            <span id="c30-sec-0004" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
            <h2 id="head-2-264" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">WHY MVVM?</h2>
            <p id="c30-para-0006" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">Dependency injection, as explained in <a href="c15.xhtml"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Chapter 15</a>, “Dependency
                Injection and Configuration,” provides an easy way to create unit tests and gives you a way to build the
                major functionality of your application independent of a hosting technology. You've seen this in
                concrete examples in <a href="c25.xhtml"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Chapter 25</a>, “Services,”
                where the same functionality has been used with ASP.NET Core Web APIs, gRPC, and Azure Functions.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">依赖注入，如第 15
                            章“依赖注入与配置”所述，为创建单元测试提供了一种简便方法，并让您能够独立于托管技术构建应用程序的主要功能。您在第 25 章“服务”中看到了具体的例子，其中相同的功能已用于
                            ASP.NET Core Web API、gRPC 和 Azure Functions。</font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0007" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1"><span aria-label="877" epub:type="pagebreak" id="Page_877"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>Dependency injection
                plays an important part with XAML-based applications as well. Windows and mobile applications give you
                many options to use, and you shouldn't restrict your application development to one of these
                technologies. With XAML, you have older (WPF, Silverlight, Xamarin.Forms, UWP) and newer (WinUI, MAUI,
                Platform Uno) technologies. Some older technologies still have great support with .NET 5, such as WPF.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">依赖注入在基于 XAML 的应用程序中也发挥着重要作用。Windows
                            和移动应用程序提供了许多选项供您使用，您不应该将应用程序开发限制于其中的一种技术。使用
                            XAML，您有较旧（WPF、Silverlight、Xamarin.Forms、UWP）和较新（WinUI、MAUI、Platform Uno）的技术。一些较旧的技术在.NET 5
                            上仍然有很好的支持，例如 WPF。</font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0008" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">One project to support all Windows 10 platforms might not fit
                your needs. Can you write a program that supports Windows 10 only? Do you think about supporting devices
                such as the HoloLens or the Xbox? Windows 10X? What about supporting Android and iOS? Can .NET
                Multi-platform App UI (MAUI) support your needs? The goal should be to reuse as much code as possible to
                support the platforms needed and to have an easy switch from one technology to another.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">一个支持所有 Windows 10
                            平台的项目可能不符合你的需求。你能写一个仅支持 Windows 10 的程序吗？你是否考虑支持 HoloLens 或 Xbox 等设备？Windows 10X 呢？支持 Android
                            和 iOS 呢？.NET Multiplatform App UI (MAUI)能满足你的需求吗？目标应该是尽可能重用代码来支持所需的平台，并能够轻松地在不同技术之间切换。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0009" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">With XAML-based applications, using dependency injection is
                helpful. The <i
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Model-View-ViewModel</i>
                (MVVM) design pattern helps to separate the view from the functionality. With the view models you
                implement, you can inject services similar to what you've seen with the controllers with an ASP.NET Core
                technology. The MVVM design pattern was invented by John Gossman of the Expression Blend team as a great
                fit to XAML with advancements to the Model-View-Controller (MVC) and Model-View-Presenter (MVP) patterns
                because it uses data binding, a number-one feature of XAML.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">对于基于 XAML
                            的应用程序，使用依赖注入是有帮助的。模型-视图-视图模型（MVVM）设计模式有助于将视图与功能分离。通过你实现的视图模型，你可以像在 ASP.NET Core
                            技术中看到的控制器一样注入服务。MVVM 设计模式是由 Expression Blend 团队的 John Gossman 发明的，它非常适合
                            XAML，是对模型-视图-控制器（MVC）和模型-视图-呈现者（MVP）模式的改进，因为它使用了数据绑定，这是 XAML 的首要特性。</font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0010" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">With XAML-based applications, the XAML file and code-behind file
                are tightly coupled to each other. This makes it hard to reuse the code-behind and also hard to do unit
                testing. To solve this issue, the MVVM pattern allows for a better separation of the code from the user
                interface.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">基于 XAML 的应用程序中，XAML
                            文件和代码隐藏文件紧密耦合在一起。这使得代码隐藏难以重用，同时也难以进行单元测试。为了解决这个问题，MVVM 模式允许更好地将代码与用户界面分离。</font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0011" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">In principle, the MVVM pattern is not that hard to understand.
                However, when you're creating applications based on the MVVM pattern, you need to pay attention to a lot
                more needs; several patterns come into play for making applications work and making reuse possible,
                including dependency injection mechanisms for being independent of the implementation and communication
                between view models.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">原则上，MVVM 模式并不难理解。然而，当你基于 MVVM
                            模式创建应用程序时，需要关注更多需求；为了使应用程序能够运行并实现重用，需要运用多种模式，包括实现独立性的依赖注入机制以及视图模型之间的通信。</font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0012" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">All this is covered in this chapter, and with this information
                not only can you use the same code with Windows apps and Windows desktop applications, but you can also
                use it for iOS and Android with the help of Xamarin.Forms and .NET MAUI. This chapter gives you a sample
                app that covers all the different aspects and patterns needed for a good separation to support different
                technologies.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本章涵盖了所有这些内容，凭借这些信息，你不仅可以在 Windows 应用和
                            Windows 桌面应用程序中使用相同的代码，还可以借助 Xamarin.Forms 和.NET MAUI 将其用于 iOS 和
                            Android。本章提供了一个示例应用程序，涵盖了实现良好分离所需的所有不同方面和模式，以支持不同的技术。</font>
                    </font>
                </font>
            </p>
        </section>
        <section aria-labelledby="head-2-265" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
            <span id="c30-sec-0005" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
            <h2 id="head-2-265" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">DEFINING THE MVVM PATTERN<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">定义 MVVM 模式</font>
                    </font>
                </font>
            </h2>
            <p id="c30-para-0013" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">First, let's take a look at the MVC design pattern that is one of
                the origins of the MVVM pattern. The Model-View-Controller pattern separates the model, the view, and
                the controller (see <a href="#c30-fig-0001" id="R_c30-fig-0001"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Figure 30-1</a>). The <i
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">model</i> defines the data
                that is shown in the view as well as the business rules about how the data can be changed and
                manipulated. The <i
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">controller</i> is the manager
                between the model and the view, it updates the model, and it sends data for display to the view. When a
                user request comes in, the controller takes action, uses the model, and updates the <i
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">view</i>.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">首先，让我们来看看 MVC 设计模式，它是 MVVM
                            模式的一个起源。模型-视图-控制器模式将模型、视图和控制器分离（见图
                            30-1）。模型定义了视图显示的数据以及关于数据如何被改变和操作的业务规则。控制器是模型和视图之间的管理者，它更新模型，并将数据显示数据发送给视图。当用户请求到来时，控制器会采取行动，使用模型并更新视图。
                        </font>
                    </font>
                </font><span aria-label="878" epub:type="pagebreak" id="Page_878" role="doc-pagebreak"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span></p>
            <figure data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"> <img
                    alt="Schematic illustration of defining the M V V M pattern." class="center"
                    src="images/c30f001.png" />
                <figcaption data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><span class="figureLabel"
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><a
                                href="#R_c30-fig-0001" id="c30-fig-0001" role="doc-backlink"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><b
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                                    data-immersive-translate-paragraph="1">FIGURE 30-1<font
                                        class="notranslate immersive-translate-target-wrapper"
                                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">
                                              </font>
                                        <font
                                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                            data-immersive-translate-translation-element-mark="1">
                                            <font
                                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                data-immersive-translate-translation-element-mark="1">图 30-1</font>
                                        </font>
                                    </font></b></a></span></p>
                </figcaption>
            </figure>
            <aside data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                <div class="top hr" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <p id="c30-para-0015" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NOTE</b> <i
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">The MVC pattern is
                            heavily used with ASP.NET Core MVC, which is covered in <a href="c26.xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Chapter 26</a>,
                            “Razor Pages and MVC.”</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意 MVC 模式在 ASP.NET Core MVC
                                    中大量使用，后者在《第 26 章：Razor Pages 和 MVC》中有介绍。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                        <hr />
                    </div>
                </section>
            </aside>
            <p id="c30-para-0016" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">With the Model-View-Presenter pattern (see <a
                    href="#c30-fig-0002" id="R_c30-fig-0002"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Figure 30-2</a>), the user
                interacts with the view. The presenter contains all the business logic for the view. The presenter can
                be decoupled from the view by using an interface to the view as a contract. This allows you to easily
                change the view implementation for unit tests. With MVP, the view and model are completely shielded from
                each other.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在模型-视图-呈现者模式（见图
                            30-2）中，用户与视图交互。呈现者包含了视图的所有业务逻辑。通过使用视图的接口作为契约，呈现者可以与视图解耦。这允许你为单元测试轻松地更改视图实现。在 MVP
                            中，视图和模型完全相互隔离。</font>
                    </font>
                </font>
            </p>
            <figure data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"> <img
                    alt="Schematic illustration of defining the M V V M pattern." class="center"
                    src="images/c30f002.png" />
                <figcaption data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><span class="figureLabel"
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><a
                                href="#R_c30-fig-0002" id="c30-fig-0002" role="doc-backlink"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><b
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                                    data-immersive-translate-paragraph="1">FIGURE 30-2<font
                                        class="notranslate immersive-translate-target-wrapper"
                                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">
                                              </font>
                                        <font
                                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                            data-immersive-translate-translation-element-mark="1">
                                            <font
                                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                data-immersive-translate-translation-element-mark="1">图 30-2</font>
                                        </font>
                                    </font></b></a></span></p>
                </figcaption>
            </figure>
            <p id="c30-para-0017" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The main pattern used with XAML-based applications is the
                Model-View-ViewModel pattern (see <a href="#c30-fig-0003" id="R_c30-fig-0003"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Figure 30-3</a>). This
                pattern takes advantage of the data-binding capabilities with XAML. With MVVM, the user interacts with
                the view. The view uses data binding to access information from the view model and invokes commands in
                the view model that are bound in the view as well. The view model doesn't have a direct dependency to
                the view. The view model itself uses the model to access data and gets change information from the model
                as well.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">主要与基于 XAML 的应用程序一起使用的模式是
                            Model-View-ViewModel 模式（见图 30-3）。该模式利用了 XAML 的数据绑定功能。通过
                            MVVM，用户与视图交互。视图使用数据绑定从视图模型中获取信息，并调用视图模型中绑定在视图中的命令。视图模型不直接依赖于视图。视图模型本身使用模型来访问数据，并从模型中获取变更信息。
                        </font>
                    </font>
                </font><span aria-label="879" epub:type="pagebreak" id="Page_879" role="doc-pagebreak"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span></p>
            <figure data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"> <img
                    alt="Snapshot of the main pattern used with XAML-based applications is the Model-View-ViewModel pattern."
                    class="center" src="images/c30f003.png" />
                <figcaption data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><span class="figureLabel"
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><a
                                href="#R_c30-fig-0003" id="c30-fig-0003" role="doc-backlink"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><b
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                                    data-immersive-translate-paragraph="1">FIGURE 30-3<font
                                        class="notranslate immersive-translate-target-wrapper"
                                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">
                                              </font>
                                        <font
                                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                            data-immersive-translate-translation-element-mark="1">
                                            <font
                                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                data-immersive-translate-translation-element-mark="1">图 30-3</font>
                                        </font>
                                    </font></b></a></span></p>
                </figcaption>
            </figure>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">In the following sections of this chapter, you will see how to
                use this architecture with the application to create views, view models, models, and other patterns that
                are needed.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            在本章的后续部分，您将看到如何使用此架构与应用程序一起创建视图、视图模型、模型以及其他所需的模式。</font>
                    </font>
                </font>
            </p>
            <aside data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                <div class="top hr" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <p id="c30-para-0019" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NOTE</b> <i
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">To reuse code with
                            libraries, make sure to read <a href="c14.xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Chapter 14</a>,
                            “Libraries, Assemblies, Packages, and NuGet.”</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意 要通过库重用代码，请确保阅读第 14
                                    章“库、程序集、包和 NuGet”。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                        <hr />
                    </div>
                </section>
            </aside>
        </section>
        <section aria-labelledby="head-2-266" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
            <span id="c30-sec-0008" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
            <h2 id="head-2-266" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">SAMPLE SOLUTION<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">示例解决方案</font>
                    </font>
                </font>
            </h2>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The sample solution consists of a WinUI application for showing
                and editing a list of books. The solution uses these projects:<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">示例解决方案包含一个用于显示和编辑书籍列表的 WinUI
                            应用程序。该解决方案使用以下项目：</font>
                    </font>
                </font>
            </p>
            <ul class="check" id="c30-list-0003" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                <li id="c30-li-0010" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1"><b
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp</b>—A WinUI
                    application project for the UI of a modern app. This application contains the views for the app with
                    XAML code and platform-specific implementation of services.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">BooksApp—一个用于现代应用程序 UI 的 WinUI
                                应用程序项目。该应用程序包含使用 XAML 代码和特定平台的服务实现的应用视图。</font>
                        </font>
                    </font>
                </li>
                <li id="c30-li-0011" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1"><b
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib</b>—A .NET 5
                    library with models, view models, and services to create, read, and update books.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">BooksLib—一个.NET 5
                                库，包含用于创建、读取和更新书籍的模型、视图模型和服务。</font>
                        </font>
                    </font>
                </li>
                <li id="c30-li-0012" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1"><b
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels</b>—A
                    .NET 5 library with view model base classes that can be used across different projects.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">GenericViewModels—一个.NET 5
                                库，包含可在不同项目中使用的视图模型基类。</font>
                        </font>
                    </font>
                </li>
            </ul>
            <p id="c30-para-0021" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">This application uses the NuGet package <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm</code>,
                which has core classes that are employed in applications using the MVVM pattern. Many other MVVM
                libraries are available for you to use as well, and you can easily create the core functionality needed
                for MVVM with your custom implementation. As we now have an MVVM library from Microsoft, this chapter
                makes use of it.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">这个应用程序使用 NuGet 包 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm</code>
                            ，其中包含在采用 MVVM 模式的应用程序中使用的核心类。还有许多其他 MVVM 库可供您使用，并且您可以通过自定义实现轻松创建 MVVM 所需的核心功能。由于我们现在有了来自微软的
                            MVVM 库，因此本章将使用它。</font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0022" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The user interface of the application will have two views: one
                view to show as a list of books and one view to show book details. When you select a book from the list,
                the detail is shown. It's also possible to add and edit books.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            应用程序的用户界面将有两个视图：一个视图用于显示书籍列表，另一个视图用于显示书籍详情。当您从列表中选择一本书时，将显示其详情。还可以添加和编辑书籍。</font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0023" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib</code> and <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels</code>
                libraries can be used by multiple applications with XAML code—for example, with WinUI, Platform Uno, and
                .NET MAUI.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1"> <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib</code> 和
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels</code>
                            库可以通过 XAML 代码在多个应用程序中使用——例如，使用 WinUI、Platform Uno 和 .NET MAUI。</font>
                    </font>
                </font>
            </p>
        </section>
        <section aria-labelledby="head-2-267" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
            <span id="c30-sec-0009" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
            <h2 id="head-2-267" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">MODELS</h2>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">Let's start defining the models, particularly the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Book</code> type. This is the
                type that will be shown and edited in the UI. To support data binding, the properties where values are
                updated from the user interface need a change notification implementation. The <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookId</code> property is
                only shown but not changed, so change notification is not needed with this property. The method <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SetProperty</code> is defined
                by the base class <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ObservableObject</code> that
                is defined in the namespace <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm.ComponentModel</code>
                in the NuGet package <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm</code>
                (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Models/Book.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">让我们开始定义模型，特别是 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Book</code>
                            类型。这是将在 UI 中显示和编辑的类型。为了支持数据绑定，需要从用户界面更新值的属性具有一个变更通知实现。 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookId</code>
                            属性仅显示但不更改，因此此属性不需要变更通知。方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SetProperty</code>
                            由在 NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm</code>
                            中定义的命名空间 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm.ComponentModel</code>
                            中的基类 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ObservableObject</code>
                            定义（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Models/Book.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0001"><code>public class Book: ObservableObject</code>
<code>{</code>
<code>  public Book(string? title = null, string? publisher = null, int id = 0)</code>
<code>  {</code>
<code>    BookId = id;</code>
<code>    _title = title ?? string.Empty;</code>
<code>    _publisher = publisher ?? string.Empty;</code>
<code>  }</code>
<code> </code>
<code>  public int BookId { get; set; }</code>
<code> <span aria-label="880" epub:type="pagebreak" id="Page_880" role="doc-pagebreak"></span></code>
<code>  private string _title;</code>
<code>  public string Title</code>
<code>  {</code>
<code>    get =&gt;  _title; </code>
<code>    set =&gt; SetProperty(ref _title, value);</code>
<code>  }</code>
<code> </code>
<code>  private string _publisher;</code>
<code>  public string Publisher</code>
<code>  {</code>
<code>    get =&gt; _publisher;</code>
<code>    set =&gt; SetProperty(ref _publisher, value);</code>
<code>  }</code>
<code> </code>
<code>  public override string ToString() =&gt; Title;</code>
<code>}</code></pre>
            <aside data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                <div class="top hr" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <p id="c30-para-0026" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NOTE</b> <i
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">The</i> <code
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ObservableObject</code>
                        <i data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">class implements the
                            interface</i> <code
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INotifyPropertyChanged</code>
                        <i data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">. This interface is
                            used with data binding of XAML-based applications to notify the user interface that a change
                            occurred in the data source. You need to specify</i> <code
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OneWay</code> <i
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">or</i> <code
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">TwoWay</code> <i
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">binding to use</i>
                        <code
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INotifyPropertyChanged</code>
                        <i data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">from the data sources
                            with the</i> <code
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Mode</code> <i
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">property of the
                            binding markup extension.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ObservableObject</code>
                                    类实现了接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INotifyPropertyChanged</code>
                                    。此接口用于基于 XAML 的应用程序的数据绑定，以通知用户界面数据源发生了更改。您需要指定 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OneWay</code>
                                    或 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">TwoWay</code>
                                    绑定，以使用绑定标记扩展的 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Mode</code>
                                    属性从数据源获取 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INotifyPropertyChanged</code>
                                    。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                        <hr />
                    </div>
                </section>
            </aside>
            <p id="c30-para-0027" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">Next, you need a way to retrieve, update, and delete <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Book</code> objects. You can
                read and write books from a database with EF Core or call a REST API or use RPC to access a service. The
                sample application just accesses books from the memory, but you can create an API service and a service
                class to call this API service. To make this easy, the contracts of the repository pattern are specified
                using the task-based async pattern where you can create a different implementation using the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">HttpClient</code> class as
                covered in <a href="c25.xhtml"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Chapter 25</a>.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">接下来，你需要一种方法来获取、更新和删除 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Book</code>
                            对象。你可以使用 EF Core 从数据库中读取和写入书籍，或者调用 REST API 或使用 RPC 来访问服务。示例应用程序只是从内存中访问书籍，但你也可以创建一个 API
                            服务和一个服务类来调用这个 API 服务。为了简化操作，仓库模式（repository pattern）的契约使用基于任务的异步模式（task-based async
                            pattern）来指定，其中你可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">HttpClient</code>
                            类来创建不同的实现，如第 25 章所述。</font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0028" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">With the client application, it's best to be independent of the
                data store. For this, the repository design pattern was defined. The <i
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">repository</i> pattern is a
                mediator between the model and the data access layer; it can act as an in-memory collection of objects.
                It gives an abstraction of the data access layer and allows for easier unit tests.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            对于客户端应用程序，最好与数据存储独立。为此，定义了仓库设计模式。仓库模式是模型和数据访问层之间的中介；它可以作为对象内存集合来发挥作用。它提供了数据访问层的抽象，并允许更容易地进行单元测试。
                        </font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The generic interface <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IQueryRepository</code>
                defines methods for retrieving one item by ID or a list of items (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Services/IQueryRepository.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">泛型接口 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IQueryRepository</code>
                            定义了通过 ID 获取单个项目或获取项目列表的方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Services/IQueryRepository.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0002"><code>public interface IQueryRepository&lt;T, in TKey&gt;</code>
<code>  where T: class</code>
<code>{</code>
<code>  Task&lt;T?&gt; GetItemAsync(TKey id);</code>
<code>  Task&lt;IEnumerable&lt;T&gt;&gt; GetItemsAsync();</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The generic interface <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IUpdateRepository</code>
                defines methods to add, update, and delete items (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Services/IUpdateRepository.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">泛型接口 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IUpdateRepository</code>
                            定义了添加、更新和删除项目的方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Services/IUpdateRepository.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0003"><code>public interface IUpdateRepository&lt;T, in TKey&gt;</code>
<code>  where T: class</code>
<code>{</code>
<code>  Task&lt;T&gt; AddAsync(T item);</code>
<code>  Task&lt;T&gt; UpdateAsync(T item);</code>
<code>  Task&lt;bool&gt; DeleteAsync(TKey id);</code></pre>
            <p id="c30-para-0031" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">}</p>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1"><span aria-label="881" epub:type="pagebreak" id="Page_881"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>The <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IBooksRepository</code>
                interface makes the previous two generic interfaces concrete by defining the type <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Book</code> for the generic
                type <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">T</code> (code file
                <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Services/IBooksRepository.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1"> <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IBooksRepository</code>
                            接口通过定义通用类型 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">T</code> 的类型
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Book</code>
                            使前两个通用接口具体化（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Services/IBooksRepository.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0004"><code>public interface IBooksRepository: IQueryRepository&lt;Book, int&gt;,</code>
<code>  IUpdateRepository&lt;Book, int&gt;</code>
<code>{</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">By using these interfaces, it's possible to change the
                repository. Create a sample repository <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksSampleRepository</code>
                that implements the members of the interface <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IBooksRepository</code> and
                contains a list of initial books (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Services/BooksSampleRepository.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用这些接口，可以更改存储库。创建一个实现接口 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IBooksRepository</code>
                            成员的示例存储库 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksSampleRepository</code>
                            ，其中包含初始书籍列表（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Services/BooksSampleRepository.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0005"><code>public class BooksSampleRepository: IBooksRepository</code>
<code>{</code>
<code>  Private readonly List&lt;Book&gt; _books;</code>
<code>  public BooksSampleRepository() =&gt;</code>
<code>    _books = GetSampleBooks();</code>
<code> </code>
<code>  private List&lt;Book&gt; GetSampleBooks() =&gt;</code>
<code>    new()</code>
<code>    {</code>
<code>      new("Professional C# and .NET - 2021 Edition", "Wrox Press", 1),</code>
<code>      new("Professional C# 7 and .NET Core 2", "Wrox Press", 2),</code>
<code>      new("Professional C# 6 and .NET Core 1.0", "Wrox Press", 3),</code>
<code>      new("Professional C# 5.0 and .NET 4.5.1", "Wrox Press", 4),</code>
<code>      new("Enterprise Services with the .NET Framework", "AWL", 5)</code>
<code>    };</code>
<code> </code>
<code>  public Task&lt;bool&gt; DeleteAsync(int id)</code>
<code>  {</code>
<code>    Book? bookToDelete = _books.Find(b =&gt; b.BookId == id);</code>
<code>    if (bookToDelete is not null)</code>
<code>    {</code>
<code>      return Task.FromResult&lt;bool&gt;(_books.Remove(bookToDelete));</code>
<code>    }</code>
<code>    return Task.FromResult&lt;bool&gt;(false);</code>
<code>  }</code>
<code> </code>
<code>  public Task&lt;Book?&gt; GetItemAsync(int id) =&gt;</code>
<code>    Task.FromResult(_books.Find(b =&gt; b.BookId == id));</code>
<code> </code>
<code>  public Task&lt;IEnumerable&lt;Book&gt;&gt; GetItemsAsync() =&gt;</code>
<code>    Task.FromResult&lt;IEnumerable&lt;Book&gt;&gt;(_books);</code>
<code> </code>
<code>  public Task&lt;Book&gt; UpdateAsync(Book item)</code>
<code>  {</code>
<code>    Book bookToUpdate = _books.Single(b =&gt; b.BookId == item.BookId);</code>
<code>    int ix = _books.IndexOf(bookToUpdate);</code>
<code>    _books[ix] = item;</code>
<code>    return Task.FromResult(_books[ix]);</code>
<code>  }</code>
<code> </code>
<code>  public Task&lt;Book&gt; AddAsync(Book item)</code>
<code>  {<span aria-label="882" epub:type="pagebreak" id="Page_882" role="doc-pagebreak"></span></code>
<code>    item.BookId = _books.Select(b =&gt; b.BookId).Max() + 1;</code>
<code>    _books.Add(item);</code>
<code>    return Task.FromResult(item);</code>
<code>  }</code>
<code>}</code></pre>
        </section>
        <section aria-labelledby="head-2-268" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
            <span id="c30-sec-0011" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
            <h2 id="head-2-268" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">SERVICES</h2>
            <p id="c30-para-0034" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">To get the books from the repository, you use a service, and you
                can use it across multiple view models that access the same data. Thus, the service is a good place to
                share data between view models.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            要从存储库获取书籍，您使用服务，并且可以在访问相同数据的多个视图模型中使用它。因此，服务是视图模型之间共享数据的良好位置。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The sample service for the books implements the generic interface
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code>. This
                interface defines the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Items</code> property of a
                type <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ObservableCollection</code>.
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ObservableCollection</code>
                implements the interface <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INotifyCollectionChanged</code>
                for notifications when the collection changes. The interface <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code> also
                defines the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SelectedItem</code> property
                and change notification with the event <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SelectedItemChanged</code>.
                Aside from that, the methods <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">RefreshAsync</code>, <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">AddOrUpdateAsync</code>, and
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">DeleteAsync</code> need to
                be implemented by the service class (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/Services/IItemsService.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">书籍样本服务实现了通用接口 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code>
                            。该接口定义了类型 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ObservableCollection</code>
                            的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Items</code> 属性。
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ObservableCollection</code>
                            实现了接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INotifyCollectionChanged</code>
                            以在集合变化时发送通知。接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code>
                            还定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SelectedItem</code>
                            属性和通过事件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SelectedItemChanged</code>
                            发送的变化通知。除此之外，服务类（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/Services/IItemsService.cs</code>
                            ）需要实现方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">RefreshAsync</code>
                            、 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">AddOrUpdateAsync</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">DeleteAsync</code>
                            ：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0006"><code>public interface IItemsService&lt;T&gt;</code>
<code>{</code>
<code>  Task RefreshAsync();</code>
<code> </code>
<code>  Task&lt;T&gt; AddOrUpdateAsync(T item);</code>
<code> </code>
<code>  Task DeleteAsync(T item);</code>
<code> </code>
<code>  ObservableCollection&lt;T&gt; Items { get; }</code>
<code> </code>
<code>  T? SelectedItem { get; set; }</code>
<code>  event EventHandler&lt;T&gt;? SelectedItemChanged;</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The class <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksService</code> derives
                from the base class <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ObservableObject</code> and
                implements the generic interface <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code>. The
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksService</code> uses
                the previously created <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SampleBooksRepository</code>
                but requires the functionality of this class offered by the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IBooksRepository</code>
                interface. The class is injected via the constructor and used on refreshing the books list, adding or
                updating books, and deleting books (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Services/BooksService.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">类 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksService</code>
                            继承自基础类 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ObservableObject</code>
                            并实现了通用接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code>
                            。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksService</code>
                            使用了先前创建的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SampleBooksRepository</code>
                            ，但需要 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IBooksRepository</code>
                            接口提供的此类功能。该类通过构造函数注入，并在刷新书籍列表、添加或更新书籍以及删除书籍时使用（代码文件 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Services/BooksService.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0007"><code>public class BooksService : ObservableObject, IItemsService&lt;Book&gt;</code>
<code>{     </code>
<code>  Private readonly ObservableCollection&lt;Book&gt; _books = new();</code>
<code>  private readonly IBooksRepository _booksRepository;</code>
<code> </code>
<code>  public event EventHandler&lt;Book&gt;? SelectedItemChanged;</code>
<code> </code>
<code>  public BooksService(IBooksRepository repository)</code>
<code>  {</code>
<code>    _booksRepository = repository;</code>
<code>  }</code>
<code> </code>
<code>  public ObservableCollection&lt;Book&gt; Items =&gt; _books;</code>
<code> </code>
<code>  private Book? _selectedItem;</code>
<code>  public Book? SelectedItem</code>
<code>  {<span aria-label="883" epub:type="pagebreak" id="Page_883" role="doc-pagebreak"></span></code>
<code>    get =&gt; _selectedItem;</code>
<code>    set</code>
<code>    {</code>
<code>      if (value is not null &amp;&amp; SetProperty(ref _selectedItem, value))</code>
<code>      {</code>
<code>        SelectedItemChanged?.Invoke(this, _selectedItem);</code>
<code>      }</code>
<code>    }</code>
<code>  }</code>
<code> </code>
<code>  public async Task&lt;Book&gt; AddOrUpdateAsync(Book book)</code>
<code>  {</code>
<code>    if (book.BookId == 0)</code>
<code>    {</code>
<code>      return await _booksRepository.AddAsync(book);</code>
<code>    }</code>
<code>    else</code>
<code>    {</code>
<code>      return await _booksRepository.UpdateAsync(book);</code>
<code>    }</code>
<code>  }</code>
<code> </code>
<code>  public Task DeleteAsync(Book book) =&gt;</code>
<code>    _booksRepository.DeleteAsync(book.BookId);</code>
<code> </code>
<code>  public async Task RefreshAsync()</code>
<code>  {</code>
<code>    IEnumerable&lt;Book&gt; books = await _booksRepository.GetItemsAsync();</code>
<code>    _books.Clear();</code>
<code>    foreach (var book in books)</code>
<code>    {</code>
<code>      _books.Add(book);</code>
<code>    }</code>
<code>    SelectedItem = Items.FirstOrDefault();</code>
<code>  }</code>
<code>}</code></pre>
            <p id="c30-para-0037" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">Now that the service functionality is in place, let's move on to
                the view models.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">现在服务功能已就绪，让我们继续讨论视图模型。</font>
                    </font>
                </font>
            </p>
        </section>
        <section aria-labelledby="head-2-269" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
            <span id="c30-sec-0012" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
            <h2 id="head-2-269" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">VIEW MODELS<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">视图模型</font>
                    </font>
                </font>
            </h2>
            <p id="c30-para-0038" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">Every view or page has a view model. With the sample app, the
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code> has the
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksViewModel</code>
                associated. Later in the sample, you'll see that user controls can have their specific view models as
                well, but this is not always necessary. The <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code> has the
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailViewModel</code>
                associated. It's a UI design decision if the list of books and details can be implemented in the same
                page. That's a matter of the available screen size of the app: what can fit on the screen? With the
                sample application, a flexible approach was taken. If the size available for the app is large enough,
                the <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code> shows
                the list and the details; if the size is not large enough, data will be shown in separate pages with
                navigation between.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">每个视图或页面都有一个视图模型。在示例应用中， <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                            与 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksViewModel</code>
                            相关联。在示例的后续部分，您将看到用户控件也可以有自己的特定视图模型，但这并不总是必要的。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code>
                            与 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailViewModel</code>
                            相关联。是否可以将书籍列表和详细信息实现在同一页面上，这是一个 UI 设计决策。这取决于应用的可用屏幕尺寸：屏幕上能容纳什么？在示例应用中，采取了灵活的方法。如果应用的可用空间足够大，
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                            会显示列表和详细信息；如果空间不够大，数据将在不同的页面中显示，并通过导航进行切换。</font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0039" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">There's a one-to-one mapping between page view and view model. In
                reality, there's a many-to-one mapping between view and view model because the same view can be
                implemented multiple times with different technologies—WinUI, WPF, Platform Uno, and others. This makes
                it important that the view model doesn't know anything about the view, but the view knows the view
                model. The view model is implemented in a .NET library, which allows using it from many technologies.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            页面视图和视图模型之间存在一一对应关系。实际上，视图和视图模型之间存在多对一对应关系，因为同一个视图可以用不同的技术实现多次——WinUI、WPF、Platform Uno
                            等。这使得确保视图模型不知道任何关于视图的信息，而视图知道视图模型变得非常重要。视图模型是在 .NET 库中实现的，这允许从多种技术中使用它。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1"><span aria-label="884" epub:type="pagebreak" id="Page_884"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>For common
                functionality of view models, it makes sense to create base classes. The <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels</code>
                library contains a <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ViewModelBase</code> class
                that implements features for progress information and for errors (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/ViewModels/ViewModelBase.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">对于视图模型中的通用功能，创建基类是合理的。 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels</code>
                            库包含一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ViewModelBase</code>
                            类，该类实现了进度信息和错误处理功能（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/ViewModels/ViewModelBase.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0008"><code>public abstract class ViewModelBase : ObservableObject</code>
<code>{</code>
<code>  // functionality for progress information and </code>
<code>  // error information</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The sample application shows a list of books and allows the user
                to select a book. Here, it is useful to define a generic base class for the view models with the
                properties <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Items</code> and
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SelectedItem</code>. The
                implementation of these properties makes use of the previously created service that implements the
                interface <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code> (code
                file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/ViewModels/MasterDetailViewModel.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">示例应用程序显示书籍列表，并允许用户选择一本书。在此，定义一个具有
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Items</code> 和
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SelectedItem</code>
                            属性的通用基类是有用的。这些属性的实现利用了先前创建的服务，该服务实现了接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code>
                            （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/ViewModels/MasterDetailViewModel.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0009"><code>public abstract class MasterDetailViewModel&lt;TItemViewModel, TItem&gt; : </code>
<code>  ViewModelBase</code>
<code>  where TItemViewModel : IItemViewModel&lt;TItem&gt;</code>
<code>  where IItem: class </code>
<code>{</code>
<code>  private readonly IItemsService&lt;TItem&gt; _itemsService;</code>
<code> </code>
<code>  public MasterDetailViewModel(IItemsService&lt;TItem&gt; itemsService)</code>
<code>  {</code>
<code>    _itemsService = itemsService;</code>
<code> </code>
<code>    //…</code>
<code>  }</code>
<code> </code>
<code>  public ObservableCollection&lt;TItem&gt; Items =&gt; _itemsService.Items;</code>
<code> </code>
<code>  protected TItem? _selectedItem;</code>
<code>  public virtual TItem? SelectedItem</code>
<code>  {</code>
<code>    get =&gt; _itemsService.SelectedItem;</code>
<code>    set</code>
<code>    {</code>
<code>      if (!EqualityComparer&lt;TItem&gt;.Default.Equals(</code>
<code>        _itemsService.SelectedItem, value))</code>
<code>      {</code>
<code>        _itemsService.SelectedItem = value;</code>
<code>        OnPropertyChanged();</code>
<code>      }</code>
<code>    }</code>
<code>  }</code>
<code> </code>
<code>  //…</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">To display a single item in detail, the base class <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ItemViewModel</code> defines
                an <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Item</code> property
                (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/ViewModels/ItemViewModel.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">为了详细显示单个项目，基类 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ItemViewModel</code>
                            定义了一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Item</code>
                            属性（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/ViewModels/ItemViewModel.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0010"><code>public abstract class ItemViewModel&lt;T&gt; : ViewModelBase, IItemViewModel&lt;T&gt;</code>
<code>{</code>
<code>  public ItemViewModel(T item) =&gt; _item = item;</code>
<code> <span aria-label="885" epub:type="pagebreak" id="Page_885" role="doc-pagebreak"></span></code>
<code>  private T _item;</code>
<code>  public virtual T Item</code>
<code>  {</code>
<code>    get =&gt; _item;</code>
<code>    set =&gt; Set(ref _item, value);</code>
<code>  }</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">More complex than the simple class <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ItemViewModel</code> is the
                view model class <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>.
                This class extends <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ItemViewModel</code> by
                allowing editing, and thus it defines a read or edit mode. The property <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsReadMode</code> is just the
                inverse of <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsEditMode</code>. The <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>
                makes use of the same service as the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MasterDetailViewModel</code>
                class, the service that implements the interface <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code>. This
                way, the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>
                and <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MasterDetailViewModel</code>
                classes can share the same items and the same selection. The view model class allows the user to cancel
                the input. For this, the item has a copied version with the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditItem</code> property
                (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/ViewModels/EditableItemViewModel.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">比简单的类 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ItemViewModel</code>
                            更复杂的是视图模型类 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>
                            。此类通过允许编辑扩展了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ItemViewModel</code>
                            ，因此它定义了只读或编辑模式。属性 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsReadMode</code>
                            只是 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsEditMode</code>
                            的反向。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>
                            利用了与 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MasterDetailViewModel</code>
                            类相同的相同服务，即实现了接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code>
                            的服务。这样， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MasterDetailViewModel</code>
                            类可以共享相同的项和相同的选中项。视图模型类允许用户取消输入。为此，项有一个带有 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditItem</code>
                            属性的副本（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/ViewModels/EditableItemViewModel.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0011"><code>public abstract class EditableItemViewModel&lt;TItem&gt; : ItemViewModel&lt;TItem&gt;, </code>
<code>  IEditableObject</code>
<code>  where TItem : class</code>
<code>{</code>
<code>  private readonly IItemsService&lt;TItem&gt; _itemsService;</code>
<code> </code>
<code>  public EditableItemViewModel(IItemsService&lt;TItem&gt; itemsService)</code>
<code>    : base(itemsService.SelectedItem ?? throw new InvalidOperationException())</code>
<code>  {</code>
<code>    _itemsService = itemsService;</code>
<code> </code>
<code>    PropertyChanged += (sender, e) =&gt;</code>
<code>    {</code>
<code>      if (e.PropertyName == nameof(Item))</code>
<code>      {</code>
<code>        OnPropertyChanged(nameof(EditItem));</code>
<code>      }</code>
<code>    };</code>
<code>    //…</code>
<code>  }</code>
<code> </code>
<code>  //…</code>
<code>  private bool _isEditMode;</code>
<code>  public bool IsReadMode =&gt; !IsEditMode;</code>
<code>  public bool IsEditMode</code>
<code>  {</code>
<code>    get =&gt; _isEditMode;</code>
<code>    set</code>
<code>    {</code>
<code>      if (Set(ref _isEditMode, value))</code>
<code>      {</code>
<code>        OnPropertyChanged(nameof(IsReadMode));</code>
<code>        //…</code>
<code>      }</code>
<code>    }</code>
<code>  }</code>
<code> </code>
<code>  private TItem? _editItem;</code>
<code>  public TItem? EditItem<span aria-label="886" epub:type="pagebreak" id="Page_886" role="doc-pagebreak"></span></code>
<code>  {</code>
<code>    get =&gt; _editItem ?? Item;</code>
<code>    set =&gt; Set(ref _editItem, value);</code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
            <section data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><span id="c30-sec-0013"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
                <h3 id="head-3-573" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">IEditableObject</h3>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">An interface that defines methods to change an object between
                    different edit states is <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IEditableObject</code>.
                    This interface is defined in the namespace <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">System.ComponentModel</code>.
                    <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IEditableObject</code>
                    defines the methods <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BeginEdit</code>, <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CancelEdit</code>, and
                    <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EndEdit</code>. <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BeginEdit</code> is
                    invoked to change the item from the read mode to the edit mode. <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CancelEdit</code> cancels
                    the edit and switches back to read mode. <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EndEdit</code> is for a
                    successful end of the edit mode and, thus, needs to save the data. The <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>
                    class implements the methods of this interface by switching the edit mode, creating a copy of the
                    item, and saving the state. This view model class is a generic one and doesn't know what should be
                    done for copying and saving the item. Copying would be possible by using binary serialization.
                    However, not all objects support binary serialization. Instead, the implementation is forwarded to
                    the class that derives from <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>,
                    similar to the save method <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnSaveAsync</code>. <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnSaveAsync</code> and
                    <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CreateCopy</code> are
                    defined as abstract methods and thus need to be implemented by the derived class. Another method is
                    defined to be invoked at the end of <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CancelEdit</code> and
                    <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EndEdit</code>
                    : <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnEndEditAsync</code>.
                    This method can be implemented by a derived class, but it's not necessary to do. That's why the
                    method is declared virtual with an empty body (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/ViewModels/EditableItemViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">定义了在不同编辑状态间切换对象的方法的接口是 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IEditableObject</code>
                                。该接口在命名空间 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">System.ComponentModel</code>
                                中定义。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IEditableObject</code>
                                定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BeginEdit</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CancelEdit</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EndEdit</code>
                                这三个方法。调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BeginEdit</code>
                                可以将项目从读取模式切换到编辑模式。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CancelEdit</code>
                                取消编辑并切换回读取模式。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EndEdit</code>
                                用于编辑模式成功结束，因此需要保存数据。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>
                                类通过切换编辑模式、创建项目副本和保存状态来实现该接口的方法。这个视图模型类是泛型的，不知道应该如何复制和保存项目。复制可以通过使用二进制序列化实现。然而，并非所有对象都支持二进制序列化。相反，实现被委托给继承自
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>
                                的类，类似于保存方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnSaveAsync</code>
                                。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnSaveAsync</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CreateCopy</code>
                                被定义为抽象方法，因此需要由派生类实现。定义了另一个方法，在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CancelEdit</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EndEdit</code>
                                结束时被调用： <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnEndEditAsync</code>
                                。这个方法可以被派生类实现，但并非必须。这就是为什么该方法被声明为虚拟的，并带有空体（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/ViewModels/EditableItemViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0012"><code>public virtual void BeginEdit()</code>
<code>{</code>
<code>  IsEditMode = true;</code>
<code>  TItem itemCopy = CreateCopy(Item);</code>
<code>  if (itemCopy != null)</code>
<code>  {</code>
<code>    EditItem = itemCopy;</code>
<code>  }</code>
<code>}</code>
<code> </code>
<code>public async virtual void CancelEdit()</code>
<code>{</code>
<code>  IsEditMode = false;</code>
<code>  EditItem = default;</code>
<code>  await _itemsService.RefreshAsync();</code>
<code>  await OnEndEditAsync();</code>
<code>}</code>
<code> </code>
<code>public async virtual void EndEdit()</code>
<code>{</code>
<code>  using var _ = StartInProgress();</code>
<code>  await OnSaveAsync();</code>
<code>  EditItem = default;</code>
<code>  IsEditMode = false;</code>
<code>  await _itemsService.RefreshAsync();</code>
<code>  await OnEndEditAsync();</code>
<code>}</code>
<code> </code>
<code>public abstract Task OnSaveAsync();</code>
<code>public abstract TItem CreateCopy(TItem item);</code>
<code>public virtual Task OnEndEditAsync() =&gt; Task.CompletedTask;</code>
<code> </code></pre>
            </section>
            <section data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><span id="c30-sec-0014"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
                <h3 id="head-3-574" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">Concrete View Model Implementations<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">具体视图模型实现</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1"><span aria-label="887" epub:type="pagebreak" id="Page_887"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>Let's move on to
                    the concrete implementations of the view models. <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailViewModel</code>
                    derives from <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>
                    and specifies <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Book</code> as the
                    generic parameter. With the base class already implementing the major functionality, this class can
                    be simple. It injects the services for the interfaces <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code> and
                    <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationSerivce</code>.
                    In the method <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnSaveAsync</code>, the
                    request is forwarded to the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code>. The
                    <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnSaveAsync</code>
                    method also makes use of the interfaces <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ILogger</code> and <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IMessageService</code>.
                    In the view model class, the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CreateCopy</code> method
                    implements the creation of a copy of the book. This method is invoked by the base class (code file
                    <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/ViewModels/BookDetailViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">接下来我们来看视图模型的具体实现。 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailViewModel</code>
                                继承自 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>
                                并将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Book</code>
                                指定为泛型参数。由于基类已经实现了主要功能，这个类可以很简单。它注入了用于接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationSerivce</code>
                                的服务。在方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnSaveAsync</code>
                                中，请求被转发给 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code>
                                。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnSaveAsync</code>
                                方法也使用了接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ILogger</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IMessageService</code>
                                。在视图模型类中， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CreateCopy</code>
                                方法实现了书籍副本的创建。这个方法由基类调用（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/ViewModels/BookDetailViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0013"><code>public class BookDetailViewModel : EditableItemViewModel&lt;Book&gt;</code>
<code>{</code>
<code>  private readonly IItemsService&lt;Book&gt; _itemsService;</code>
<code>  private readonly INavigationService _navigationService;</code>
<code>  private readonly IMessageService _messageService;</code>
<code>  private readonly ILogger _logger;</code>
<code> </code>
<code>  public BookDetailViewModel(IItemsService&lt;Book&gt; itemsService, </code>
<code>    INavigationService navigationService, IMessageService messageService, </code>
<code>    ILogger&lt;BookDetailViewModel&gt; logger)</code>
<code>    : base(itemsService)</code>
<code>  {</code>
<code>    _itemsService = itemsService;</code>
<code>    _navigationService = navigationService;</code>
<code>    _messageService = messageService;</code>
<code>    _logger = logger;</code>
<code> </code>
<code>    itemsService.SelectedItemChanged += (sender, book) =&gt;</code>
<code>    {</code>
<code>      Item = book;</code>
<code>    };</code>
<code>  }</code>
<code> </code>
<code>  public override Book CreateCopy(Book? item)</code>
<code>  {</code>
<code>    int id = item?.BookId ?? -1;</code>
<code>    string title = item?.Title ?? "enter a title";</code>
<code>    string publisher = item?.Publisher ?? "enter a publisher";</code>
<code>    return new Book(title, publisher, id);</code>
<code>  }</code>
<code> </code>
<code>  public override async Task OnSaveAsync()</code>
<code>  {</code>
<code>    try</code>
<code>    {</code>
<code>      if (EditItem is null) return;</code>
<code>      await _itemsService.AddOrUpdateAsync(EditItem);</code>
<code>    }</code>
<code>    catch (Exception ex)</code>
<code>    {</code>
<code>      _logger.LogError("error {0} in {1}", ex.Message, nameof(OnSaveAsync));</code>
<code>      await _dialogService.ShowMessageAsync("Error saving the data");</code>
<code>    }</code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><span aria-label="888"
                        epub:type="pagebreak" id="Page_888" role="doc-pagebreak"
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span></p>
                <aside data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <div class="top hr" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                        <p id="c30-para-0047" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NOTE</b> <i
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">The</i> <code
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ILogger</code> <i
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">interface is
                                explained in <a href="c16.xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Chapter
                                    16</a>, “Diagnostics and Metrics.” The interface</i> <code
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IDialogService</code>
                            <i data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">is discussed later
                                in this chapter in the section “Opening Dialogs from View Models.”</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ILogger</code>
                                        接口在第 16 章“诊断和指标”中解释。接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IDialogService</code>
                                        在本章稍后的“从视图模型中打开对话框”一节中讨论。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">The class <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksViewModel</code> can
                    be kept simple by inheriting the main functionality from <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MasterDetailViewModel</code>.
                    This class injects the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationService</code>
                    interface that will be discussed later, forwards the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code>
                    interface to the base class, and overrides the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnAdd</code> method that
                    is invoked by the base class (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/ViewModels/BooksViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">通过继承 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MasterDetailViewModel</code>
                                的主要功能，类 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksViewModel</code>
                                可以保持简单。这个类注入了稍后将讨论的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationService</code>
                                接口，将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IItemsService</code>
                                接口转发给基类，并覆盖了由基类调用的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnAdd</code>
                                方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/ViewModels/BooksViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0014"><code>public class BooksViewModel : MasterDetailViewModel&lt;BookItemViewModel, Book&gt;</code>
<code>{</code>
<code>  private readonly IItemsService&lt;Book&gt; _booksService;</code>
<code>  private readonly INavigationService _navigationService;</code>
<code> </code>
<code>  public BooksViewModel(IItemsService&lt;Book&gt; booksService, </code>
<code>    INavigationService navigationService)</code>
<code>    : base(booksService)</code>
<code>  {</code>
<code>    _booksService = booksService ?? </code>
<code>      throw new ArgumentNullException(nameof(booksService));</code>
<code>    _navigationService = navigationService ?? </code>
<code>      throw new ArgumentNullException(nameof(navigationService));</code>
<code>    //…</code>
<code>  }</code>
<code> </code>
<code>  public override void OnAdd()</code>
<code>  {</code>
<code>    Book newBook = new();</code>
<code>    Items.Add(newBook);</code>
<code>    SelectedItem = newBook;</code>
<code>  }</code>
<code> </code>
<code>  //…</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><span id="c30-sec-0016"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
                <h3 id="head-3-575" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">Commands<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">命令</font>
                        </font>
                    </font>
                </h3>
                <p id="c30-para-0049" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">The view models offer commands that implement the interface
                    <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ICommand</code>.
                    Commands allow a separation between the view and the command handler method via data binding.
                    Commands also offer the functionality to enable or disable the command. The <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ICommand</code> interface
                    defines the methods <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Execute</code> and <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CanExecute</code> and the
                    event <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CanExecuteChanged</code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">视图模型提供了实现接口 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ICommand</code>
                                的命令。命令通过数据绑定实现了视图与命令处理方法之间的分离。命令还提供了启用或禁用命令的功能。接口 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ICommand</code>
                                定义了方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Execute</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CanExecute</code>
                                以及事件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CanExecuteChanged</code>
                                。</font>
                        </font>
                    </font>
                </p>
                <p id="c30-para-0050" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">The class <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">RelayCommand</code> that
                    implements this interface is implemented in the NuGet package <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm</code>
                    in the namespace <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm.Input</code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">实现该接口的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">RelayCommand</code>
                                类在 NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm</code>
                                的命名空间 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm.Input</code>
                                中实现。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">The constructor of the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>
                    creates new <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">RelayCommand</code>
                    objects and assigns the previously shown methods <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BeginEdit</code>, <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CancelEdit</code>, and
                    <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EndEdit</code> on
                    execution of the commands. All these commands also check whether the command is available by using
                    the <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsReadMode</code>
                    and <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsEditMode</code>
                    properties. When the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsEditMode</code>
                    property changes, the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CanExecuteChanged</code>
                    event of the command is fired to update the command accordingly (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/ViewModels/EditableItemViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditableItemViewModel</code>
                                的构造函数在执行命令时创建了新的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">RelayCommand</code>
                                对象，并分配了前面所示的方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BeginEdit</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CancelEdit</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EndEdit</code>
                                。所有这些命令还会通过使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsReadMode</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsEditMode</code>
                                属性检查命令是否可用。当 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsEditMode</code>
                                属性发生变化时，命令的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CanExecuteChanged</code>
                                事件被触发以相应地更新命令（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/ViewModels/EditableItemViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0015"><code>public abstract class EditableItemViewModel&lt;TItem&gt; : ItemViewModel&lt;TItem&gt;, </code>
<code>  IEditableObject<span aria-label="889" epub:type="pagebreak" id="Page_889" role="doc-pagebreak"></span></code>
<code>  where TItem : class</code>
<code>{</code>
<code>  private readonly IItemsService&lt;TItem&gt; _itemsService;</code>
<code> </code>
<code>  public EditableItemViewModel(IItemsService&lt;TItem&gt; itemsService)</code>
<code>  {</code>
<code>    _itemsService = itemsService;</code>
<code>    Item = _itemsService.SelectedItem;</code>
<code> </code>
<code>    <b>EditCommand = new RelayCommand(BeginEdit, () =&gt; IsReadMode);</b></code>
<code>    <b>CancelCommand = new RelayCommand(CancelEdit, () =&gt; IsEditMode);</b></code>
<code>    <b>SaveCommand = new RelayCommand(EndEdit, () =&gt; IsEditMode);</b></code>
<code>  }</code>
<code> </code>
<code>  <b>public RelayCommand EditCommand { get; }</b></code>
<code>  <b>public RelayCommand CancelCommand { get; }</b></code>
<code>  <b>public RelayCommand SaveCommand { get; }</b></code>
<code> </code>
<code>  //…</code>
<code> </code>
<code>  public bool IsEditMode</code>
<code>  {</code>
<code>    get =&gt; _isEditMode;</code>
<code>    set</code>
<code>    {</code>
<code>      if (Set(ref _isEditMode, value))</code>
<code>      {</code>
<code>        OnPropertyChanged(nameof(IsReadMode));</code>
<code>        <b>CancelCommand.NotifyCanExecuteChanged();</b></code>
<code>        <b>SaveCommand.NotifyCanExecuteChanged();</b></code>
<code>        <b>EditCommand.NotifyCanExecuteChanged();</b></code>
<code>      }</code>
<code>    }</code>
<code>  }</code>
<code>  //…</code></pre>
                <p id="c30-para-0052" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">}</p>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">From the XAML code, the commands are bound to the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Command</code> property
                    of a <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Button</code>.
                    This is discussed when creating the views in the section “Views” in more detail (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BookDetailUserControl.xaml</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">从 XAML 代码中可以看出，命令绑定到了 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Command</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Button</code>
                                属性上。这将在“视图”部分创建视图时详细讨论（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BookDetailUserControl.xaml</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0016"><code>&lt;AppBarButton Content="Edit" Icon="Edit" </code>
<code>  <b>Command="{x:Bind ViewModel.EditCommand, Mode=OneTime}" /&gt;</b></code>
<code>&lt;AppBarButton Content="Save" Icon="Save" </code>
<code>  <b>Command="{x:Bind ViewModel.SaveCommand, Mode=OneTime}" /&gt;</b></code></pre>
            </section>
            <section data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><span id="c30-sec-0017"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
                <h3 id="head-3-576" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">Services, View Models, and Dependency Injection<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">服务、视图模型和依赖注入</font>
                        </font>
                    </font>
                </h3>
                <p id="c30-para-0054" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">View models and services inject services, and view models
                    need to be created. For this, you can use a dependency injection container. The sample application
                    makes use of <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Extensions.DependencyInjection</code>,
                    which is covered in detail in <a href="c15.xhtml"
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Chapter 15</a>. <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm</code>
                    offers the <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Ioc</code>
                    class where this container is used by default.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                视图模型和服务会注入服务，并且需要创建视图模型。为此，你可以使用依赖注入容器。示例应用程序使用了 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Extensions.DependencyInjection</code>
                                ，在第 15 章中会详细讲解。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm</code>
                                提供了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Ioc</code>
                                类，该容器默认使用这个类。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1"><span aria-label="890" epub:type="pagebreak" id="Page_890"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>The container is
                    configured using <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Ioc.Default.ConfigureServices</code>
                    in the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">RegisterServices</code>
                    method of the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">App</code> class. <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">RegisterServices</code>
                    is invoked from the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnLaunched</code> method
                    (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/App.xaml.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">容器通过在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">App</code> 类的
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">RegisterServices</code>
                                方法中使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Ioc.Default.ConfigureServices</code>
                                进行配置。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">RegisterServices</code>
                                从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnLaunched</code>
                                方法中调用（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/App.xaml.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0017"><code>private void RegisterServices()</code>
<code>{</code>
<code>  Ioc.Default.ConfigureServices(</code>
<code>    new ServiceCollection()</code>
<code>      .AddSingleton&lt;IBooksRepository, BooksSampleRepository&gt;()</code>
<code>      .AddScoped&lt;BooksViewModel&gt;()</code>
<code>      .AddScoped&lt;BookDetailViewModel&gt;()</code>
<code>      .AddScoped&lt;MainWindowViewModel&gt;()</code>
<code>      .AddSingleton&lt;IItemsService&lt;Book&gt;, BooksService&gt;()</code>
<code>      .AddSingleton&lt;IDialogService, WinUIDialogService&gt;()</code>
<code>      .AddSingleton&lt;INavigationService, WinUINavigationService&gt;()</code>
<code>      .AddSingleton&lt;WinUIInitializeNavigationService&gt;()</code>
<code>      .AddLogging(builder =&gt;</code>
<code>      {</code>
<code>        builder.AddDebug();</code>
<code>      }).BuildServiceProvider());</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">Now the view model needs to be associated with the view,
                    which is done in the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code> by
                    accessing the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">AppServices</code>
                    property of the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">App</code> class and
                    invoking the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GetService</code> method
                    from the DI container. The container then instantiates the view model class with the required
                    services as defined in the constructor of the view model class. The <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code> contains
                    a user control for the detail information of the book that needs a different view model. This view
                    model is assigned by setting the property <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ViewModel</code> of the
                    <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailUserControl</code>
                    user control (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BooksPage.xaml.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">现在需要将视图模型与视图关联起来，这通过访问 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">AppServices</code>
                                属性并从依赖注入容器中调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GetService</code>
                                方法来完成。容器随后根据视图模型类构造函数中定义的所需服务来实例化视图模型类。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                                包含一个用于书籍详细信息的用户控件，该用户控件需要不同的视图模型。这个视图模型通过设置 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailUserControl</code>
                                用户控件的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ViewModel</code>
                                属性来分配（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BooksPage.xaml.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0018"><code>public sealed partial class BooksPage : Page</code>
<code>{</code>
<code>  public BooksPage()</code>
<code>  {</code>
<code>    this.InitializeComponent();</code>
<code>    <b>BookDetailUC.ViewModel = Ioc.Default.GetRequiredService&lt;BookDetailViewModel&gt;();</b></code>
<code>  }</code>
<code> </code>
<code>  <b>public BooksViewModel ViewModel { get; } = </b></code>
<code>    <b>Ioc.Default.GetRequiredService&lt;BooksViewModel&gt;();</b></code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">With the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code>,
                    the association to the view model happens similarly (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BookDetailPage.xaml.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code>
                                ，视图模型之间的关联同样发生（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BookDetailPage.xaml.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0019"><code>public sealed partial class BookDetailPage : Page</code>
<code>{</code>
<code>  public BookDetailPage()</code>
<code>  {</code>
<code>    this.InitializeComponent();</code>
<code>  }</code>
<code> </code>
<code>  <b>public BookDetailViewModel ViewModel { get; } = </b></code>
<code>    <b>Ioc.Default.GetRequiredService&lt;BookDetailViewModel&gt;();</b></code>
<code><b>}</b></code></pre>
            </section>
        </section>
        <section aria-labelledby="head-2-270" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
            <span id="c30-sec-0018" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
            <h2 id="head-2-270" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">VIEWS<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">视图</font>
                    </font>
                </font>
            </h2>
            <p id="c30-para-0058" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1"><span aria-label="891" epub:type="pagebreak" id="Page_891"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>Now that you've been
                introduced to creating the view models and to connecting the views to the view models, it's time to get
                into the views.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            现在你已经了解了如何创建视图模型以及如何将视图连接到视图模型，接下来是时候深入探讨视图了。</font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0059" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The main view of the application is defined by the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainWindow</code>. This
                window makes use of the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationView</code> control
                that was introduced in the previous chapter. Usually, if you have only a small list of items for
                navigation, you shouldn't use this UI control. However, the sample application uses the control because
                it is assumed the application will grow to more than eight times its current size.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">应用程序的主视图由 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainWindow</code>
                            定义。这个窗口使用了在上一章中介绍过的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationView</code>
                            控件。通常，如果你只有少量用于导航的项目，就不应该使用这个 UI 控件。然而，示例应用程序使用该控件，因为假设应用程序将增长到当前规模的八倍以上。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationView</code> control
                assigns the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SelectionChanged</code> event
                to the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnNavigationSelectionChanged</code>
                method of the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainPageViewModel</code>. The
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainPageViewModel</code> is
                very different from the other view model types and will be discussed later in the section “Navigating
                Between Pages.” One <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationViewItem</code> is
                defined to navigate to the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code> (code file
                <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/MainWindow.xaml</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1"> <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationView</code>
                            控件将 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SelectionChanged</code>
                            事件分配给 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnNavigationSelectionChanged</code>
                            的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainPageViewModel</code>
                            方法。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainPageViewModel</code>
                            与其他视图模型类型非常不同，将在“页面间导航”部分稍后讨论。定义了一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationViewItem</code>
                            来导航到 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                            （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/MainWindow.xaml</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0020"><code>&lt;NavigationView IsBackButtonVisible="Collapsed"</code>
<code>  <b>SelectionChanged="{x:Bind ViewModel.OnNavigationSelectionChanged, Mode=OneTime}"&gt;</b></code>
<code>  &lt;NavigationView.MenuItems&gt;</code>
<code>    <b>&lt;NavigationViewItem Content="Books" Tag="books"&gt;</b></code>
<code>      <b>&lt;NavigationViewItem.Icon&gt;</b></code>
<code>        <b>&lt;FontIcon FontFamily="Segoe MDL2 Assets" Glyph="" /&gt;</b></code>
<code>      <b>&lt;/NavigationViewItem.Icon&gt;</b></code>
<code>    <b>&lt;/NavigationViewItem&gt;</b></code>
<code>  <b>&lt;/NavigationView.MenuItems&gt;</b></code>
<code> </code>
<code>  &lt;Frame x:Name="MainFrame" Margin="16"&gt;</code>
<code>    &lt;Frame.ContentTransitions&gt;</code>
<code>      &lt;TransitionCollection&gt;</code>
<code>        &lt;NavigationThemeTransition/&gt;</code>
<code>      &lt;/TransitionCollection&gt;</code>
<code>    &lt;/Frame.ContentTransitions&gt;</code>
<code>  &lt;/Frame&gt;</code>
<code>&lt;/NavigationView&gt;</code></pre>
            <p id="c30-para-0061" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1"><a href="#c30-fig-0004" id="R_c30-fig-0004"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Figure 30-4</a> shows the
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationView</code> of
                the running app with the navigation item set to the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">图 30-4 显示了运行中的应用的 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationView</code>
                            ，导航项设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                            。</font>
                    </font>
                </font>
            </p>
            <figure data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"> <img
                    alt="Snapshot shows the NavigationView of the running app with the navigation item set to the BooksPage."
                    class="center" src="images/c30f004.png" />
                <figcaption data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
                    <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><span class="figureLabel"
                            data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><a
                                href="#R_c30-fig-0004" id="c30-fig-0004" role="doc-backlink"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><b
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                                    data-immersive-translate-paragraph="1">FIGURE 30-4<font
                                        class="notranslate immersive-translate-target-wrapper"
                                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">
                                              </font>
                                        <font
                                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                            data-immersive-translate-translation-element-mark="1">
                                            <font
                                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                data-immersive-translate-translation-element-mark="1">图 30-4</font>
                                        </font>
                                    </font></b></a></span></p>
                </figcaption>
            </figure>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1"><span aria-label="892" epub:type="pagebreak" id="Page_892"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>The <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code> contains a
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ListView</code> and binds
                the <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ItemsSource</code> to
                the <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ItemsViewModel</code>
                property of the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksViewModel</code>.
                Usually, you would bind it to the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Items</code> property of the
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksViewModel</code>.
                However, the display of a single list item is not only used to show the value of the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Book</code> objects, but also
                contains buttons that are bound to commands. To implement such functionality, another view model can be
                used for the items (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BooksPage.xaml</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1"> <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                            包含一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ListView</code>
                            并将 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ItemsSource</code>
                            绑定到 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksViewModel</code>
                            的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ItemsViewModel</code>
                            属性。通常，你会将其绑定到 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksViewModel</code>
                            的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Items</code>
                            属性。然而，单个列表项的显示不仅用于显示 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Book</code>
                            对象的值，还包含绑定到命令的按钮。为了实现此类功能，可以为项使用另一个视图模型（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BooksPage.xaml</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0021"><code>&lt;StackPanel Orientation="Horizontal" Grid.Row="1"&gt;</code>
<code>  &lt;AppBarButton Icon="Refresh" IsCompact="True"</code>
<code>    Command="{x:Bind ViewModel.RefreshCommand}"   </code>
<code>    Label="Get Books"/&gt;</code>
<code>  &lt;AppBarButton Icon="Add" IsCompact="True"</code>
<code>    Command="{x:Bind ViewModel.AddCommand}" </code>
<code>    Label="Add Book"/&gt;</code>
<code>&lt;/StackPanel&gt;</code>
<code>&lt;ListView <b>ItemTemplate="{StaticResource BookItemTemplate}"</b> Grid.Row="2" </code>
<code>  <b>ItemsSource="{x:Bind ViewModel.ItemsViewModels, Mode=OneWay}"</b> </code>
<code>  <b>SelectedItem="{x:Bind ViewModel.SelectedItemViewModel, Mode=TwoWay}" /&gt;</b></code>
<code>&lt;local:BookDetailUserControl x:Name="BookDetailUC" Visibility="Collapsed" </code>
<code>  Grid.Column="1" Grid.RowSpan="2"/&gt;</code></pre>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code> just
                contains a user control: the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailUserControl</code>.
                The <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code>
                has the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailViewModel</code>
                associated, as you've seen previously. This view model is forwarded to the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailUserControl</code>
                by assigning the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ViewModel</code> property of
                the <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code>
                to the <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ViewModel</code>
                property of the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailUserControl</code>
                (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BookDetailPage.xaml</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1"> <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code>
                            仅包含一个用户控件： <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailUserControl</code>
                            。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code>
                            如之前所见，关联了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailViewModel</code>
                            。此视图模型通过将 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code>
                            的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ViewModel</code>
                            属性分配给 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailUserControl</code>
                            的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ViewModel</code>
                            属性传递给 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailUserControl</code>
                            （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BookDetailPage.xaml</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0022"><code>&lt;Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"&gt;</code>
<code>  &lt;views:BookDetailUserControl ViewModel="{x:Bind ViewModel, Mode=OneTime}"/&gt;</code>
<code>&lt;/Grid&gt;</code></pre>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The dependency property of the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailUserControl</code>
                is shown in the following code snippet. This mapping to the view model is then used for data binding in
                the XAML code (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BookDetailUserControl.xaml.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1"> <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailUserControl</code>
                            的依赖属性在以下代码片段中显示。然后，这个映射用于 XAML 代码中的数据绑定（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BookDetailUserControl.xaml.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0023"><code>public BookDetailViewModel ViewModel</code>
<code>{</code>
<code>  get =&gt; (BookDetailViewModel)GetValue(ViewModelProperty);</code>
<code>  set =&gt; SetValue(ViewModelProperty, value);</code>
<code>}</code>
<code> </code>
<code>public static readonly DependencyProperty ViewModelProperty =</code>
<code>  DependencyProperty.Register("ViewModel", typeof(BookDetailViewModel), </code>
<code>    typeof(BookDetailUserControl), new PropertyMetadata(null));</code></pre>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The user interface of the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailUserControl</code>
                makes use of two <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">StackPanel</code> elements.
                With the first <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">StackPanel</code>, the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Command</code> property of
                the <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">AppBarButton</code>
                controls is bound to the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditCommand</code>, <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SaveCommand</code>, and <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CancelCommand</code> commands
                defined in the view model. The buttons will be automatically enabled or disabled depending on the state
                of the commands. With the second <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">StackPanel</code>, <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">TextBox</code> elements are
                used to display the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Title</code> and <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Publisher</code> properties
                of the <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Book</code>. For a
                read-only display, the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsReadOnly</code> property is
                assigned to the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsReadMode</code> property of
                the view model. When the view model is set to edit mode, the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">TextBox</code> controls allow
                entering data (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BookDetailUserControl.xaml</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1"> <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailUserControl</code>
                            的用户界面使用两个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">StackPanel</code>
                            元素。通过第一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">StackPanel</code>
                            ， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">AppBarButton</code>
                            控件的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Command</code>
                            属性绑定到视图模型中定义的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">EditCommand</code>
                            、 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SaveCommand</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">CancelCommand</code>
                            命令。按钮将根据命令的状态自动启用或禁用。通过第二个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">StackPanel</code>
                            ，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">TextBox</code>
                            元素显示 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Book</code> 的
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Title</code> 和
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Publisher</code>
                            属性。对于只读显示，将 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsReadOnly</code>
                            属性分配给视图模型的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IsReadMode</code>
                            属性。当视图模型设置为编辑模式时， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">TextBox</code>
                            控件允许输入数据（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Views/BookDetailUserControl.xaml</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0024"><code>&lt;StackPanel Orientation="Horizontal"&gt;</code>
<code>  &lt;AppBarButton Content="Edit" Icon="Edit" </code>
<code>    Command="{x:Bind ViewModel.EditCommand, Mode=OneTime}"/&gt;</code>
<code>  &lt;AppBarButton Content="Save" Icon="Save" </code>
<code>    Command="{x:Bind ViewModel.SaveCommand, Mode=OneTime}"/&gt;</code>
<code>  &lt;AppBarButton Content="Cancel" Icon="Cancel" <span aria-label="893" epub:type="pagebreak" id="Page_893" role="doc-pagebreak"></span></code>
<code>    Command="{x:Bind ViewModel.CancelCommand, Mode=OneTime}"/&gt;</code>
<code>&lt;/StackPanel&gt;</code>
<code>&lt;StackPanel Orientation="Vertical" Grid.Row="1"&gt;</code>
<code>  <b>&lt;TextBox Header="Title"</b> </code>
<code>           <b>IsReadOnly="{x:Bind ViewModel.IsReadMode, Mode=OneWay}"</b> </code>
<code>           <b>Text="{x:Bind ViewModel.EditItem.Title, Mode=TwoWay,</b>  </code>
<code>           <b>UpdateSourceTrigger=PropertyChanged}" /&gt;</b></code>
<code>  <b>&lt;TextBox Header="Publisher"</b> </code>
<code>           <b>IsReadOnly="{x:Bind ViewModel.IsReadMode, Mode=OneWay}"</b> </code>
<code>           <b>Text="{x:Bind ViewModel.EditItem.Publisher, Mode=TwoWay,</b> </code>
<code>           <b>UpdateSourceTrigger=PropertyChanged}" /&gt;</b></code>
<code>&lt;/StackPanel&gt;</code></pre>
            <section data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><span id="c30-sec-0019"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
                <h3 id="head-3-577" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">Opening Dialogs from View Models<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">从视图模型中打开对话框</font>
                        </font>
                    </font>
                </h3>
                <p id="c30-para-0066" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">Sometimes it's necessary to show dialogs from actions within
                    view models. As the view model is implemented in a .NET library, access to the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MessageDialog</code>
                    class from WinUI is not possible without adding references to WinUI packages. This would hinder
                    using this library from other technologies. You should avoid this situation anyway, because the
                    <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MessageDialog</code> is
                    specific to UWP and WinUI. With WPF you use the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MessageBox</code> class
                    instead. With <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Xamarin.Forms</code>, you
                    use <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Page.DisplayAlert</code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">有时需要从视图模型中的操作显示对话框。由于视图模型是在 .NET
                                库中实现的，若不添加对 WinUI 包的引用，则无法访问 WinUI 的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MessageDialog</code>
                                类，这将阻碍从其他技术使用该库。无论如何都应避免这种情况，因为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MessageDialog</code>
                                是 UWP 和 WinUI 特有的。使用 WPF 时，您应使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MessageBox</code>
                                类；使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Xamarin.Forms</code>
                                时，您应使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Page.DisplayAlert</code>
                                。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">What needs to be done is to define a contract that can be
                    used by the view models and services. This contract is defined in the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib</code> library
                    with the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IMessageService</code>
                    interface (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Services/IDialogService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">需要做的是定义一个视图模型和服务都可以使用的契约。此契约在
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib</code>
                                库中通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IMessageService</code>
                                接口定义（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Services/IDialogService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0025"><code>public interface IDialogService</code>
<code>{</code>
<code>  Task ShowMessageAsync(string message);</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">In the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailViewModel</code>,
                    the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IDialogService</code> is
                    injected in the constructor and used on the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnSaveAsync</code>
                    method. The <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ShowMessageAsync</code>
                    method is invoked in the case of an exception (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/ViewModels/BookDetailViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailViewModel</code>
                                中， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IDialogService</code>
                                通过构造函数注入并在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnSaveAsync</code>
                                方法中使用。当出现异常时，会调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ShowMessageAsync</code>
                                方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/ViewModels/BookDetailViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0026"><code>public override async Task OnSaveAsync()</code>
<code>{</code>
<code>  try</code>
<code>  {</code>
<code>    if (EditItem is null) throw new InvalidOperationException();</code>
<code>    await _itemsService.AddOrUpdateAsync(EditItem);</code>
<code>  }</code>
<code>  catch (Exception ex)</code>
<code>  {</code>
<code>    _logger.LogError("error {0} in {1}", ex.Message, nameof(OnSaveAsync));</code>
<code>    <b>await _messageService.ShowMessageAsync("Error saving the data");</b></code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">Now just a specific implementation for WinUI is needed. The
                    <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ShowMessageAsync</code>
                    method is implemented using the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MessageDialog</code>
                    class. The <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WinUIDialogService</code>
                    is implemented in the WinUI BooksApp; that's why access to <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MessageDialog</code> is
                    now possible (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Services/WinUIDialogService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">现在只需要一个针对 WinUI 的特定实现。 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ShowMessageAsync</code>
                                方法使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MessageDialog</code>
                                类实现。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WinUIDialogService</code>
                                在 WinUI BooksApp 中实现，这就是为什么现在可以访问 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MessageDialog</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Services/WinUIDialogService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0027"><code>public class WinUIDialogService : IDialogService</code>
<code>{</code>
<code>  public async Task ShowMessageAsync(string message) =&gt; </code>
<code>    <b>await new MessageDialog(message).ShowAsync();</b></code>
<code>}</code></pre>
                <p id="c30-para-0070" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1"><span aria-label="894" epub:type="pagebreak" id="Page_894"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>With the
                    dependency container configuration that was discussed earlier in the section “Services, View Models,
                    and Dependency Injection,” the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WinUIDialogService</code>
                    is configured to be used when the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IDialogService</code>
                    interface is requested. Creating .NET MAUI or WPF applications, different implementations need to be
                    created that then need to be configured with the DI container of the application. The library where
                    the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IDialogService</code>
                    contract is used does not need to have knowledge about the implementation.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在前面“服务、视图模型和依赖注入”部分讨论的依赖容器配置中，当请求
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IDialogService</code>
                                接口时， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WinUIDialogService</code>
                                被配置为使用。创建 .NET MAUI 或 WPF 应用程序时，需要创建不同的实现，然后需要使用应用程序的依赖注入容器进行配置。使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IDialogService</code>
                                合约的库不需要了解具体实现。</font>
                        </font>
                    </font>
                </p>
            </section>
            <section data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"><span id="c30-sec-0020"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
                <h3 id="head-3-578" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">Navigating Between Pages<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">页面间导航</font>
                        </font>
                    </font>
                </h3>
                <p id="c30-para-0071" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">As with opening dialogs, navigating between pages is
                    different among different technologies. With WinUI, the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code> class is
                    used to navigate pages within the app. With WPF, it's again a <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code> class, but
                    it's a different one. With Xamarin.Forms, the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationPage</code> is
                    used for navigation. How the navigation is implemented with these technologies also differs. With
                    UWP, you need a <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Type</code> object to
                    navigate to. With Xamarin.Forms, you need an object instance of the page. With Xamarin.Forms, the
                    navigation methods are asynchronous, whereas they are synchronous with WinUI. For this, a common
                    contract is needed again.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">与打开对话框类似，不同技术在页面间导航方面有所不同。在 WinUI
                                中，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code>
                                类在应用程序内导航页面。在 WPF 中，再次使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code>
                                类，但它是不同的。在 Xamarin.Forms 中，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationPage</code>
                                进行导航。这些技术在实现导航时也有所不同。在 UWP 中，需要 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Type</code>
                                对象进行导航。在 Xamarin.Forms 中，需要页面对象实例。在 Xamarin.Forms 中，导航方法是异步的，而在 WinUI
                                中是同步的。为此，再次需要一个通用合约。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">With the sample application, navigation to a page is needed,
                    and you need a way to navigate back. Also, the current page needs to be accessed to know whether
                    navigation needs to be done. For this, the interface <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationService</code>
                    is defined. This interface is based on strings for navigation, which makes it possible to create
                    implementations for the different platforms (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/Services/INavigationService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                使用示例应用程序时，需要导航到页面，并且需要一个返回导航的方式。此外，需要访问当前页面以确定是否需要执行导航。为此，定义了接口 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationService</code>
                                。该接口基于字符串进行导航，这使得可以为不同的平台创建实现（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">GenericViewModels/Services/INavigationService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0028"><code>public interface INavigationService</code>
<code>{</code>
<code>  bool UseNavigation { get; set; }</code>
<code>  Task NavigateToAsync(string page);</code>
<code>  Task GoBackAsync();</code>
<code>  string CurrentPage { get; }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WinUINavigationService</code>
                    needs a <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code>
                    assigned, so it can navigate for WinUI. When you define a property of a <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code>, it's not
                    possible to access it because from the outside, just the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationService</code>
                    interface is used. With the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationService</code>
                    interface, the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code> cannot be
                    used to avoid a dependency on WinUI. What can be done in such a scenario is to create a service
                    specific for WinUI that will be injected with the WinUI implementation of the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationService</code>.
                    Internally, when the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Pages</code> and <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code> properties
                    are accessed, this information is taken from the initialization service, as shown in the following
                    code snippet (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Services/WinUINavigationService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">接口 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WinUINavigationService</code>
                                需要一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code>
                                分配给它，以便能够为 WinUI 进行导航。当你定义一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code>
                                的属性时，由于外部只使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationService</code>
                                接口，因此无法访问它。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationService</code>
                                接口时， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code>
                                不能用来避免对 WinUI 的依赖。在这种情况下可以做的事情是创建一个专门为 WinUI 提供的服务，该服务将被注入 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationService</code>
                                的 WinUI 实现。在内部，当访问 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Pages</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code>
                                属性时，这些信息是从初始化服务中获取的，如下面的代码片段所示（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Services/WinUINavigationService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0029"><code>public class WinUINavigationService : INavigationService</code>
<code>{</code>
<code>  private readonly WinUIInitializeNavigationService _initializeNavigation;</code>
<code> </code>
<code>  public WinUINavigationService(</code>
<code>    WinUIInitializeNavigationService initializeNavigation) =&gt;</code>
<code>    _initializeNavigation = initializeNavigation;</code>
<code> </code>
<code>  private Dictionary&lt;string, Type&gt;? _pages;</code>
<code>  private Dictionary&lt;string, Type&gt; Pages =&gt; _pages ??= _initializeNavigation.Pages;</code>
<code> </code>
<code>  private Frame? _frame;</code>
<code>  private Frame Frame =&gt; _frame ??= _initializeNavigation.Frame;</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">The implementation of the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigateToAsync</code>
                    method uses the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code> property to
                    navigate to the page (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Services/WinUINavigationService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">接口 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigateToAsync</code>
                                方法的实现使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code>
                                属性来导航到页面（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Services/WinUINavigationService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0030"><code>public class UWPNavigationService : INavigationService</code>
<code>{<span aria-label="895" epub:type="pagebreak" id="Page_895" role="doc-pagebreak"></span></code>
<code>  //…</code>
<code>  public Task NavigateToAsync(string pageName)</code>
<code>  {</code>
<code>    _currentPage = pageName;</code>
<code>    <b>Frame.Navigate(Pages[pageName]);</b></code>
<code>    return Task.CompletedTask;</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">The only functionality the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WinUIInitializeNavigationService</code>
                    offers is to initialize it with a <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code> and a
                    dictionary of pages and to retrieve this information (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Services/WinUIInitializeNavigationService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">接口 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WinUIInitializeNavigationService</code>
                                提供的唯一功能是使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code>
                                和一个页面字典来初始化它，并检索这些信息（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/Services/WinUIInitializeNavigationService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0031"><code>public class WinUIInitializeNavigationService</code>
<code>{</code>
<code>  public void Initialize(Frame frame, Dictionary&lt;string, Type&gt; pages)</code>
<code>  {</code>
<code>    Frame = frame ?? throw new ArgumentNullException(nameof(frame));</code>
<code>    Pages = pages ?? throw new ArgumentNullException(nameof(pages));</code>
<code>  }</code>
<code>  private Frame? _frame;</code>
<code>  public Frame Frame =&gt; _frame ?? throw new InvalidOperationException(</code>
<code>    $"{nameof(WinUIInitializeNavigationService)} not initalized");</code>
<code> </code>
<code>  private Dictionary&lt;string, Type&gt;? _pages;</code>
<code>  public Dictionary&lt;string, Type&gt; Pages =&gt; _pages ?? throw new InvalidOperationException(</code>
<code>    $"{nameof(WinUIInitializeNavigationService)} not initalized");}</code></pre>
                <p id="c30-para-0076" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WinUIInitializeNavigationService</code>
                    can now be initialized on a place where the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code> is
                    available. With the WinUI sample application, this is in the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainWindow</code>. Within
                    the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationView</code>
                    control specified earlier, the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code> with the
                    name <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainFrame</code>
                    is specified. Now it would be possible to define the initialization within the code-behind file of
                    the <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainWindow</code>,
                    or in a WinUI-specific <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainPageViewModel</code>.
                    For the sample application, the second option was chosen.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WinUIInitializeNavigationService</code>
                                现在可以在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code>
                                可用的位置进行初始化。使用 WinUI 示例应用程序时，这位于 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainWindow</code>
                                中。在之前指定的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationView</code>
                                控件内，指定了名称为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Frame</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainFrame</code>
                                。现在可以在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainWindow</code>
                                的代码隐藏文件中定义初始化，或者在 WinUI 特定的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainPageViewModel</code>
                                中。对于示例应用程序，选择了第二种选项。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">In the following code snippet, the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainWindowViewModel</code>
                    keeps a list of pages for the navigation and initializes the navigation service when the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SetNavigationFrame</code>
                    is invoked (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/ViewModels/MainWindowViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在以下代码片段中， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainWindowViewModel</code>
                                保存了用于导航的页面列表，并在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SetNavigationFrame</code>
                                被调用时初始化导航服务（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/ViewModels/MainWindowViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0032"><code>public class MainPageViewModel : ViewModelBase</code>
<code>{</code>
<code>  private readonly Dictionary&lt;string, Type&gt; _pages = new()</code>
<code>  {</code>
<code>    [PageNames.BooksPage] = typeof(BooksPage),</code>
<code>    [PageNames.BookDetailPage] = typeof(BookDetailPage)</code>
<code>  };</code>
<code> </code>
<code>  private readonly INavigationService _navigationService;</code>
<code>  private readonly WinUIInitializeNavigationService _initializeNavigationService;</code>
<code>  public MainPageViewModel(INavigationService navigationService, </code>
<code>    WinUIInitializeNavigationService initializeNavigationService)</code>
<code>  {</code>
<code>    _navigationService = navigationService;</code>
<code>    _initializeNavigationService = initializeNavigationService;</code>
<code>  }<span aria-label="896" epub:type="pagebreak" id="Page_896" role="doc-pagebreak"></span></code>
<code> </code>
<code>  <b>public void SetNavigationFrame(Frame frame) =&gt;</b> </code>
<code>    <b>_initializeNavigationService.Initialize(frame, _pages);</b></code>
<code> </code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">With this view model in place, all that needs to be in the
                    code-behind file of the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainWindow</code> is the
                    <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ViewModel</code>
                    property and the passing of the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainFrame</code> to the
                    navigation service via invocation of the method <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SetNavigationFrame</code>
                    (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/MainWindow.xaml.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">有了这个视图模型， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainWindow</code>
                                的代码隐藏文件中只需要 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">ViewModel</code>
                                属性，并通过调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SetNavigationFrame</code>
                                将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainFrame</code>
                                传递给导航服务（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/MainWindow.xaml.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0033"><code>public sealed partial class MainWindow : Window</code>
<code>{</code>
<code>  public MainWindow()</code>
<code>  {</code>
<code>    this.InitializeComponent();</code>
<code>    ViewModel = Ioc.Default.GetRequiredService&lt;MainPageViewModel&gt;();</code>
<code>    ViewModel.SetNavigationFrame(MainFrame);</code>
<code>  }</code>
<code> </code>
<code>  public MainPageViewModel ViewModel { get; }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">The first navigation to the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code> happens
                    in the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainPageViewModel</code>.
                    The method <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnNavigationSelectionChanged</code>
                    is the handler for the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationSelectionChanged</code>
                    event of the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationView</code>
                    control. With the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Tag</code> set to <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">books</code>, navigation
                    to the <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                    is done using <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationService</code>
                    (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/ViewModels/MainPageViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">第一次导航到 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                                发生在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainPageViewModel</code>
                                中。方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnNavigationSelectionChanged</code>
                                是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationView</code>
                                控件的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationSelectionChanged</code>
                                事件的处理器。当 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Tag</code>
                                设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">books</code>
                                时，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INavigationService</code>
                                进行导航到 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/ViewModels/MainPageViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0034"><code>public class MainPageViewModel : ViewModelBase</code>
<code>{</code>
<code>  //…</code>
<code>  public void OnNavigationSelectionChanged(NavigationView sender, </code>
<code>    NavigationViewSelectionChangedEventArgs args)</code>
<code>  {</code>
<code>    if (args.SelectedItem is NavigationViewItem navigationItem)</code>
<code>    {</code>
<code>      switch (navigationItem.Tag)</code>
<code>      {</code>
<code>        case "books":</code>
<code>          <b>_navigationService.NavigateToAsync(PageNames.BooksPage);</b></code>
<code>          break;</code>
<code>        default:</code>
<code>          break;</code>
<code>      }</code>
<code>    }</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">Navigation from the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code> is done
                    directly from a shared view model. The navigation from the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code> to the
                    <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksDetailPage</code>
                    happens when a list item is selected, and the <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">PropertyChanged</code>
                    event fires. Navigation is also done only when the property <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">UseNavigation</code> is
                    set to <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">true</code>. As
                    previously mentioned, with WinUI, when the UI is large enough, navigation is not needed at this
                    place because the detail information is then shown side by side with the list (code file <code
                        data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/ViewModels/BooksViewModel.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">从 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                                的导航直接从共享的视图模型进行。从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                                到 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksDetailPage</code>
                                的导航在列表项被选中时发生，并且 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">PropertyChanged</code>
                                事件被触发。导航也只在属性 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">UseNavigation</code>
                                被设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">true</code>
                                时进行。如前所述，使用 WinUI 时，当 UI 足够大时，此处不需要导航，因为详细信息会与列表并排显示（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/ViewModels/BooksViewModel.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c30-code-0035"><code>public class BooksViewModel : MasterDetailViewModel&lt;BookItemViewModel, Book&gt;</code>
<code>{</code>
<code>  private readonly IItemsService&lt;Book&gt; _booksService;</code>
<code>  private readonly INavigationService _navigationService;<span aria-label="897" epub:type="pagebreak" id="Page_897" role="doc-pagebreak"></span></code>
<code> </code>
<code>  public BooksViewModel(IItemsService&lt;Book&gt; booksService, </code>
<code>    INavigationService navigationService)</code>
<code>    : base(booksService)</code>
<code>  {</code>
<code>    _booksService = booksService ?? </code>
<code>      throw new ArgumentNullException(nameof(booksService));</code>
<code>    _navigationService = navigationService ?? </code>
<code>      throw new ArgumentNullException(nameof(navigationService));</code>
<code> </code>
<code>    <b>PropertyChanged += async (sender, e) =&gt;</b></code>
<code>    <b>{</b></code>
<code>      <b>if (UseNavigation &amp;&amp; e.PropertyName == nameof(SelectedItem) &amp;&amp;</b>  </code>
<code>        <b>_navigationService.CurrentPage == PageNames.BooksPage)</b></code>
<code>      <b>{</b></code>
<code>        <b>await _navigationService.NavigateToAsync(PageNames.BookDetailPage);</b></code>
<code>      <b>}</b></code>
<code>    <b>};</b></code>
<code>  }</code>
<code> </code>
<code>  public bool UseNavigation { get; set; }</code>
<code>  //…</code>
<code>}</code></pre>
                <p id="c30-para-0081" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                    data-immersive-translate-paragraph="1">To inform the application about window size changes, you can
                    use an event aggregator as discussed in the next section.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了通知应用程序窗口大小变化，您可以使用下一节中讨论的事件聚合器。
                            </font>
                        </font>
                    </font>
                </p>
            </section>
        </section>
        <section aria-labelledby="head-2-271" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
            <span id="c30-sec-0021" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
            <h2 id="head-2-271" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">MESSAGING USING EVENTS<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用事件进行消息传递</font>
                    </font>
                </font>
            </h2>
            <p id="c30-para-0082" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">You can pass information between view models, views, and services
                by using stateful services that are configured with the DI container. In such services, you can also
                define events, so a subscriber can register to events while a publisher fires information. Instead of
                creating such custom services, you can use an event aggregator like the one available with <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm</code>.
                With this framework, the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IMessenger</code> interface
                can be used to publish and subscribe messages. The <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WeakReferenceManager</code>
                is one of the classes implementing this interface.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            您可以通过使用配置了依赖注入容器的有状态服务在视图模型、视图和服务之间传递信息。在这样的服务中，您还可以定义事件，因此订阅者可以在发布者发送信息时注册到事件。而不是创建这样的自定义服务，您可以使用像
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm</code>
                            那样的事件聚合器。使用这个框架， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IMessenger</code>
                            接口可以用来发布和订阅消息。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WeakReferenceManager</code>
                            是实现该接口的一个类。</font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0083" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">In case the books application is used on a mobile device with
                .NET MAUI, you might always navigate between the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code> and the
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code> when
                clicking a book in the list. On the desktop, instead of using the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code>, a user
                control for the book details is set to visible in the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>. If the
                window size of the application is not large enough, you can switch to use navigation to pages instead.
                To inform anyone who is interested about the window size, you can use an event aggregator.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">如果图书应用程序在 .NET MAUI
                            的移动设备上使用，当点击列表中的图书时，您可能总是在 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code>
                            之间进行导航。在桌面端，而不是使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BookDetailPage</code>
                            ，图书详情的用户控件在 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksPage</code>
                            中设置为可见。如果应用程序的窗口大小不够大，您可以切换到使用页面导航。为了通知任何感兴趣的人关于窗口大小，您可以使用事件聚合器。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">For passing the information about the navigation from the main
                window to the view model, the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationInfoEvent</code> is
                needed. This event information class uses a Boolean property to define whether navigation should be used
                (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Events/NavigationMessage.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">为了从主窗口传递导航信息到视图模型，需要使用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationInfoEvent</code>
                            。这个事件信息类使用一个布尔属性来定义是否应该使用导航（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksLib/Events/NavigationMessage.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0036"><code>public class NavigationInfo</code>
<code>{</code>
<code>  public bool UseNavigation { get; set; }</code>
<code>}</code>
<code> </code>
<code>public class NavigationMessage : ValueChangedMessage&lt;NavigationInfo&gt;</code>
<code>{</code>
<code>  public NavigationMessage(NavigationInfo navigationInfo)</code>
<code>    : base(navigationInfo) {  }</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1"><span aria-label="898" epub:type="pagebreak" id="Page_898"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>The event is published
                when the size of the main window changes. With the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainWindow</code> class, the
                <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnSizeChanged</code> event
                handler is registered to the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SizeChanged</code> event of
                the page. In the event handler, the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WeakReferenceMessenger</code>
                is accessed to send a <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationMessage</code>
                (code file <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/MainWindow.xaml.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">当主窗口的尺寸发生变化时，会发布这个事件。使用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">MainWindow</code>
                            类，将 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">OnSizeChanged</code>
                            事件处理器注册到页面的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">SizeChanged</code>
                            事件上。在事件处理器中，访问 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WeakReferenceMessenger</code>
                            以发送 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">NavigationMessage</code>
                            （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">BooksApp/MainWindow.xaml.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c30-code-0037"><code>public sealed partial class MainWindow : Window</code>
<code>{</code>
<code>  //…</code>
<code>  private void OnSizeChanged(object sender, SizeChangedEventArgs e)</code>
<code>  {</code>
<code>    double width = args.Size.Width;</code>
<code>    NavigationMessage navigation = new(new()</code>
<code>    {</code>
<code>      UseNavigation = width &lt; 1024</code>
<code>    });</code>
<code>    WeakReferenceMessenger.Default.Send(navigation);  </code>
<code>  }</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">In places where information about the window event size is
                needed, subscription to the event can be done by implementing the interface <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IRecepient&lt;TMessage&gt;</code>.
                This interface defines the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Receive</code> method to
                receive the event information.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在需要窗口事件尺寸信息的地方，可以通过实现接口 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">IRecepient&lt;TMessage&gt;</code>
                            来订阅事件。这个接口定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Receive</code>
                            方法来接收事件信息。</font>
                    </font>
                </font>
            </p>
            <pre
                id="c30-code-0038"><code>WeakReferenceMessenger.Default.Register&lt;NavigationMessage&gt;(this);</code></pre>
            <p id="c30-para-0087" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">When you use the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Unregister</code> method,
                events can be unsubscribed. To avoid memory leaks when not unsubscribing, the <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WeakReferenceMessenger</code>
                uses <code data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WeakReference</code>
                objects. <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm</code>
                also offers the faster <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">StrongReferenceManager</code>,
                but you need to make sure to unsubscribe.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Unregister</code>
                            方法时，可以取消订阅事件。如果不取消订阅，为了避免内存泄漏， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WeakReferenceMessenger</code>
                            使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">WeakReference</code>
                            对象。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">Microsoft.Toolkit.Mvvm</code>
                            也提供了更快的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">StrongReferenceManager</code>
                            ，但你需要确保取消订阅。</font>
                    </font>
                </font>
            </p>
        </section>
        <section aria-labelledby="head-2-272" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">
            <span id="c30-sec-0022" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"></span>
            <h2 id="head-2-272" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">SUMMARY<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">摘要</font>
                    </font>
                </font>
            </h2>
            <p id="c30-para-0088" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">This chapter gave you an architectural guideline for creating
                XAML-based applications around the MVVM pattern. You've seen the separation of concerns (SoC) pattern by
                creating a model, view, and view model. Besides that, you've seen implementing change notification with
                the interface <code
                    data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INotifyPropertyChanged</code>,
                the repository pattern to separate the data access code, messaging between view models (that can also be
                used to communicate with views) by using events, and dependency injection with an IoC container.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本章为你提供了围绕 MVVM 模式创建基于 XAML
                            应用程序的架构指南。你通过创建模型、视图和视图模型看到了关注点分离（SoC）模式。除此之外，你还看到了通过接口 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4">INotifyPropertyChanged</code>
                            实现变更通知、使用仓库模式分离数据访问代码、通过事件在视图模型之间（也可以用于与视图通信）进行消息传递，以及使用 IoC 容器进行依赖注入。</font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0089" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The chapter also showed you a library of view models that can be
                used across applications. All this allows for code sharing while still using features of specific
                platforms. You can use platform-specific features with repository and service implementations, and
                contracts are available with all platforms.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            本章还向你展示了一个可在应用程序间使用的视图模型库。所有这些允许代码共享，同时仍然可以使用特定平台的特性。你可以使用特定平台的仓库和服务实现，并且所有平台都提供了合同。</font>
                    </font>
                </font>
            </p>
            <p id="c30-para-0090" data-immersive-translate-walked="d076fed7-74e7-4bf7-8317-2ffcebe906c4"
                data-immersive-translate-paragraph="1">The next chapter continues the discussion of XAML and is about
                styles and resources.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">下一章将继续讨论 XAML，内容是关于样式和资源。</font>
                    </font>
                </font>
            </p>
        </section>
    </section>
</body>
<div id="immersive-translate-popup" style="all: initial"></div>

</html>