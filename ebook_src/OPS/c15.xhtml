<!-- 这行注释会存在于经过翻译的源文件中。除非您获得许可请不要删除这个注释。
    翻译由 ClassicByte Org 的 higashitani yume 完成
    使用工具 沉浸式翻译 智谱GLM模型
    您可以阅读这个源代码，也可以向他人分发此源代码，但是不得用于商业用途。
    您也可以自己将这些代码打包成epub分发给别人，但是不得用于商业用途。
    如果此源代码侵犯了您的权益，请联系我我将会删除侵权内容。
    您在阅读此源代码时，可能会看到一些英文内容，这些内容是原书的内容，可能是因为翻译不准确或者是因为原书的内容没有被翻译。
    如果您发现了错误，请联系我我会进行修正。
  -->
<!--This line of comments will exist in the translated source file. Do not delete this comment unless you have permission.
    Translation is done by ClassicByte Org's higashitani yume
    Usage Tools Immersive Translation Zhipu GLM Model
    You can read this source code or distribute it to others, but it may not be used for commercial purposes.
    You can also package these codes yourself into epub and distribute them to others, but they may not be used for commercial purposes.
    If this source code infringes your rights, please contact me and I will delete the infringing content.
    When you read this source code, you may see some English content, which is the content of the original book, which may be because the translation is inaccurate or because the content of the original book has not been translated.
    If you find an error, please contact me and I will correct it.
  -->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops"
    xmlns:svg="http://www.w3.org/2000/svg" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en"
    imt-state="dual" imt-trans-position="after">

<head>
    <title>15 依赖注入和配置 --- 15 Dependency Injection and Configuration</title>
    <link href="WileyTemplate_v5.5.css" rel="stylesheet" type="text/css" />
    <meta content="urn:uuid:e0000000-0000-0000-0000-000006715209" name="Adept.expected.resource" />
    <style data-id="immersive-translate-input-injected-css">
        .immersive-translate-input {
            position: absolute;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            z-index: 2147483647;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .immersive-translate-attach-loading::after {
            content: " ";

            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;

            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-2000%, -50%);
            z-index: 100;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .immersive-translate-input-loading {
            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;
        }

        @keyframes immersiveTranslateShadowRolling {
            0% {
                box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            12% {
                box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            25% {
                box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            36% {
                box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color),
                    100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
            }

            50% {
                box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color),
                    110px 0 var(--loading-color), 100px 0 var(--loading-color);
            }

            62% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color),
                    120px 0 var(--loading-color), 110px 0 var(--loading-color);
            }

            75% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    130px 0 var(--loading-color), 120px 0 var(--loading-color);
            }

            87% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
            }

            100% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
            }
        }

        .immersive-translate-toast {
            display: flex;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            right: 0;
            top: 1%;
            width: fit-content;
            padding: 12px 20px;
            margin: auto;
            overflow: auto;
            background: #fef6f9;
            box-shadow: 0px 4px 10px 0px rgba(0, 10, 30, 0.06);
            font-size: 15px;
            border-radius: 8px;
            color: #333;
        }

        .immersive-translate-toast-content {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .immersive-translate-toast-hidden {
            margin: 0 20px 0 72px;
            text-decoration: underline;
            cursor: pointer;
        }

        .immersive-translate-toast-close {
            color: #666666;
            font-size: 20px;
            font-weight: bold;
            padding: 0 10px;
            cursor: pointer;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-toast {
                top: 0;
                padding: 12px 0px 0 10px;
            }

            .immersive-translate-toast-content {
                flex-direction: column;
                text-align: center;
            }

            .immersive-translate-toast-hidden {
                margin: 10px auto;
            }
        }

        .immersive-translate-modal {
            display: none;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
            font-size: 15px;
        }

        .immersive-translate-modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 40px 24px 24px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 80%;
            max-width: 270px;
            font-family: system-ui, -apple-system, "Segoe UI", "Roboto", "Ubuntu",
                "Cantarell", "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
                "Segoe UI Symbol", "Noto Color Emoji";
            position: relative;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-content {
                margin: 50% auto !important;
            }
        }

        .immersive-translate-modal .immersive-translate-modal-content-in-input {
            max-width: 500px;
        }

        .immersive-translate-modal-content-in-input .immersive-translate-modal-body {
            text-align: left;
            max-height: unset;
        }

        .immersive-translate-modal-title {
            text-align: center;
            font-size: 16px;
            font-weight: 700;
            color: #333333;
        }

        .immersive-translate-modal-body {
            text-align: center;
            font-size: 14px;
            font-weight: 400;
            color: #333333;
            word-break: break-all;
            margin-top: 24px;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-body {
                max-height: 250px;
                overflow-y: auto;
            }
        }

        .immersive-translate-close {
            color: #666666;
            position: absolute;
            right: 16px;
            top: 16px;
            font-size: 20px;
            font-weight: bold;
        }

        .immersive-translate-close:hover,
        .immersive-translate-close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .immersive-translate-modal-footer {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        .immersive-translate-btn {
            width: fit-content;
            color: #fff;
            background-color: #ea4c89;
            border: none;
            font-size: 16px;
            margin: 0 8px;
            padding: 9px 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .immersive-translate-btn:hover {
            background-color: #f082ac;
        }

        .immersive-translate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .immersive-translate-btn:disabled:hover {
            background-color: #ea4c89;
        }

        .immersive-translate-cancel-btn {
            /* gray color */
            background-color: rgb(89, 107, 120);
        }

        .immersive-translate-cancel-btn:hover {
            background-color: hsl(205, 20%, 32%);
        }

        .immersive-translate-action-btn {
            background-color: transparent;
            color: #ea4c89;
            border: 1px solid #ea4c89;
        }

        .immersive-translate-btn svg {
            margin-right: 5px;
        }

        .immersive-translate-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #007bff;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-primary-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #ea4c89;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-modal input[type="radio"] {
            margin: 0 6px;
            cursor: pointer;
        }

        .immersive-translate-modal label {
            cursor: pointer;
        }

        .immersive-translate-close-action {
            position: absolute;
            top: 2px;
            right: 0px;
            cursor: pointer;
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5) !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 16px !important;
        }

        .imt-image-status img,
        .imt-image-status svg,
        .imt-img-loading {
            width: 28px !important;
            height: 28px !important;
            margin: 0 0 8px 0 !important;
            min-height: 28px !important;
            min-width: 28px !important;
            position: relative !important;
        }

        .imt-img-loading {
            background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAtFBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////oK74hAAAAPHRSTlMABBMIDyQXHwyBfFdDMSw+OjXCb+5RG51IvV/k0rOqlGRM6KKMhdvNyZBz9MaupmxpWyj437iYd/yJVNZeuUC7AAACt0lEQVRIx53T2XKiUBCA4QYOiyCbiAsuuGBcYtxiYtT3f6/pbqoYHVFO5r+iivpo6DpAWYpqeoFfr9f90DsYAuRSWkFnPO50OgR9PwiCUFcl2GEcx+N/YBh6pvKaefHlUgZd1zVe0NbYcQjGBfzrPE8Xz8aF+71D8gG6DHFPpc4a7xFiCDuhaWgKgGIJQ3d5IMGDrpS4S5KgpIm+en9f6PlAhKby4JwEIxlYJV9h5k5nee9GoxHJ2IDSNB0dwdad1NAxDJ/uXDHYmebdk4PdbkS58CIVHdYSUHTYYRWOJblWSyu2lmy3KNFVJNBhxcuGW4YBVCbYGRZwIooipHsNqjM4FbgOQqQqSKQQU9V8xmi1QlgHqQQ6DDBvRUVCDirs+EzGDGOQTCATgtYTnbCVLgsVgRE0T1QE0qHCFAht2z6dLvJQs3Lo2FQoDxWNUiBhaP4eRgwNkI+dAjVOA/kUrIDwf3CG8NfNOE0eiFotSuo+rBiq8tD9oY4Qzc6YJw99hl1wzpQvD7ef2M8QgnOGJfJw+EltQc+oX2yn907QB22WZcvlUpd143dqQu+8pCJZuGE4xCuPXJqqcs5sNpsI93Rmzym1k4Npk+oD1SH3/a3LOK/JpUBpWfqNySxWzCfNCUITuDG5dtuphrUJ1myeIE9bIsPiKrfqTai5WZxbhtNphYx6GEIHihyGFTI69lje/rxajdh0s0msZ0zYxyPLhYCb1CyHm9Qsd2H37Y3lugVwL9kNh8Ot8cha6fUNQ8nuXi5z9/ExsAO4zQrb/ev1yrCB7lGyQzgYDGuxq1toDN/JGvN+HyWNHKB7zEoK+PX11e12G431erGYzwmytAWU56fkMHY5JJnDRR2eZji3AwtIcrEV8Cojat/BdQ7XOwGV1e1hDjGGjXbdArm8uJZtCH5MbcctVX8A1WpqumJHwckAAAAASUVORK5CYII=");
            background-size: 28px 28px;
            animation: image-loading-rotate 1s linear infinite !important;
        }

        .imt-image-status span {
            color: var(--bg-2, #fff) !important;
            font-size: 14px !important;
            line-height: 14px !important;
            font-weight: 500 !important;
            font-family: "PingFang SC", Arial, sans-serif !important;
        }

        @keyframes image-loading-rotate {
            from {
                transform: rotate(360deg);
            }

            to {
                transform: rotate(0deg);
            }
        }
    </style>
    <style data-id="immersive-translate-default-injected-css">
        :root {
            --immersive-translate-theme-underline-borderColor: #72ece9;
            --immersive-translate-theme-nativeUnderline-borderColor: #72ece9;
            --immersive-translate-theme-nativeDashed-borderColor: #72ece9;
            --immersive-translate-theme-nativeDotted-borderColor: #72ece9;
            --immersive-translate-theme-highlight-backgroundColor: #ffff00;
            --immersive-translate-theme-dashed-borderColor: #59c1bd;
            --immersive-translate-theme-blockquote-borderColor: #cc3355;
            --immersive-translate-theme-thinDashed-borderColor: #ff374f;
            --immersive-translate-theme-dashedBorder-borderColor: #94a3b8;
            --immersive-translate-theme-dashedBorder-borderRadius: 0;
            --immersive-translate-theme-solidBorder-borderColor: #94a3b8;
            --immersive-translate-theme-solidBorder-borderRadius: 0;
            --immersive-translate-theme-dotted-borderColor: #94a3b8;
            --immersive-translate-theme-wavy-borderColor: #72ece9;
            --immersive-translate-theme-dividingLine-borderColor: #94a3b8;
            --immersive-translate-theme-grey-textColor: #2f4f4f;
            --immersive-translate-theme-marker-backgroundColor: #fbda41;
            --immersive-translate-theme-marker-backgroundColor-rgb: 251, 218, 65;
            --immersive-translate-theme-marker2-backgroundColor: #ffff00;
            --immersive-translate-theme-background-backgroundColor: #dbafaf;
            --immersive-translate-theme-background-backgroundColor-rgb: 219, 175, 175;
            --immersive-translate-theme-background-backgroundOpacity: 12;
            --immersive-translate-theme-opacity-opacity: 10;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pre-whitespace {
            white-space: pre-wrap !important;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container {
            position: absolute;
            background-color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
                sans-serif;
            top: 0;
            width: 600px;
            height: 100%;
            z-index: 2;
            line-height: 1.3;
            font-size: 16px;
        }

        [imt-state="dual"] .immersive-translate-target-wrapper[dir="rtl"] {
            text-align: right;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper {
            color: rgb(0, 0, 0);
            white-space: normal;
            position: absolute;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper font {
            color: inherit;
            white-space: inherit;
            position: unset;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper &gt;

        br {
            display: none;
        }

        [imt-state="translation"] .immersive-translate-target-translation-block-wrapper {
            margin: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper {
            margin: 8px 0 !important;
            display: inline-block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            display: block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            margin-top: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pdf-block-wrapper {
            margin: 0 !important;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-grey-inner {
            color: var(--immersive-translate-theme-grey-textColor);
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-underline-inner {
            border-bottom: 1px solid var(--immersive-translate-theme-underline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeUnderline-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeUnderline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDashed-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDashed-borderColor) !important;
            text-decoration-style: dashed !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-thinDashed-inner {
            border-bottom: 1px dashed var(--immersive-translate-theme-thinDashed-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dotted-inner {
            background-image: linear-gradient(to right,
                    var(--immersive-translate-theme-dotted-borderColor) 30%,
                    rgba(255, 255, 255, 0) 0%);
            background-position: bottom;
            background-size: 5px 1px;
            background-repeat: repeat-x;
            padding-bottom: 3px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDotted-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDotted-borderColor) !important;
            text-decoration-style: dotted !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-wavy-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-wavy-borderColor) !important;
            text-decoration-style: wavy !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dashed-inner {
            background: linear-gradient(to right,
                    var(--immersive-translate-theme-dashed-borderColor) 0%,
                    var(--immersive-translate-theme-dashed-borderColor) 50%,
                    transparent 50%,
                    transparent 100%) repeat-x left bottom;
            background-size: 8px 2px;
            padding-bottom: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            content: "";
            display: block;
            max-width: 80px;
            width: 10%;
            border-top: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            padding-top: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dividingLine::before {
            content: "";
            border-left: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            max-height: 16px;
            height: 16px;
            padding-left: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-highlight-inner {
            background: var(--immersive-translate-theme-highlight-backgroundColor);
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-marker {
            line-height: 1.5em;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker2-inner {
            font-weight: bold;
            text-shadow: 10px 0px 3px var(--immersive-translate-theme-marker2-backgroundColor),
                16px 3px 9px var(--immersive-translate-theme-marker2-backgroundColor),
                2px 0px 6px var(--immersive-translate-theme-marker2-backgroundColor),
                -12px 0px 12px var(--immersive-translate-theme-marker2-backgroundColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker-inner {
            /* TODO: add more texture */
            background: linear-gradient(to right,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.1),
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 3%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 35%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 70%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.8) 95%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.3));
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-weakening {
            opacity: 0.618 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-italic {
            font-style: italic !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-bold {
            font-weight: bold !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-paper {
            margin: 8px 0;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
            padding: 16px 32px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-blockquote {
            border-left: 4px solid var(--immersive-translate-theme-blockquote-borderColor) !important;
            padding-left: 12px !important;
            margin-top: 4px;
            margin-bottom: 4px;
            padding-top: 4px;
            padding-bottom: 4px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-mask-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        /* opacity theme start */

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner,
        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: none !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        /* opacity theme end */

        /* background theme start */
        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-background {
            margin: 8px 0;
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            border-radius: 4px;
            box-shadow: unset !important;
            padding: 12px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-background-inner {
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            padding-left: 6px;
            padding-right: 6px;
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper .immersive-translate-target-translation-theme-background-inner {
            background: unset;
            padding-left: unset;
            padding-right: unset;
        }

        /* background theme end */

        /* vertical css , please remain it in the last one. */
        .immersive-translate-target-translation-vertical-block-wrapper {
            margin: 0px 8px !important;
        }

        .immersive-translate-text {
            font-size: 15px !important;
        }

        .immersive-translate-error-toast {
            position: fixed;
            top: 5%;
            z-index: 99999999;
            left: 0;
            right: 0;
            margin: auto;
            max-width: 300px;
            padding: 16px;
            border-radius: 12px;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        @media all and (min-width: 750px) {
            .immersive-translate-error-toast {
                max-width: 400px;
            }
        }

        .immersive-translate-clickable-button {
            cursor: pointer;
        }

        .immersive-translate-help-button {
            cursor: pointer;
        }

        .immersive-translate-loading-text:before {
            content: "...";
        }

        /* dark mode for loading */

        @media only screen and (prefers-color-scheme: dark) {
            .immersive-translate-loading {
                border: 2px rgba(255, 255, 255, 0.25) solid !important;
                border-top: 2px rgba(255, 255, 255, 1) solid !important;
            }
        }

        .immersive-translate-error-wrapper {
            position: relative;
            display: inline-flex;
            padding: 6px;
            margin: 0 12px;
            white-space: nowrap;
            font-size: 0.9em;
        }

        [lang="zh-CN"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        [lang="zh-TW"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        .immersive-translate-tooltip {
            position: relative;
            display: inline-flex;
            /* little indicater to indicate it's hoverable */
        }

        .immersive-translate-tooltip-content {
            /* here's the magic */
            position: absolute;
            z-index: 100000000000;

            left: 50%;
            bottom: 0;
            transform: translate(-50%, 110%);
            line-height: 1;
            /* and add a small left margin */

            /* basic styles */
            width: max-content;
            max-width: 250px;
            word-wrap: break-word;
            white-space: pre-line;
            padding: 10px;
            border-radius: 10px;
            background: #000c;
            color: #fff;
            text-align: center;
            font-size: 14px;
            display: none;
            /* hide by default */
        }

        .immersive-translate-tooltip:hover .immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip:hover+.immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip-content-table {
            left: unset !important;
            bottom: unset !important;
            transform: translate(-10%, 50%) !important;
        }

        .immersive-translate-tooltip:hover:before {
            display: inline-block;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--bg-2, #fff);
            font-size: 14px;
        }
    </style>
    <style data-id="immersive-translate-user-custom-style">
        :root {

            .immersive-translate-target-inner {
                font-family: inherit;
            }


            .immersive-translate-target-inner {
                font-family: inherit;
            }
        }
    </style>
    <style data-id="immersive-translate-dynamic-injected-css">
        .immersive-translate-target-wrapper[dir='rtl'] {
            text-align: right;
        }

        .immersive-translate-target-wrapper[dir='rtl'] [data-immersive-translate-class-bak*='block-wrapper'] {
            display: block;
        }

        .immersive-translate-target-wrapper {
            word-break: break-word;
            user-select: text;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper[dir='rtl'] {
            display: inline-block;
        }

        [dir='rtl'] .immersive-translate-target-wrapper:not([dir]) {
            text-align: left;
        }

        [imt-state=dual] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            display: block;
        }

        [imt-trans-position=before] .immersive-translate-target-translation-block-wrapper {
            display: block !important;
        }

        [imt-state][data-immersive-translate_rtl] .immersive-translate-target-wrapper {
            display: block !important;
        }
    </style>
</head>

<body epub:type="bodymatter" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
    <section aria-labelledby="c15_1" epub:type="chapter" role="doc-chapter"
        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
        <header data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
            <h1 id="c15_1" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1"><span aria-label="392" epub:type="pagebreak" id="Page_392"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span><span id="c15"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span><span
                    class="chapterNumber"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">15</span><br /><span
                    class="chapterTitle"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Dependency Injection and
                    Configuration</span>
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">15 依赖注入和配置</font>
                    </font>
                </font>
            </h1>
        </header>
        <section aria-label="chapter opening" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
            <span id="c15-sec-0001" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
            <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <h3 data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1">WHAT'S IN THIS CHAPTER?<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章包含什么内容？</font>
                            </font>
                        </font>
                    </h3>
                    <ul class="check2" id="c15-list-0001"
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <li id="c15-li-0001" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1">Understanding dependency injection<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">理解依赖注入</font>
                                </font>
                            </font>
                        </li>
                        <li id="c15-li-0002" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1">Configuring the DI Container with the host class<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用主机类配置 DI 容器</font>
                                </font>
                            </font>
                        </li>
                        <li id="c15-li-0003" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1">Managing the lifetime of services<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">管理服务的生命周期</font>
                                </font>
                            </font>
                        </li>
                        <li id="c15-li-0004" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1">Disposing services<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">释放服务</font>
                                </font>
                            </font>
                        </li>
                        <li id="c15-li-0005" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1">Using options and configuration to initialize
                            services<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用选项和配置初始化服务</font>
                                </font>
                            </font>
                        </li>
                        <li id="c15-li-0006" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1">Handling configuration with .NET applications<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">处理.NET 应用程序中的配置</font>
                                </font>
                            </font>
                        </li>
                        <li id="c15-li-0007" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1">Working with user secrets<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">与用户机密合作</font>
                                </font>
                            </font>
                        </li>
                        <li id="c15-li-0008" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1">Using Azure App Configuration<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用 Azure App Configuration
                                    </font>
                                </font>
                            </font>
                        </li>
                    </ul>
                    <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                </section>
            </aside>
            <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span
                        id="c15-fea-0001" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                    <h3 id="head-2-128" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1">CODE DOWNLOADS FOR THIS CHAPTER<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章代码下载</font>
                            </font>
                        </font>
                    </h3>
                    <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span
                            id="c15-sec-0002"
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                        <p id="c15-para-0003" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1">The source code for this chapter is available on the
                            book page at <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><a href="http://www.wiley.com">www.wiley.com</a></code>.
                            Click the Downloads link. The code can also be found at <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                            in the <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">2_Libs/DependencyInjectionAndConfiguration</code>
                            folder.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的源代码可在第 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><a href="http://www.wiley.com">www.wiley.com</a></code>
                                        页的书籍页面上找到。点击下载链接。代码也可以在第 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                                        的 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">2_Libs/DependencyInjectionAndConfiguration</code>
                                        文件夹中找到。</font>
                                </font>
                            </font>
                        </p>
                        <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1">The code for this chapter is divided into the
                            following major examples:<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的代码分为以下主要示例：</font>
                                </font>
                            </font>
                        </p>
                        <ul class="check" id="c15-list-0002"
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                            <li id="c15-li-0009" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                                data-immersive-translate-paragraph="1">WithDIContainer<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">使用 DI 容器 </font>
                                    </font>
                                </font>
                            </li>
                            <li id="c15-li-0010" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                                data-immersive-translate-paragraph="1">WithHost<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">使用主机</font>
                                    </font>
                                </font>
                            </li>
                            <li id="c15-li-0011" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                                data-immersive-translate-paragraph="1">ServicesLifetime<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">服务生命周期</font>
                                    </font>
                                </font>
                            </li>
                            <li id="c15-li-0012" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                                data-immersive-translate-paragraph="1">DIWithOptions<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">带选项的依赖注入</font>
                                    </font>
                                </font>
                            </li>
                            <li id="c15-li-0013" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                                data-immersive-translate-paragraph="1">DIWithConfiguration<font
                                    class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">带配置的依赖注入</font>
                                    </font>
                                </font>
                            </li>
                            <li id="c15-li-0014" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                                data-immersive-translate-paragraph="1"><span aria-label="393" epub:type="pagebreak"
                                    id="Page_393" role="doc-pagebreak"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>ConfigurationSample
                                <font class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                    </font>
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">配置示例</font>
                                    </font>
                                </font>
                            </li>
                            <li id="c15-li-0015" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                                data-immersive-translate-paragraph="1">AzureAppConfigWebApp</li>
                        </ul>
                        <p id="c15-para-0005" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1">All the projects have nullable reference types
                            enabled.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">所有项目都启用了可空引用类型。 </font>
                                </font>
                            </font>
                        </p>
                    </section>
                    <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                </section>
            </aside>
        </section>
        <section aria-labelledby="head-2-129" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
            <span id="c15-sec-0003" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
            <h2 id="head-2-129" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">WHAT IS DEPENDENCY INJECTION?<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">什么是依赖注入？ </font>
                    </font>
                </font>
            </h2>
            <p id="c15-para-0006" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">Faster development cycles demand unit tests and better
                updatability. Making some code changes should not result in errors where you don't expect them. Creating
                more modular applications where dependencies are reduced helps with that.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            更快的开发周期需要单元测试和更好的可更新性。某些代码更改不应导致您未预期的错误。创建更多模块化的应用程序，减少依赖关系有助于实现这一点。 </font>
                    </font>
                </font>
            </p>
            <p id="c15-para-0007" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1"><i
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Dependency injection</i> (DI)
                is a pattern where an object receives other objects it depends on—instead of creating it on its own.
                This reduces dependencies, because the receiving object doesn't need to know about the details of the
                object it receives; all it needs is a contract (usually a C# interface).<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            依赖注入（DI）是一种模式，其中对象接收它所依赖的其他对象——而不是自己创建它。这减少了依赖关系，因为接收对象不需要了解它所接收对象的细节；它只需要一个合同（通常是 C#接口）。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c15-para-0008" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">Dependency injection was introduced in <a href="c04.xhtml"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter 4</a>,
                “Object-Oriented Programming in C#.” This chapter enhances dependency injection using the container
                <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.DependencyInjection</code>
                for having the management of dependencies in a central place of the application. This chapter starts
                with a small application for creating a dependency injection container with the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                class, which is later changed to use the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> class that itself
                creates a DI container and shows various features of this DI container. The second part of this chapter
                shows the configuration of a .NET application, which is another feature of the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> class.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">依赖注入在第四章“C#中的面向对象编程”中引入。本章使用容器 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.DependencyInjection</code>
                            增强依赖注入，将依赖管理集中在应用程序的中央位置。本章从一个使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                            类创建依赖注入容器的简单应用程序开始，随后将其更改为使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                            类，该类本身创建了一个 DI 容器并展示了该 DI 容器的各种功能。本章的第二部分展示了.NET 应用程序的配置，这是 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                            类的一个特性。</font>
                    </font>
                </font>
            </p>
        </section>
        <section aria-labelledby="head-2-130" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
            <span id="c15-sec-0004" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
            <h2 id="head-2-130" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">USING THE .NET DI CONTAINER<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用.NET DI 容器</font>
                    </font>
                </font>
            </h2>
            <p id="c15-para-0009" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">With a dependency injection container, you can have one place in
                your application where you define which contracts map to each specific implementation. You also can
                specify whether a service should be used as a singleton or a new instance should be created every time
                it's used.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            使用依赖注入容器，您可以在应用程序中定义一个位置，指定哪些合同映射到每个特定的实现。您还可以指定服务应作为单例使用，还是每次使用时创建新实例。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">With the next few samples, a greeting service (defined with the
                interface contract <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code> and
                implemented with the class <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>) is
                injected in the class <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>. The
                interface defines the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Greet</code> method (code
                file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/WithDIContainer/IGreetingService.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在接下来的几个示例中，一个问候服务（使用接口合同 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>
                            定义，使用类 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                            实现）被注入到类 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            中。接口定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Greet</code>
                            方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/WithDIContainer/IGreetingService.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0001"><code>public interface IGreetingService</code>
<code>{</code>
<code>  string Greet(string name);</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">The contract is implemented in the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code> class
                (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DepencencyInjectionSamples/WithDIContainer/GreetingService.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">合约在 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                            类（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DepencencyInjectionSamples/WithDIContainer/GreetingService.cs</code>
                            ）中实现：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0002"><code>public class GreetingService : IGreetingService</code>
<code>{</code>
<code>  public string Greet(string name) =&gt; $"Hello, {name}";</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">Finally, the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>
                interface is injected using constructor injection in the class <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code> (code
                file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DepencencyInjectionSamples/WithDIContainer/HomeController.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">最后，使用构造函数注入在 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            类（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DepencencyInjectionSamples/WithDIContainer/HomeController.cs</code>
                            ）中注入 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>
                            接口：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0003"><code>public class HomeController</code>
<code>{</code>
<code>  private readonly IGreetingService _greetingService;</code>
<code>  public HomeController(IGreetingService greetingService) =&gt;</code>
<code>    _greetingService = greetingService;<span aria-label="394" epub:type="pagebreak" id="Page_394" role="doc-pagebreak"></span></code>
<code>    </code>
<code>  public string Hello(string name) =&gt;</code>
<code>    _greetingService.Greet(name).ToUpper();</code>
<code>}</code></pre>
            <p id="c15-para-0013" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">Within the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Program</code> class, the
                <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetServiceProvider</code>
                method is defined. Here, a new <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                object is instantiated. <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code> is
                defined in the namespace <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.DependencyInjection</code>
                after you add the NuGet package <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.DependencyInjection</code>.
                The extension methods <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddSingleton</code> and <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddTransient</code> are used
                to register the types that need to be known by the DI container. With the sample application, both the
                <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code> and
                the <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                are registered in the container, which makes it possible to retrieve the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code> from
                the container.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Program</code>
                            类中定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetServiceProvider</code>
                            方法。这里实例化了一个新的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                            对象。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                            在添加 NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.DependencyInjection</code>
                            后在命名空间 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.DependencyInjection</code>
                            中定义。使用扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddSingleton</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddTransient</code>
                            注册需要 DI 容器识别的类型。在示例应用程序中， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            都注册在容器中，这使得可以从容器中获取 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            。</font>
                    </font>
                </font>
            </p>
            <p id="c15-para-0014" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">The class <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code> will
                be instantiated when the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>
                interface is requested. With the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>, an
                interface is not defined. Here, the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code> is
                instantiated when the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code> is
                requested.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">当请求 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>
                            接口时， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                            类将被实例化。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            时，接口未定义。这里，当请求 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            时，实例化 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">For the lifetime of <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>, the
                same instance is always returned when <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code> is
                requested. This is different with <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>, where
                a new instance is always returned on every request to retrieve a <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>. This
                information for the DI container is specified by using the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddSingleton</code> and <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddTransient</code> methods.
                Later in this chapter, you can read more about the lifetime of services. Invoking the method <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">BuildServiceProvider</code>
                returns a <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceProvider</code> object
                that can then be used to access the services registered (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/WithDIContainer/Program.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">对于 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                            的生命周期，当请求 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>
                            时，始终返回相同的实例。这与 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            不同，在 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            中，每次请求都会返回一个新的实例以获取 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            。DI 容器通过使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddSingleton</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddTransient</code>
                            方法指定这些信息。在本章后面，您可以阅读更多关于服务生命周期的内容。调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">BuildServiceProvider</code>
                            方法会返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceProvider</code>
                            对象，然后可以使用该对象来访问已注册的服务（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/WithDIContainer/Program.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0004"><code>static ServiceProvider GetServiceProvider()</code>
<code>{</code>
<code>  ServiceCollection = new();</code>
<code>  <b>services.AddSingleton</b>&lt;IGreetingService, GreetingService&gt;();</code>
<code>  <b>services.AddTransient</b>&lt;HomeController&gt;();</code>
<code>  return services.BuildServiceProvider();</code>
<code>}</code></pre>
            <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <p id="c15-para-0017" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">If you add the same
                            interface contract multiple times to the services collection, the last one added wins for
                            getting the interface from the container. This makes it easy to replace contracts with
                            different implementations if you need a changed functionality—for example, with services
                            implemented by ASP.NET Core or Entity Framework Core.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意
                                    如果您多次将相同的接口契约添加到服务集合中，最后添加的契约将决定从容器中获取接口。这使得在需要更改功能时可以轻松地用不同的实现替换契约——例如，使用 ASP.NET
                                    Core 或 Entity Framework Core 实现的服务。</font>
                            </font>
                        </font>
                    </p>
                    <p id="c15-para-0018" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1"><i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">On the other hand,
                            with the </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> class, you also have
                            access not only to add but also to remove services and to retrieve a list of all services
                            for a specific contract.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">另一方面，使用 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                                    类，您不仅可以添加服务，还可以删除服务，并获取特定契约的所有服务的列表。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                </section>
            </aside>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">Next, let's change the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Main</code> method to invoke
                the <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">RegisterServices</code>
                method for making the registration within the DI container and then to invoke the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                method of the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceProvider</code> to get
                a reference to a <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                instance (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/WithDIContainer/Program.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">接下来，让我们更改 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Main</code> 方法以调用
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">RegisterServices</code>
                            方法在 DI 容器中进行注册，然后调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceProvider</code>
                            的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                            方法以获取 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            实例的引用（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/WithDIContainer/Program.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0005"><code>using ServiceProvider <b>container = GetServiceProvider();</b></code>
<code>var controller = <b>container.GetRequiredService&lt;HomeController&gt;();</b></code>
<code>string result = controller.Hello("Stephanie");</code>
<code>Console.WriteLine(result);</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span aria-label="395"
                    epub:type="pagebreak" id="Page_395" role="doc-pagebreak"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span></p>
            <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <p id="c15-para-0021" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">With the </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceProvider</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> class, different
                            overloads of </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetService</code> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> and </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> exist. The method
                            that is directly implemented in the </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceProvider</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> class is </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetService</code> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> with a </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Type</code> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> parameter. The
                            generic method </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetService&lt;T&gt;</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> is an extension
                            method that takes the generic type parameter and </i> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">passes it to the </i>
                        <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetService</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> method.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意：在 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceProvider</code>
                                    类中， <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetService</code>
                                    和 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                                    存在不同的重载版本。直接在 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceProvider</code>
                                    类中实现的方法是 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetService</code>
                                    ，它有一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Type</code>
                                    参数。泛型方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetService&lt;T&gt;</code>
                                    是一个扩展方法，它接收泛型类型参数并将其传递给 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetService</code>
                                    方法。</font>
                            </font>
                        </font>
                    </p>
                    <p id="c15-para-0022" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1"><i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">If the service is not
                            available in the container, </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetService</code> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> returns </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">null</code> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">. The </i> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">extension method </i>
                        <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> checks for a </i>
                        <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">null</code> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> result and throws an
                        </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">InvalidOperationException</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> if the service is not
                            found. If the service provider implements the interface </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ISupportsRequiredService</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">, the extension method
                        </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> invokes the </i>
                        <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> of the provider. The
                            container of .NET Core does not implement this interface, but some third-party containers
                            do.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">如果容器中没有该服务， <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetService</code>
                                    将返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">null</code>
                                    。扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                                    会检查 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">null</code>
                                    结果，如果服务未找到则抛出 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">InvalidOperationException</code>
                                    异常。如果服务提供者实现了接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ISupportsRequiredService</code>
                                    ，扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                                    会调用提供者的 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                                    。.NET Core 的容器没有实现该接口，但一些第三方容器实现了。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                </section>
            </aside>
            <p id="c15-para-0023" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">Let's examine how the different parts are connected when starting
                the application. When the application starts, on the request of the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                method, the DI container creates an instance of the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code> class.
                The <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                constructor requires an object implementing <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>. This
                interface is also registered with the container; for <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>, a
                <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                object needs to be returned. The <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code> class
                has a default constructor; thus, the container can create an instance and pass this instance to the
                constructor of the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>. This
                instance is used with the controller variable and used as before to invoke the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Hello</code> method.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">让我们看看在启动应用程序时各个部分是如何连接的。当应用程序启动时，在
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                            方法的请求下，依赖注入容器创建 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            类的实例。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            构造函数需要一个实现 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>
                            接口的对象。这个接口也注册在容器中；对于 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>
                            ，需要返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                            对象。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                            类有一个默认构造函数；因此，容器可以创建一个实例并将这个实例传递给 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            的构造函数。这个实例与控制器变量一起使用，并像之前一样用于调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Hello</code> 方法。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c15-para-0024" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">What happens if not every dependency is registered with the DI
                container? In that case, the registration that maps <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code> to
                <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code> is
                removed, and the container throws the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">InvalidOperationException</code>.
                In case of the sample application, this error message shows up: <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Unable to resolve service for type 'WithDIContainer.IGreetingService' while attempting to activate 'WithDIContainer.HomeController'</code>.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">如果并非所有依赖项都注册在依赖注入容器中会怎样？在这种情况下，映射
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>
                            到 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                            的注册会被移除，容器会抛出 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">InvalidOperationException</code>
                            异常。在示例应用程序中，会显示错误消息： <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Unable to resolve service for type 'WithDIContainer.IGreetingService' while attempting to activate 'WithDIContainer.HomeController'</code>
                            。</font>
                    </font>
                </font>
            </p>
        </section>
        <section aria-labelledby="head-2-131" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
            <span id="c15-sec-0007" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
            <h2 id="head-2-131" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">USING THE HOST CLASS<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用宿主类</font>
                    </font>
                </font>
            </h2>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">A class that offers out-of-the-box support for a dependency
                injection container is the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> class from the
                NuGet package <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.Hosting</code>.
                This class not only offers creating the dependency injection container but also functionality for
                logging and configuration, which are features that practically all applications need.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">一个为依赖注入容器提供开箱即用支持的类是 NuGet 包 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.Hosting</code>
                            中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                            类。这个类不仅提供创建依赖注入容器，还提供日志记录和配置的功能，这些是几乎所有应用程序都需要的功能。</font>
                    </font>
                </font>
            </p>
            <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <p id="c15-para-0026" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Configuration using
                            the </i>
                        <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> class is covered in
                            this chapter in the section “Configuration with .NET Applications.” Logging is covered in <a
                                href="c16.xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter 16</a>,
                            “Diagnostics and Metrics.”</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意：使用 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                                    类的配置在本章的“使用 .NET 应用程序进行配置”一节中介绍。日志记录在“诊断和指标”章节（第 16 章）中介绍。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                </section>
            </aside>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">Let's change the previous sample application to use the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> class. With the
                sample application, the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>, <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>, and
                <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>
                types didn't change. When you use the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> class, a
                simplification is possible with the top-level statements in the file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Program.cs</code>. Instead of
                creating a new <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>,
                this is now a job of the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                method of the <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                class. The <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                method configures defaults for dependency injection, logging, and configuration. In the implementation
                of this method, a new <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code> is
                created, and some commonly used interfaces are already registered. To configure more services, the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                returns an <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IHostBuilder</code>, and with
                this, the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureServices</code>
                method can be invoked to register additional services. One overload of the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureServices</code>
                method defines a <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                parameter that can be used to configure services <span aria-label="396" epub:type="pagebreak"
                    id="Page_396" role="doc-pagebreak"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>as has been shown
                before in the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetServiceProvider</code>
                method (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DepencencyInjectionSamples/WithHost/Program.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">让我们将之前的示例应用程序改为使用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                            类。在示例应用程序中， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            、 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>
                            类型没有变化。当你使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                            类时，可以在文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Program.cs</code>
                            的顶层语句中进行简化。不再需要创建新的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                            ，现在这是 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                            类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                            方法的任务。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                            方法配置依赖注入、日志记录和配置的默认值。在该方法的实现中，创建了一个新的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                            ，并且已经注册了一些常用的接口。要配置更多服务， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                            会返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IHostBuilder</code>
                            ，然后可以通过这个返回值调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureServices</code>
                            方法来注册额外服务。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureServices</code>
                            方法的其中一个重载定义了一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                            参数，该参数可用于配置服务，正如在 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetServiceProvider</code>
                            方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DepencencyInjectionSamples/WithHost/Program.cs</code>
                            ）中所展示的那样：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0006"><code>using var host = Host.CreateDefaultBuilder(args)</code>
<code>  .ConfigureServices(services =&gt;</code>
<code>  {</code>
<code>    services.AddSingleton&lt;IGreetingService, GreetingService&gt;();</code>
<code>    services.AddTransient&lt;HomeController&gt;();</code>
<code>  }).Build();</code>
<code> </code>
<code>var controller = host.Services.GetRequiredService&lt;HomeController&gt;();</code>
<code>string result = controller.Hello("Matthias");</code>
<code>Console.WriteLine(result);</code></pre>
            <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <p id="c15-para-0029" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">You might think that
                            adding extra source code when using the </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> class makes it not
                            worthwhile to use this feature. However, the </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> method also registers
                            some commonly used services and configures defaults for logging and configuration. All of
                            these topics are discussed later in this chapter and in <a href="c16.xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter
                                16</a>.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意 你可能会认为在使用 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                                    类时添加额外的源代码使得使用这个特性不划算。然而， <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                                    方法也注册了一些常用服务，并为日志记录和配置配置了默认值。所有这些主题都在本章的后面和第 16 章中讨论。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                </section>
            </aside>
        </section>
        <section aria-labelledby="head-2-132" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
            <span id="c15-sec-0010" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
            <h2 id="head-2-132" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">LIFETIME OF SERVICES<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">服务的生命周期 </font>
                    </font>
                </font>
            </h2>
            <p id="c15-para-0030" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">Registering a service as a singleton always returns the same
                instance; registering a service transient returns a new object every time the service is injected. There
                are more options available and more issues to think about. Let's start with another example showing this
                and implementing the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IDisposable</code> interface
                with the services, so you can see how disposing of service instances is handled by the container.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            将服务注册为单例始终返回相同的实例；将服务注册为瞬态每次注入服务时都会返回一个新对象。有更多选项可供选择，也有更多问题需要考虑。让我们通过另一个示例来展示这一点，并使用服务实现
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IDisposable</code>
                            接口，以便你可以看到容器如何处理服务实例的释放。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">To easily differentiate between instances, every service
                instantiated will be given a different number. The number is created from a shared service. This shared
                service defines a simple interface <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">INumberService</code> to
                return a number (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/INumberService.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            为了轻松区分实例，每个实例化的服务都将被赋予一个不同的编号。编号是由一个共享服务创建的。这个共享服务定义了一个简单的接口 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">INumberService</code>
                            来返回一个编号（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/INumberService.cs</code>
                            ):</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0007"><code>public interface INumberService</code>
<code>{</code>
<code>  int GetNumber();</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">The implementation of <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">INumberService</code> always
                returns a new number in the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetNumber</code> method. This
                service will be registered as singleton to have the number shared between the other services (code file
                <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/NumberService.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1"> <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">INumberService</code>
                            的实现总是在 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetNumber</code>
                            方法中返回一个新数字。为了使其他服务之间共享这个数字，这个服务将被注册为单例（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/NumberService.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0008"><code>public class NumberService : INumberService</code>
<code>{</code>
<code>  private int _number = 0;</code>
<code>  public int GetNumber() =&gt; Interlocked.Increment(ref _number);</code>
<code>}</code></pre>
            <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <p id="c15-para-0034" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">The </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Interlocked.Increment</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> class offers a
                            thread-safe increment. The </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Interlocked</code> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> class is covered in
                            <a href="c16.xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter
                                16</a>.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意： <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Interlocked.Increment</code>
                                    类提供了线程安全的自增功能。 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Interlocked</code>
                                    类在第 16 章中介绍。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                </section>
            </aside>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1"><span aria-label="397" epub:type="pagebreak" id="Page_397"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>The other services
                that will be looked at are defined by the interface contracts <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceA</code>, <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceB</code>, and <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceC</code> with the
                corresponding methods <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">A</code>, <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">B</code>, and <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">C</code>. The following code
                snippet shows the contract for <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceA</code> (code file
                <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/IServiceA.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">将要查看的其他服务由接口契约 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceA</code>
                            、 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceB</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceC</code>
                            定义，以及相应的方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">A</code> 、 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">B</code> 和 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">C</code>
                            。以下代码片段展示了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceA</code>
                            的契约（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/IServiceA.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0009"><code>public interface IServiceA</code>
<code>{</code>
<code>  void A();</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">With the implementation of <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>, the
                constructor needs an injection of the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">INumberService</code>. With
                this service, the number is retrieved to assign it to the private field <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">_n</code>. To see the
                lifetime of the objects when running the implementation, console output is written in the constructor,
                the method <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">A</code>, and
                the <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Dispose</code> method.
                The <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationA</code>
                class is specified to pass configuration data to this service that will be used to show how the service
                is configured from the DI container (for example, transient or singleton) to display this on the console
                (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/ServiceA.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">通过 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>
                            的实现，构造函数需要注入 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">INumberService</code>
                            。使用这个服务时，会获取数字并将其分配给私有字段 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">_n</code>
                            。为了查看运行实现时对象的生命周期，构造函数、方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">A</code> 和方法
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Dispose</code>
                            中都写入了控制台输出。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationA</code>
                            类用于向此服务传递配置数据，这些数据将用于展示服务是如何从 DI 容器（例如，瞬态或单例）进行配置的，并在控制台上显示（代码文件 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/ServiceA.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0010"><code>public class ConfigurationA</code>
<code>{</code>
<code>  public string? Mode { get; set; }</code>
<code>}</code>
<code> </code>
<code>public sealed class ServiceA : IServiceA, IDisposable</code>
<code>{</code>
<code>  private readonly int _n;</code>
<code>  private readonly string? _mode;</code>
<code>  public ServiceA(INumberService numberService, </code>
<code>    IOptions&lt;ConfigurationA&gt; options)</code>
<code>  {</code>
<code>    _mode = options.Value.Mode;</code>
<code>    _n = numberService.GetNumber();</code>
<code>    Console.WriteLine($"ctor {nameof(ServiceA)}, {_n}");</code>
<code>  }</code>
<code> </code>
<code>  public void A() =&gt; Console.WriteLine($"{nameof(A)}, {_n}, mode: {_mode}");</code>
<code>  public void Dispose() =&gt; </code>
<code>    Console.WriteLine($"disposing {nameof(ServiceA)}, {_n}");</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">The other service classes <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code> and <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceC</code> are
                implemented similarly to <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">其他服务类 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code> 和
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceC</code>
                            的实现方式与 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>
                            类似。</font>
                    </font>
                </font>
            </p>
            <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <p id="c15-para-0038" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">The </i>
                        <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IDisposable</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> interface is
                            explained in detail in <a href="c13.xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter 13</a>,
                            “Managed and Unmanaged Memory.” The </i>
                        <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> interface is
                            explained later in this chapter in the </i><i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">section
                            “Initialization of Services Using Options.”</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IDisposable</code>
                                    接口在“第 13 章：管理和未管理内存”中有详细说明。 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code>
                                    接口在本章的“使用选项初始化服务”部分有后续说明。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                </section>
            </aside>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">In addition to the services, the controller <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code> is
                implemented. <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code> requires
                constructor injection of three services: <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceA</code>, <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceB</code>, and <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">INumberService</code>. With
                the method <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">M</code>, two of
                the injected services are invoked. Also, constructor and <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Dispose</code> information is
                written to the console (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/ControllerX.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">除了服务之外，还实现了控制器 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code>
                            。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code>
                            需要构造函数注入三个服务： <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceA</code>
                            、 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceB</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">INumberService</code>
                            。通过方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">M</code>
                            ，会调用两个注入的服务。此外，构造函数和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Dispose</code>
                            信息会写入控制台（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/ControllerX.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0011"><code>public sealed class ControllerX : IDisposable</code>
<code>{</code>
<code>  private readonly IServiceA _serviceA;</code>
<code>  private readonly IServiceB _serviceB;<span aria-label="398" epub:type="pagebreak" id="Page_398" role="doc-pagebreak"></span></code>
<code>  private readonly int _n;</code>
<code>  private int _countm = 0;</code>
<code>  public ControllerX(IServiceA serviceA, IServiceB serviceB, </code>
<code>    INumberService numberService)</code>
<code>  {</code>
<code>    _n = numberService.GetNumber();</code>
<code>    Console.WriteLine($"ctor {nameof(ControllerX)}, {_n}");</code>
<code>    _serviceA = serviceA;</code>
<code>    _serviceB = serviceB;</code>
<code>  }</code>
<code> </code>
<code>  public void M()</code>
<code>  {</code>
<code>    Console.WriteLine($"invoked {nameof(M)} for the {++_countm}. time");</code>
<code>    _serviceA.A();</code>
<code>    _serviceB.B();</code>
<code>  }</code>
<code> </code>
<code>  public void Dispose() =&gt; </code>
<code>    Console.WriteLine($"disposing {nameof(ControllerX)}, {_n}");</code>
<code>}</code></pre>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0013"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-283" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Singleton and Transient Services <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">单例和瞬态服务</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Let's start registering singleton and transient services.
                    Here, the services <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>, <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>, <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NumberService</code>, and
                    the controller class <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code> are
                    registered. <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NumberService</code>
                    needs to be registered as singleton to have shared state. <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code> is
                    registered as singleton as well. <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code> and <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code> are
                    registered as transient (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">让我们开始注册单例和瞬态服务。这里，服务 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NumberService</code>
                                以及控制器类 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code>
                                被注册。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NumberService</code>
                                需要注册为单例以保持共享状态。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>
                                也被注册为单例。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code>
                                被注册为瞬态（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0012"><code>private static void SingletonAndTransient()</code>
<code>{</code>
<code>  Console.WriteLine(nameof(SingletonAndTransient));</code>
<code> </code>
<code>  using var host = Host.CreateDefaultBuilder()</code>
<code>    .ConfigureServices(services =&gt;</code>
<code>  {</code>
<code>    services.Configure&lt;ConfigurationA&gt;(config =&gt; config.Mode = "singleton");</code>
<code>    services.AddSingleton&lt;IServiceA, ServiceA&gt;();</code>
<code>    services.Configure&lt;ConfigurationB&gt;(config =&gt; config.Mode = "transient");</code>
<code> </code>
<code>    services.AddTransient&lt;IServiceB, ServiceB&gt;();</code>
<code>    services.AddTransient&lt;ControllerX&gt;();</code>
<code>    services.AddSingleton&lt;INumberService, NumberService&gt;();</code>
<code>  }).Build();</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddSingleton</code> and
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddTransient</code> are
                    extension methods that make it easier to register services with the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.DependencyInjection</code>
                    framework. Instead of using these helpful methods, you can register services with the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Add</code> method (which
                    is itself invoked by the convenient extension methods). The <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Add</code> method
                    requires a <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceDescriptor</code>
                    containing the service type, the implementation type, and the kind of the service. The kind of the
                    service is specified using the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceLifetime</code>
                    enum type. <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceLifetime</code>
                    defines the values <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Singleton</code>, <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Transient</code>, and
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Scoped</code>
                    :<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddSingleton</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddTransient</code>
                                是扩展方法，它们使得使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.DependencyInjection</code>
                                框架注册服务更加便捷。不使用这些有用的方法，你也可以通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Add</code>
                                方法（该方法本身是由便捷的扩展方法调用的）来注册服务。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Add</code>
                                方法需要一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceDescriptor</code>
                                ，其中包含服务类型、实现类型以及服务种类。服务种类使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceLifetime</code>
                                枚举类型指定。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceLifetime</code>
                                定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Singleton</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Transient</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Scoped</code>
                                这些值：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0013"><code>services.Add(new ServiceDescriptor(typeof(ControllerX), </code>
<code>  typeof(ControllerX), ServiceLifetime.Transient));</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span aria-label="399"
                        epub:type="pagebreak" id="Page_399" role="doc-pagebreak"
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span></p>
                <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <p id="c15-para-0043" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">The </i> <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Add</code> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> method of the
                            </i> <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                            <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> class is
                                explicitly implemented for the interface </i> <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceCollection</code>
                            <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">. With this, you
                                can see the method only when using the interface </i> <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceCollection</code>
                            <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">, not when you
                                have a variable of the </i> <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                            <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> type. Explicit
                                interface implementation is covered in <a href="c04.xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter
                                    4</a>.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                                        类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Add</code>
                                        方法是针对接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceCollection</code>
                                        显式实现的。有了这个，你只有在使用接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceCollection</code>
                                        时才能看到这个方法，而不是当你有一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceCollection</code>
                                        类型的变量时。显式接口实现将在第 4 章中介绍。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                    method is invoked to get the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code> two
                    times and invoke the method <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">M</code> before the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> instance is
                    disposed of when the variable goes out of scope at the end of the method (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetRequiredService</code>
                                方法被调用两次以获取 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code>
                                ，并在变量在方法末尾超出作用域时，在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                                实例被释放之前调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">M</code>
                                方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0014"><code>private static void SingletonAndTransient()</code>
<code>{</code>
<code>  //…</code>
<code>  Console.WriteLine($"requesting {nameof(ControllerX)}");</code>
<code> </code>
<code>  ControllerX x = host.Services.GetRequiredService&lt;ControllerX&gt;();</code>
<code>  x.M();</code>
<code>  x.M();</code>
<code> </code>
<code>  Console.WriteLine($"requesting {nameof(ControllerX)}");</code>
<code> </code>
<code>  ControllerX x2 = host.Services.GetRequiredService&lt;ControllerX&gt;();</code>
<code>  x2.M();</code>
<code> </code>
<code>  Console.WriteLine();</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">In order to run, the application is using the NuGet package
                    <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">System.CommandLine.DragonFruit</code>.
                    This library is based on <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">System.CommandLine</code>
                    and gives an easy way to pass arguments to the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Main</code> method. This
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Main</code> method is
                    defined to receive a string that's stored in the variable <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">mode</code>, and thus the
                    application can be started by passing <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">--mode singletonandtransient</code>
                    :<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了运行，应用程序使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">System.CommandLine.DragonFruit</code>
                                NuGet 包。该库基于 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">System.CommandLine</code>
                                ，提供了一种简便的方法来向 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Main</code>
                                方法传递参数。这个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Main</code>
                                方法被定义为接收存储在变量 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">mode</code>
                                中的字符串，因此可以通过传递 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">--mode singletonandtransient</code>
                                来启动应用程序：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0015"><code>static void Main(<b>string mode</b>)</code>
<code>{</code>
<code>  switch (mode)</code>
<code>  {</code>
<code>    case "singletonandtransient":</code>
<code>      SingletonAndTransient();</code>
<code>      break;</code>
<code>    case "scoped":</code>
<code>      UsingScoped();</code>
<code>      break;</code>
<code>    case "custom":</code>
<code>      CustomFactories();</code>
<code>      break;</code>
<code>    default:</code>
<code>      Usage();</code>
<code>      break;</code>
<code>    }</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">When you run the application, you can see when the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code> is
                    requested and when <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code> and <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code> are
                    instantiated, and the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NumberService</code>
                    returns a new number every time the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetNumber</code> method
                    is <span aria-label="400" epub:type="pagebreak" id="Page_400" role="doc-pagebreak"
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>invoked. When the
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code> is
                    requested the second time, the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code> is
                    newly created and so is <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code> because
                    these types are registered as transient with the container. With <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>, the same
                    instance is used as before, and no new instance is created:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">运行应用程序时，可以看到何时请求 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code>
                                ，何时实例化 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>
                                ，以及每次调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetNumber</code>
                                方法时 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NumberService</code>
                                都返回一个新数字。当第二次请求 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code>
                                时， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ControllerX</code>
                                被重新创建， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>
                                也被重新创建，因为这些类型在容器中注册为瞬态。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>
                                时，与之前使用相同的实例，不会创建新实例：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0016"><code>SingletonAndTransient</code>
<code>requesting ControllerX</code>
<code>ctor ServiceA, 1</code>
<code>ctor ServiceB, 2</code>
<code>ctor ControllerX, 3</code>
<code>invoked M for the 1. time</code>
<code>A, 1, mode: singleton</code>
<code>B, 2, mode: transient</code>
<code>invoked M for the 2. time</code>
<code>A, 1, mode: singleton</code>
<code>B, 2, mode: transient</code>
<code>requesting ControllerX</code>
<code>ctor ServiceB, 4</code>
<code>ctor ControllerX, 5</code>
<code>invoked M for the 1. time</code>
<code>A, 1, mode: singleton</code>
<code>B, 4, mode: transient</code>
<code> </code>
<code>disposing ControllerX, 5</code>
<code>disposing ServiceB, 4</code>
<code>disposing ControllerX, 3</code>
<code>disposing ServiceB, 2</code>
<code>disposing ServiceA, 1</code></pre>
            </section>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0015"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-284" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Using Scoped Services <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用作用域服务</font>
                        </font>
                    </font>
                </h3>
                <p id="c15-para-0047" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Services can also be registered within a scope. This is
                    something between transient and singleton. With singleton, only a single instance is created.
                    Transient creates a new instance every time the service is requested from the container. With
                    scoped, the same instance is always returned from the same scope, but from a different scope, a
                    different instance is returned. Scopes are by default defined with ASP.NET Core web applications.
                    Here, the scope is an HTTP web request. With the scoped service, the same instance is returned as
                    long as the request to the container is coming from the same HTTP request. With different HTTP
                    requests, other instances are returned. This allows for easily sharing state inside an HTTP request.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                服务也可以在特定范围内注册。这介于瞬态和单例之间。对于单例，只创建一个实例。瞬态每次从容器请求服务时都会创建一个新实例。对于范围服务，从同一个范围始终返回相同的实例，但从不同的范围返回不同的实例。范围默认在
                                ASP.NET Core Web 应用程序中定义。在这里，范围是一个 HTTP Web 请求。对于范围服务，只要容器请求来自同一个 HTTP
                                请求，就会返回相同的实例。对于不同的 HTTP 请求，会返回其他实例。这允许在 HTTP 请求内部轻松共享状态。</font>
                        </font>
                    </font>
                </p>
                <p id="c15-para-0048" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">With non-ASP.NET Core web applications, you need to create
                    the scope for yourself to get the advantages of scoped services.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">对于非 ASP.NET Core Web
                                应用程序，你需要自己创建范围以获得范围服务的优势。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Let's start registering services with the local function
                    <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">RegisterServices</code>.
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code> is
                    registered as a scoped service, <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code> as
                    singleton, and <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceC</code> as
                    transient (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">让我们从本地函数 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">RegisterServices</code>
                                开始注册服务。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>
                                注册为范围服务， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>
                                注册为单例， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceC</code>
                                注册为瞬态（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0017"><code>private static void UsingScoped()</code>
<code>{</code>
<code>  Console.WriteLine(nameof(UsingScoped));</code>
<code> </code>
<code>  using var host = Host.CreateDefaultBuilder()</code>
<code>    .ConfigureServices(services =&gt;</code>
<code>    {</code>
<code>      services.AddSingleton&lt;INumberService, NumberService&gt;();</code>
<code>      services.Configure&lt;ConfigurationA&gt;(config =&gt; config.Mode = "scoped");</code>
<code>      services.AddScoped&lt;IServiceA, ServiceA&gt;();</code>
<code>      services.Configure&lt;ConfigurationB&gt;(</code>
<code>        config =&gt; config.Mode = "singleton");<span aria-label="401" epub:type="pagebreak" id="Page_401" role="doc-pagebreak"></span></code>
<code>      services.AddSingleton&lt;IServiceB, ServiceB&gt;();</code>
<code>      services.Configure&lt;ConfigurationC&gt;(</code>
<code>        config =&gt; config.Mode = "transient");</code>
<code>      services.AddTransient&lt;IServiceC, ServiceC&gt;();</code>
<code>    }).Build();</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">You can create a scope that invokes the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateScope</code> method
                    of the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceProvider</code>.
                    This returns a scope object implementing the interface <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceScope</code>.
                    From there you can access the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceProvider</code>
                    that belongs to this scope where you can request the services from the container. With the following
                    code snippet, <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code> and <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceC</code> are
                    requested two times, whereas <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code> is
                    requested just once. Then the methods <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">A</code>, <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">B</code>, and <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">C</code> are invoked:
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">你可以创建一个调用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateScope</code>
                                的作用域，该作用域返回一个实现 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceScope</code>
                                接口的作用域对象。从那里你可以访问属于这个作用域的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceProvider</code>
                                ，在那里你可以从容器中请求服务。在以下代码片段中， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceC</code>
                                被请求两次，而 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>
                                只被请求一次。然后调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">A</code> 、
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">B</code> 和
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">C</code> ：
                            </font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0018"><code>private static void UsingScoped()</code>
<code>{</code>
<code>  //…</code>
<code>  // the using statement is used here to end scope1 early         </code>
<code>  using (IServiceScope scope1 = host.Services.CreateScope())</code>
<code>  {</code>
<code>    IServiceA a1 = scope1.ServiceProvider.GetRequiredService&lt;IServiceA&gt;();</code>
<code>    a1.A();</code>
<code>    IServiceA a2 = scope1.ServiceProvider.GetRequiredService&lt;IServiceA&gt;();</code>
<code>    a2.A();</code>
<code>    IServiceB b1 = scope1.ServiceProvider.GetRequiredService&lt;IServiceB&gt;();</code>
<code>    b1.B();</code>
<code>    IServiceC c1 = scope1.ServiceProvider.GetRequiredService&lt;IServiceC&gt;();</code>
<code>    c1.C();</code>
<code>    IServiceC c2 = scope1.ServiceProvider.GetRequiredService&lt;IServiceC&gt;();</code>
<code>    c2.C();</code>
<code>  }</code>
<code>  Console.WriteLine("end of scope1");</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">After the first scope is disposed of, another scope is
                    created. With the second scope, again <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>, <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>, and
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceC</code> are
                    requested, and methods are invoked:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">第一个作用域被销毁后，会创建另一个作用域。使用第二个作用域，再次请求
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceC</code>
                                ，并调用方法：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0019"><code>private static void UsingScoped()</code>
<code>{</code>
<code>  //…</code>
<code>  using (IServiceScope scope2 = host.Services.CreateScope())</code>
<code>  {</code>
<code>    IServiceA a3 = scope2.ServiceProvider.GetRequiredService&lt;IServiceA&gt;();</code>
<code>    a3.A();</code>
<code>    IServiceB b2 = scope2.ServiceProvider.GetRequiredService&lt;IServiceB&gt;();</code>
<code>    b2.B();</code>
<code>    IServiceC c3 = scope2.ServiceProvider.GetRequiredService&lt;IServiceC&gt;();</code>
<code>    c3.C();</code>
<code>  }</code>
<code>  Console.WriteLine("end of scope2");</code>
<code>  Console.WriteLine();</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">When you run the application, you can see the services for
                    the instances are created, methods are invoked, and services are automatically disposed of. As <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code> is
                    registered as transient, within the same scope, the same instance is used. <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceC</code> is
                    registered as transient, so here an instance is created with every request to the <span
                        aria-label="402" epub:type="pagebreak" id="Page_402" role="doc-pagebreak"
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>container. At the
                    end of the scope, the transient and scoped services are automatically disposed of, but <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code> isn't.
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code> is
                    registered as singleton and thus needs to survive to the end of the scope:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                运行应用程序时，你可以看到为实例创建服务、调用方法以及服务自动被销毁。由于 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>
                                被注册为瞬态，在同一作用域内，使用相同的实例。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceC</code>
                                被注册为瞬态，因此每次请求容器时都会创建一个实例。作用域结束时，瞬态和作用域服务会自动被销毁，但 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>
                                不会。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>
                                被注册为单例，因此需要存活到作用域结束：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0020"><code>UsingScoped</code>
<code>ctor ServiceA, 1</code>
<code>A, 1, mode: scoped</code>
<code>A, 1, mode: scoped</code>
<code>ctor ServiceB, 2</code>
<code>B, 2, mode: singleton</code>
<code>ctor ServiceC, 3</code>
<code>C, 3, mode: transient</code>
<code>ctor ServiceC, 4</code>
<code>C, 4, mode: transient</code>
<code>disposing ServiceC, 4</code>
<code>disposing ServiceC, 3</code>
<code>disposing ServiceA, 1</code>
<code>end of scope1</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">When you start the second scope, <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code> and <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code> are
                    instantiated again. When you request <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>, the same
                    object previously created is returned. At the end of the scope, <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code> and <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceC</code> are
                    disposed of again. <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code> is
                    disposed of after the root provider is disposed of:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当你启动第二个作用域时， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>
                                会被重新实例化。当你请求 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>
                                时，会返回之前创建的同一个对象。在作用域结束时， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceA</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceC</code>
                                再次被销毁。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>
                                在根提供者被销毁后会被销毁：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0021"><code>ctor ServiceA, 5</code>
<code>A, 5, mode: scoped</code>
<code>B, 2, mode: singleton</code>
<code>ctor ServiceC, 6</code>
<code>C, 6, mode: transient</code>
<code>disposing ServiceC, 6</code>
<code>disposing ServiceA, 5</code>
<code>end of scope2</code>
<code> </code>
<code>disposing ServiceB, 2</code></pre>
                <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <p id="c15-para-0055" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">You don't need to
                                invoke the </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Dispose</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> method on
                                services to release them. With services implementing the </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IDisposable</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> interface, the
                                container invokes the </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Dispose</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> method.
                                Transient and scoped services are disposed of when the scope is disposed of. Singleton
                                services are disposed of when the root provider is disposed of.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 你不需要在服务上调用 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Dispose</code>
                                        方法来释放它们。对于实现 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IDisposable</code>
                                        接口的服务，容器会调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Dispose</code>
                                        方法。瞬态和作用域服务在作用域被销毁时会被销毁。单例服务在根提供者被销毁时会被销毁。</font>
                                </font>
                            </font>
                        </p>
                        <p id="c15-para-0056" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                                data-immersive-translate-paragraph="1">Service instances are disposed of in the reverse
                                order that they were created. This is important when one service needs another one
                                injected. For example, service A requires that service B is injected. Thus, service B is
                                created first, followed by service A. For disposing of the services, service A is
                                disposed of first. During the disposal of A, A can still access methods from service B.
                                <font class="notranslate immersive-translate-target-wrapper"
                                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                    <font
                                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                        data-immersive-translate-translation-element-mark="1">
                                        <font
                                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                            data-immersive-translate-translation-element-mark="1">
                                            服务实例的销毁顺序与它们的创建顺序相反。这一点很重要，当一个服务需要另一个服务注入时。例如，服务 A 需要注入服务 B。因此，首先创建服务
                                            B，然后创建服务 A。在销毁服务时，首先销毁服务 A。在销毁 A 的过程中，A 仍然可以访问 B 的方法。</font>
                                    </font>
                                </font></i></p>
                        <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                            <hr />
                        </div>
                    </section>
                </aside>
                <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <p id="c15-para-0057" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">WARNING</b> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Disposing of
                                transient services at the end of the scope might be too late for some scenarios.
                                Transient services could be disposed of directly after use. However, this can be missed,
                                and the registration of the service might have changed. There's also an issue that the
                                garbage collector cannot release the memory of transient services registered because
                                references are kept in the service container implementation (so it can be disposed of at
                                the end of the scope). A good practice is to register disposable services as either
                                scoped or singleton. Also remember that with non-ASP.NET Core applications, the scope
                                needs to be created manually.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">警告
                                        在作用域结束时处置瞬态服务在某些场景下可能太晚了。瞬态服务可以在使用后直接处置。然而，这可能会被遗漏，而且服务的注册可能已经改变。还有一个问题是，垃圾收集器无法释放注册的瞬态服务的内存，因为服务容器实现中保留了引用（所以它可以在作用域结束时被处置）。一个好的做法是将可处置服务注册为作用域或单例。同时请记住，对于非
                                        ASP.NET Core 应用程序，作用域需要手动创建。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section> <span aria-label="403" epub:type="pagebreak" id="Page_403" role="doc-pagebreak"
                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0018"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-285" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Using Custom Factories <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用自定义工厂</font>
                        </font>
                    </font>
                </h3>
                <p id="c15-para-0058" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Instead of using the predefined methods to register
                    transient, scoped, and singleton services, you can create a custom factory or pass an existing
                    instance to the container. The next code snippet shows how you can do this.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                除了使用预定义方法注册瞬态、作用域和单例服务外，你可以创建一个自定义工厂或将现有实例传递给容器。下一个代码片段展示了如何做到这一点。</font>
                        </font>
                    </font>
                </p>
                <p id="c15-para-0059" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">You can pass a previously created instance to the container
                    by using an overload of the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddSingleton</code>
                    method. Here, in the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">RegisterServices</code>
                    method, a <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NumberService</code>
                    object is created first and then passed to the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddSingleton</code>
                    method. Using the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetService</code> method
                    or injecting it in the constructor is not different from the code you've seen before. You just need
                    to be aware that the container is not responsible for invoking the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Dispose</code> method in
                    this case. With objects creating and passing to the container, it's your responsibility to dispose
                    of these objects—if the objects need disposal at all.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">你可以通过使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddSingleton</code>
                                方法的重载将先前创建的实例传递给容器。在这里，在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">RegisterServices</code>
                                方法中，首先创建一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NumberService</code>
                                对象，然后将其传递给 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddSingleton</code>
                                方法。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetService</code>
                                方法或在构造函数中注入它与你之前看到的代码没有区别。你只需要注意在这种情况下容器不会负责调用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Dispose</code>
                                方法。在创建对象并将其传递给容器时，如果你需要处理这些对象，这是你的责任——如果这些对象需要处理的话。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">You can also use a factory method to create the instance
                    instead of letting the service be created from the container. If the service needs a custom
                    initialization or defines constructors not supported by the DI container, this is a useful option.
                    You can pass a delegate with an <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceProvider</code>
                    parameter and return the service instance to the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddSingleton</code>,
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddScoped</code>, and
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddTransient</code>
                    methods. With the sample code, the local function named <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateServiceBFactory</code>
                    returns a <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code> object.
                    If the constructor of the service implementation needs other services, these can be retrieved using
                    the passed <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceProvider</code>
                    instance (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                你也可以使用工厂方法来创建实例，而不是让服务从容器中创建。如果服务需要自定义初始化或定义了依赖注入容器不支持的构造函数，这会是一个有用的选项。你可以传递一个带有 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceProvider</code>
                                参数的委托，并将服务实例返回给 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddSingleton</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddScoped</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddTransient</code>
                                方法。在示例代码中，名为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateServiceBFactory</code>
                                的本地函数返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ServiceB</code>
                                对象。如果服务实现类的构造函数需要其他服务，这些服务可以通过传递的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceProvider</code>
                                实例获取（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/ServicesLifetime/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0022"><code>private static void CustomFactories()</code>
<code>{</code>
<code>  <b>IServiceB CreateServiceBFactory(IServiceProvider provider) =&gt;</b></code>
<code>    <b>new ServiceB(provider.GetRequiredService&lt;INumberService&gt;(),</b> </code>
<code>      <b>provider.GetRequiredService&lt;IOptions&lt;ConfigurationB&gt;&gt;());</b></code>
<code> </code>
<code>  Console.WriteLine(nameof(CustomFactories));</code>
<code> </code>
<code>  using var host = Host.CreateDefaultBuilder()</code>
<code>    .ConfigureServices(services =&gt;</code>
<code>    {</code>
<code>      <b>NumberService = new();</b></code>
<code> </code>
<code>      <b>services.AddSingleton&lt;INumberService&gt;(numberService);  // add existing</b></code>
<code>      services.Configure&lt;ConfigurationB&gt;(config =&gt; config.Mode = "factory");</code>
<code>      <b>// use a factory</b></code>
<code>      <b>services.AddTransient&lt;IServiceB&gt;(CreateServiceBFactory);</b></code>
<code>      services.Configure&lt;ConfigurationA&gt;(</code>
<code>        config =&gt; config.Mode = "singleton");</code>
<code>      services.AddSingleton&lt;IServiceA, ServiceA&gt;();</code>
<code>    }).Build();</code>
<code> </code>
<code>  IServiceA a1 = host.Services.GetRequiredService&lt;IServiceA&gt;();</code>
<code>  IServiceA a2 = host.Services.GetRequiredService&lt;IServiceA&gt;();</code>
<code>  IServiceB b1 = host.Services.GetRequiredService&lt;IServiceB&gt;();</code>
<code>  IServiceB b2 = host.Services.GetRequiredService&lt;IServiceB&gt;();</code>
<code>  Console.WriteLine();</code>
<code>}</code></pre>
            </section>
        </section>
        <section aria-labelledby="head-2-133" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
            <span id="c15-sec-0019" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
            <h2 id="head-2-133" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">INITIALIZATION OF SERVICES USING OPTIONS<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用选项初始化服务</font>
                    </font>
                </font>
            </h2>
            <p id="c15-para-0061" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">You've already seen that a service can be injected in another
                service. This can also be used to initialize a service with options. You cannot define a constructor
                with types not registered with the DI container because the container does not know how to initialize
                this. Services are needed. However, to pass options for a service, you can also use a service that is
                already available with .NET.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            你已经看到服务可以被注入到另一个服务中。这也可以用来使用选项初始化服务。你不能定义一个构造函数，其类型未在依赖注入容器中注册，因为容器不知道如何初始化这个。需要服务。但是，为了传递服务的选项，你也可以使用
                            .NET 中已经可用的服务。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1"><span aria-label="404" epub:type="pagebreak" id="Page_404"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>The sample code makes
                use of the previously used <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code> with
                modifications to pass options. The configuration values needed by the service are defined with the class
                <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingServiceOptions</code>.
                The sample code requires a <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">string</code> parameter with
                the <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">From</code> property
                (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithOptions/GreetingServiceOptions.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">示例代码使用了之前使用的 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                            并进行了修改以传递选项。服务所需的配置值通过类 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingServiceOptions</code>
                            定义。示例代码需要一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">string</code>
                            参数，具有 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">From</code>
                            属性（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithOptions/GreetingServiceOptions.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0023"><code>public class GreetingServiceOptions</code>
<code>{</code>
<code>  public string? From { get; set; }</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">The options for the service can be passed by specifying a
                constructor with an <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions&lt;T&gt;</code>
                parameter. The previously defined class <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingServiceOptions</code>
                is the generic type used with <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code>. The value
                passed to the constructor is used to initialize the field <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">_from</code> (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithOptions/GreetingService.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">可以通过指定一个具有 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions&lt;T&gt;</code>
                            参数的构造函数来传递服务的选项。之前定义的类 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingServiceOptions</code>
                            是与 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code>
                            一起使用的泛型类型。传递给构造函数的值用于初始化字段 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">_from</code>
                            （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithOptions/GreetingService.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0024"><code>public class GreetingService : IGreetingService</code>
<code>{</code>
<code>  public GreetingService(IOptions&lt;GreetingServiceOptions&gt; options) =&gt;</code>
<code>    _from = options.Value.From;</code>
<code> </code>
<code>  private readonly string? _from;</code>
<code> </code>
<code>  public string Greet(string name) =&gt; $"Hello, {name}! Greetings from {_from}";</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">To make it easy to register the service with the DI container,
                the extension method <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddGreetingService</code> is
                defined. This method extends the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceCollection</code>
                interface and allows passing the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingServiceOptions</code>
                with a delegate. In the implementation, the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Configure</code> method is
                used to specify the configuration with the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code> interface.
                The <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Configure</code> method
                is an extension method for <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceCollection</code>
                defined in the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.Options</code>
                NuGet package (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithOptions/GreetingServiceExtensions.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">为了方便将服务注册到依赖注入容器中，定义了扩展方法 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddGreetingService</code>
                            。此方法扩展了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceCollection</code>
                            接口，并允许通过委托传递 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingServiceOptions</code>
                            。在实现中，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Configure</code>
                            方法来指定具有 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code>
                            接口的配置。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Configure</code>
                            方法是 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceCollection</code>
                            的扩展方法，定义在 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.Options</code>
                            NuGet 包中（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithOptions/GreetingServiceExtensions.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0025"><code>public static class GreetingServiceExtensions</code>
<code>{</code>
<code>  public static IServiceCollection AddGreetingService(</code>
<code>    this IServiceCollection collection,</code>
<code>    Action&lt;GreetingServiceOptions&gt; setupAction)</code>
<code>  {</code>
<code>    if (collection == null) </code>
<code>      throw new ArgumentNullException(nameof(collection));</code>
<code>    if (setupAction == null) </code>
<code>      throw new ArgumentNullException(nameof(setupAction));</code>
<code> </code>
<code>    collection.Configure(setupAction);</code>
<code>    return collection.AddTransient&lt;IGreetingService, GreetingService&gt;();</code>
<code>  }</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">The <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code> that's
                using the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code> with
                constructor injection doesn't require any changes compared to the previous sample (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithOptions/HomeController.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用构造函数注入的 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            与之前的示例相比不需要任何更改（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithOptions/HomeController.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0026"><code>public class HomeController</code>
<code>{</code>
<code>  private readonly IGreetingService _greetingService;</code>
<code>  public HomeController(IGreetingService greetingService)</code>
<code>  {</code>
<code>    _greetingService = greetingService;</code>
<code>  }</code>
<code>  public string Hello(string name) =&gt; _greetingService.Greet(name);</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1"><span aria-label="405" epub:type="pagebreak" id="Page_405"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>You can now register
                the services with the helper method <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddGreetingService</code>.
                The configuration for the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code> is
                done here by passing the required options. What's also needed is a service that implements the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code> interface.
                For this interface, a service implementation is already added from the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                method. In case you don't use the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> class, you need
                to invoke the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddOptions</code> method to
                register an implementation in the DI container (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithOptions/Program.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">现在您可以使用辅助方法 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddGreetingService</code>
                            注册服务。在这里通过传递所需选项来配置 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                            。还需要一个实现 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code>
                            接口的服务。对于这个接口，从 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                            方法中已经添加了一个服务实现。如果您不使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                            类，需要调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddOptions</code>
                            方法来在依赖注入容器中注册一个实现（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithOptions/Program.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0027"><code>using var host = Host.CreateDefaultBuilder()</code>
<code>  .ConfigureServices(services =&gt;</code>
<code>  {</code>
<code>    // services.AddOptions(); // already added from host</code>
<code>    <b>services.AddGreetingService(options =&gt;</b></code>
<code>    <b>{</b></code>
<code>      <b>options.From = "Christian";</b></code>
<code>    <b>});</b></code>
<code>    services.AddSingleton&lt;IGreetingService, GreetingService&gt;();</code>
<code>    services.AddTransient&lt;HomeController&gt;();</code>
<code>  }).Build();</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">The service can now be used as before. The <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code> is
                retrieved from the container, and constructor injection is used in the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code> where
                the <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>
                is used:<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">现在服务可以像之前一样使用。从容器中获取 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            ，并在使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IGreetingService</code>
                            的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HomeController</code>
                            中使用构造函数注入：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0028"><code>var controller = host.Services.GetRequiredService&lt;HomeController&gt;();</code>
<code>string result = controller.Hello("Katharina");</code>
<code>Console.WriteLine(result);</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">When you run the application, now the options are used:<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">当您运行应用程序时，现在使用这些选项：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0029"><code>Hello, Katharina! Greetings from Christian</code></pre>
            <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <p id="c15-para-0070" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">You can use </i>
                        <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">-derived interfaces
                            such as </i> <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptionsSnapshot</code>
                        <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> to update </i> <i
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">settings dynamically
                            when the configuration is updated. How you do this with Azure App Configuration is explained
                            later in this chapter.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意 您可以使用基于 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code>
                                    的接口（如 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptionsSnapshot</code>
                                    ）在配置更新时动态更新设置。如何使用 Azure App Configuration 实现这一点将在本章后面解释。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                </section>
            </aside>
        </section>
        <section aria-labelledby="head-2-134" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
            <span id="c15-sec-0021" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
            <h2 id="head-2-134" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">USING CONFIGURATION FILES<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用配置文件</font>
                    </font>
                </font>
            </h2>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">You can also use options as shown in the previous section when a
                service needs to be configured from a configuration file. However, there's a more direct way to do this;
                you can use the .NET configuration features in conjunction with an extension to the options. With the
                next sample, the services are unchanged and still use <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions&lt;GreetingServiceOptions&gt;</code>
                injected in the constructor. Now, the file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.json</code> is
                used to supply the option values. The <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">From</code> key defines a
                value that maps to the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">From</code> property from the
                <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingServiceOptions</code>
                class (configuration file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithConfiguration/appsettings.json</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            当服务需要从配置文件进行配置时，您也可以像前一节所示使用选项。然而，有一种更直接的方法；您可以使用 .NET
                            配置功能与选项的扩展相结合。在下一个示例中，服务保持不变，仍然在构造函数中注入 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions&lt;GreetingServiceOptions&gt;</code>
                            。现在，文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.json</code>
                            用于提供选项值。键 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">From</code>
                            定义了一个映射到 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingServiceOptions</code>
                            类（配置文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithConfiguration/appsettings.json</code>
                            ）的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">From</code> 属性的值：
                        </font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0030"><code>{</code>
<code>  "GreetingService": {</code>
<code>    "From": "Matthias"</code>
<code>  }</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">The configuration file needs to be copied to the directory of the
                executable. You do this by adding the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CopyToOutputDirectory</code>
                element to the project file (project file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithConfiguration/DIWithConfiguration.csproj</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">配置文件需要复制到可执行文件的目录。您通过向项目文件（项目文件 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithConfiguration/DIWithConfiguration.csproj</code>
                            ）添加 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CopyToOutputDirectory</code>
                            元素来实现这一点：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0031"><code>  &lt;ItemGroup&gt;</code>
<code>    &lt;None Update="appsettings.json"&gt;</code>
<code>      &lt;CopyToOutputDirectory&gt;PreserveNewest&lt;/CopyToOutputDirectory&gt;</code>
<code>    &lt;/None&gt;</code>
<code>  &lt;/ItemGroup&gt;</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1"><span aria-label="406" epub:type="pagebreak" id="Page_406"
                    role="doc-pagebreak" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>A
                new extension method that helps with registering the options of the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code> class
                defines an <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>
                parameter. With the implementation, an overload of the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Configure</code> method is
                used where an object implementing the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code> can be
                directly passed (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithConfiguration/GreetingServiceExtensions.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">一个新的扩展方法帮助注册 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                            类的选项，定义了一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>
                            参数。通过实现，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Configure</code>
                            方法的重载，可以直接传递一个实现 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>
                            的对象（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithConfiguration/GreetingServiceExtensions.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0032"><code>public static class GreetingServiceExtensions</code>
<code>{</code>
<code>  public static IServiceCollection AddGreetingService(</code>
<code>    this IServiceCollection services, <b>IConfiguration config</b>)</code>
<code>  {</code>
<code>    if (services == null) throw new ArgumentNullException(nameof(services));</code>
<code>    if (config == null) throw new ArgumentNullException(nameof(config));</code>
<code> </code>
<code>    <b>services.Configure&lt;GreetingServiceOptions&gt;(config);</b></code>
<code>    return services.AddTransient&lt;IGreetingService, GreetingService&gt;();</code>
<code>  }</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">To inject the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>
                interface in a service, the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                method configures this interface in the DI container. To access this interface already with the
                configuration of the additional services, the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureServices</code>
                method defines an overload where the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HttpBuilderContext</code> is
                supplied in addition to the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceCollection</code>.
                Using the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Configuration</code> property
                of the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HttpBuilderContext</code>
                returns the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>
                interface that allows retrieving configured values. In the configuration file, for the service
                configuration, the section named <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code> is
                defined. Invoking the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetSection</code> method
                returns an <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfigurationSection</code>.
                <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfigurationSection</code>
                derives from <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>, thus
                the returned value can be passed to the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddGreetingService</code>
                extension method (code file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithConfiguration/Program.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">要在服务中注入 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>
                            接口， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                            方法在依赖注入容器中配置此接口。为了在配置附加服务的同时访问此接口， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureServices</code>
                            方法定义了一个重载，除了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IServiceCollection</code>
                            之外还提供了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HttpBuilderContext</code>
                            。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HttpBuilderContext</code>
                            的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Configuration</code>
                            属性返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>
                            接口，该接口允许获取配置的值。在配置文件中，为服务配置定义了一个名为 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GreetingService</code>
                            的部分。调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetSection</code>
                            方法返回一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfigurationSection</code>
                            。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfigurationSection</code>
                            派生自 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>
                            ，因此返回的值可以传递给 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddGreetingService</code>
                            扩展方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DI/DIWithConfiguration/Program.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0033"><code>using var host = Host.CreateDefaultBuilder()</code>
<code>  .ConfigureServices(<b>(context, services)</b> =&gt;</code>
<code>  {</code>
<code>    <b>var configuration = context.Configuration;</b></code>
<code>    <b>services.AddGreetingService(</b></code>
<code>      <b>configuration.GetSection("GreetingService"));</b></code>
<code>    services.AddSingleton&lt;IGreetingService, GreetingService&gt;();</code>
<code>    services.AddTransient&lt;HomeController&gt;();</code>
<code>  }).Build();</code>
<code> </code>
<code>var controller = host.Services.GetRequiredService&lt;HomeController&gt;();</code>
<code>string result = controller.Hello("Katharina");</code>
<code>Console.WriteLine(result);</code></pre>
            <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">Running the application shows the following:<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">运行应用程序显示以下内容：</font>
                    </font>
                </font>
            </p>
            <pre id="c15-code-0034"><code>Hello, Katharina! Greetings from Matthias</code></pre>
            <p id="c15-para-0076" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">This sample application retrieved configuration settings from
                <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.json</code>.
                This filename is configured by default with the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                method of the <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                class. This method configures more configuration sources, which, of course, can also be changed as shown
                in the next section.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">此示例应用程序从 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.json</code>
                            获取配置设置。此文件名默认通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> 类的
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                            方法配置。此方法配置了更多配置源，当然，正如下一节所示，这些源也可以更改。</font>
                    </font>
                </font>
            </p>
        </section>
        <section aria-labelledby="head-2-135" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
            <span id="c15-sec-0022" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
            <h2 id="head-2-135" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">CONFIGURATION WITH .NET APPLICATIONS<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用.NET 应用程序进行配置</font>
                    </font>
                </font>
            </h2>
            <p id="c15-para-0077" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">The previous section shows how you can supply configuration
                values to services that are injected by the DI container using the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>
                interface and the configuration file <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.json</code>. This
                section covers how .NET offers a flexible mechanism to get configuration values from different sources.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">上一节展示了如何使用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>
                            接口和配置文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.json</code>
                            向由 DI 容器注入的服务提供配置值。本节将介绍.NET 如何提供一种灵活的机制来从不同来源获取配置值。</font>
                    </font>
                </font>
            </p> <span aria-label="407" epub:type="pagebreak" id="Page_407" role="doc-pagebreak"
                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0023"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-286" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Using IConfiguration <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 IConfiguration </font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">The sample application uses configuration from <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.json</code>,
                    which specifies configuration values for a key; a section containing a key; a section named <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConnectionStrings</code>
                    ; and another section named <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">SomeTypedConfig</code>,
                    which contains an inner section (configuration file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/appsettings.json</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">示例应用程序使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.json</code>
                                中的配置，它指定了键的配置值；包含键的节；名为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConnectionStrings</code>
                                的节；以及另一个名为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">SomeTypedConfig</code>
                                的节，其中包含一个内部节（配置文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/appsettings.json</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0035"><code>{</code>
<code>  "Key1": "value for Key1",</code>
<code>  "Section1": {</code>
<code>    "Key2": "value from appsettings.json"</code>
<code>  },</code>
<code>  "ConnectionStrings": {</code>
<code>    "BooksConnection": "this is the connection string to a database"</code>
<code>  },</code>
<code>  "SomeTypedConfig": {</code>
<code>    "Key3": "value for key 3",</code>
<code>    "Key4": "value for key 4",</code>
<code>    "InnerConfig": {</code>
<code>      "Key5": "value for key 5"</code>
<code>    }</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">With the class <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSampleService</code>,
                    an object implementing <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code> is
                    injected in the constructor (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/ConfigurationSampleService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用类 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSampleService</code>
                                时，在构造函数中注入实现了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>
                                的对象（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/ConfigurationSampleService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0036"><code>public class ConfigurationSampleService</code>
<code>{</code>
<code>  private readonly IConfiguration _configuration;</code>
<code> </code>
<code>  public ConfigurationSampleService(<b>IConfiguration configuration</b>)</code>
<code>  {</code>
<code>    _configuration = configuration;</code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To retrieve configuration values, different options are
                    available. With the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetValue</code> method, a
                    key can be passed with the arguments of this method to retrieve the value. An indexer passing the
                    key can be used as well. If a section is used with inner values, such as the section named Section1,
                    the <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetSection</code>
                    method can be used to retrieve the section, and from there on, the indexer can be used to access the
                    inner values. <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetSection</code> returns
                    <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfigurationSection</code>,
                    which in turn derives from <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>. If
                    the section is named <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConnectionStrings</code>,
                    the extension method <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetConnectionString</code>
                    can be used to pass a key within this section to retrieve connection strings. <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetConnectionString</code>
                    is just an extension method that makes it convenient for using connection strings (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/ConfigurationSampleService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要获取配置值，有多种选项可用。使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetValue</code>
                                方法时，可以将键作为此方法的参数传递以获取值。也可以使用传递键的索引器。如果使用包含内部值的节，例如名为 Section1 的节，可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetSection</code>
                                方法获取该节，然后从此处开始，可以使用索引器访问内部值。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetSection</code>
                                返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfigurationSection</code>
                                ，而 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfigurationSection</code>
                                继承自 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IConfiguration</code>
                                。如果节名为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConnectionStrings</code>
                                ，可以使用扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetConnectionString</code>
                                在该节内传递键以获取连接字符串。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">GetConnectionString</code>
                                只是一个扩展方法，它使使用连接字符串变得方便（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/ConfigurationSampleService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0037"><code>public void ShowConfiguration()</code>
<code>{</code>
<code>  string value1 = <b>_configuration.GetValue&lt;string&gt;("Key1");</b></code>
<code>  Console.WriteLine(value1);</code>
<code>  string value1b = <b>_configuration["Key1"];</b></code>
<code>  Console.WriteLine(value1b);</code>
<code>  string value2 = <b>_configuration.GetSection("Section1")["Key2"];</b></code>
<code>  Console.WriteLine(value2);</code>
<code>  string connectionString = <span aria-label="408" epub:type="pagebreak" id="Page_408" role="doc-pagebreak"></span></code>
<code>    <b>_configuration.GetConnectionString("BooksConnection");</b></code>
<code>  Console.WriteLine(connectionString);</code>
<code>  Console.WriteLine();</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0024"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-287" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Reading Strongly Typed Values <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">读取强类型值</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">With .NET configurations, classes can be used where the
                    configuration values should be filled into (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/StronglyTypedConfig.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在.NET 配置中，类可用于将配置值填充到其中（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/StronglyTypedConfig.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0038"><code>public class InnerConfig</code>
<code>{</code>
<code>  public string? Key5 { get; set; }</code>
<code>}</code>
<code> </code>
<code>public class StronglyTypedConfig</code>
<code>{</code>
<code>  public string? Key3 { get; set; }</code>
<code>  public string? Key4 { get; set; }</code>
<code>  public InnerConfig? InnerConfig { get; set; }</code>
<code> </code>
<code>  public override string ToString() =&gt;</code>
<code>    $"values: {Key3} {Key4} {InnerConfig?.Key5}";</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To bind the values from the configuration source, the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Get</code> extension
                    method can be used. This method tries to fill matching keys to properties of the generic value type.
                    Setting the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">BinderOption</code> value
                    <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">BindNonPublicProperties</code>
                    to <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code> also
                    sets read-only values and not just read/write properties (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/ConfigurationSampleService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了绑定来自配置源的值，可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Get</code>
                                扩展方法。此方法尝试将匹配的键填充到泛型值类型的属性中。将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">BinderOption</code>
                                值 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">BindNonPublicProperties</code>
                                设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code>
                                也会设置只读值，而不仅仅是读写属性（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/ConfigurationSampleService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0039"><code>public void ShowTypedConfiguration()</code>
<code>{</code>
<code>  Console.WriteLine(nameof(ShowTypedConfiguration));</code>
<code>  var section = _configuration.GetSection("SomeTypedConfig");</code>
<code>  var typedConfig = <b>section.Get&lt;StronglyTypedConfig&gt;(</b></code>
<code>    <b>binder =&gt; binder.BindNonPublicProperties = true);</b></code>
<code>  Console.WriteLine(typedConfig);</code>
<code>  Console.WriteLine();</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0025"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-288" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Configuration Sources <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">配置源</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">When you use the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                    method of the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> class, you
                    use these configuration sources:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当您使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                                方法时，您使用这些配置源：</font>
                        </font>
                    </font>
                </p>
                <ul class="check" id="c15-list-0003"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <li id="c15-li-0016" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.json</code>
                    </li>
                    <li id="c15-li-0017" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <code
                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.{environment-name}.json</code>
                    </li>
                    <li id="c15-li-0018" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1">Environment variables<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                            <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">环境变量</font>
                            </font>
                        </font>
                    </li>
                    <li id="c15-li-0019" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1">Command-line arguments<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                            <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">命令行参数</font>
                            </font>
                        </font>
                    </li>
                    <li id="c15-li-0020" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                        data-immersive-translate-paragraph="1">User secrets in development-mode<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">开发模式下的用户密钥</font>
                            </font>
                        </font>
                    </li>
                </ul>
                <p id="c15-para-0084" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">The order is important. Every source coming later in the list
                    can override settings from previous sources. The configuration sources are completely customizable.
                    Other configuration providers are available in NuGet packages—for example, providers reading
                    configuration values from XML or INI files.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                顺序很重要。列表中后出现的每个源都可以覆盖之前源的设置。配置源是完全可定制的。其他配置提供者在 NuGet 包中可用——例如，读取 XML 或 INI 文件中的配置值的提供者。
                            </font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1"><span aria-label="409" epub:type="pagebreak" id="Page_409"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>The following code
                    sample shows adding another JSON provider that's accessing the file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">customconfigurationfile.json</code>.
                    You can separate any configuration data you like, such as all database connection strings to other
                    configuration files. The extension method <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddJsonFile</code>
                    references this file. The method <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">SetBasePath</code> that
                    is invoked before <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddJsonFile</code>
                    defines the directory where the file is searched. Setting the optional parameter to <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code> doesn't throw
                    an exception when the file does not exist (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSamples/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">以下代码示例展示了添加另一个访问文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">customconfigurationfile.json</code>
                                的 JSON 提供者。你可以将任何你喜欢的配置数据分离，例如所有数据库连接字符串到其他配置文件。扩展方法 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddJsonFile</code>
                                引用了这个文件。在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddJsonFile</code>
                                之前调用的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">SetBasePath</code>
                                方法定义了搜索文件的目录。将可选参数设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code>
                                不会在文件不存在时抛出异常（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSamples/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0040"><code>using var host = Host.CreateDefaultBuilder(args)</code>
<code>  <b>.ConfigureAppConfiguration(config =&gt;</b></code>
<code>  <b>{</b></code>
<code>    <b>config.SetBasePath(Directory.GetCurrentDirectory());</b></code>
<code>    <b>config.AddJsonFile("customconfigurationfile.json", optional: true);</b></code>
<code>  <b>}).</b>ConfigureServices(services =&gt;</code>
<code>  {</code>
<code>    services.AddTransient&lt;ConfigurationSampleService&gt;();</code>
<code>    services.AddTransient&lt;EnvironmentSampleService&gt;();</code>
<code>  }).Build();</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">When you set configuration values with environment variables
                    and command-line arguments, a colon indicates separate sections. The following statement invokes the
                    application overriding values for <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Key1</code> and <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Key2</code> within the
                    section <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Section1</code>
                    :<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                当你使用环境变量和命令行参数设置配置值时，冒号表示分隔不同的部分。以下语句调用了应用程序，覆盖了在部分 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Section1</code>
                                中 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Key1</code> 和
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Key2</code>
                                的值：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0041"><code>&gt; dotnet run -- Key1="val1" Section1:Key2="val2"</code></pre>
                <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <p id="c15-para-0088" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">If the JSON
                                configuration file changes dynamically while the application is </i> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">running, and new
                                values should be retrieved from the application, you just have to set the </i> <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">reloadOnChange</code>
                            <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> argument of the
                            </i> <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddJsonFile</code>
                            <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> method to </i>
                            <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">. This way, a
                                file watcher is attached to be notified on changes, and the configuration values are
                                updated. See <a href="c18.xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter
                                    18</a>, “Files and Streams,” to learn how to create your own file watcher.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 如果 JSON
                                        配置文件在应用程序运行时动态更改，并且需要从应用程序中检索新值，你只需将 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">reloadOnChange</code>
                                        方法的 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddJsonFile</code>
                                        参数设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code>
                                        。这样，就会附加一个文件监视器来通知更改，并且配置值会更新。有关如何创建自己的文件监视器的信息，请参阅第 18 章“文件和流”。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0027"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-289" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Production and Development Settings <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">生产和开发设置</font>
                        </font>
                    </font>
                </h3>
                <p id="c15-para-0089" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To differentiate between settings for development,
                    production, and staging environments, the environmental variable <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DOTNET_ENVIRONMENT</code>
                    is used. The second configuration source that's in the list to search for configuration values is
                    <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.{environment-name}.json</code>.
                    Configuration values that are different with production, staging, and development environments just
                    need to be configured with <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.Production.json</code>,
                    <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.Staging.json</code>,
                    and <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.Development.json</code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了区分开发、生产和预发布环境的设置，使用环境变量 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DOTNET_ENVIRONMENT</code>
                                。列表中用于搜索配置值的第二个配置源是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.{environment-name}.json</code>
                                。与生产、预发布和开发环境不同的配置值只需要通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.Production.json</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.Staging.json</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.Development.json</code>
                                进行配置。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To set the environmental variable easily when running the
                    application, you can configure launch settings in the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Properties</code> folder
                    of the project and specify the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DOTNET_ENVIRONMENT</code>
                    environment variable (configuration file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/Properties/launchsettings.json</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了在运行应用程序时轻松设置环境变量，可以在项目的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Properties</code>
                                文件夹中配置启动设置，并指定 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DOTNET_ENVIRONMENT</code>
                                环境变量（配置文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/Properties/launchsettings.json</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0042"><code>{</code>
<code>  "profiles": {</code>
<code>    "ConfigurationSample": {</code>
<code>      "commandName": "Project",</code>
<code>      "environmentVariables": {</code>
<code>        "DOTNET_Environment": "Development"</code>
<code>      }</code>
<code>    }</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1"><span aria-label="410" epub:type="pagebreak" id="Page_410"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>To check for the
                    environment, the interface <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IHostEnvironment</code>
                    can be injected with a service. With this interface, the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">EnvironmentName</code>
                    property gives the name of the environment. Extension methods such as <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IsDevelopment</code>,
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IsStaging</code>, and
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IsProduction</code> can
                    be used to verify whether the application is running in a specific environment (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/EnvironmentSampleService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了检查环境，可以将服务注入到 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IHostEnvironment</code>
                                接口中。通过这个接口， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">EnvironmentName</code>
                                属性提供环境的名称。可以使用扩展方法如 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IsDevelopment</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IsStaging</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IsProduction</code>
                                来验证应用程序是否在特定环境中运行（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigurationSample/EnvironmentSampleService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0043"><code>public class EnvironmentSampleService</code>
<code>{</code>
<code>  private readonly IHostEnvironment _hostEnvironment;</code>
<code> </code>
<code>  public EnvironmentSampleService(IHostEnvironment hostEnvironment)</code>
<code>  {</code>
<code>    _hostEnvironment = hostEnvironment;</code>
<code>  }</code>
<code> </code>
<code>  public void ShowHostEnvironment()</code>
<code>  {</code>
<code>    Console.WriteLine(<b>_hostEnvironment.EnvironmentName</b>);</code>
<code>    if (<b>_hostEnvironment.IsDevelopment()</b>)</code>
<code>    {</code>
<code>      Console.WriteLine("it's a development environment");</code>
<code>    }</code>
<code>  }</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <p id="c15-para-0093" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">You can create
                                custom environments to differentiate environments where you use simulated local services
                                that are injected in the DI container—for example, to increase debugging speed by not
                                accessing authentication or other services. For this, you can create extension methods
                                to verify for the custom environment name. The implementation just needs to check for
                                the value of the </i> <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">EnvironmentName</code>
                            <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> property.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意
                                        您可以创建自定义环境，以区分您使用模拟本地服务（这些服务被注入到依赖注入容器中）的环境——例如，通过不访问身份验证或其他服务来提高调试速度。为此，您可以创建扩展方法来验证自定义环境名称。实现只需检查
                                        <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">EnvironmentName</code>
                                        属性的值即可。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0029"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-290" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">User Secrets <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">用户密钥</font>
                        </font>
                    </font>
                </h3>
                <p id="c15-para-0094" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Secrets shouldn't be stored within configuration files that
                    are part of the source code repository. Open-source code repositories are continuously scanned for
                    passwords and keys that could be used. Private-source code repositories also are not good places to
                    keep the secrets. During development time, <i
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">user secrets</i> can be
                    used. With user secrets, the configuration is stored in the user profile. Only the user who is
                    allowed to access the user profile can get access to these configuration values. During production,
                    you need to use a different environment instead. Here, depending on the environment, secrets can be
                    stored in environmental variables or, better yet, in a service like the Azure Key Vault.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                密钥不应存储在源代码仓库的一部分配置文件中。开源代码仓库会持续扫描可能被使用的密码和密钥。私有源代码仓库也不适合存储密钥。在开发期间，可以使用用户密钥。使用用户密钥时，配置存储在用户配置文件中。只有被允许访问用户配置文件的用户才能访问这些配置值。在生产环境中，你需要使用不同的环境。在这里，根据环境的不同，密钥可以存储在环境变量中，或者更好的方式是存储在
                                Azure Key Vault 等服务中。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To work with user secrets, you can use the dotnet tool <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">user-secrets</code>. For
                    example, the following:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要使用用户密钥，你可以使用 dotnet 工具 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">user-secrets</code>
                                。例如，以下操作：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0044"><code>&gt; dotnet user-secrets init</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">adds a configuration specifying a <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">UserSecretsId</code> in
                    the project file, such as this:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在项目文件中添加指定 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">UserSecretsId</code>
                                的配置，例如这样：</font>
                        </font>
                    </font>
                </p>
                <pre
                    id="c15-code-0045"><code>&lt;UserSecretsId&gt;7695182a-e84c-44c0-8644-4a531200ecff&lt;/UserSecretsId&gt; </code></pre>
                <p id="c15-para-0097" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">The ID is not a secret by itself. The ID can be a simple
                    string. By default, a GUID is created. All applications where user secrets are used store the
                    secrets in the user profile. To differentiate secrets from different applications, GUIDs are used.
                    If you want to access the same secret configuration from multiple applications, use the same user
                    secret ID with these applications.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">ID 本身不是秘密。ID
                                可以是一个简单的字符串。默认情况下会创建一个 GUID。所有使用用户秘密的应用程序都会将秘密存储在用户配置文件中。为了区分不同应用程序的秘密，使用
                                GUID。如果你希望从多个应用程序访问相同的秘密配置，请使用这些应用程序相同的用户秘密 ID。</font>
                        </font>
                    </font>
                </p>
                <p id="c15-para-0098" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1"><span aria-label="411" epub:type="pagebreak" id="Page_411"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>To access user
                    secrets from the application, the NuGet package <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.Configuration.UserSecrets</code>
                    needs to be added. The <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> class method
                    <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                    configures user secrets if the application is running in the Development environment, and a user
                    secret ID is specified in the project file. If you need user secrets in other scenarios, you can add
                    the provider in the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureAppConfiguration</code>
                    method calling <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddUserSecrets</code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要从应用程序访问用户秘密，需要添加 NuGet 包 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.Configuration.UserSecrets</code>
                                。如果应用程序在开发环境中运行，并且项目文件中指定了用户秘密 ID， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                                类方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">CreateDefaultBuilder</code>
                                会配置用户秘密。如果你需要在其他场景中使用用户秘密，可以在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureAppConfiguration</code>
                                方法中调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddUserSecrets</code>
                                来添加提供者。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To set a user secret via the command line, use the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">set</code> command:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要通过命令行设置用户秘密，使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">set</code>
                                命令：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0046"><code>&gt; dotnet user-secrets set Section1:Key2 "a secret"</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To show all the application's secrets, use the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">list</code> command:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要显示所有应用程序的秘密，使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">list</code>
                                命令：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0047"><code>&gt; dotnet user-secrets list</code></pre>
            </section>
        </section>
        <section aria-labelledby="head-2-136" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
            <span id="c15-sec-0030" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
            <h2 id="head-2-136" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">AZURE APP CONFIGURATION<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">AZURE 应用配置</font>
                    </font>
                </font>
            </h2>
            <p id="c15-para-0101" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">When publishing an ASP.NET Core web application to an Azure App
                Service, configuration values from the JSON configuration files can be retrieved and put into the
                configuration of the Azure App Service. This is a practical option; however, for many scenarios it's a
                better option to use Azure App Configuration. A solution often consists of multiple services that
                partially have the same configurations. Azure App Configuration allows one central place for the
                configuration, and all the applications within the solution can use the configuration. It also offers
                features such as having different configuration values for staging and production environments and using
                switches to turn features on or off based on different scenarios as needed.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">当将 ASP.NET Core 网络应用程序发布到 Azure App
                            Service 时，可以从 JSON 配置文件中获取配置值，并将其放入 Azure App Service 的配置中。这是一个实用的选项；然而，对于许多场景来说，使用 Azure
                            App Configuration 是更好的选择。解决方案通常由多个服务组成，这些服务部分具有相同的配置。Azure App Configuration
                            允许一个中央位置来管理配置，解决方案中的所有应用程序都可以使用该配置。它还提供了一些功能，例如为暂存环境和生产环境提供不同的配置值，以及根据不同场景按需使用开关来启用或禁用功能。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c15-para-0102" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">To use Azure App Configuration from the application, another
                configuration provider needs to be configured.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">要从应用程序中使用 Azure App
                            Configuration，需要配置另一个配置提供程序。</font>
                    </font>
                </font>
            </p>
            <p id="c15-para-0103" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">With the solution, configuration during development and in
                production not only needs different configuration values but also different environments. When you use
                configuration for an application running in Microsoft Azure, you can use an identity that is defined
                with the Azure App Service to access the Azure App Configuration. This option is probably not available
                in your development environment.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            有了这个解决方案，开发和生产环境中的配置不仅需要不同的配置值，还需要不同的环境。当你使用配置来运行 Microsoft Azure 中的应用程序时，你可以使用 Azure App
                            Service 定义的身份来访问 Azure App Configuration。这个选项可能在你开发环境中不可用。</font>
                    </font>
                </font>
            </p>
            <p id="c15-para-0104" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">In order to deal with that, you have different options. You
                already know that .NET configuration is flexible. During development time, you can use all the
                configuration locally and have secrets stored in user secrets.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">为了处理这个问题，你有不同的选择。你已经知道 .NET
                            配置是灵活的。在开发期间，你可以在本地使用所有配置，并将密钥存储在用户密钥中。</font>
                    </font>
                </font>
            </p>
            <p id="c15-para-0105" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">At some point in time, you want to test and debug using your
                application as it's running locally while accessing configuration stored in Microsoft Azure. It's best
                to have different Azure subscriptions to separate your development and your production environment. If
                you are using Visual Studio Professional or Visual Studio Enterprise, every month you have a free amount
                of money you can spend on Azure resources. You can use your Azure development environment with your
                Visual Studio subscription.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">某个时刻，你希望测试和调试正在本地运行的应用程序，同时访问存储在
                            Microsoft Azure 中的配置。最好使用不同的 Azure 订阅来分离你的开发和生产环境。如果你使用的是 Visual Studio Professional 或
                            Visual Studio Enterprise，每个月你都有一定金额的免费额度可以用于 Azure 资源。你可以使用与你的 Visual Studio 订阅关联的 Azure
                            开发环境。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0031"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-291" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Creating Azure App Configuration <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建 Azure App Configuration </font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Using the Azure Shell with the Bash environment, you can use
                    the following Azure CLI commands to create a resource group and app configuration. Some keys and
                    values used with the sample application are configured. Change the values for the resource group
                    name (<code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">rg</code>) and
                    the location that best fits your location (<code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">loc</code>):<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 Azure Shell 的 Bash 环境，你可以使用以下
                                Azure CLI 命令来创建资源组和应用配置。示例应用程序中使用的某些键和值已配置。请更改资源组名称（ <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">rg</code>
                                ）和最适合你位置的地点（ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">loc</code>
                                ）的值：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0048"><code>rg=rg-procsharp</code>
<code>loc=westeurope</code>
<code>conf=ProCSharpConfig$Random</code>
<code>key1=AppConfigurationSample:Settings:Config1</code>
<code>val1="configuration value for key 1"</code>
<code>devval1="development value for key 1"</code>
<code>stagingval1="staging value for key 1"</code>
<code>prodval1="production value for key 1"</code>
<code>sentinelKey=AppConfigurationSample:Settings:Sentinel</code>
<code>sentinelValue=1</code>
<code> <span aria-label="412" epub:type="pagebreak" id="Page_412" role="doc-pagebreak"></span></code>
<code><b>az group create --location $loc --name $rg</b></code>
<code><b>az appconfig create --location $loc --name $conf --resource-group $rg</b> </code>
<code>az appconfig kv set -n $conf --key $key1 --value "$val1" --yes</code>
<code>az appconfig kv set -n $conf --key $key1 --label Development --value "$devval1" --yes</code>
<code>az appconfig kv set -n $conf --key $key1 --label Staging --value "$stagingval1" --yes</code>
<code>az appconfig kv set -n $conf --key $key1 --label Production --value "$prodval1" --yes</code>
<code>az appconfig kv set -n $conf --key $sentinelKey --value $sentinelValue --yes</code></pre>
                <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <p id="c15-para-0108" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Azure resources
                                can be created and configured using the portal </i>(<code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><a href="https://portal.azure.com">https://portal.azure.com</a></code>)<i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">, the Azure CLI,
                                PowerShell, and also an Azure SDK. Check <a href="c01.xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter
                                    1</a>, “.NET Applications and Tools” for different ways to create Microsoft Azure
                                resources. You can open the Azure shell from the portal or by opening </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><a href="https://shell.azure.com">https://shell.azure.com</a></code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">. For the sample
                                application, also check the readme file of the chapter samples for a Bash script to
                                create the Azure resources.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 Azure 资源可以通过门户（ <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><a href="https://portal.azure.com">https://portal.azure.com</a></code>
                                        ）、Azure CLI、PowerShell 以及 Azure SDK 创建和配置。请查看第 1 章“.NET 应用程序和工具”，了解创建 Microsoft
                                        Azure 资源的不同方法。您可以从门户或通过打开 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><a href="https://shell.azure.com">https://shell.azure.com</a></code>
                                        打开 Azure Shell。对于示例应用程序，请查看章节示例的 README 文件，获取用于创建 Azure 资源的 Bash 脚本。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0033"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-292" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Using Azure App Configuration in the Development Environment
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在开发环境中使用 Azure App Configuration
                            </font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Let's explore a sample application using Azure App
                    Configuration. An ASP.NET Core web application can be easily deployed with Azure App Services. With
                    the sample application, you'll see the web application running locally and accessing the Azure App
                    Configuration and also see it running when it's deployed to an Azure App Service and accessing the
                    configuration. An empty web application can be created with <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">dotnet new web</code>. To
                    use Azure App Configuration from an ASP.NET Core application, the NuGet package <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Azure.AppConfiguration.AspNetCore</code>
                    is added. This package has a dependency on <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.Configuration.AzureAppConfiguration</code>,
                    which would be enough for .NET applications. The ASP.NET Core package adds middleware functionality
                    for dynamic configuration, as shown in the next section.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">让我们通过一个示例应用程序来探索 Azure App
                                Configuration。ASP.NET Core 网络应用程序可以轻松地使用 Azure App Services
                                部署。通过示例应用程序，您将看到网络应用程序在本地运行并访问 Azure App Configuration，同时也会看到它部署到 Azure App Service
                                后运行并访问配置。可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">dotnet new web</code>
                                创建一个空的网络应用程序。要在 ASP.NET Core 应用程序中使用 Azure App Configuration，需要添加 NuGet 包 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Azure.AppConfiguration.AspNetCore</code>
                                。该包依赖于 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.Extensions.Configuration.AzureAppConfiguration</code>
                                ，这对于 .NET 应用程序就足够了。ASP.NET Core 包添加了用于动态配置的中间件功能，下一节将展示。</font>
                        </font>
                    </font>
                </p>
                <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <p id="c15-para-0110" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Read more
                                information about the foundations of ASP.NET Core web applications in <a
                                    href="c24.xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter
                                    24</a>, “ASP.NET Core.”</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 有关 ASP.NET Core Web
                                        应用程序基础的信息，请参阅第 24 章“ASP.NET Core”。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p id="c15-para-0111" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To access Azure App Configuration, you use a <i
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">connection string</i> or
                    an <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">endpoint</i>. The
                    connection string includes a secret. Instead of using the connection string containing the secret,
                    you can use the endpoint to your App Configuration resource and an account that is allowed to access
                    the Azure resource when running the application. If you use the connection string with the secret,
                    in the development environment, store the connection string with user secrets. With the sample
                    application, an account is used that allows using the same code in the production environment.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要访问 Azure App
                                Configuration，您使用连接字符串或端点。连接字符串包含一个密钥。您可以使用包含密钥的连接字符串，也可以使用您的 App Configuration
                                资源的端点和一个允许在运行应用程序时访问 Azure
                                资源的帐户。如果您使用包含密钥的连接字符串，在开发环境中，将连接字符串存储在用户密钥中。在示例应用程序中，使用一个帐户，该帐户允许在生产环境中使用相同的代码。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">The endpoint to the Azure App Configuration resource is shown
                    using <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">az appconfig show</code>
                    :<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">Azure App Configuration 资源的端点使用
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">az appconfig show</code>
                                显示：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0049"><code>&gt; az appconfig show --name $conf --query endpoint</code></pre>
                <p id="c15-para-0113" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">This endpoint is added to the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.json</code>
                    file with the key <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AppConfigEndpoint</code>.
                    Because a secret is not included, it's okay to have it in the source code repo.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">此端点添加到 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">appsettings.json</code>
                                文件中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AppConfigEndpoint</code>
                                键。由于不包含密钥，因此可以将其放在源代码存储库中。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To run the web application with a privileged user, add the
                    environment variable <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AZURE_USERNAME</code> and
                    set it to your Azure username. To automatically do this on starting the application, change the file
                    <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">launchsettings.json</code>
                    in the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Properties</code> folder:
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要以特权用户运行 Web 应用程序，请添加环境变量 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AZURE_USERNAME</code>
                                并将其设置为您的 Azure 用户名。要在启动应用程序时自动执行此操作，请更改 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Properties</code>
                                文件夹中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">launchsettings.json</code>
                                文件：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0050"><code>{</code>
<code>  "profiles": {</code>
<code>    "AzureAppConfigWebApp": {</code>
<code>      "commandName": "Project",<span aria-label="413" epub:type="pagebreak" id="Page_413" role="doc-pagebreak"></span></code>
<code>      "dotnetRunMessages": "true",</code>
<code>      "launchBrowser": true,</code>
<code>      "applicationUrl": "https://localhost:5001;http://localhost:5000",</code>
<code>      "environmentVariables": {</code>
<code>        "ASPNETCORE_ENVIRONMENT": "Development",</code>
<code>        <b>"AZURE_USERNAME": "add your username here, e.g. name@outlook.com"</b></code>
<code>      }</code>
<code>    }</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Next, add the Azure App Configuration provider to the
                    configuration of the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> class. With
                    the web application, you can use <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureAppConfiguration</code>
                    of the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IWebHostBuilder</code>
                    instead of the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureAppConfiguration</code>
                    method of the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IHostBuilder</code> used
                    before. The difference is that with the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IWebHostBuilder</code>
                    version, you have access to the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">WebHostBuilderContext</code>
                    instead of the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HostBuilderContext</code>,
                    which gives you more options. One overload of the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddAzureAppConfiguration</code>
                    method needs the connection string, including the secret. To use the account instead, you need the
                    overload to pass the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigurationOptions</code>.
                    With the <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">options</code>
                    variable, the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Connect</code> method can
                    be used to pass the endpoint that's retrieved from the configuration and an instance of <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DefaultAzureCredential</code>
                    (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">接下来，将 Azure App Configuration
                                提供程序添加到 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                                类的配置中。对于 Web 应用，你可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureAppConfiguration</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IWebHostBuilder</code>
                                而不是之前使用的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IHostBuilder</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureAppConfiguration</code>
                                方法。不同之处在于，在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IWebHostBuilder</code>
                                版本中，你可以访问 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">WebHostBuilderContext</code>
                                而不是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">HostBuilderContext</code>
                                ，这为你提供了更多选项。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddAzureAppConfiguration</code>
                                方法的其中一个重载需要包含密钥的连接字符串。若要使用账户，你需要使用重载来传递 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigurationOptions</code>
                                。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">options</code>
                                变量时，可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Connect</code>
                                方法来传递从配置中获取的端点以及 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DefaultAzureCredential</code>
                                的实例（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0051"><code>public static IHostBuilder CreateHostBuilder(string[] args) =&gt;</code>
<code>  Host.CreateDefaultBuilder(args)</code>
<code>    .ConfigureWebHostDefaults(webBuilder =&gt;</code>
<code>    {</code>
<code>      webBuilder.ConfigureAppConfiguration((context, config) =&gt;</code>
<code>      {</code>
<code>        <b>// configuration is already needed from within setting up config</b></code>
<code>        <b>var settings = config.Build();</b> </code>
<code>        <b>config.AddAzureAppConfiguration(options =&gt;</b></code>
<code>        <b>{</b>                            </code>
<code>          <b>DefaultAzureCredential credential = new();</b></code>
<code>          <b>var endpoint = settings["AppConfigEndpoint"];</b></code>
<code> </code>
<code>          <b>options.Connect(new Uri(endpoint), credential);</b></code>
<code>        });</code>
<code>      });</code>
<code>      webBuilder.UseStartup&lt;Startup&gt;();</code>
<code>    });</code></pre>
                <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <p id="c15-para-0117" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">The class
                            </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DefaultAzureCredential</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> has different
                                ways to log in to Microsoft Azure. First, it tries to use </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">EnvironmentalCredential</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">. This credential
                                class makes use of an environmental variable </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ACCOUNT_USERNAME</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> that you can
                                configure with the </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">launchsettings.json</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> file. If this
                                fails, it uses </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ManagedIdentityCredential</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">. When running
                                the app in Azure, you can configure your App Service to run with a managed identity,
                                which is then used to access Azure App Configuration. Next, </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">SharedTokenCacheCredential</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> is used. This
                                uses a local token cache. </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">VisualStdudioCredential</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> is next. You can
                                configure these credentials with Tools ➪ Options ➪ Azure Service Authentication. After
                                this, </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">VisualStudioCodeCredential</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> and </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureCliCredential</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> (credentials
                                used with the Azure CLI) follow. </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">InteractiveBrowserCredential</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> (interactive log
                                in via the browser) is the last option that's tried for a successful login, but only if
                                the parameter </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">includeInteractiveCredentials</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> of the </i><code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DefaultAzureCredential</code><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> constructor is
                                set to <code
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code>.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 类 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DefaultAzureCredential</code>
                                        有多种方式登录 Microsoft Azure。首先，它尝试使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">EnvironmentalCredential</code>
                                        。这个凭证类利用一个环境变量 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ACCOUNT_USERNAME</code>
                                        ，你可以通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">launchsettings.json</code>
                                        文件进行配置。如果失败，它使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ManagedIdentityCredential</code>
                                        。在 Azure 中运行应用时，你可以配置你的 App Service 以使用托管身份，然后使用该身份访问 Azure App
                                        Configuration。接下来，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">SharedTokenCacheCredential</code>
                                        。这使用本地令牌缓存。然后是 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">VisualStdudioCredential</code>
                                        。你可以通过 Tools ➪ Options ➪ Azure Service Authentication 配置这些凭证。之后，使用 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">VisualStudioCodeCredential</code>
                                        和 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureCliCredential</code>
                                        （与 Azure CLI 一起使用的凭证）。最后尝试的是 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">InteractiveBrowserCredential</code>
                                        （通过浏览器进行交互式登录），但只有当 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">DefaultAzureCredential</code>
                                        构造函数的参数 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">includeInteractiveCredentials</code>
                                        设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code>
                                        时才会尝试成功登录。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1"><span aria-label="414" epub:type="pagebreak" id="Page_414"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>To inject the
                    configured values, the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IndexAppSettings</code>
                    class is defined. This will be used to fill the value for the key <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AppConfigurationSample:Settings:Config1</code>
                    (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/IndexAppSettings.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了注入配置的值，定义了 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IndexAppSettings</code>
                                类。这将用于填充键 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AppConfigurationSample:Settings:Config1</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/IndexAppSettings.cs</code>
                                ）的值：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0052"><code>public class IndexAppSettings</code>
<code>{</code>
<code>  public string? Config1 { get; set; }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">In the code-behind of the Index Razor page, <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptionsSnapshot</code>
                    is injected to access the configuration value and fill the property <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Config1</code> (code file
                    <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/Pages/Index.cshtml.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在 Index Razor 页面的代码隐藏部分，注入 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptionsSnapshot</code>
                                以访问配置值并填充属性 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Config1</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/Pages/Index.cshtml.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0053"><code>public class IndexModel : PageModel</code>
<code>{</code>
<code>  private readonly ILogger&lt;IndexModel&gt; _logger;</code>
<code> </code>
<code>  public IndexModel(<b>IOptionsSnapshot&lt;IndexAppSettings&gt; options,</b> </code>
<code>                    <b>ILogger&lt;IndexModel&gt; logger)</b></code>
<code>  {</code>
<code>    _logger = logger;</code>
<code>    <b>Config1 = options.Value.Config1 ?? "no value";</b></code>
<code>  }</code>
<code> </code>
<code>  <b>public string Config1 { get; }</b></code>
<code>  //…</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <p id="c15-para-0121" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">The </i> <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code>
                            <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> interface is
                                explained earlier in this chapter in the section “Initialization of Services Using
                                Options.” </i> <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptionsSnapshot</code>
                            <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> derives from </i>
                            <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code>
                            <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> </i> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">and allows
                                changing configuration values dynamically as is shown in the next section.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code>
                                        接口在本章“使用选项初始化服务”部分有详细说明。 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptionsSnapshot</code>
                                        派生自 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IOptions</code>
                                        并允许动态更改配置值，如下一节所示。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">In the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Index</code> Razor page,
                    the configuration value is shown accessing the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Config1</code> property
                    (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/Pages/Index.cshtml</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Index</code>
                                Razor 页面中，配置值通过访问 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Config1</code>
                                属性显示（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/Pages/Index.cshtml</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0054"><code>&lt;p&gt;configuration value: @Model.Config1&lt;/p&gt;</code></pre>
            </section>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0037"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-293" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Dynamic Configuration <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">动态配置 </font>
                        </font>
                    </font>
                </h3>
                <p id="c15-para-0123" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To avoid an application restart when a configuration value
                    changes, the configuration can be set to reread configuration values after a sentinel value changes.
                    This sentinel value needs to be set to a new value as soon as any other configuration for the
                    application gets a new value.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                为了避免配置值更改时应用程序需要重启，可以将配置设置为在哨兵值更改后重新读取配置值。这个哨兵值需要在应用程序的任何其他配置获得新值时立即设置为新的值。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To configure a refresh for all values when the sentinel value
                    changes, you use an overload of the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddAzureAppConfiguration</code>
                    extension method to pass an action delegate. With the implementation of the lambda expression, the
                    connection string for Azure App Configuration is now passed to the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Connect</code> method of
                    the action delegate. Now it's also possible to invoke the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureRefresh</code>
                    method. Passing a lambda expression with an <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigurationRefreshOptions</code>
                    parameter, a configuration value can be registered that should be refreshed based on the setting
                    passed to the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">SetCacheExpiration</code>
                    method. By default, the registered values are refreshed every 30 seconds. To reduce the invocations
                    to the Azure App Configuration, the refresh is changed to refresh every five minutes. After the
                    value is retrieved, and it is changed, all the other configuration values are retrieved as well
                    because of the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">refreshAll</code>
                    parameter setting (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要配置在哨兵值变化时刷新所有值，您使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddAzureAppConfiguration</code>
                                扩展方法的重载来传递一个动作委托。通过 lambda 表达式的实现，Azure App Configuration 的连接字符串现在传递给动作委托的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Connect</code>
                                方法。现在也可以调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureRefresh</code>
                                方法。传递一个带有 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigurationRefreshOptions</code>
                                参数的 lambda 表达式，可以注册一个应根据传递给 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">SetCacheExpiration</code>
                                方法的设置进行刷新的配置值。默认情况下，注册的值每 30 秒刷新一次。为了减少对 Azure App Configuration
                                的调用，将刷新改为每五分钟刷新一次。在值被检索后，如果它发生了变化，由于 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">refreshAll</code>
                                参数的设置（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/Program.cs</code>
                                ），所有其他配置值也会被检索。</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0055"><code>webBuilder.ConfigureAppConfiguration((context, config) =&gt;</code>
<code>{</code>
<code>  // configuration is already needed from within setting up config</code>
<code>  var settings = config.Build(); <span aria-label="415" epub:type="pagebreak" id="Page_415" role="doc-pagebreak"></span></code>
<code>  config.AddAzureAppConfiguration(options =&gt;</code>
<code>  {</code>
<code>    DefaultAzureCredential credential = new();</code>
<code>    var endpoint = settings["AppConfigEndpoint"];                            </code>
<code>    options.Connect(new Uri(endpoint), credential)</code>
<code>      <b>.ConfigureRefresh(refresh =&gt;</b></code>
<code>      <b>{</b></code>
<code>         <b>refresh.Register(</b></code>
<code>           <b>"AppConfigurationSample:Settings:Sentinel",</b></code>
<code>             <b>refreshAll: true)</b></code>
<code>           <b>.SetCacheExpiration(TimeSpan.FromMinutes(5));</b></code>
<code>      })</code>
<code>  });</code></pre>
                <p id="c15-para-0125" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">The ASP.NET Core middleware needs to be configured to check
                    if the sentinel value was changed, and thus the refresh of the configuration values can be done
                    automatically on every request. To configure the middleware, the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Startup</code> class is
                    configured by invoking the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddAzureAppConfiguration</code>
                    method in the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureServices</code>
                    method and by invoking the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">UseAzureAppConfiguration</code>
                    method in the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Configure</code> method.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">ASP.NET Core
                                中间件需要配置以检查哨兵值是否已更改，从而可以在每次请求时自动刷新配置值。要配置中间件，需要在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureServices</code>
                                方法中调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AddAzureAppConfiguration</code>
                                方法，并在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Configure</code>
                                方法中调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">UseAzureAppConfiguration</code>
                                方法来配置 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Startup</code>
                                类。</font>
                        </font>
                    </font>
                </p>
                <p id="c15-para-0126" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">For a test, you might lower the cache expiration time and
                    change both the value for the key <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AppConfigurationSample:Settings:Config1</code>
                    as well as the sentinel value while the application is running. The new value will show up after the
                    defined timespan.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了测试，你可能需要降低缓存过期时间，并在应用程序运行时更改键
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AppConfigurationSample:Settings:Config1</code>
                                的值以及哨兵值。新值将在定义的时间段后显示。</font>
                        </font>
                    </font>
                </p>
            </section>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0038"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-294" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Production and Staging Settings with Azure App Configuration
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">Azure App Configuration
                                中的生产环境和预发布环境设置</font>
                        </font>
                    </font>
                </h3>
                <p id="c15-para-0127" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">With the .NET configuration, you've seen different values
                    based on the environment name (see the section “Production and Development Settings”). With Azure
                    App Configuration, you can do this with a feature named <i
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">labels</i> in this
                    service. On defining the configuration values for this service, labels named Production, Staging,
                    and Development have been used. These labels are now used to map the different hosting environments.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在.NET
                                配置中，你已经看到了基于环境名称的不同值（参见“生产环境和开发环境设置”部分）。使用 Azure App
                                Configuration，你可以通过这个服务中的一个名为标签的功能来实现这一点。在定义此服务的配置值时，已经使用了名为生产、预发布和开发的标签。现在这些标签用于映射不同的托管环境。
                            </font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Depending on the environment name, you can use label filters
                    to filter the configuration. With the first <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Select</code> method, no
                    label filter is used. Here all the configuration values are retrieved. With the second <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Select</code> method,
                    configuration values are overridden based on the environment. This way, it's only necessary to add
                    values for a specific environment when the values are different (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">根据环境名称，你可以使用标签过滤器来过滤配置。在第一个 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Select</code>
                                方法中，不使用标签过滤器。这里检索所有配置值。在第二个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Select</code>
                                方法中，配置值根据环境被覆盖。这样，当值不同时，只需为特定环境添加值（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0056"><code>config.AddAzureAppConfiguration(options =&gt;</code>
<code>{</code>
<code>  DefaultAzureCredential credential = new();</code>
<code>  var endpoint = settings["AppConfigEndpoint"];                            </code>
<code>  options.Connect(new Uri(endpoint), credential)</code>
<code>    <b>.Select(KeyFilter.Any, LabelFilter.Null)</b></code>
<code>    <b>.Select(KeyFilter.Any, context.HostingEnvironment.EnvironmentName)</b></code>
<code>    .ConfigureRefresh(refresh =&gt;</code>
<code>    {</code>
<code>      refresh.Register("AppConfigurationSample:Settings:Sentinel", </code>
<code>        refreshAll: true)</code>
<code>        .SetCacheExpiration(TimeSpan.FromMinutes(5));</code>
<code>    }));</code></pre>
            </section>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0039"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-295" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Feature Flags <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">功能标志</font>
                        </font>
                    </font>
                </h3>
                <p id="c15-para-0129" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Feature flags is another feature of Azure App Configuration.
                    With feature flags, you can enable or disable different parts at specific times or to a subset of
                    users. New features (for example, preview features) of an application can be made available to a
                    group of early adopters before the feature is available for all users. You can also implement a new
                    feature with different user interface options and make this feature available to different groups
                    <span aria-label="416" epub:type="pagebreak" id="Page_416" role="doc-pagebreak"
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>of users. You can
                    use telemetry information to find out how the different users find and use the new feature. Analysis
                    of the information will tell you which version was most successful.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">功能标志是 Azure App Configuration
                                的另一个特性。通过功能标志，您可以在特定时间或针对部分用户启用或禁用不同功能。应用程序的新功能（例如，预览功能）可以在该功能对所有用户可用之前，提供给一组早期采用者。您还可以使用不同的用户界面选项实现新功能，并将此功能提供给不同的用户组。您可以使用遥测信息来了解不同用户发现和使用新功能的情况。通过分析这些信息，您可以知道哪个版本最为成功。
                            </font>
                        </font>
                    </font>
                </p>
                <p id="c15-para-0130" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Azure App Configuration offers built-in feature flags based
                    on a percentage of users, a specific time window, and user groups. You can also implement a custom
                    feature filter that implements the interface <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IFeatureFilter</code> in
                    the namespace <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.FeatureManagement</code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">Azure App Configuration
                                提供基于用户百分比、特定时间窗口和用户组的内置功能标志。您还可以实现自定义功能过滤器，该过滤器实现了命名空间 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.FeatureManagement</code>
                                中的接口 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IFeatureFilter</code>
                                。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To create the feature <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">FeatureX</code> with the
                    previously defined Azure App Configuration, you can use the following Azure CLI command:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要使用先前定义的 Azure App Configuration
                                创建功能 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">FeatureX</code>
                                ，您可以使用以下 Azure CLI 命令：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0057"><code>&gt; az appconfig feature set --feature FeatureX -n $conf</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">The configuration of the feature is shown in the following:
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">功能的配置如下所示：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0058"><code>&gt; az appconfig feature show --feature FeatureX -n $conf</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">with a result like this:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">得到类似这样的结果：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0059"><code>{</code>
<code>  "conditions": {</code>
<code>    "client_filters": [</code>
<code>      {</code>
<code>        "name": "Microsoft.Percentage",</code>
<code>        "parameters": {</code>
<code>          "Value": 50</code>
<code>        }</code>
<code>      }</code>
<code>    ]</code>
<code>  },</code>
<code>  "description": "",</code>
<code>  "key": "FeatureX",</code>
<code>  "label": null,</code>
<code>  "lastModified": "2020-11-08T16:18:22+00:00",</code>
<code>  "locked": false,</code>
<code>  "state": "conditional"</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To use feature flags with ASP.NET Core, you need to add the
                    NuGet package <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.FeatureManagement.AspNetCore</code>
                    to the project. The sample application has a percentage filter associated. With the percentage
                    filter, a percentage can be configured for which the filter should return <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code>. The DI
                    container needs to be configured to add the implementation for feature management and to define the
                    type of the filter that should be used (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要在 ASP.NET Core 中使用功能标志，您需要将 NuGet
                                包 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.FeatureManagement.AspNetCore</code>
                                添加到项目中。示例应用程序有一个百分比过滤器关联。通过百分比过滤器，可以配置过滤器返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code>
                                的百分比。需要配置依赖注入容器以添加功能管理的实现，并定义应使用的过滤器类型（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/Startup.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre
                    id="c15-code-0060"><code>services.AddFeatureManagement().AddFeatureFilter&lt;PercentageFilter&gt;();</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">In the code-behind file of the Razor page <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">FeatureSample</code>, the
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IFeatureManager</code>
                    is injected in the constructor. The <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IsEnabledAsync</code>
                    method passing <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">FeatureX</code> returns
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code> or <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">false</code>. With the
                    current configuration, 50 percent of the requests return <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code>, and the
                    feature can be used (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/FeatureSample.cshtml.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在 Razor 页面 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">FeatureSample</code>
                                的后台代码文件中， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IFeatureManager</code>
                                在构造函数中被注入。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">IsEnabledAsync</code>
                                方法传递 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">FeatureX</code>
                                后返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code> 或
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">false</code>
                                。根据当前配置，50%的请求返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">true</code>
                                ，该功能可以使用（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebApp/FeatureSample.cshtml.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0061"><code>public class FeatureSampleModel : PageModel</code>
<code>{</code>
<code>  private readonly IFeatureManager _featureManager;</code>
<code>  public FeatureSampleModel(IFeatureManager featureManager)</code>
<code>  {</code>
<code>    _featureManager = featureManager;</code>
<code>  }</code>
<code> </code>
<code>  public string? FeatureXText { get; private set; }</code>
<code> <span aria-label="417" epub:type="pagebreak" id="Page_417" role="doc-pagebreak"></span></code>
<code>  public async Task OnGetAsync()</code>
<code>  {</code>
<code>    bool featureX = await _featureManager.IsEnabledAsync("FeatureX");</code>
<code>    string featureText = featureX ? "is" : "is not";</code>
<code>    FeatureXText = $"FeatureX {featureText} available"; </code>
<code>  }</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <p id="c15-para-0137" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">With nonweb
                                applications, the package </i> <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.FeatureManagement</code>
                            <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> is enough to use
                                features from .NET applications. </i> <code
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.FeatureManagement.AspNetCore</code>
                            <i data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"> adds classes for
                                middleware and attributes for controllers as well as tag helpers. Tag helpers are
                                covered in <a href="c26.xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter
                                    26</a>, “Razor Pages and MVC.”</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 对于非 Web 应用程序，包 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.FeatureManagement</code>
                                        足以使用 .NET 应用程序的功能。 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Microsoft.FeatureManagement.AspNetCore</code>
                                        还添加了用于中间件的类以及用于控制器的属性和标签辅助类。标签辅助类在“Razor Pages 和 MVC”第 26 章中介绍。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
            <section data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"><span id="c15-sec-0041"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
                <h3 id="head-3-296" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Using the Azure Key Vault <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 Azure Key Vault </font>
                        </font>
                    </font>
                </h3>
                <p id="c15-para-0138" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To configure secrets in Microsoft Azure, the Azure Key Vault
                    gives more security features. In the cloud, Hardware Security Modules (HSM), physical environments
                    to safeguard and manage keys, can be used. With the Azure Key Vault, there's also a specific
                    security role to monitor who accesses which keys.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要在 Microsoft Azure 中配置密钥，Azure Key
                                Vault 提供了更多的安全功能。在云中，硬件安全模块（HSM），物理环境用于保护和管理密钥，可以被使用。使用 Azure Key
                                Vault，还有一个特定的安全角色用于监控谁访问了哪些密钥。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To create an Azure Key Vault, you can use the Azure CLI with
                    variables <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">rg</code> and
                    <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">loc</code> as specified
                    earlier:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要创建 Azure Key Vault，您可以使用 Azure
                                CLI，并使用前面指定的变量 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">rg</code> 和
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">loc</code> ：
                            </font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0062"><code>&gt; az keyvault create --resource-group $rg --location $loc </code>
<code>--enable-rbac-authorization --name procsharpkeyvault</code></pre>
                <p id="c15-para-0140" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">To access the key vault, the Azure Key Vault provider can be
                    used with the .NET configuration. An alternative option is to configure Azure App Configuration to
                    access Azure Key Vault. This way the application can get all the settings via Azure App
                    Configuration. This simplifies the setup. Behind the scenes, the Azure Key Vault is directly
                    accessed from the application; thus, the identity used with the application needs to have access
                    configured in Azure Key Vault to read the secret values.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要访问密钥库，可以使用与.NET 配置配合使用的 Azure Key
                                Vault 提供程序。另一种选择是配置 Azure App Configuration 以访问 Azure Key Vault。这样，应用程序可以通过 Azure App
                                Configuration 获取所有设置。这种方式简化了配置。在后台，应用程序直接访问 Azure Key Vault；因此，与应用程序一起使用的身份需要在 Azure Key
                                Vault 中配置访问权限，以读取密钥值。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">Using the Fluent API of the <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigurationOptions</code>,
                    <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureKeyVault</code>
                    is invoked to configure the credentials for the Key Vault. The Key Vault needs to be connected with
                    the Azure App Configuration using a Key Vault reference configuration (code file <code
                        data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebAppSample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigurationOptions</code>
                                的 Fluent API， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">ConfigureKeyVault</code>
                                被调用以配置密钥库的凭证。密钥库需要通过密钥库引用配置（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">AzureAppConfigWebAppSample/Program.cs</code>
                                ）连接到 Azure App Configuration：</font>
                        </font>
                    </font>
                </p>
                <pre id="c15-code-0063"><code>webBuilder.ConfigureAppConfiguration((context, config) =&gt;</code>
<code>{</code>
<code>  // configuration is already needed from within setting up config</code>
<code>  var settings = config.Build(); </code>
<code>  config.AddAzureAppConfiguration(options =&gt;</code>
<code>  {</code>
<code>    DefaultAzureCredential credential = new();</code>
<code>    var endpoint = settings["AppConfigEndpoint"];                            </code>
<code>    options.Connect(new Uri(endpoint), credential)</code>
<code>      .ConfigureRefresh(refresh =&gt;</code>
<code>      {</code>
<code>         refresh.Register(</code>
<code>           "AppConfigurationSample:Settings:Sentinel",</code>
<code>             refreshAll: true)</code>
<code>           .SetCacheExpiration(TimeSpan.FromMinutes(5));</code>
<code>      })<span aria-label="418" epub:type="pagebreak" id="Page_418" role="doc-pagebreak"></span></code>
<code>      <b>.ConfigureKeyVault(kv =&gt;</b> </code>
<code>      <b>{</b></code>
<code>        <b>kv.SetCredential(credential);</b></code>
<code>      <b>});</b></code>
<code>  });</code></pre>
                <p data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                    data-immersive-translate-paragraph="1">With this in place, configuration values can be retrieved
                    from the Azure Key Vault as well.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">这样一来，配置值也可以从 Azure Key Vault 中获取。
                            </font>
                        </font>
                    </font>
                </p>
                <aside data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                    <div class="top hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                        <p id="c15-para-0143" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">NOTE</b> <i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Read <a
                                    href="c24.xhtml"
                                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter
                                    24</a> for information about how to deploy web apps to Azure App </i><i
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Services and how
                                to configure managed identities.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：有关如何将 Web 应用程序部署到 Azure
                                        App Services 以及如何配置托管身份的信息，请参阅第 24 章。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
        </section>
        <section aria-labelledby="head-2-137" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">
            <span id="c15-sec-0043" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"></span>
            <h2 id="head-2-137" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">SUMMARY<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">摘要</font>
                    </font>
                </font>
            </h2>
            <p id="c15-para-0144" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">This chapter covered various features of the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> class. The most
                important one is probably the dependency injection container that's hosted by this class. You've seen
                transient, scoped, and singleton services and how this DI container manages the lifetime.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本章介绍了 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                            类的各种功能。其中最重要的可能是由该类托管的依赖注入容器。你已经看到了瞬态、作用域和单例服务，以及这个 DI 容器如何管理生命周期。</font>
                    </font>
                </font>
            </p>
            <p id="c15-para-0145" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">This book contains several chapters where dependency injection
                has an important role. <a href="c21.xhtml"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter 21</a>, “Entity
                Framework Core,” shows how dependency injection is used with EF Core and how you can replace built-in
                functionality. Read <a href="c23.xhtml"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter 23</a>, “Tests,” for
                information on how dependency injection helps creating unit tests. Web applications (<a href="c24.xhtml"
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapters 24</a> through <a
                    href="c28.xhtml" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">28</a>) have
                the dependency injection built in with the project templates. For Windows applications, read <a
                    href="c30.xhtml" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Chapter
                    30</a>, “Patterns with XAML Apps,” on how to use the DI container and the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> class.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本书中有几章中依赖注入扮演着重要角色。第 21 章“Entity
                            Framework Core”展示了如何使用 EF Core 中的依赖注入，以及如何替换内置功能。有关依赖注入如何帮助创建单元测试的信息，请阅读第 23 章“Tests”。Web
                            应用程序（第 24 章至第 28 章）在项目模板中内置了依赖注入。对于 Windows 应用程序，请阅读第 30 章“XAML 应用程序模式”，了解如何使用 DI 容器和 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> 类。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c15-para-0146" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">The second part of this chapter covered flexible options to read
                configuration values from various sources. Besides environmental variables, the command line, JSON
                files, and user secrets, you've also seen how to read settings for the application from Azure App
                Configuration. For the application to read the configuration values no changes are needed. Only the
                setup of the <code data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                class needs a change if more configuration sources are added.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            本章的第二部分介绍了从各种来源读取配置值的灵活选项。除了环境变量、命令行、JSON 文件和用户密钥之外，你还了解了如何从 Azure App Configuration
                            读取应用程序的设置。为了让应用程序读取配置值，无需进行任何更改。如果添加更多配置源，只有 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                            类的设置需要更改。</font>
                    </font>
                </font>
            </p>
            <p id="c15-para-0147" data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9"
                data-immersive-translate-paragraph="1">The next chapter continues with features of the <code
                    data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code> class that make
                use of logging. To see what the application is doing, also telemetry and metrics information is
                implemented.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">下一章将继续介绍 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="341821c6-f10f-444c-922f-e29eba1e93b9">Host</code>
                            类中使用日志记录的功能。为了了解应用程序正在做什么，还实现了遥测和指标信息。</font>
                    </font>
                </font>
            </p>
        </section>
    </section>
</body>
<div id="immersive-translate-popup" style="all: initial"></div>

</html>