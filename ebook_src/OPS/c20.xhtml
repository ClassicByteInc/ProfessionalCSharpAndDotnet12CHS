<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops"
    xmlns:svg="http://www.w3.org/2000/svg" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en"
    imt-state="dual" imt-trans-position="after">

<head>
    <title>《20 Security》 --- 20 Security</title>
    <link href="WileyTemplate_v5.5.css" rel="stylesheet" type="text/css" />
    <meta content="urn:uuid:e0000000-0000-0000-0000-000006715209" name="Adept.expected.resource" />
    <style data-id="immersive-translate-input-injected-css">
        .immersive-translate-input {
            position: absolute;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            z-index: 2147483647;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .immersive-translate-attach-loading::after {
            content: " ";

            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;

            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-2000%, -50%);
            z-index: 100;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .immersive-translate-input-loading {
            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;
        }

        @keyframes immersiveTranslateShadowRolling {
            0% {
                box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            12% {
                box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            25% {
                box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            36% {
                box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color),
                    100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
            }

            50% {
                box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color),
                    110px 0 var(--loading-color), 100px 0 var(--loading-color);
            }

            62% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color),
                    120px 0 var(--loading-color), 110px 0 var(--loading-color);
            }

            75% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    130px 0 var(--loading-color), 120px 0 var(--loading-color);
            }

            87% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
            }

            100% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
            }
        }

        .immersive-translate-toast {
            display: flex;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            right: 0;
            top: 1%;
            width: fit-content;
            padding: 12px 20px;
            margin: auto;
            overflow: auto;
            background: #fef6f9;
            box-shadow: 0px 4px 10px 0px rgba(0, 10, 30, 0.06);
            font-size: 15px;
            border-radius: 8px;
            color: #333;
        }

        .immersive-translate-toast-content {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .immersive-translate-toast-hidden {
            margin: 0 20px 0 72px;
            text-decoration: underline;
            cursor: pointer;
        }

        .immersive-translate-toast-close {
            color: #666666;
            font-size: 20px;
            font-weight: bold;
            padding: 0 10px;
            cursor: pointer;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-toast {
                top: 0;
                padding: 12px 0px 0 10px;
            }

            .immersive-translate-toast-content {
                flex-direction: column;
                text-align: center;
            }

            .immersive-translate-toast-hidden {
                margin: 10px auto;
            }
        }

        .immersive-translate-modal {
            display: none;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
            font-size: 15px;
        }

        .immersive-translate-modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 40px 24px 24px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 80%;
            max-width: 270px;
            font-family: system-ui, -apple-system, "Segoe UI", "Roboto", "Ubuntu",
                "Cantarell", "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
                "Segoe UI Symbol", "Noto Color Emoji";
            position: relative;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-content {
                margin: 50% auto !important;
            }
        }

        .immersive-translate-modal .immersive-translate-modal-content-in-input {
            max-width: 500px;
        }

        .immersive-translate-modal-content-in-input .immersive-translate-modal-body {
            text-align: left;
            max-height: unset;
        }

        .immersive-translate-modal-title {
            text-align: center;
            font-size: 16px;
            font-weight: 700;
            color: #333333;
        }

        .immersive-translate-modal-body {
            text-align: center;
            font-size: 14px;
            font-weight: 400;
            color: #333333;
            word-break: break-all;
            margin-top: 24px;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-body {
                max-height: 250px;
                overflow-y: auto;
            }
        }

        .immersive-translate-close {
            color: #666666;
            position: absolute;
            right: 16px;
            top: 16px;
            font-size: 20px;
            font-weight: bold;
        }

        .immersive-translate-close:hover,
        .immersive-translate-close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .immersive-translate-modal-footer {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        .immersive-translate-btn {
            width: fit-content;
            color: #fff;
            background-color: #ea4c89;
            border: none;
            font-size: 16px;
            margin: 0 8px;
            padding: 9px 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .immersive-translate-btn:hover {
            background-color: #f082ac;
        }

        .immersive-translate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .immersive-translate-btn:disabled:hover {
            background-color: #ea4c89;
        }

        .immersive-translate-cancel-btn {
            /* gray color */
            background-color: rgb(89, 107, 120);
        }

        .immersive-translate-cancel-btn:hover {
            background-color: hsl(205, 20%, 32%);
        }

        .immersive-translate-action-btn {
            background-color: transparent;
            color: #ea4c89;
            border: 1px solid #ea4c89;
        }

        .immersive-translate-btn svg {
            margin-right: 5px;
        }

        .immersive-translate-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #007bff;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-primary-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #ea4c89;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-modal input[type="radio"] {
            margin: 0 6px;
            cursor: pointer;
        }

        .immersive-translate-modal label {
            cursor: pointer;
        }

        .immersive-translate-close-action {
            position: absolute;
            top: 2px;
            right: 0px;
            cursor: pointer;
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5) !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 16px !important;
        }

        .imt-image-status img,
        .imt-image-status svg,
        .imt-img-loading {
            width: 28px !important;
            height: 28px !important;
            margin: 0 0 8px 0 !important;
            min-height: 28px !important;
            min-width: 28px !important;
            position: relative !important;
        }

        .imt-img-loading {
            background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAtFBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////oK74hAAAAPHRSTlMABBMIDyQXHwyBfFdDMSw+OjXCb+5RG51IvV/k0rOqlGRM6KKMhdvNyZBz9MaupmxpWyj437iYd/yJVNZeuUC7AAACt0lEQVRIx53T2XKiUBCA4QYOiyCbiAsuuGBcYtxiYtT3f6/pbqoYHVFO5r+iivpo6DpAWYpqeoFfr9f90DsYAuRSWkFnPO50OgR9PwiCUFcl2GEcx+N/YBh6pvKaefHlUgZd1zVe0NbYcQjGBfzrPE8Xz8aF+71D8gG6DHFPpc4a7xFiCDuhaWgKgGIJQ3d5IMGDrpS4S5KgpIm+en9f6PlAhKby4JwEIxlYJV9h5k5nee9GoxHJ2IDSNB0dwdad1NAxDJ/uXDHYmebdk4PdbkS58CIVHdYSUHTYYRWOJblWSyu2lmy3KNFVJNBhxcuGW4YBVCbYGRZwIooipHsNqjM4FbgOQqQqSKQQU9V8xmi1QlgHqQQ6DDBvRUVCDirs+EzGDGOQTCATgtYTnbCVLgsVgRE0T1QE0qHCFAht2z6dLvJQs3Lo2FQoDxWNUiBhaP4eRgwNkI+dAjVOA/kUrIDwf3CG8NfNOE0eiFotSuo+rBiq8tD9oY4Qzc6YJw99hl1wzpQvD7ef2M8QgnOGJfJw+EltQc+oX2yn907QB22WZcvlUpd143dqQu+8pCJZuGE4xCuPXJqqcs5sNpsI93Rmzym1k4Npk+oD1SH3/a3LOK/JpUBpWfqNySxWzCfNCUITuDG5dtuphrUJ1myeIE9bIsPiKrfqTai5WZxbhtNphYx6GEIHihyGFTI69lje/rxajdh0s0msZ0zYxyPLhYCb1CyHm9Qsd2H37Y3lugVwL9kNh8Ot8cha6fUNQ8nuXi5z9/ExsAO4zQrb/ev1yrCB7lGyQzgYDGuxq1toDN/JGvN+HyWNHKB7zEoK+PX11e12G431erGYzwmytAWU56fkMHY5JJnDRR2eZji3AwtIcrEV8Cojat/BdQ7XOwGV1e1hDjGGjXbdArm8uJZtCH5MbcctVX8A1WpqumJHwckAAAAASUVORK5CYII=");
            background-size: 28px 28px;
            animation: image-loading-rotate 1s linear infinite !important;
        }

        .imt-image-status span {
            color: var(--bg-2, #fff) !important;
            font-size: 14px !important;
            line-height: 14px !important;
            font-weight: 500 !important;
            font-family: "PingFang SC", Arial, sans-serif !important;
        }

        @keyframes image-loading-rotate {
            from {
                transform: rotate(360deg);
            }

            to {
                transform: rotate(0deg);
            }
        }
    </style>
    <style data-id="immersive-translate-default-injected-css">
        :root {
            --immersive-translate-theme-underline-borderColor: #72ece9;
            --immersive-translate-theme-nativeUnderline-borderColor: #72ece9;
            --immersive-translate-theme-nativeDashed-borderColor: #72ece9;
            --immersive-translate-theme-nativeDotted-borderColor: #72ece9;
            --immersive-translate-theme-highlight-backgroundColor: #ffff00;
            --immersive-translate-theme-dashed-borderColor: #59c1bd;
            --immersive-translate-theme-blockquote-borderColor: #cc3355;
            --immersive-translate-theme-thinDashed-borderColor: #ff374f;
            --immersive-translate-theme-dashedBorder-borderColor: #94a3b8;
            --immersive-translate-theme-dashedBorder-borderRadius: 0;
            --immersive-translate-theme-solidBorder-borderColor: #94a3b8;
            --immersive-translate-theme-solidBorder-borderRadius: 0;
            --immersive-translate-theme-dotted-borderColor: #94a3b8;
            --immersive-translate-theme-wavy-borderColor: #72ece9;
            --immersive-translate-theme-dividingLine-borderColor: #94a3b8;
            --immersive-translate-theme-grey-textColor: #2f4f4f;
            --immersive-translate-theme-marker-backgroundColor: #fbda41;
            --immersive-translate-theme-marker-backgroundColor-rgb: 251, 218, 65;
            --immersive-translate-theme-marker2-backgroundColor: #ffff00;
            --immersive-translate-theme-background-backgroundColor: #dbafaf;
            --immersive-translate-theme-background-backgroundColor-rgb: 219, 175, 175;
            --immersive-translate-theme-background-backgroundOpacity: 12;
            --immersive-translate-theme-opacity-opacity: 10;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pre-whitespace {
            white-space: pre-wrap !important;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container {
            position: absolute;
            background-color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
                sans-serif;
            top: 0;
            width: 600px;
            height: 100%;
            z-index: 2;
            line-height: 1.3;
            font-size: 16px;
        }

        [imt-state="dual"] .immersive-translate-target-wrapper[dir="rtl"] {
            text-align: right;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper {
            color: rgb(0, 0, 0);
            white-space: normal;
            position: absolute;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper font {
            color: inherit;
            white-space: inherit;
            position: unset;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper &gt;

        br {
            display: none;
        }

        [imt-state="translation"] .immersive-translate-target-translation-block-wrapper {
            margin: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper {
            margin: 8px 0 !important;
            display: inline-block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            display: block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            margin-top: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pdf-block-wrapper {
            margin: 0 !important;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-grey-inner {
            color: var(--immersive-translate-theme-grey-textColor);
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-underline-inner {
            border-bottom: 1px solid var(--immersive-translate-theme-underline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeUnderline-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeUnderline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDashed-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDashed-borderColor) !important;
            text-decoration-style: dashed !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-thinDashed-inner {
            border-bottom: 1px dashed var(--immersive-translate-theme-thinDashed-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dotted-inner {
            background-image: linear-gradient(to right,
                    var(--immersive-translate-theme-dotted-borderColor) 30%,
                    rgba(255, 255, 255, 0) 0%);
            background-position: bottom;
            background-size: 5px 1px;
            background-repeat: repeat-x;
            padding-bottom: 3px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDotted-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDotted-borderColor) !important;
            text-decoration-style: dotted !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-wavy-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-wavy-borderColor) !important;
            text-decoration-style: wavy !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dashed-inner {
            background: linear-gradient(to right,
                    var(--immersive-translate-theme-dashed-borderColor) 0%,
                    var(--immersive-translate-theme-dashed-borderColor) 50%,
                    transparent 50%,
                    transparent 100%) repeat-x left bottom;
            background-size: 8px 2px;
            padding-bottom: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            content: "";
            display: block;
            max-width: 80px;
            width: 10%;
            border-top: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            padding-top: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dividingLine::before {
            content: "";
            border-left: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            max-height: 16px;
            height: 16px;
            padding-left: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-highlight-inner {
            background: var(--immersive-translate-theme-highlight-backgroundColor);
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-marker {
            line-height: 1.5em;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker2-inner {
            font-weight: bold;
            text-shadow: 10px 0px 3px var(--immersive-translate-theme-marker2-backgroundColor),
                16px 3px 9px var(--immersive-translate-theme-marker2-backgroundColor),
                2px 0px 6px var(--immersive-translate-theme-marker2-backgroundColor),
                -12px 0px 12px var(--immersive-translate-theme-marker2-backgroundColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker-inner {
            /* TODO: add more texture */
            background: linear-gradient(to right,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.1),
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 3%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 35%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 70%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.8) 95%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.3));
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-weakening {
            opacity: 0.618 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-italic {
            font-style: italic !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-bold {
            font-weight: bold !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-paper {
            margin: 8px 0;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
            padding: 16px 32px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-blockquote {
            border-left: 4px solid var(--immersive-translate-theme-blockquote-borderColor) !important;
            padding-left: 12px !important;
            margin-top: 4px;
            margin-bottom: 4px;
            padding-top: 4px;
            padding-bottom: 4px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-mask-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        /* opacity theme start */

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner,
        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: none !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        /* opacity theme end */

        /* background theme start */
        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-background {
            margin: 8px 0;
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            border-radius: 4px;
            box-shadow: unset !important;
            padding: 12px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-background-inner {
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            padding-left: 6px;
            padding-right: 6px;
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper .immersive-translate-target-translation-theme-background-inner {
            background: unset;
            padding-left: unset;
            padding-right: unset;
        }

        /* background theme end */

        /* vertical css , please remain it in the last one. */
        .immersive-translate-target-translation-vertical-block-wrapper {
            margin: 0px 8px !important;
        }

        .immersive-translate-text {
            font-size: 15px !important;
        }

        .immersive-translate-error-toast {
            position: fixed;
            top: 5%;
            z-index: 99999999;
            left: 0;
            right: 0;
            margin: auto;
            max-width: 300px;
            padding: 16px;
            border-radius: 12px;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        @media all and (min-width: 750px) {
            .immersive-translate-error-toast {
                max-width: 400px;
            }
        }

        .immersive-translate-clickable-button {
            cursor: pointer;
        }

        .immersive-translate-help-button {
            cursor: pointer;
        }

        .immersive-translate-loading-text:before {
            content: "...";
        }

        /* dark mode for loading */

        @media only screen and (prefers-color-scheme: dark) {
            .immersive-translate-loading {
                border: 2px rgba(255, 255, 255, 0.25) solid !important;
                border-top: 2px rgba(255, 255, 255, 1) solid !important;
            }
        }

        .immersive-translate-error-wrapper {
            position: relative;
            display: inline-flex;
            padding: 6px;
            margin: 0 12px;
            white-space: nowrap;
            font-size: 0.9em;
        }

        [lang="zh-CN"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        [lang="zh-TW"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        .immersive-translate-tooltip {
            position: relative;
            display: inline-flex;
            /* little indicater to indicate it's hoverable */
        }

        .immersive-translate-tooltip-content {
            /* here's the magic */
            position: absolute;
            z-index: 100000000000;

            left: 50%;
            bottom: 0;
            transform: translate(-50%, 110%);
            line-height: 1;
            /* and add a small left margin */

            /* basic styles */
            width: max-content;
            max-width: 250px;
            word-wrap: break-word;
            white-space: pre-line;
            padding: 10px;
            border-radius: 10px;
            background: #000c;
            color: #fff;
            text-align: center;
            font-size: 14px;
            display: none;
            /* hide by default */
        }

        .immersive-translate-tooltip:hover .immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip:hover+.immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip-content-table {
            left: unset !important;
            bottom: unset !important;
            transform: translate(-10%, 50%) !important;
        }

        .immersive-translate-tooltip:hover:before {
            display: inline-block;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--bg-2, #fff);
            font-size: 14px;
        }
    </style>
    <style data-id="immersive-translate-user-custom-style">
        :root {

            .immersive-translate-target-inner {
                font-family: inherit;
            }


            .immersive-translate-target-inner {
                font-family: inherit;
            }
        }
    </style>
    <style data-id="immersive-translate-dynamic-injected-css">
        .immersive-translate-target-wrapper[dir='rtl'] {
            text-align: right;
        }

        .immersive-translate-target-wrapper[dir='rtl'] [data-immersive-translate-class-bak*='block-wrapper'] {
            display: block;
        }

        .immersive-translate-target-wrapper {
            word-break: break-word;
            user-select: text;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper[dir='rtl'] {
            display: inline-block;
        }

        [dir='rtl'] .immersive-translate-target-wrapper:not([dir]) {
            text-align: left;
        }

        [imt-state=dual] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            display: block;
        }

        [imt-trans-position=before] .immersive-translate-target-translation-block-wrapper {
            display: block !important;
        }

        [imt-state][data-immersive-translate_rtl] .immersive-translate-target-wrapper {
            display: block !important;
        }
    </style>
</head>

<body epub:type="bodymatter" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
    <section aria-labelledby="c20_1" epub:type="chapter" role="doc-chapter"
        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
        <header data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
            <h1 id="c20_1" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1"><span aria-label="558" epub:type="pagebreak" id="Page_558"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span><span id="c20"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span><span
                    class="chapterNumber"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">20</span><br /><span
                    class="chapterTitle"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Security</span></h1>
        </header>
        <section aria-label="chapter opening" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
            <span id="c20-sec-0001" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
            <aside data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                <div class="top hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <h3 data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                        data-immersive-translate-paragraph="1">WHAT'S IN THIS CHAPTER?<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章包含什么内容？</font>
                            </font>
                        </font>
                    </h3>
                    <ul class="check2" id="c20-list-0001"
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <li id="c20-li-0001" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Working with authentication and authorization<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">处理认证和授权</font>
                                </font>
                            </font>
                        </li>
                        <li id="c20-li-0002" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Creating and verifying signatures<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">创建和验证签名</font>
                                </font>
                            </font>
                        </li>
                        <li id="c20-li-0003" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Implementing secure data exchange<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">实现安全数据交换</font>
                                </font>
                            </font>
                        </li>
                        <li id="c20-li-0004" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Using signing and hashing<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用签名和哈希</font>
                                </font>
                            </font>
                        </li>
                        <li id="c20-li-0005" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Handling web security<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">处理网络安全</font>
                                </font>
                            </font>
                        </li>
                    </ul>
                    <div class="bottom hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <hr />
                    </div>
                </section>
            </aside>
            <aside data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                <div class="top hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><span
                        id="c20-fea-0001" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
                    <h3 id="head-2-185" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                        data-immersive-translate-paragraph="1">CODE DOWNLOADS FOR THIS CHAPTER<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章代码下载</font>
                            </font>
                        </font>
                    </h3>
                    <section data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><span
                            id="c20-sec-0003"
                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
                        <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">The source code for this chapter is available on the
                            book page at <code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="http://www.wiley.com">www.wiley.com</a></code>.
                            Click the Downloads link. The code can also be found at <code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                            in the folder <code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">2_Libs/Security</code>.
                            The code for this chapter is divided into the following major examples:<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的源代码可在书籍页面 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="http://www.wiley.com">www.wiley.com</a></code>
                                        上获取。点击下载链接。代码也可以在 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                                        的 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">2_Libs/Security</code>
                                        文件夹中找到。本章的代码分为以下主要示例：</font>
                                </font>
                            </font>
                        </p>
                        <ul class="check" id="c20-list-0002"
                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                            <li id="c20-li-0006" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                                data-immersive-translate-paragraph="1">IdentitySample</li>
                            <li id="c20-li-0007" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                                data-immersive-translate-paragraph="1">WebAppWithADSample</li>
                            <li id="c20-li-0008" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                                data-immersive-translate-paragraph="1">X509CertificateSample</li>
                            <li id="c20-li-0009" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                                data-immersive-translate-paragraph="1">SigningDemo</li>
                            <li id="c20-li-0010" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                                data-immersive-translate-paragraph="1">SecureTransfer</li>
                            <li id="c20-li-0011" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                                data-immersive-translate-paragraph="1">ASPNETCoreMVCSecurity</li>
                        </ul>
                        <p id="c20-para-0004" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Samples from this chapter mainly use the namespace
                            <code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">System.Security.Cryptography</code>.
                            All the sample projects have <i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">nullable
                                reference types</i> enabled.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的示例主要使用命名空间 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">System.Security.Cryptography</code>
                                        。所有示例项目都启用了可空引用类型。</font>
                                </font>
                            </font>
                        </p>
                    </section>
                    <div class="bottom hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <hr />
                    </div>
                </section>
            </aside>
        </section> <span aria-label="559" epub:type="pagebreak" id="Page_559" role="doc-pagebreak"
            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
        <section aria-labelledby="head-2-186" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
            <span id="c20-sec-0004" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
            <h2 id="head-2-186" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">ELEMENTS OF SECURITY<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">安全要素</font>
                    </font>
                </font>
            </h2>
            <p id="c20-para-0005" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">Security has several key elements that you need to consider for
                making your applications secure. The primary one, of course, is the user of the application. Is the
                person authorized to access the application or someone posing as that person? How can this user be
                trusted? As you see in this chapter, ensuring the security of an application regarding the user is a
                two-part process. First, users need to be authenticated, and then they need to be authorized to verify
                that they are allowed to use the requested resources.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            安全有几个关键要素需要考虑以确保您的应用程序安全。当然，最重要的是应用程序的用户。这个人是否有权访问应用程序，还是冒充该人的人？如何信任这个用户？如您在本章中看到的，确保应用程序关于用户的安全是一个两步过程。首先，用户需要通过身份验证，然后需要授权来验证他们是否有权使用请求的资源。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0006" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">What about data that is stored or sent across the network? Is it
                possible for someone to access this data, for example, by using a network sniffer? Encryption of data is
                important in this regard. If you use HTTPS (which nearly all websites use today), keys are used to
                encrypt the data. You just need to install a certificate containing public and private keys on the
                server. If you use Microsoft Azure, encryption is done for the data in transit (sending it across), as
                well as for the data at rest (when data is stored). With many services, you can supply your own
                encryption key; otherwise, an encryption key is created from Azure.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            那么存储或通过网络发送的数据呢？是否有可能有人访问这些数据，例如，通过使用网络嗅探器？在这方面，数据加密很重要。如果您使用
                            HTTPS（今天几乎所有的网站都在使用），则使用密钥来加密数据。您只需要在服务器上安装一个包含公钥和私钥的证书。如果您使用 Microsoft
                            Azure，则对传输中的数据（发送数据时）以及静态数据（数据存储时）进行加密。对于许多服务，您可以提供自己的加密密钥；否则，Azure 会创建一个加密密钥。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0007" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">This chapter explores the features available in .NET to help you
                manage security and demonstrates how .NET protects you from malicious code, how to administer security
                policies, and how to access the security subsystem programmatically.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本章探讨了.NET 中可用于管理安全的功能，并演示了.NET
                            如何保护您免受恶意代码的侵害，如何管理安全策略，以及如何以编程方式访问安全子系统。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0008" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">You can also read about the issues you need to be aware of when
                making web applications secure.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">您还可以了解在使 Web 应用程序安全时需要注意的问题。</font>
                    </font>
                </font>
            </p>
        </section>
        <section aria-labelledby="head-2-187" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
            <span id="c20-sec-0005" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
            <h2 id="head-2-187" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">VERIFYING USER INFORMATION<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">验证用户信息</font>
                    </font>
                </font>
            </h2>
            <p id="c20-para-0009" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">Two fundamental pillars of security are authentication and
                authorization. <i
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Authentication</i> is the
                process of identifying the user, and <i
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">authorization</i> occurs
                afterward to verify that the identified user is allowed to access a specific resource. This section
                shows how to get information about users and get a token that in turn can be used to authenticate the
                user calling a REST service.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            安全性的两个基本支柱是身份验证和授权。身份验证是识别用户的过程，授权随后发生以验证已识别的用户是否有权访问特定资源。本节展示了如何获取有关用户的信息，并获取一个令牌，该令牌反过来可以用于验证调用
                            REST 服务的用户。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0010" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">The sample application makes use of an Azure Active Directory.
                With an Azure subscription, you also have an Azure Active Directory. With an Azure subscription, you can
                use your default Azure Active Directory to run the first sample application. You can also create a new
                Azure Active Directory or modify the sample application slightly to access your on-premises directory
                services.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">示例应用程序使用了 Azure Active Directory。拥有
                            Azure 订阅，您也拥有 Azure Active Directory。通过 Azure 订阅，您可以使用默认的 Azure Active Directory
                            来运行第一个示例应用程序。您也可以创建一个新的 Azure Active Directory，或稍微修改示例应用程序以访问您本地的目录服务。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><span id="c20-sec-0006"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
                <h3 id="head-3-378" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Working with the Microsoft Identity Platform <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 Microsoft 身份平台</font>
                        </font>
                    </font>
                </h3>
                <p id="c20-para-0011" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">You can identify the user running the application by using an
                    <i data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">identity</i>. The
                    landscape of identities has become complex in recent years. Some years ago, we just had to deal with
                    Windows users, users coming from the on-premises Active Directory, or local users on the Windows
                    system. Today, this is a lot more complex; we have to deal with users from the Azure Active
                    Directory (which also includes Office 365 users), identities from users on mobile devices, and users
                    with accounts verified by Microsoft, Facebook, Google, Twitter, and other providers.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                您可以通过使用身份来识别运行应用程序的用户。近年来，身份领域变得复杂起来。几年前，我们只需要处理 Windows 用户、来自本地 Active Directory 的用户或
                                Windows 系统上的本地用户。如今，情况变得更加复杂；我们需要处理来自 Azure Active Directory（这也包括 Office 365
                                用户）、来自移动设备用户的身份，以及由 Microsoft、Facebook、Google、Twitter 和其他提供商验证账户的用户。</font>
                        </font>
                    </font>
                </p>
                <p id="c20-para-0012" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">To make programming easier, Microsoft created the Microsoft
                    identity platform. With this platform, we have users in Office 365 and Microsoft Azure who use
                    Microsoft Azure Active Directory (AD). With Azure AD business-to-business (B2B), different
                    organizations can share resources with other organizations using Azure AD. Azure AD
                    business-to-consumer (B2C) is an extension of Azure AD in which users can register themselves to
                    create a new account in the AD and keep their passwords managed from other providers using a
                    Microsoft, Gmail, Facebook, or Twitter account—or any other account that uses OAuth or OpenID
                    Connect.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了简化编程，微软创建了微软身份平台。通过这个平台，我们在
                                Office 365 和 Microsoft Azure 中的用户使用微软 Azure 活动目录（AD）。Azure AD 企业对企业（B2B）允许不同组织通过 Azure
                                AD 共享资源。Azure AD 企业对消费者（B2C）是 Azure AD 的扩展，用户可以自行注册在 AD 中创建新账户，并使用
                                Microsoft、Gmail、Facebook 或 Twitter 账户（或任何使用 OAuth 或 OpenID Connect 的其他账户）来管理密码。</font>
                        </font>
                    </font>
                </p>
                <p id="c20-para-0013" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Important parts of the Microsoft identity platform are users,
                    resources, and policies. Users want to access a resource—for example, your web application—or use an
                    application that's accessing your API. How the user should be allowed to access the resources is
                    specified by a policy. Because users access resources from different networks using different
                    devices, policies have become very complex. Microsoft identity supports complex and dynamic
                    policies. These can be different, for example, if the user is on a trusted corporate network using a
                    company laptop or the same user is accessing the same resource from a different network on a
                    different device.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">Microsoft
                                身份平台的重要部分包括用户、资源和策略。用户希望访问资源——例如，您的 Web 应用程序——或使用正在访问您的 API
                                的应用程序。用户如何被允许访问资源是由策略指定的。由于用户使用不同的设备从不同的网络访问资源，策略变得非常复杂。Microsoft
                                身份支持复杂和动态的策略。这些策略可以不同，例如，如果用户在受信任的企业网络上使用公司笔记本电脑，或者相同的用户在不同的设备上从不同的网络访问相同的资源。</font>
                        </font>
                    </font>
                </p>
                <p id="c20-para-0014" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1"><span aria-label="560" epub:type="pagebreak" id="Page_560"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>To authenticate
                    the user, you can use the OpenID Connect authentication protocol. OpenID Connect extends the OAuth
                    2.0 authorization protocol. After getting an ID token from an authentication server, this token can
                    be used to request an access token. With the access token, the user can access a resource that's
                    secured by an authorization server.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了验证用户，您可以使用 OpenID Connect
                                认证协议。OpenID Connect 扩展了 OAuth 2.0 授权协议。在从认证服务器获取 ID
                                令牌后，此令牌可用于请求访问令牌。使用访问令牌，用户可以访问由授权服务器保护的资源。</font>
                        </font>
                    </font>
                </p>
            </section>
            <section data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><span id="c20-sec-0007"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
                <h3 id="head-3-379" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Using Microsoft.Identity.Client <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 Microsoft.Identity.Client
                            </font>
                        </font>
                    </font>
                </h3>
                <p id="c20-para-0015" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Let's create a simple console application that authenticates
                    the user against the Azure AD and displays information about the user. The application references
                    the NuGet packages <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Extensions.Hosting</code>
                    and <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Identity.Client</code>.
                    Before creating the application, you need to register it with Azure AD. When configuring the app
                    registration, you need to define the name, the account types, and the redirect URI. With a client
                    application, you can configure the link <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="http://localhost">http://localhost</a></code>,
                    and you need to specify the same link with the client configuration. With the application
                    configuration, you can also configure API permissions that the application is using (if the user
                    grants the permissions). By default, the API permission <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">User.Read</code> is
                    specified; this allows the application to sign in on behalf of the user and read the user's profile.
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Openid</code>
                    permissions with the names <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">email</code>, <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">offline_access</code>,
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">openid</code>, and
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">profile</code> are
                    granted as well.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                让我们创建一个简单的控制台应用程序，用于验证用户身份并显示用户信息。该应用程序引用了 NuGet 包 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Extensions.Hosting</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Identity.Client</code>
                                。在创建应用程序之前，您需要将其注册到 Azure AD。在配置应用程序注册时，您需要定义名称、账户类型和重定向 URI。对于客户端应用程序，您可以配置链接 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="http://localhost">http://localhost</a></code>
                                ，并且需要在客户端配置中指定相同的链接。通过应用程序配置，您还可以配置应用程序正在使用的 API 权限（如果用户授予权限）。默认情况下，指定了 API 权限 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">User.Read</code>
                                ；这允许应用程序代表用户登录并读取用户资料。同时，还授予了名称为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">email</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">offline_access</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">openid</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">profile</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Openid</code>
                                权限。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">You can add additional permissions—for example, to use
                    Microsoft Graph and to use your own APIs. (You can read about creating and using API permissions for
                    your services in <a href="c25.xhtml"
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Chapter 25</a>,
                    “Services.”) From the app registration, you need to copy the application (client) ID and the
                    directory (tenant) ID. When using the Azure CLI, you can find the app ID by passing the name of the
                    app with the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">--display-name</code>
                    argument and querying for the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">appId</code> element in
                    the array of applications returned, as shown here:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">你可以添加额外的权限，例如使用 Microsoft Graph
                                和使用你自己的 API。（你可以在第 25 章“服务”中阅读有关为你的服务创建和使用 API 权限的信息。）从应用注册中，你需要复制应用（客户端）ID
                                和目录（租户）ID。在使用 Azure CLI 时，你可以通过使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">--display-name</code>
                                参数传递应用名称并查询返回的应用数组中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">appId</code>
                                元素来找到应用 ID，如下所示：</font>
                        </font>
                    </font>
                </p>
                <pre
                    id="c20-code-0001"><code>&gt; az app list --display-name ProCSharpIdentityApp --query [].appId</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">The tenant ID is shown using <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">az account</code>, like
                    so:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">租户 ID 使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">az account</code>
                                显示，如下所示：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0002"><code>&gt; az account show --query tenantId</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">You can use the command line, with the current directory of
                    your project, to configure the user secrets <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">TenantId</code> and <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ClientId</code>. With
                    this setting, the configuration is read from the application while it's running in your development
                    environment:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">你可以使用命令行，并使用你项目的当前目录，来配置用户密钥 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">TenantId</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ClientId</code>
                                。使用此设置，配置会在应用在开发环境中运行时从应用中读取：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0003"><code>&gt; dotnet user-secrets init</code>
<code>&gt; dotnet user-secrets set TenantId &lt;enter-your-tenant-id&gt;</code>
<code>&gt; dotnet user-secrets set ClientId &lt;enter-your-client-id&gt;</code></pre>
                <aside data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <div class="top hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <p id="c20-para-0020" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">NOTE</b> <i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Configuration,
                                user secrets, and dependency injection are covered in <a href="c15.xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Chapter
                                    15</a>, “Dependency Injection and Configuration.”</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：配置、用户密钥和依赖注入在第 15
                                        章“依赖注入和配置”中进行了介绍。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p id="c20-para-0021" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">With the following sample application, the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Runner</code> class is
                    configured with the dependency injection container. To have the user secrets automatically
                    configured with the DI container, you set the environmental variable <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">DOTNET_ENVIRONMENT</code>
                    to <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Development</code>.
                    Because the dependency injection container is configured using the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CreateDefaultBuilder</code>
                    method, the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">IConfiguration</code> and
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ILogger</code>
                    interfaces can be injected with the constructor of the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Runner</code> class. The
                    client ID and tenant ID are retrieved from the configuration. The <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Init</code> method of the
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Runner</code> class
                    uses the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">PublicClientApplicationBuilder</code>
                    to create the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">PublicClientApplication</code>,
                    which can be used to log in and retrieve the ID and access tokens. The client ID is passed to the
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Create</code> method,
                    and the tenant ID is passed to the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WithAuthority</code>
                    method.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">通过以下示例应用程序， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Runner</code>
                                类被配置为依赖注入容器。要使用户密钥自动配置到依赖注入容器中，您需要将环境变量 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">DOTNET_ENVIRONMENT</code>
                                设置为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Development</code>
                                。由于依赖注入容器是使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CreateDefaultBuilder</code>
                                方法配置的，因此 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">IConfiguration</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ILogger</code>
                                接口可以通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Runner</code>
                                类的构造函数进行注入。客户端 ID 和租户 ID 从配置中获取。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Runner</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Init</code>
                                方法使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">PublicClientApplicationBuilder</code>
                                创建 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">PublicClientApplication</code>
                                ，该对象可用于登录并获取 ID 和访问令牌。客户端 ID 被传递给 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Create</code>
                                方法，租户 ID 被传递给 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WithAuthority</code>
                                方法。</font>
                        </font>
                    </font>
                </p>
                <p id="c20-para-0022" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">To use Azure Active Directory, the cloud instance is
                    specified with <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AzureCloudInstance.AzurePublic</code>.
                    For the U.S. government, Azure China, and the sovereign versions of Germany, different enum values
                    need to be specified. The <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WithRedirectUri</code>
                    method needs to be configured with the link that's specified as a redirect URI with the app
                    registration.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要使用 Azure Active Directory，云实例需指定为
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AzureCloudInstance.AzurePublic</code>
                                。对于美国政府、Azure 中国以及德国的本地化版本，需要指定不同的枚举值。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WithRedirectUri</code>
                                方法需要配置为应用注册时指定的重定向 URI 链接。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1"><span aria-label="561" epub:type="pagebreak" id="Page_561"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>To help you
                    identify issues and understand the communication going on, the Microsoft Identity platform offers
                    rich logging information that you can enable using the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WithLogging</code> method
                    (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">IdentitySample/Runner.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了帮助您识别问题并理解正在进行的通信，Microsoft
                                Identity 平台提供了丰富的日志信息，您可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WithLogging</code>
                                方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">IdentitySample/Runner.cs</code>
                                ）启用这些信息：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0004"><code>using Microsoft.Extensions.Configuration;</code>
<code>using Microsoft.Extensions.Logging;</code>
<code>using System;</code>
<code>using System.Linq;</code>
<code>using System.Threading.Tasks;</code>
<code><b>using Id = Microsoft.Identity.Client;</b></code>
<code> </code>
<code>//…</code>
<code> </code>
<code>class Runner</code>
<code>{</code>
<code>  private readonly string _clientId;</code>
<code>  private readonly string _tenantId;</code>
<code>  private Id.IPublicClientApplication? _clientApp;</code>
<code>  private readonly ILogger _logger;</code>
<code> </code>
<code>  public Runner(IConfiguration configuration, ILogger&lt;Runner&gt; logger)</code>
<code>  {</code>
<code>    _clientId = configuration["ClientId"] </code>
<code>      ?? throw new InvalidOperationException("Configure a ClientId");</code>
<code>    _tenantId = configuration["TenantId"] </code>
<code>      ?? throw new InvalidOperationException("Configure a TenantId");</code>
<code>    _logger = logger;</code>
<code>  }</code>
<code> </code>
<code>  public void Init()</code>
<code>  {</code>
<code>    void LogCallback(Id.LogLevel level, string message, bool containsPii)</code>
<code>      =&gt; _logger.Log(level.ToLogLevel(), message);      </code>
<code> </code>
<code>    <b>_clientApp = Id.PublicClientApplicationBuilder</b></code>
<code>      <b>.Create(_clientId)</b></code>
<code>      <b>.WithLogging(LogCallback, logLevel: Id.LogLevel.Verbose)</b></code>
<code>      <b>.WithAuthority(Id.AzureCloudInstance.AzurePublic, _tenantId)</b></code>
<code>      <b>.WithRedirectUri("http://localhost")</b></code>
<code>      <b>.Build();</b></code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">To see logging information from Microsoft Identity, you can
                    specify a callback method with the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WithLogging</code>
                    method. This method is invoked with every log output. Microsoft Identity has its own logging
                    implementation and <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">LogLevel</code> enum
                    definition that are very different from Microsoft .NET logging. If you check the numbers used with
                    the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Extensions.Logging.LogLevel</code>
                    enum and the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Identity.Client.LogLevel</code>
                    enum, they are ordered in the reverse direction. To not get into conflict with the two definitions
                    when using both types, the alias ID in the sample application is defined to reference <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Identity.Client</code>.
                    With the extension method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ToLogLevel</code>, which
                    is shown in the following code snippet, the log level from <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Identity.Client</code>
                    is converted to the log level from <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Extensions.Logging</code>.
                    As different values are used with these enum types, a simple <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">switch</code> expression
                    is used to do the conversion. This extension method is invoked from the previously shown <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">LogCallback</code> method
                    (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">IdentitySample/Runner.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要查看 Microsoft Identity 的日志信息，您可以使用
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WithLogging</code>
                                方法指定一个回调方法。该方法会在每次日志输出时被调用。Microsoft Identity 拥有自己独立的日志实现和 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">LogLevel</code>
                                枚举定义，这些与 Microsoft .NET 日志非常不同。如果您检查 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Extensions.Logging.LogLevel</code>
                                枚举和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Identity.Client.LogLevel</code>
                                枚举中使用的数字，它们的顺序是相反的。为了在使用这两种类型时避免与这两个定义冲突，示例应用程序中的别名 ID 被定义为引用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Identity.Client</code>
                                。通过以下代码片段中显示的扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ToLogLevel</code>
                                ，将 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Identity.Client</code>
                                的日志级别转换为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Extensions.Logging</code>
                                的日志级别。由于这些枚举类型使用了不同的值，因此使用了一个简单的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">switch</code>
                                表达式来进行转换。这个扩展方法是从之前显示的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">LogCallback</code>
                                方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">IdentitySample/Runner.cs</code>
                                ）中调用的。</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0005"><code>internal static class IdentityLogLevelExtensions</code>
<code>{<span aria-label="562" epub:type="pagebreak" id="Page_562" role="doc-pagebreak"></span></code>
<code>  public static LogLevel ToLogLevel(this Id.LogLevel logLevel)</code>
<code>    =&gt; logLevel switch</code>
<code>    {</code>
<code>      Id.LogLevel.Error =&gt; LogLevel.Error,</code>
<code>      Id.LogLevel.Warning =&gt; LogLevel.Warning,</code>
<code>      Id.LogLevel.Info =&gt; LogLevel.Information,</code>
<code>      Id.LogLevel.Verbose =&gt; LogLevel.Trace,</code>
<code>      _ =&gt; throw new InvalidOperationException("unexpected log level")</code>
<code>    };</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">With the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">LogAsync</code> method
                    that's shown next, first, a check is done by invoking the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetAccountsAsync</code>
                    method to see whether accounts are already cached. If they are, a silent authentication can be done
                    without a need to ask the user for their login information by using the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenSilent</code>
                    method. If silent authentication does not return a token, login happens through an interactive login
                    that invokes the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenInteractive</code>
                    method. The scopes required by the application (and also configured with the app registration) are
                    specified in a string array and passed to the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenXX</code>
                    methods (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">IdentitySample/Runner.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用接下来展示的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">LogAsync</code>
                                方法，首先通过调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetAccountsAsync</code>
                                方法检查账户是否已经被缓存。如果是，则可以通过使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenSilent</code>
                                方法进行无声认证，无需询问用户登录信息。如果无声认证没有返回令牌，则通过调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenInteractive</code>
                                方法进行交互式登录。应用程序所需的范围（以及通过应用程序注册配置的范围）在字符串数组中指定，并传递给 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenXX</code>
                                方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">IdentitySample/Runner.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0006"><code>public async Task LoginAsync()</code>
<code>{</code>
<code>  if (_clientApp is null) throw new InvalidOperationException(</code>
<code>    "Invoke Init before calling this method");</code>
<code> </code>
<code>  try</code>
<code>  {</code>
<code>    <b>string[] scopes = { "user.read" };</b></code>
<code>    <b>var accounts = await _clientApp.GetAccountsAsync();</b></code>
<code>    var firstAccount = accounts.FirstOrDefault();</code>
<code>    if (firstAccount is not null)</code>
<code>    {</code>
<code>      Id.AuthenticationResult result = </code>
<code>        <b>await _clientApp.AcquireTokenSilent(scopes, firstAccount)</b></code>
<code>          <b>.ExecuteAsync();</b></code>
<code>      ShowAuthenticationResult(result);</code>
<code>    }</code>
<code>    else</code>
<code>    {</code>
<code>      <b>Id.AuthenticationResult result = await _clientApp.AcquireTokenInteractive(scopes)</b></code>
<code>        <b>.ExecuteAsync();</b></code>
<code>      ShowAuthenticationResult(result);</code>
<code>    }</code>
<code>  }</code>
<code>  catch (Exception ex)</code>
<code>  {</code>
<code>    _logger.LogError(ex, ex.Message);</code>
<code>    throw;</code>
<code>  }</code>
<code>}</code></pre>
                <p id="c20-para-0026" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Besides offering <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenSilent</code>
                    and <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenInteractive</code>,
                    the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">PublicClientApplication</code>
                    also offers logins with other mechanisms. A login via username/password is done with <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenByUsernamePassword</code>.
                    You can also use this class for Windows authentication and use <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenByIntegratedWindowsAuthentication</code>.
                    Another option is to log in by using a device code: <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenWithDeviceCode</code>.
                    This method can be used to log in on a device without a browser. When you invoke this method, a
                    device code is returned. The user enters this code on a device with a browser. After the user
                    successfully enters the code, access to the device is granted.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">除了提供 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenSilent</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenInteractive</code>
                                之外， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">PublicClientApplication</code>
                                还提供使用其他机制进行登录的功能。通过用户名/密码的登录是通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenByUsernamePassword</code>
                                完成的。你也可以使用这个类进行 Windows 认证并使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenByIntegratedWindowsAuthentication</code>
                                。另一个选项是使用设备码进行登录： <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AquireTokenWithDeviceCode</code>
                                。这种方法可用于在没有浏览器的设备上进行登录。当你调用这个方法时，会返回一个设备码。用户在带有浏览器的设备上输入这个代码。用户成功输入代码后，将获得设备访问权限。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1"><span aria-label="563" epub:type="pagebreak" id="Page_563"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>An ID token and
                    access token are retrieved with just one call. The <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ShowAuthenticationResult</code>
                    method uses <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AuthenticationResult</code>
                    and shows token and account information (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">IdentitySample/Runner.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">一个 ID 令牌和访问令牌通过一次调用即可检索。 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ShowAuthenticationResult</code>
                                方法使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AuthenticationResult</code>
                                并显示令牌和账户信息（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">IdentitySample/Runner.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0007"><code>private void ShowAuthenticationResult(Id.AuthenticationResult result)</code>
<code>{</code>
<code>  Console.WriteLine($"Id token: {result.IdToken[..20]}");</code>
<code>  Console.WriteLine($"Access token: {result.AccessToken[..20]}");</code>
<code>  Console.WriteLine($"Username: {result.Account.Username}");</code>
<code>  Console.WriteLine($"Environment: {result.Account.Environment}");</code>
<code>  Console.WriteLine($"Account Id: {result.Account.HomeAccountId}");</code>
<code>  foreach (var scope in result.Scopes)</code>
<code>  {</code>
<code>    Console.WriteLine($"scope: {scope}");</code>
<code>  }</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><span id="c20-sec-0009"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
                <h3 id="head-3-380" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Using Authentication and Authorization with a Web App <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 Web 应用的认证和授权</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Now that you've seen how to authenticate a user in a console
                    application, let's get into the .NET support for web applications.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">既然你已经看到了如何在控制台应用程序中认证用户，让我们来看看.NET
                                对 Web 应用的支持。</font>
                        </font>
                    </font>
                </p>
                <aside data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <div class="top hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <p id="c20-para-0029" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">NOTE</b> <i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">This section
                                makes use of ASP.NET Core and ASP.NET Core Razor Pages, which are covered in <a
                                    href="c24.xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Chapter
                                    24</a>, “ASP.NET Core,” and <a href="c26.xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Chapter
                                    26</a>, “Razor Pages and MVC.”</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 本节使用 ASP.NET Core 和
                                        ASP.NET Core Razor Pages，这些内容在“ASP.NET Core”第 24 章和“Razor Pages 和 MVC”第 26
                                        章中有介绍。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">When you create an ASP.NET Core application, you can create
                    the code needed for authentication with a template. If you use <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">dotnet new</code> with
                    the <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">--auth</code>
                    option to specify <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SingleOrg</code>, code is
                    created to log in with Microsoft Azure Active Directory:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当您创建一个 ASP.NET Core
                                应用程序时，您可以使用模板创建用于身份验证的代码。如果您使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">dotnet new</code>
                                与 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">--auth</code>
                                选项来指定 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SingleOrg</code>
                                ，则会创建用于使用 Microsoft Azure Active Directory 登录的代码：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0008"><code>&gt; dotnet new webapp --auth SingleOrg -o WebAppWithADSample</code></pre>
                <p id="c20-para-0031" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">With this template, the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddAuthentication</code>
                    method is used to configure the DI container. <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddAuthentication</code>
                    returns the authentication builder that is then used to invoke the method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddMicrosoftIdentityWeb</code>
                    to configure the Microsoft Identity platform for a web application.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用此模板，通过 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddAuthentication</code>
                                方法配置依赖注入容器。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddAuthentication</code>
                                返回身份验证构建器，然后使用它来调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddMicrosoftIdentityWeb</code>
                                方法，为 Web 应用程序配置 Microsoft Identity 平台。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Configuration values are retrieved from the section <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AzureAd</code> with the
                    configuration settings. After this, the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddAuthorization</code>
                    method configures the authorization. You'll change the implementation of this method later to define
                    requirements for the user by accessing specific pages. With the MVC builder that follows the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddMvcOptions</code>
                    method—
                    <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddMicrosoftIdentityUI</code>—user
                    interfaces for logging in are used from the Microsoft Identity platform (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WebAppWithADSample/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">配置值从配置设置中的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AzureAd</code>
                                部分获取。之后， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddAuthorization</code>
                                方法配置授权。稍后您将更改此方法的实现，以通过访问特定页面来定义用户的要求。在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddMvcOptions</code>
                                方法之后的 MVC 构建器— <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddMicrosoftIdentityUI</code>
                                —中，使用来自 Microsoft Identity 平台的登录界面（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WebAppWithADSample/Startup.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0009"><code>public void ConfigureServices(IServiceCollection services)</code>
<code>{</code>
<code>  services.AddAuthentication(OpenIdConnectDefaults.AuthenticationScheme)</code>
<code>    .AddMicrosoftIdentityWebApp(Configuration.GetSection("AzureAd"));</code>
<code> </code>
<code>  services.AddAuthorization(options =&gt;</code>
<code>  {</code>
<code>    options.FallbackPolicy = options.DefaultPolicy;</code>
<code>  });</code>
<code>  services.AddRazorPages()</code>
<code>    .AddMvcOptions(options =&gt; {})</code>
<code>    .AddMicrosoftIdentityUI();</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1"><span aria-label="564" epub:type="pagebreak" id="Page_564"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>The configuration
                    specified with the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AzureAd</code> section is
                    added to the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">appsettings.json</code>
                    configuration file. You can add the domain, tenant ID, and client ID to this file. This time,
                    because it's a web application, you need to register it with the redirect URI <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://localhost:5001/signin-oidc">https://localhost:5001/signin-oidc</a></code>
                    when using the default port running this application locally with the Kestrel server. To run the
                    application on a different URL, you then need to adapt this URI accordingly (config file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WebAppWithADSample/appsettings.json</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AzureAd</code>
                                部分指定的配置被添加到 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">appsettings.json</code>
                                配置文件中。你可以将域名、租户 ID 和客户端 ID 添加到这个文件中。这次，因为这是一个 Web 应用程序，当你在本地使用 Kestrel
                                服务器以默认端口运行这个应用程序时，需要使用重定向 URI <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://localhost:5001/signin-oidc">https://localhost:5001/signin-oidc</a></code>
                                进行注册。然后，如果你要在不同的 URL 上运行应用程序，你需要相应地调整这个 URI（配置文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WebAppWithADSample/appsettings.json</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0010"><code>{</code>
<code>  "AzureAd": {</code>
<code>    "Instance": "https://login.microsoftonline.com/",</code>
<code>    "Domain": "qualified.domain.name",</code>
<code>    "TenantId": "22222222-2222-2222-2222-222222222222",</code>
<code>    "ClientId": "11111111-1111-1111-11111111111111111",</code>
<code>    "CallbackPath": "/signin-oidc"</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">With the configuration of the middleware, <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">UseAuthentication</code>
                    and <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">UseAuthorization</code>
                    are invoked to support authentication and authorization (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WebAppWithADSample/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在中间件的配置中， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">UseAuthentication</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">UseAuthorization</code>
                                被调用以支持身份验证和授权（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WebAppWithADSample/Startup.cs</code>
                                ）。</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0011"><code>public void Configure(IApplicationBuilder app, IWebHostEnvironment env)</code>
<code>{</code>
<code>  if (env.IsDevelopment())</code>
<code>  {</code>
<code>    app.UseDeveloperExceptionPage();</code>
<code>  }</code>
<code>  else</code>
<code>  {</code>
<code>    app.UseExceptionHandler("/Error");</code>
<code>    app.UseHsts();</code>
<code>  }</code>
<code> </code>
<code>  app.UseHttpsRedirection();</code>
<code>  app.UseStaticFiles();</code>
<code> </code>
<code>  app.UseRouting();</code>
<code> </code>
<code>  <b>app.UseAuthentication();</b></code>
<code>  <b>app.UseAuthorization();</b></code>
<code> </code>
<code>  app.UseEndpoints(endpoints =&gt;</code>
<code>  {</code>
<code>    endpoints.MapRazorPages();</code>
<code>    endpoints.MapControllers();</code>
<code>  });</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">With the default policy configured, authentication is
                    required. Without this policy, you can apply the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Authorize</code>
                    attribute to classes and methods—for example, the class of a Razor page, an MVC controller, or an
                    MVC action method. To override the authorization requirement, you can apply the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AllowAnonymous</code>
                    attribute. In the following code snippet, the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Authorize</code>
                    attribute is applied to the code-behind file of the Razor page <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">UserInfo</code>. Because
                    the user is authorized, user information can be accessed. With the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">OnGet</code> method that
                    is invoked with an HTTP GET request to this page, user information is accessed; the name of the user
                    and the claims delivered as part of the token are assigned to the properties <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">UserName</code> and <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ClaimsInformation</code>.
                    The property <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ClaimsInformation</code>
                    contains a generic <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">List</code> containing
                    tuples (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WebAppWithADSample/Pages/UserInfo.cshtml.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在默认策略配置下，需要身份验证。如果没有此策略，你可以将 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Authorize</code>
                                属性应用于类和方法——例如，Razor 页面的类、MVC 控制器或 MVC 动作方法。要覆盖授权要求，你可以应用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AllowAnonymous</code>
                                属性。在以下代码片段中， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Authorize</code>
                                属性被应用于 Razor 页面的代码隐藏文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">UserInfo</code>
                                。由于用户已获得授权，可以访问用户信息。通过调用此页面的 HTTP GET 请求的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">OnGet</code>
                                方法，访问用户信息；用户的名称和作为令牌一部分传递的声明被分配给属性 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">UserName</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ClaimsInformation</code>
                                。属性 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ClaimsInformation</code>
                                包含一个通用的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">List</code>
                                ，其中包含元组（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WebAppWithADSample/Pages/UserInfo.cshtml.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0012"><code>[Authorize]</code>
<code>public class UserInfoModel : PageModel<span aria-label="565" epub:type="pagebreak" id="Page_565" role="doc-pagebreak"></span></code>
<code>{</code>
<code>  public void OnGet()</code>
<code>  {</code>
<code>    UserName = User.Identity?.Name;</code>
<code>       </code>
<code>    foreach (var claim in User.Claims)</code>
<code>    {</code>
<code>      ClaimsInformation.Add((claim.Type, </code>
<code>        claim.Subject?.Name ?? string.Empty, claim.Value));</code>
<code>    }</code>
<code>  }</code>
<code> </code>
<code>  public string? UserName { get; private set; }</code>
<code> </code>
<code>  public List&lt;(string Type, string Subject, string Value)&gt; ClaimsInformation { get; } = </code>
<code>    new List&lt;(string, string, string)&gt;();</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">When you use Razor syntax, values from the properties <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">UserName</code> and <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ClaimsInformation</code>
                    are shown in the user interface (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WebAppWithADSample/Pages/UserInfo.cshtml.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当你使用 Razor 语法时，属性 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">UserName</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ClaimsInformation</code>
                                的值会在用户界面中显示（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WebAppWithADSample/Pages/UserInfo.cshtml.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0013"><code>@page</code>
<code>@model WebAppWithADSample.Pages.UserInfoModel</code>
<code>@{</code>
<code>}</code>
<code> </code>
<code>&lt;h2&gt;User: @Model.UserName&lt;/h2&gt;</code>
<code> </code>
<code>&lt;table&gt;</code>
<code>  @foreach (var claimsInfo in Model.ClaimsInformation)</code>
<code>  {</code>
<code>  &lt;tr&gt;</code>
<code>    &lt;td&gt;@claimsInfo.Type&lt;/td&gt;</code>
<code>    &lt;td&gt;@claimsInfo.Subject&lt;/td&gt;</code>
<code>    &lt;td&gt;@claimsInfo.Value&lt;/td&gt;</code>
<code>  &lt;/tr&gt;</code>
<code>  }</code>
<code>&lt;/table&gt;</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">With the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddAuthorization</code>
                    method invoked in the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Startup</code> class, you
                    can create policies that define specific requirements, such as a user belonging to a specific role
                    defined in the Azure AD (<code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">RequireRole</code>
                    method), or that specific claims need to be available in a token (<code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">RequireClaim</code>
                    method) (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WebAppWithADSample/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Startup</code>
                                类中调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AddAuthorization</code>
                                方法时，你可以创建定义特定要求的策略，例如用户属于 Azure AD 中定义的特定角色（ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">RequireRole</code>
                                方法），或者需要在令牌中提供特定的声明（ <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">RequireClaim</code>
                                方法）（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">WebAppWithADSample/Startup.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0014"><code>services.AddAuthorization(options =&gt;</code>
<code>{</code>
<code>  options.AddPolicy("Developers", policy =&gt;</code>
<code>  {</code>
<code>    policy.RequireRole("DevGroup");</code>
<code>  });</code>
<code>  options.AddPolicy("Employees", policy =&gt;</code>
<code>  {</code>
<code>    policy.RequireClaim("EmployeeNumber");</code>
<code>  });</code>
<code>  options.FallbackPolicy = options.DefaultPolicy;</code>
<code>});</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1"><span aria-label="566" epub:type="pagebreak" id="Page_566"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>After you set the
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Policy</code> with the
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Authorize</code>
                    attribute, the requirements of the policy are now checked:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在您使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Authorize</code>
                                属性设置 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Policy</code>
                                后，现在会检查策略的要求：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0015"><code>[Authorize(Policy="Developers")]</code></pre>
                <p id="c20-para-0039" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">If the policy is not successful, the user receives an access
                    denied message.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">如果策略不成功，用户将收到访问被拒绝的消息。</font>
                        </font>
                    </font>
                </p>
                <p id="c20-para-0040" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Now that you know more about user identities, tokens, and
                    claims, let's step into another security-relevant topic: encryption of data.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                现在您已经了解了更多关于用户身份、令牌和声明的内容，让我们进入另一个与安全相关的主题：数据的加密。</font>
                        </font>
                    </font>
                </p>
            </section>
        </section>
        <section aria-labelledby="head-2-188" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
            <span id="c20-sec-0011" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
            <h2 id="head-2-188" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">ENCRYPTING DATA<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">加密数据</font>
                    </font>
                </font>
            </h2>
            <p id="c20-para-0041" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">Confidential data should be secured so that it cannot be read by
                unprivileged users. This is valid for both data that is sent across the network and stored data. You can
                encrypt such data with symmetric or asymmetric encryption keys.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            机密数据应当被保护，以防止未授权用户读取。这适用于通过网络传输的数据和存储的数据。您可以使用对称或非对称加密密钥来加密此类数据。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0042" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">With a symmetric key, you can use the same key for encryption and
                decryption. With asymmetric encryption, different keys are used for encryption and decryption: a public
                key and a private key. Something encrypted using a public key can be decrypted with the corresponding
                private key. This also works the other way around: something encrypted using a private key can be
                decrypted by using the corresponding public key but not the private key. It's practically impossible to
                calculate a private or public key from the other key.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            使用对称密钥，你可以用同一个密钥进行加密和解密。使用非对称加密时，加密和解密使用不同的密钥：一个公钥和一个私钥。用公钥加密的内容可以用相应的私钥解密。反过来也成立：用私钥加密的内容可以用相应的公钥解密，但不能用私钥解密。实际上，从另一个密钥计算出一个私钥或公钥是不可能的。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0043" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">Public and private keys are always created as a pair. The public
                key can be made available to everybody, and even put on a website, but the private key must be safely
                locked away. Following are some examples that demonstrate how public and private keys are used for
                encryption.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            公钥和私钥总是成对生成的。公钥可以提供给所有人，甚至可以放在网站上，但私钥必须安全地保管起来。以下是一些示例，展示了公钥和私钥如何用于加密。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0044" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">If Alice sends a message to Bob (see <a href="#c20-fig-0001"
                    id="R_c20-fig-0001" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Figure
                    20-1</a>) and she wants to ensure that no one other than Bob can read the message, she uses Bob's
                public key. The message is encrypted using Bob's public key. Bob opens the message and can decrypt it
                using his secretly stored private key. This key exchange guarantees that only Bob can read Alice's
                message.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">如果爱丽丝向鲍勃发送消息（见图
                            20-1），并且她希望确保只有鲍勃能阅读该消息，她使用鲍勃的公钥。该消息使用鲍勃的公钥进行加密。鲍勃打开消息，并使用他秘密存储的私钥进行解密。这种密钥交换确保了只有鲍勃能阅读爱丽丝的消息。
                        </font>
                    </font>
                </font>
            </p>
            <figure data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"> <img
                    alt="Snapshot of the concept of encrypting data." class="center" src="images/c20f001.png" />
                <figcaption data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><span class="figureLabel"
                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a
                                href="#R_c20-fig-0001" id="c20-fig-0001" role="doc-backlink"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><b
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                                    data-immersive-translate-paragraph="1">FIGURE 20-1<font
                                        class="notranslate immersive-translate-target-wrapper"
                                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">
                                              </font>
                                        <font
                                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                            data-immersive-translate-translation-element-mark="1">
                                            <font
                                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                data-immersive-translate-translation-element-mark="1">图 20-1</font>
                                        </font>
                                    </font></b></a></span></p>
                </figcaption>
            </figure>
            <p id="c20-para-0045" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">There is one problem, however: Bob can't be sure that the mail
                comes from Alice. Eve can use Bob's public key to encrypt messages sent to Bob and pretend to be Alice.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            然而，存在一个问题：鲍勃无法确定邮件来自爱丽丝。伊芙可以使用鲍勃的公钥加密发送给鲍勃的消息，并冒充爱丽丝。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0046" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">We can extend this principle using public/private keys. Let's
                start again with Alice sending a message to Bob. Before Alice encrypts the message using Bob's public
                key, she adds her signature and a hash of the message and <span aria-label="567" epub:type="pagebreak"
                    id="Page_567" role="doc-pagebreak"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>encrypts this
                information using her own private key. Then she encrypts the complete mail using Bob's public key.
                Therefore, it is guaranteed that no one other than Bob can read the message. When Bob decrypts it, he
                detects an encrypted signature. The signature can be decrypted using Alice's public key. For Bob, it is
                not a problem to access Alice's public key because the key is public. After decrypting the signature,
                Bob can be sure that it was Alice who sent the message.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">我们可以使用公钥/私钥扩展这一原理。让我们再次以 Alice 向 Bob
                            发送消息为例。在 Alice 使用 Bob 的公钥加密消息之前，她添加了她的签名和消息的哈希值，并使用自己的私钥加密这些信息。然后她使用 Bob
                            的公钥加密完整的邮件。因此，可以保证除了 Bob 之外没有人能阅读该消息。当 Bob 解密时，他检测到一个加密的签名。该签名可以使用 Alice 的公钥解密。对于 Bob 来说，获取
                            Alice 的公钥不是问题，因为该密钥是公开的。解密签名后，Bob 可以确信是 Alice 发送了该消息。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0047" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">The encryption and decryption algorithms using symmetric keys are
                a lot faster than those using asymmetric keys. The problem with symmetric keys is that the keys must be
                exchanged in a safe manner. With network communication, one way to do this is by using asymmetric keys
                first for the key exchange and then symmetric keys for the encryption of the data that is sent across
                the wire.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            使用对称密钥的加密和解密算法比使用非对称密钥的算法快得多。对称密钥的问题在于密钥必须以安全的方式交换。在网络通信中，一种方法首先是使用非对称密钥进行密钥交换，然后使用对称密钥对通过线路传输的数据进行加密。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0048" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">In the following table, you'll find algorithms implemented by the
                .NET classes grouped into different categories with some information on the use and issues with
                different algorithms. The purpose of hash algorithms is to create a fixed-length hash value from binary
                strings of arbitrary length. These algorithms are used with digital signatures and for data integrity.
                If the same binary string is hashed again, the same hash result is returned. Also, if the binary string
                has been modified even a little, it is extremely unlikely that the hash result will be the same. <i
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Symmetric key algorithms</i>
                use the same key for encryption and decryption of data. <i
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Asymmetric algorithms</i> use
                a key pair: one key for encryption and another for decryption.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在下表中，您将找到由 .NET
                            类实现的算法按不同类别分组，并附有关于不同算法的使用和问题的信息。哈希算法的目的是将任意长度的二进制字符串创建为固定长度的哈希值。这些算法用于数字签名和数据完整性。如果对同一个二进制字符串再次进行哈希，将返回相同的哈希结果。此外，如果二进制字符串稍有修改，几乎不可能得到相同的哈希结果。对称密钥算法使用相同的密钥进行数据的加密和解密。非对称算法使用密钥对：一个密钥用于加密，另一个用于解密。
                        </font>
                    </font>
                </font>
            </p>
            <table border="1" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                <thead data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <tr data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <th class="left bgcolor2" scope="col">CATEGORY</th>
                        <th class="left bgcolor2" scope="col">ALGORITHM</th>
                        <th class="left bgcolor2" scope="col">DESCRIPTION</th>
                    </tr>
                </thead>
                <tbody data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <tr data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <td class="left bgcolor3" rowspan="4"
                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Hash<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">哈希</font>
                                </font>
                            </font>
                        </td>
                        <td class="left bgcolor3">MD5</td>
                        <td class="left bgcolor3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">The Message Digest Algorithm 5 (MD5) was developed at
                            RSA Laboratories. The algorithm should be used only with legacy applications; it can be
                            broken on regular computers in less than a second.<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">消息摘要算法 5（MD5）由 RSA
                                        实验室开发。该算法仅应与遗留应用程序一起使用；在普通计算机上，它可以在不到一秒的时间内被破解。</font>
                                </font>
                            </font>
                        </td>
                    </tr>
                    <tr data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <td class="left bgcolor3">HMAC</td>
                        <td class="left bgcolor3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Hash-based Message Authentication Code (HMAC) uses a
                            hash function with a secret cryptography key and allows verifying data integrity and
                            authenticity of a message.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">
                                        基于哈希的消息认证码（HMAC）使用一个带有秘密加密密钥的哈希函数，并允许验证消息的完整性和真实性。</font>
                                </font>
                            </font>
                        </td>
                    </tr>
                    <tr data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <td class="left bgcolor3">RIPEMD</td>
                        <td class="left bgcolor3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">RIPE Message Digest (RIPEMD) was developed by the EU
                            project RACE Integrity Primitives Evaluation (RIPE). The original RIPEMD-128 is now
                            considered insecure. RIPEMD-160 is the most commonly used algorithm of the RIPEMD family
                            with 160-bit hash results. Specifications for RIPEMD-256 and RIPEMD-512 are available as
                            well. These provide the same security but longer hash sizes. Bitcoin makes use of
                            RIPEMD-160.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">RIPE 消息摘要（RIPEMD）是由欧盟项目
                                        RACE 完整性原语评估（RIPE）开发的。最初的 RIPEMD-128 现在被认为是不安全的。RIPEMD-160 是 RIPEMD 家族中最常用的算法，生成
                                        160 位的哈希结果。RIPEMD-256 和 RIPEMD-512 的规范也是可用的。这些提供相同的安全性，但哈希尺寸更长。比特币使用 RIPEMD-160。
                                    </font>
                                </font>
                            </font>
                        </td>
                    </tr>
                    <tr data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <td class="left bgcolor3">SHA</td>
                        <td class="left bgcolor3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">The Secure Hash Algorithm (SHA) algorithms were
                            designed by the National Security Agency (NSA). SHA-1 uses a 160-bit hash and is stronger
                            than MD5 (128-bit) against brute-force attacks, but because of security issues, SHA1 has not
                            been supported with HTTPS in browsers since 2017. Microsoft discontinued SHA-1 code signing
                            for Windows Update in 2020. Git uses SHA-1 for data integrity against disk and DRAM
                            corruption.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">
                                        安全散列算法（SHA）是由国家安全局（NSA）设计的。SHA-1 使用 160 位的哈希，比 MD5（128 位）更能抵抗暴力破解攻击，但由于安全问题，SHA1
                                        自 2017 年以来不再被浏览器支持 HTTPS。微软在 2020 年停止了 Windows 更新中的 SHA-1 代码签名。Git 使用 SHA-1
                                        来防止磁盘和 DRAM 损坏的数据完整性。</font>
                                </font>
                            </font><br data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0" /> The
                            other SHA algorithms contain the hash size in the name. SHA512 is the strongest of these
                            algorithms, with a hash size of 512 bits; it is also the slowest. <font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">其他 SHA 算法在名称中包含哈希尺寸。SHA512
                                        是这些算法中最强的，具有 512 位的哈希尺寸；它也是最慢的。</font>
                                </font>
                            </font>
                        </td>
                    </tr>
                    <tr data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <td class="left bgcolor3" rowspan="3"
                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Symmetric<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">对称</font>
                                </font>
                            </font>
                        </td>
                        <td class="left bgcolor3">DES</td>
                        <td class="left bgcolor3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Data Encryption Standard (DES) is now considered
                            insecure because it uses only 56 bits for the key size and can be broken in less than 24
                            hours.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">
                                        数据加密标准（DES）现在被认为是不安全的，因为它只使用 56 位作为密钥长度，可以在不到 24 小时内被破解。</font>
                                </font>
                            </font>
                        </td>
                    </tr>
                    <tr data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <td class="left bgcolor3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Triple-DES<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">三重 DES </font>
                                </font>
                            </font>
                        </td>
                        <td class="left bgcolor3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Triple-DES is the successor to DES and has a key
                            length of 168 bits, but the effective security it provides is only 112-bit. It uses three
                            iterations of DES.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">三重 DES 是 DES 的继任者，其密钥长度为
                                        168 位，但它提供的有效安全性只有 112 位。它使用三次 DES 迭代。</font>
                                </font>
                            </font>
                        </td>
                    </tr>
                    <tr data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <td class="left bgcolor3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Rijndael<br
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0" /> AES </td>
                        <td class="left bgcolor3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Today, Advanced Encryption Standard (AES) is the
                            most-used symmetric algorithm. It has a key size of 128, 192, or 256 bits. Rijndael is the
                            predecessor of AES. AES is an encryption standard adopted by the U.S. government.<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">
                                        如今，高级加密标准（AES）是最常用的对称算法。它的密钥长度为 128、192 或 256 位。Rijndael 是 AES 的前身。AES
                                        是美国政府采用的一种加密标准。 </font>
                                </font>
                            </font>
                        </td>
                    </tr>
                    <tr data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <td class="left bgcolor3" rowspan="4"
                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Asymmetric<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">非对称 </font>
                                </font>
                            </font>
                        </td>
                        <td class="left bgcolor3">RSA</td>
                        <td class="left bgcolor3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">The Rivest, Shamir, Adleman (RSA) algorithm was the
                            first one used for signing as well as encryption. This algorithm is widely used in
                            e-commerce protocols.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">
                                        Rivest、Shamir、Adleman（RSA）算法是第一个既用于签名也用于加密的算法。该算法广泛应用于电子商务协议中。</font>
                                </font>
                            </font>
                        </td>
                    </tr>
                    <tr data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <td class="left bgcolor3">DSA</td>
                        <td class="left bgcolor3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Digital Signature Algorithm (DSA) is a U.S. federal
                            government standard for digital signatures as defined in Federal Information Processing
                            Standards Publication (FIPS) PUB 186. A draft version available at the time of this writing
                            indicates that DSA will no longer be approved for new digital signatures. The DSA algorithm
                            is based on modular exponentiation and the discrete logarithm problem.<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">
                                        数字签名算法（DSA）是美国联邦政府标准的数字签名算法，如联邦信息处理标准出版物（FIPS）PUB 186
                                        中定义的那样。在撰写本文时，可用的草案版本表明，DSA 将不再被批准用于新的数字签名。DSA 算法基于模幂运算和离散对数问题。</font>
                                </font>
                            </font>
                        </td>
                    </tr>
                    <tr data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <td class="left bgcolor3">ECDSA</td>
                        <td class="left bgcolor3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Elliptic Curve DSA (ECDSA) uses elliptic curves
                            instead of logarithms. These algorithms are more secure, with shorter key sizes. For
                            example, having a key size of 1024 for DSA is similar in security to 160 bits for ECDSA. As
                            a result, ECDSA is much faster.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">椭圆曲线
                                        DSA（ECDSA）使用椭圆曲线而不是对数。这些算法更安全，密钥长度更短。例如，DSA 的 1024 位密钥长度在安全性上类似于 ECDSA 的 160
                                        位。因此，ECDSA 速度更快。</font>
                                </font>
                            </font>
                        </td>
                    </tr>
                    <tr data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <td class="left bgcolor3">ECDH</td>
                        <td class="left bgcolor3" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1">Elliptic Curve Diffie-Hellman (ECDH) is based on
                            elliptic curves similar to ECDSA. This algorithm allows you to exchange private keys in a
                            secure way over an insecure channel.<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">椭圆曲线
                                        Diffie-Hellman（ECDH）基于与 ECDSA 类似的椭圆曲线。该算法允许您以安全的方式在不可靠的信道上交换私钥。</font>
                                </font>
                            </font><span aria-label="568" epub:type="pagebreak" id="Page_568" role="doc-pagebreak"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span></td>
                    </tr>
                </tbody>
            </table>
            <p id="c20-para-0054" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">With that many algorithms, you'll have a lot more classes
                available with .NET with which to implement these algorithms. .NET contains classes for encryption in
                the namespace <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">System.Security.Cryptography</code>.
                .NET implementations access OS system libraries. Keeping cryptography libraries safe is a high priority
                for all OS vendors. When the OS is updated, as the .NET classes invoke the libraries from the OS, .NET
                applications use the updated implementations. However, this dependency also means that .NET applications
                can use only those features the OS supports. To get the details, you can read <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://docs.microsoft.com/dotnet/standard/security/cross-platform-cryptography">https://docs.microsoft.com/dotnet/standard/security/cross-platform-cryptography</a></code>.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">有了这么多算法，你将能在.NET 中拥有更多可用于实现这些算法的类。.NET
                            在 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">System.Security.Cryptography</code>
                            命名空间中包含用于加密的类。.NET 实现会访问操作系统系统库。对所有操作系统供应商来说，保护加密库是高优先级事项。当操作系统更新时，由于.NET
                            类会调用来自操作系统的库，因此.NET 应用程序会使用更新的实现。然而，这种依赖性也意味着.NET 应用程序只能使用操作系统支持的功能。要了解详细信息，你可以阅读 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://docs.microsoft.com/dotnet/standard/security/cross-platform-cryptography">https://docs.microsoft.com/dotnet/standard/security/cross-platform-cryptography</a></code>
                            。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0055" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">To better navigate within the huge lists of classes, let's get
                into the object inheritance used by the .NET crypto classes. The most important abstract base classes,
                according to the algorithm categories in the preceding table, are <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HashAlgorithm</code>, <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SymmetricAlgorithm</code>,
                and <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AsymmetricAlgorithm</code>.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">为了更好地在庞大的类列表中导航，让我们了解一下.NET
                            加密类使用的对象继承。根据前面表格中的算法类别，最重要的抽象基类是 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HashAlgorithm</code>
                            、 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SymmetricAlgorithm</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AsymmetricAlgorithm</code>
                            。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0056" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">Another list of abstract base classes, called <i
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">algorithm classes</i>, is
                derived from these base classes. For example, the classes <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Aes</code>, <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">RSA</code>, and <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellman</code> are
                base classes representing specific algorithms. AES is a symmetric algorithm; thus, the <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Aes</code> class derives from
                the base class <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SymmetricAlgorithm</code>.
                RSA and Elliptic Curve Diffie-Hellman (ECDH) are asymmetric algorithms; thus, the <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">RSA</code> and <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellman</code>
                classes derive from the base class <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AsymmetricAlgorithm</code>.
                All of these classes are abstract as well. Then you find another layer of classes with concrete
                algorithm implementations. <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellmanCng</code> and
                <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellmanOpenSsl</code>
                derive from <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHelman</code>.
                Classes with the <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Cng</code>
                prefix or postfix make use of the Cryptography Next Generation (CNG) Windows API. Classes with the <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">OpenSsl</code> postfix are
                based on the OpenSSL library available on Linux platforms.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">另一组抽象基类，称为算法类，是从这些基类派生出来的。例如， <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Aes</code> 、
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">RSA</code> 和
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellman</code>
                            类是表示特定算法的基类。AES 是对称算法；因此， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Aes</code> 类派生自基类
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SymmetricAlgorithm</code>
                            。RSA 和椭圆曲线 Diffie-Hellman（ECDH）是非对称算法；因此， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">RSA</code> 和
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellman</code>
                            类派生自基类 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AsymmetricAlgorithm</code>
                            。所有这些类也是抽象的。然后你会发现另一层具有具体算法实现的类。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellmanCng</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellmanOpenSsl</code>
                            派生自 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHelman</code>
                            。以 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Cng</code>
                            为前缀或后缀的类使用 Cryptography Next Generation（CNG）Windows API。以 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">OpenSsl</code>
                            为后缀的类基于 Linux 平台上的 OpenSSL 库。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0057" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1"><span aria-label="569" epub:type="pagebreak" id="Page_569"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>To create applications
                that are platform-independent, you can use the <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Create</code> method of an
                abstract base class. The implementation returned depends on the platform where the program runs. To take
                advantage of the platform-specific features, you need to use the platform-specific classes. The sample
                applications in this chapter are platform-independent.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">要创建与平台无关的应用程序，你可以使用抽象基类的 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Create</code>
                            方法。返回的实现取决于程序运行的平台。要利用平台特定的功能，你需要使用平台特定的类。本章中的示例应用程序是与平台无关的。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0058" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">The following sections include some examples that demonstrate how
                you can use these algorithms programmatically.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">以下几节包含一些示例，演示了您如何可以编程使用这些算法。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><span id="c20-sec-0012"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
                <h3 id="head-3-381" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Getting an X.509 Certificate <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">获取 X.509 证书</font>
                        </font>
                    </font>
                </h3>
                <p id="c20-para-0059" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">To create a public/private key pair, you have different
                    options. You can use the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Create</code> method of
                    the <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CngKey</code>
                    class. This class is available only on Windows. If you use this class in a platform-independent
                    application, the compiler gives you a warning. On Linux (including WSL-2), you can use the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ssh-keygen</code> and
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">openssl</code>
                    utilities. In production environments, you might use certification services to create certificates
                    with public and private keys. With Microsoft Azure, you can manage (and also create) your
                    certificates with the Azure Key Vault. This Azure service was previously covered in <a
                        href="c15.xhtml" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Chapter
                        15</a>. This chapter looks at it with regard to certificates. To create a new Azure Key Vault
                    instance and certificates with the Azure CLI in your subscription, check the readme file that's part
                    of the code samples. The download files contain scripts that you can start in the Bash shell.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要创建公钥/私钥对，你有不同的选项。你可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Create</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CngKey</code>
                                方法。这个类仅在 Windows 上可用。如果你在跨平台应用程序中使用这个类，编译器会给你一个警告。在 Linux（包括 WSL-2）上，你可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ssh-keygen</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">openssl</code>
                                工具。在生产环境中，你可能会使用认证服务来创建带有公钥和私钥的证书。使用 Microsoft Azure，你可以通过 Azure Key Vault
                                管理你的证书（也可以创建）。这个 Azure 服务在之前的第 15 章中已经介绍过。本章从证书的角度来讨论它。要在你的订阅中通过 Azure CLI 创建新的 Azure
                                Key Vault 实例和证书，请查看代码示例中包含的 README 文件。下载文件包含你可以在 Bash shell 中启动的脚本。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">This sample application uses the NuGet packages <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Azure.Security.KeyVault.Certificates</code>
                    to retrieve certificates:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">这个示例应用程序使用 NuGet 包 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Azure.Security.KeyVault.Certificates</code>
                                来获取证书：</font>
                        </font>
                    </font>
                </p>
                <ul class="check" id="c20-list-0003"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <li id="c20-li-0012" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                        data-immersive-translate-paragraph="1"><code
                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Azure.Security.KeyVault.Secrets</code>
                        to retrieve the private key of certificates<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1"> <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Azure.Security.KeyVault.Secrets</code>
                                    来获取证书的私钥</font>
                            </font>
                        </font>
                    </li>
                    <li id="c20-li-0013" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                        data-immersive-translate-paragraph="1"><code
                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Azure.Identity</code>
                        for authentication with Microsoft Azure with the same namespaces referenced<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1"> <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Azure.Identity</code>
                                    用于使用相同的命名空间与 Microsoft Azure 进行身份验证</font>
                            </font>
                        </font>
                    </li>
                    <li id="c20-li-0014" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                        data-immersive-translate-paragraph="1">The commonly used package <code
                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Extensions.Hosting</code>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">常用的包 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Microsoft.Extensions.Hosting</code>
                                </font>
                            </font>
                        </font>
                    </li>
                </ul>
                <p id="c20-para-0061" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">The .NET library namespace used for the certificate class
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">X509Certificate2</code>
                    is <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">System.Security.Cryptography.X509Certificates</code>.
                    X.509 is a standard that defines the format for public key certificates. X.509 certificates are used
                    with electronic signatures and TLS/SSL, which is the basis for HTTPS.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">用于证书类 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">X509Certificate2</code>
                                的 .NET 库命名空间是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">System.Security.Cryptography.X509Certificates</code>
                                。X.509 是一个定义公钥证书格式的标准。X.509 证书用于电子签名和 TLS/SSL，而 TLS/SSL 是 HTTPS 的基础。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">The sample application defines the class <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">KeyVaultService</code>,
                    as shown in the following code snippet, which performs the communication with the Azure Key Vault
                    using the Azure Key Vault API. The Azure Key Vault API uses .NET event sourcing for logging (which
                    is covered in <a href="c16.xhtml"
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Chapter 16</a>,
                    “Diagnostics and Metrics”) to offer metrics information. To see this information with <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ILogger</code> providers,
                    the event log provider is registered, invoking the method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AzureEventSourceListener</code>,
                    and the values for the log levels are changed. The link to the Azure Key Vault is retrieved via the
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">VaultUri</code>
                    settings that you can specify with the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">appsettings.json</code>
                    file or the user secrets, or it is passed using command-line parameters when starting the
                    application (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">X509CertificateSample/KeyVaultService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">示例应用程序定义了类 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">KeyVaultService</code>
                                ，如下面的代码片段所示，该类使用 Azure Key Vault API 与 Azure Key Vault 进行通信。Azure Key Vault API 使用 .NET
                                事件溯源进行日志记录（在第 16 章“诊断和指标”中涵盖），以提供指标信息。要使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ILogger</code>
                                提供商查看这些信息，需要注册事件日志提供程序，调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AzureEventSourceListener</code>
                                ，并更改日志级别的值。通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">VaultUri</code>
                                设置获取 Azure Key Vault 的链接，这些设置可以通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">appsettings.json</code>
                                文件或用户密钥指定，或在启动应用程序时通过命令行参数传递（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">X509CertificateSample/KeyVaultService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0016"><code>static class EventLevelExtensions</code>
<code>{</code>
<code>  public static LogLevel ToLogLevel(this EventLevel eventLevel)</code>
<code>    =&gt; eventLevel switch</code>
<code>    {</code>
<code>      EventLevel.Critical =&gt; LogLevel.Critical,</code>
<code>      EventLevel.Error =&gt; LogLevel.Error,</code>
<code>      EventLevel.Warning =&gt; LogLevel.Warning,</code>
<code>      EventLevel.Informational =&gt; LogLevel.Information,</code>
<code>      EventLevel.Verbose =&gt; LogLevel.Trace,</code>
<code>      EventLevel.LogAlways =&gt; LogLevel.Critical,</code>
<code>      _ =&gt; throw new InvalidOperationException("Update for a new event level")</code>
<code>    };</code>
<code>}</code>
<code> <span aria-label="570" epub:type="pagebreak" id="Page_570" role="doc-pagebreak"></span></code>
<code>class KeyVaultService : IDisposable</code>
<code>{</code>
<code>  private readonly string _vaultUri;</code>
<code>  private readonly ILogger _logger;</code>
<code>  private readonly DefaultAzureCredential _credential = new();</code>
<code>  private readonly AzureEventSourceListener _azureEventSourceListener;</code>
<code>  public KeyVaultService(IConfiguration configuration, ILogger&lt;KeyVaultService&gt; logger)</code>
<code>  {</code>
<code>    _vaultUri = configuration["VaultUri"];</code>
<code>    _logger = logger;</code>
<code>    _azureEventSourceListener = new AzureEventSourceListener((eventArgs, message) </code>
<code>      =&gt; _logger.Log(eventArgs.Level.ToLogLevel(), message), EventLevel.Verbose);</code>
<code>  }</code>
<code> </code>
<code>  public void Dispose()</code>
<code>    =&gt; _azureEventSourceListener.Dispose();</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">For authentication with the Azure Key Vault, the source code
                    makes use of the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">DefaultAzureCredential</code>
                    class. This class tries to use different accounts to connect with Microsoft Azure. One class used
                    from <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">DefaultAzureCredential</code>
                    is <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">VisualStudioCredential</code>,
                    which uses the account specified with the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AZURE_USERNAME</code>
                    environmental variable. As shown in the following code snippet, set this variable to the account
                    that has access to reading certificates and secrets within the key vault to run the application in
                    your local environment.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为使用 Azure Key Vault 进行身份验证，源代码使用了
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">DefaultAzureCredential</code>
                                类。该类尝试使用不同的账户连接到 Microsoft Azure。从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">DefaultAzureCredential</code>
                                中使用的类之一是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">VisualStudioCredential</code>
                                ，它使用通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AZURE_USERNAME</code>
                                环境变量指定的账户。如以下代码片段所示，将该变量设置为可访问密钥库中证书和密钥的账户，以便在本地环境中运行应用程序。</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0017"><code>{</code>
<code>  "profiles": {</code>
<code>    "X509CertificateSample": {</code>
<code>      "commandName": "Project",</code>
<code>      "commandLineArgs": "KeyVaultUri={enter your Azure Key Vault URI",</code>
<code>      "environmentVariables": {</code>
<code>        "DOTNET_ENVIRONMENT": "Development",</code>
<code>        <b>"AZURE_USERNAME": "{enter your azure username}"</b></code>
<code>      }</code>
<code>    }</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">With the following code snippet, the certificate is retrieved
                    using the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CertificateClient</code>
                    class from the namespace <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Azure.Security.KeyVault.Certificates</code>.
                    With the method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetCertificateAsync</code>
                    passing the name of the certificate, the certificate—excluding the private key—is retrieved. The
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Value</code> property
                    of the <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Response</code>
                    contains the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">KeyVaultCertificateWithPolicy</code>
                    object. The public key is returned from the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Cer</code> property. To
                    return an <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">X509Certificate2</code>
                    object that includes both the public key and the private key, the private key is retrieved by
                    invoking the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetSecretAsync</code>
                    method and passing the name and version of the secret. The name and version are taken from the URI
                    parts of the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SecretId</code> property
                    of the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">KeyVaultCertificateWithPolicy</code>
                    (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">X509CertificateSample/KeyVaultService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">通过以下代码片段，使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CertificateClient</code>
                                类从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Azure.Security.KeyVault.Certificates</code>
                                命名空间中获取证书。通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetCertificateAsync</code>
                                方法传递证书名称，可获取除私钥外的证书。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Response</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Value</code>
                                属性包含 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">KeyVaultCertificateWithPolicy</code>
                                对象。公钥从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Cer</code>
                                属性返回。若要返回包含公钥和私钥的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">X509Certificate2</code>
                                对象，需调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetSecretAsync</code>
                                方法并传递密钥的名称和版本。名称和版本取自 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">KeyVaultCertificateWithPolicy</code>
                                对象的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SecretId</code>
                                属性的 URI 部分（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">X509CertificateSample/KeyVaultService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0018"><code>public async Task&lt;X509Certificate2&gt; GetCertificateAsync(string name)</code>
<code>{</code>
<code>  CertificateClientOptions options = new();</code>
<code>  options.Diagnostics.IsLoggingEnabled = true;</code>
<code>  options.Diagnostics.IsDistributedTracingEnabled = true;</code>
<code>  options.Diagnostics.IsLoggingContentEnabled = true;</code>
<code> </code>
<code>  <b>CertificateClient certClient = new(new Uri(_vaultUri), _credential, options);</b></code>
<code>  <b>Response&lt;KeyVaultCertificateWithPolicy&gt; response =</b> <span aria-label="571" epub:type="pagebreak" id="Page_571" role="doc-pagebreak"></span></code>
<code>    <b>await certClient.GetCertificateAsync(name);</b></code>
<code>  byte[] publicKeyBytes = response.Value.Cer;</code>
<code>  Uri secretId = response.Value.SecretId;</code>
<code>  string secretName = secretId.Segments[2].Trim('/');</code>
<code>  string version = secretId.Segments[3].TrimEnd('/');</code>
<code>        </code>
<code>  SecretClient secretClient = new(new Uri(_vaultUri), _credential);</code>
<code>  <b>Response&lt;KeyVaultSecret&gt; responseSecret =</b> </code>
<code>    <b>await secretClient.GetSecretAsync(secretName, version);</b></code>
<code>  KeyVaultSecret secret = responseSecret.Value;</code>
<code>  byte[] privateKeyBytes = Convert.FromBase64String(secret.Value);</code>
<code>  X509Certificate2 cert = new(privateKeyBytes);</code>
<code>  return cert;</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Let's get into the top-level statements of the application.
                    After the DI container is configured, the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">KeyVaultService</code> is
                    retrieved. Using this service, the certificate with the name <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AliceCert</code> is
                    retrieved, and some values such as the subject of the certificate, the key exchange algorithm, and
                    valid dates are shown on the console (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">X509CertificateSample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">让我们来看看应用程序的顶层语句。在依赖注入容器配置完成后，会获取
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">KeyVaultService</code>
                                。使用该服务，检索名为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AliceCert</code>
                                的证书，并在控制台上显示证书的主题、密钥交换算法和有效日期等值（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">X509CertificateSample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0019"><code>using var host = Host</code>
<code>  .CreateDefaultBuilder(args)</code>
<code>  .ConfigureServices(services =&gt;</code>
<code>  {</code>
<code>    services.AddSingleton&lt;KeyVaultService&gt;();</code>
<code>  }).Build();</code>
<code> </code>
<code>var service = host.Services.GetRequiredService&lt;KeyVaultService&gt;();</code>
<code>using var certificate = await service.GetCertificateAsync("AliceCert");</code>
<code> </code>
<code>ShowCertificate(certificate);</code>
<code> </code>
<code>void ShowCertificate(X509Certificate2 certificate)</code>
<code>{</code>
<code>  Console.WriteLine($"Subject: {certificate.Subject}");</code>
<code>  Console.WriteLine($"Not before: {certificate.NotBefore:D}");</code>
<code>  Console.WriteLine($"Not after: {certificate.NotAfter:D}");</code>
<code>  Console.WriteLine($"Has private key: {certificate.HasPrivateKey}");</code>
<code>  Console.WriteLine($"Key algorithm: {certificate.PublicKey.Key.KeyExchangeAlgorithm}");</code>
<code>  Console.WriteLine($"Key size: {certificate.PublicKey.Key.KeySize}");</code>
<code>}</code></pre>
                <p id="c20-para-0066" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">When you run the application, you can see the logging
                    communication with the Azure Key Vault, as well as information about the retrieved certificate.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">运行应用程序时，您可以看到与 Azure Key Vault
                                的日志通信，以及检索到的证书信息。</font>
                        </font>
                    </font>
                </p>
                <p id="c20-para-0067" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">.NET 6 will add methods to use the keys from the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">X509Certificate2</code>
                    class with EC Diffie-Hellman types. The samples in the following sections create public/private
                    pairs programmatically, but when .NET 6 is available, check the downloadable readme file of the
                    chapter for links to samples with .NET 6.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">.NET 6 将添加方法，用于使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">X509Certificate2</code>
                                类的密钥与 EC Diffie-Hellman 类型一起使用。以下各节中的示例会以编程方式创建公钥/私钥对，但在.NET 6 可用时，请查看章节的可下载 readme
                                文件，以获取使用.NET 6 的示例链接。</font>
                        </font>
                    </font>
                </p>
            </section>
            <section data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><span id="c20-sec-0013"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
                <h3 id="head-3-382" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Creating and Verifying a Signature <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">创建和验证签名</font>
                        </font>
                    </font>
                </h3>
                <p id="c20-para-0068" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Now that you've seen how to create a public/private key pair
                    using a certificate, let's get into verifying a signature with ECDSA algorithms.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">现在你已经看到了如何使用证书创建公钥/私钥对，让我们来学习如何使用
                                ECDSA 算法验证签名。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">With the following sample, Alice creates a signature that is
                    encrypted with her private key. This signature can be verified with her public key. If the
                    verification succeeds, it's guaranteed that the signature is from Alice because <span
                        aria-label="572" epub:type="pagebreak" id="Page_572" role="doc-pagebreak"
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>only she has the
                    private key. See the following code snippet with <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AliceRunner</code> to
                    create the signature and <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">BobRunner</code> to
                    verify the signature (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SigningDemo/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">通过以下示例，Alice
                                使用她的私钥创建一个加密签名。该签名可以使用她的公钥进行验证。如果验证成功，则可以保证该签名来自 Alice，因为她只有私钥。请参考以下代码片段，其中 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AliceRunner</code>
                                部分用于创建签名， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">BobRunner</code>
                                部分用于验证签名（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SigningDemo/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0020"><code>using Microsoft.Extensions.DependencyInjection;</code>
<code>using Microsoft.Extensions.Hosting;</code>
<code> </code>
<code>using var host = Host.CreateDefaultBuilder(args)</code>
<code>  .ConfigureServices(services =&gt;</code>
<code>  {</code>
<code>    services.AddTransient&lt;AliceRunner&gt;();</code>
<code>    services.AddTransient&lt;BobRunner&gt;();</code>
<code>  })</code>
<code>  .Build();</code>
<code> </code>
<code>var alice = host.Services.GetRequiredService&lt;AliceRunner&gt;();</code>
<code>var bob = host.Services.GetRequiredService&lt;BobRunner&gt;();</code>
<code>var keyAlice = alice.GetPublicKey();</code>
<code>var aliceData = alice.GetDocumentAndSignature();</code>
<code>bob.VerifySignature(aliceData.Data, aliceData.Sign, keyAlice);</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Let's look at the main functionality in the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AliceRunner</code> class.
                    In the constructor, which uses <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDsa.Create</code>, an
                    instance of the class implementing the ECDSA algorithms is returned. The method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ExportSubjectPublicKeyInfo</code>
                    used in the method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetPublicKey</code>
                    returns the public key that can be used by other parties. In the method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetDocumentsAndSignature</code>,
                    Alice creates a string and a signature. The signature is created by invoking the method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SignData</code>. This
                    method uses the private key for signing. The second argument of this method defines the name of the
                    algorithm that should be used for signing. Here, <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SHA512</code> is used.
                    Both the document as well as the signature are returned from the method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetDocumentsAndSignature</code>
                    (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SigningDemo/AliceRunner.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">让我们看看 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AliceRunner</code>
                                类中的主要功能。在使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDsa.Create</code>
                                的构造函数中，会返回一个实现 ECDSA 算法的类实例。在方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetPublicKey</code>
                                中使用的方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ExportSubjectPublicKeyInfo</code>
                                会返回其他方可以使用的公钥。在方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetDocumentsAndSignature</code>
                                中，Alice 创建了一个字符串和签名。签名是通过调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SignData</code>
                                创建的。该方法使用私钥进行签名。此方法的第二个参数定义了用于签名的算法名称。这里使用的是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SHA512</code>
                                。文档和签名都从方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetDocumentsAndSignature</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SigningDemo/AliceRunner.cs</code>
                                ）返回：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0021"><code>class AliceRunner : IDisposable</code>
<code>{</code>
<code>  private readonly ILogger _logger;</code>
<code>  private ECDsa _signAlgorithm;</code>
<code>  public AliceRunner(ILogger&lt;AliceRunner&gt; logger)</code>
<code>  {</code>
<code>    _logger = logger;</code>
<code>    _signAlgorithm = ECDsa.Create();</code>
<code>    _logger.LogInformation($"Using this ECDsa class: {_signAlgorithm.GetType().Name}");</code>
<code>  }</code>
<code> </code>
<code>  public void Dispose() =&gt; _signAlgorithm.Dispose();</code>
<code> </code>
<code>  public byte[] GetPublicKey() =&gt; _signAlgorithm.ExportSubjectPublicKeyInfo();</code>
<code> </code>
<code>  public (byte[] Data, byte[] Sign) GetDocumentAndSignature()</code>
<code>  {</code>
<code>    byte[] aliceData = Encoding.UTF8.GetBytes("I'm Alice");</code>
<code>    byte[] aliceDataSignature = </code>
<code>      _signAlgorithm.SignData(aliceData, HashAlgorithmName.SHA512);</code>
<code>    return (aliceData, aliceDataSignature);</code>
<code>  }</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <div class="top hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <p id="c20-para-0072" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">NOTE</b> <i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">You can pass
                                arguments to the </i> <code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDsa.Create</code>
                            <i data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"> methods to
                                specify the algorithm used for the creation of the curve. The </i> <code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECCurve</code> <i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"> struct defines
                            </i> <code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">NamedCurves</code>
                            <i data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"> that you can pass
                                (for example, </i> <code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">brainpoolP320r1</code>
                            <i data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">, </i> <code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">nistP521</code>
                            <i data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">), but you can
                                also specify your own configuration values to </i> <code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECCurve</code> <i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"> to create an
                                elliptic curve.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 您可以向 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDsa.Create</code>
                                        方法传递参数来指定用于创建曲线的算法。 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECCurve</code>
                                        结构定义了您可以传递的 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">NamedCurves</code>
                                        （例如， <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">brainpoolP320r1</code>
                                        、 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">nistP521</code>
                                        ），但您也可以指定自己的配置值来 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECCurve</code>
                                        以创建椭圆曲线。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p id="c20-para-0071" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><span
                        aria-label="573" epub:type="pagebreak" id="Page_573" role="doc-pagebreak"
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span></p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Bob now needs to verify the signature. To do this, an
                    instance of the ECDS algorithm class is created with the same parameters as used by Alice. The <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">VerifyData</code> method
                    of the <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDsa</code>
                    class takes the data, the signature, and the hash algorithm. The algorithm needs to be the same as
                    was used by Alice to create the signature. The public key from Alice needs to be imported with the
                    <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ImportSubjectPublicKeyInfo</code>
                    method. <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">VerifyData</code> now
                    uses this public key to determine whether the signature is from Alice. If this succeeds, it's
                    guaranteed that the data has not been tampered with, and the signature was created using the private
                    key that belongs to the public key received (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SigningDemo/BobRunner.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">Bob 现在需要验证签名。为此，需要创建一个与 Alice
                                使用相同参数的 ECDS 算法类实例。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">VerifyData</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDsa</code>
                                方法接收数据、签名和哈希算法。算法必须与 Alice 创建签名时使用的算法相同。需要使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ImportSubjectPublicKeyInfo</code>
                                方法导入 Alice 的公钥。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">VerifyData</code>
                                现在使用这个公钥来确定签名是否来自 Alice。如果成功，就保证数据未被篡改，并且签名是使用属于所接收公钥的私钥创建的（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SigningDemo/BobRunner.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0022"><code>class BobRunner : IDisposable</code>
<code>{</code>
<code>  private readonly ILogger _logger;</code>
<code>  private ECDsa _signAlgorithm;</code>
<code>  public BobRunner(ILogger&lt;AliceRunner&gt; logger)</code>
<code>  {</code>
<code>    _logger = logger;</code>
<code>    _signAlgorithm = ECDsa.Create();</code>
<code>  }</code>
<code> </code>
<code>  public void Dispose() =&gt; _signAlgorithm.Dispose();</code>
<code> </code>
<code>  public byte[] GetPublicKey() =&gt; _signAlgorithm.ExportSubjectPublicKeyInfo();</code>
<code> </code>
<code>  public void VerifySignature(byte[] data, byte[] signature, byte[] pubKey)</code>
<code>  {</code>
<code>    _signAlgorithm.ImportSubjectPublicKeyInfo(pubKey.AsSpan(), out int bytesRead);</code>
<code>    bool success = _signAlgorithm.VerifyData(data, signature, HashAlgorithmName.SHA512);</code>
<code> </code>
<code>    _logger.LogInformation($"Signature is ok: {success}");</code>
<code>  }</code>
<code>}</code></pre>
                <p id="c20-para-0074" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">When you run the application, you see a success result. While
                    debugging, you can modify values from the data array to see that if you tamper with the data, <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">VerifyData</code> does
                    not return success.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                当你运行应用程序时，你会看到一个成功的结果。在调试时，你可以修改数据数组中的值，以查看如果你篡改数据， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">VerifyData</code>
                                不会返回成功。</font>
                        </font>
                    </font>
                </p>
            </section>
            <section data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><span id="c20-sec-0015"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
                <h3 id="head-3-383" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Implementing Secure Data Exchange <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">实现安全数据交换</font>
                        </font>
                    </font>
                </h3>
                <p id="c20-para-0075" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">The next example helps explain public/private key principles,
                    exchanging a secret between two parties, and communication with symmetric keys. A secret can be
                    exchanged between two parties using the EC Diffie-Hellman algorithm. This algorithm allows
                    exchanging a secret just by using public and private keys and exchanging the public key between two
                    parties.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                下一个示例有助于解释公钥/私钥原理、两方之间交换秘密以及使用对称密钥进行通信。秘密可以使用 EC Diffie-Hellman
                                算法在两方之间交换。该算法允许仅通过使用公钥和私钥并在两方之间交换公钥来交换秘密。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">The following top-level statements show the main flow of the
                    application. By using the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AliceRunner</code> and
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">BobRunner</code>
                    classes, the public keys from Alice and Bob are retrieved. Alice then creates a secret message and
                    uses the public key from Bob for the encryption. Bob reads the encrypted message using the public
                    key from Alice (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SecureTransfer/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">以下顶级语句显示了应用程序的主要流程。通过使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AliceRunner</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">BobRunner</code>
                                类，获取了 Alice 和 Bob 的公钥。然后 Alice 创建了一条秘密消息，并使用 Bob 的公钥进行加密。Bob 使用 Alice 的公钥读取加密消息（代码文件
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SecureTransfer/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0023"><code>using var host = Host</code>
<code>  .CreateDefaultBuilder(args)</code>
<code>  .ConfigureServices(services =&gt;</code>
<code>  {</code>
<code>    services.AddTransient&lt;AliceRunner&gt;();</code>
<code>    services.AddTransient&lt;BobRunner&gt;();</code>
<code>  })</code>
<code>  .Build();</code>
<code> <span aria-label="574" epub:type="pagebreak" id="Page_574" role="doc-pagebreak"></span></code>
<code>var alice = host.Services.GetRequiredService&lt;AliceRunner&gt;();</code>
<code>var bob = host.Services.GetRequiredService&lt;BobRunner&gt;();</code>
<code>var keyAlice = alice.GetPublicKey();</code>
<code>var keyBob = bob.GetPublicKey();</code>
<code>var message = await alice.GetSecretMessageAsync(keyBob);</code>
<code>await bob.ReadMessageAsync(message.Iv, message.EncryptedData, keyAlice);</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">In the constructor of the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AliceRunner</code> class,
                    the static <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Create</code> method of
                    the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellman</code>
                    algorithm class is used to create an instance. Either <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellmanOpenSsl</code>
                    or <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellmanCng</code>
                    instances are created, depending on the platform where the application runs. Using the returned
                    instance, the public key is retrieved from the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">PublicKey</code>
                    property. Instead of using byte arrays as with the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDsa</code> class, here
                    an instance of the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellmanPublicKey</code>
                    is returned. <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellmanPublicKey</code>
                    is an abstract base class, and concrete classes, which are determined by the platform, are returned
                    here as well (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SecureTransfer/AliceRunner.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AliceRunner</code>
                                类的构造函数中，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellman</code>
                                算法类的静态 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Create</code>
                                方法来创建一个实例。根据应用程序运行的平台，创建 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellmanOpenSsl</code>
                                或 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellmanCng</code>
                                实例。使用返回的实例，从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">PublicKey</code>
                                属性中获取公钥。与 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDsa</code>
                                类使用字节数组不同，这里返回的是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellmanPublicKey</code>
                                的实例。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellmanPublicKey</code>
                                是一个抽象基类，这里也返回由平台确定的具体类（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SecureTransfer/AliceRunner.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0024"><code>class AliceRunner : IDisposable</code>
<code>{</code>
<code>  private readonly ILogger _logger;</code>
<code>  private ECDiffieHellman _algorithm;</code>
<code>  public AliceRunner(ILogger&lt;AliceRunner&gt; logger)</code>
<code>  {</code>
<code>    _logger = logger;</code>
<code>    _algorithm = ECDiffieHellman.Create();</code>
<code>    _logger.LogInformation(</code>
<code>      $"Using this ECDiffieHellman class: {_algorithm.GetType().Name}");</code>
<code>  }</code>
<code> </code>
<code>  public void Dispose() =&gt; _algorithm.Dispose();</code>
<code> </code>
<code>  public ECDiffieHellmanPublicKey GetPublicKey() =&gt; <b>_algorithm.PublicKey;</b></code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Alice's <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellman</code>
                    instance contains the public and private keys from Alice. To encrypt the message that is sent to
                    Bob, the public key from Bob is used to create a symmetric key. The method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">DeriveKeyMaterial</code>
                    makes use of Bob's public key to create the symmetric key. The returned symmetric key is used with
                    the AES symmetric algorithm to encrypt the data. The <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Aes</code> class requires
                    the key and an initialization vector (IV). The IV is generated dynamically from the method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GenerateIV</code>. The
                    symmetric key is exchanged with the help of the EC Diffie-Hellman algorithm, but the IV must also be
                    exchanged. From a security standpoint, it is okay to transfer the IV unencrypted across the network,
                    but the key exchange must be secured. The IV is part of the tuple that is returned from the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetSecretMessageAsync</code>,
                    along with the encrypted message. When you use the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Aes</code> object, an
                    encryptor is created by invoking the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetEncryptor</code>
                    method. This encryptor is then used with a <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CryptoStream</code>. The
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CryptoStream</code> is
                    configured to write into a <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">MemoryStream</code>.
                    After the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CryptoStream</code> is
                    flushed, the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">MemoryStream</code> can
                    be used to convert the data written to a byte array (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SecureTransfer/AliceRunner.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">爱丽丝的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECDiffieHellman</code>
                                实例包含爱丽丝的公钥和私钥。为了加密发送给鲍勃的消息，使用鲍勃的公钥来创建对称密钥。方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">DeriveKeyMaterial</code>
                                利用鲍勃的公钥来创建对称密钥。返回的对称密钥与 AES 对称算法一起用于加密数据。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Aes</code>
                                类需要密钥和初始化向量（IV）。IV 是通过方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GenerateIV</code>
                                动态生成的。对称密钥通过 EC Diffie-Hellman 算法进行交换，但 IV 也必须交换。从安全角度来看，将 IV
                                未加密地传输过网络是可以的，但密钥交换必须保持安全。IV 是返回自 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetSecretMessageAsync</code>
                                的元组的一部分，与加密消息一起返回。当你使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Aes</code>
                                对象时，通过调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetEncryptor</code>
                                方法创建一个加密器。然后使用该加密器与 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CryptoStream</code>
                                一起使用。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CryptoStream</code>
                                被配置为写入 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">MemoryStream</code>
                                。在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CryptoStream</code>
                                被刷新后， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">MemoryStream</code>
                                可以用来将写入的数据转换为字节数组（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SecureTransfer/AliceRunner.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0025"><code>public async Task&lt;(byte[] Iv, byte[] EncryptedData)&gt; GetSecretMessageAsync(</code>
<code>  ECDiffieHellmanPublicKey otherPublicKey)</code>
<code>{</code>
<code>  string message = "secret message from Alice";</code>
<code>  _logger.LogInformation($"Alice sends message {message}");</code>
<code> </code>
<code>  byte[] plainData = Encoding.UTF8.GetBytes(message);</code>
<code> </code>
<code>  byte[] symmKey = <b>_algorithm.DeriveKeyMaterial(otherPublicKey);</b></code>
<code>  _logger.LogInformation($"Alice creates this symmetric key with " +</code>
<code>    $"Bobs public key information: {Convert.ToBase64String(symmKey)}");</code>
<code> <span aria-label="575" epub:type="pagebreak" id="Page_575" role="doc-pagebreak"></span></code>
<code>  <b>using Aes aes = Aes.Create();</b></code>
<code>  _logger.LogInformation($"Using this Aes class: {aes.GetType().Name}");</code>
<code>  <b>aes.Key = symmKey;</b></code>
<code>  <b>aes.GenerateIV();</b></code>
<code>  <b>using ICryptoTransform encryptor = aes.CreateEncryptor();</b></code>
<code>  using MemoryStream ms = new();</code>
<code>  using (CryptoStream cs = new(ms, encryptor, CryptoStreamMode.Write))</code>
<code>  {</code>
<code>    <b>await cs.WriteAsync(plainData.AsMemory());</b></code>
<code>  } // need to close the CryptoStream before using the MemoryStream</code>
<code>  byte[] encryptedData = ms.ToArray();</code>
<code>  _logger.LogInformation($"Alice: message is encrypted: " + </code>
<code>    $"{Convert.ToBase64String(encryptedData)}");</code>
<code>  var returnData = (aes.IV, encrye ptedData);</code>
<code>  aes.Clear();</code>
<code>  return returnData;</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <div class="top hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <p id="c20-para-0080" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">NOTE</b> <i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Read more about
                                streams in <a href="c18.xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Chapter
                                    18</a>, “Files and Streams.”</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 有关流的更多信息，请参阅第 18
                                        章“文件和流”。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">The constructor and the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetPublicKey</code>
                    method look similar to the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AliceRunner</code> class;
                    that's why they’re not repeated with Bob. The <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ReadMessageAsync</code>
                    method shown in the following code snippet uses the public and private keys from Bob that have been
                    created when creating the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECFiffieHellman</code>
                    instance, and the public key from Alice is used to create the symmetric key for the
                    communication—again invoking <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">DeriveKeyMaterial</code>.
                    Now the same symmetric key value as the one that was created from Alice is created—this is a
                    property of the EC Diffie-Helman algorithm—without exchanging this key. This key is assigned to the
                    Key property of the Aes instance.
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></code> Here, the same
                    IV that was created from Alice must be assigned to the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">IV</code> property. Next,
                    a decryptor is created invoking the method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CreateDecryptor</code> to
                    decrypt the message. This decryptor is used with the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CryptoStream</code>
                    class. The code is similar to the one from Alice, but now the message is decrypted (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SecureTransfer/BobRunner.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">构造函数和 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">GetPublicKey</code>
                                方法与 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AliceRunner</code>
                                类相似；这就是它们没有与 Bob 重复的原因。以下代码片段中显示的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ReadMessageAsync</code>
                                方法使用了创建 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ECFiffieHellman</code>
                                实例时生成的 Bob 的公钥和私钥，并使用 Alice 的公钥来创建通信的对称密钥——再次调用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">DeriveKeyMaterial</code>
                                。现在，与 Alice 创建的相同对称密钥值被创建——这是 EC Diffie-Helman 算法的特性——而无需交换这个密钥。这个密钥被分配给 Aes 实例的 Key 属性。
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></code>
                                这里，必须将 Alice 创建的相同 IV 分配给 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">IV</code>
                                属性。接下来，创建一个解密器，调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CreateDecryptor</code>
                                来解密消息。这个解密器与 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">CryptoStream</code>
                                类一起使用。代码与 Alice 的代码相似，但现在消息被解密（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SecureTransfer/BobRunner.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0026"><code>public async Task ReadMessageAsync(byte[] iv, byte[] encryptedData, </code>
<code>  ECDiffieHellmanPublicKey otherPublicKey)</code>
<code>{</code>
<code>  _logger.LogInformation("Bob receives encrypted data");</code>
<code>  <b>byte[] symmKey = _algorithm.DeriveKeyMaterial(otherPublicKey);</b></code>
<code>  _logger.LogInformation($"Bob creates this symmetric key with " +</code>
<code>    $"Alice public key information: {Convert.ToBase64String(symmKey)}");</code>
<code> </code>
<code>  <b>Aes aes = Aes.Create();</b></code>
<code>  <b>aes.Key = symmKey;</b></code>
<code>  <b>aes.IV = iv;</b></code>
<code>  <b>using ICryptoTransform decryptor = aes.CreateDecryptor();</b></code>
<code>  using MemoryStream ms = new();</code>
<code>  using (CryptoStream cs = new(ms, decryptor, CryptoStreamMode.Write))</code>
<code>  {</code>
<code>    await cs.WriteAsync(encryptedData.AsMemory());</code>
<code>  } // close the cryptostream before using the memorystream </code>
<code>  byte[] rawData = ms.ToArray();</code>
<code>  _logger.LogInformation($"Bob decrypts message to: {Encoding.UTF8.GetString(rawData)}");</code>
<code>  aes.Clear();</code>
<code>}<span aria-label="576" epub:type="pagebreak" id="Page_576" role="doc-pagebreak"></span></code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Running the application returns output like the following.
                    The message from Alice is encrypted and then decrypted by Bob with the securely exchanged symmetric
                    key.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">运行应用程序返回如下输出。来自 Alice 的消息被加密，然后由
                                Bob 使用安全交换的对称密钥解密。</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0027"><code>info: AliceRunner[0]</code>
<code>      Using this ECDiffieHellman class: ECDiffieHellmanCng</code>
<code>info: AliceRunner[0]</code>
<code>      Alice sends message secret message from Alice</code>
<code>info: AliceRunner[0]</code>
<code>      Alice creates this symmetric key with Bobs public key information: </code>
<code>JAj1V/xZaaFQriVGsKWzBwWk0WpGSltC8O8ja6vqxX4=</code>
<code>info: AliceRunner[0]</code>
<code>      Using this Aes class: AesImplementation</code>
<code>info: AliceRunner[0]</code>
<code>      Alice: message is encrypted: ItD+jtDRlSyEIyNnT1BHMNXoRQG3xZzpClakd6Zy/js=</code>
<code>info: BobRunner[0]</code>
<code>      Bob receives encrypted data</code>
<code>info: BobRunn]</code>
<code>      Bob creates this symmetric key with Alice public key information: </code>
<code>JAj1V/xZaaFQriVGsKWzBwWk0WpGSltC8O8ja6vqxX4=</code>
<code>info: BobRunner[0]</code>
<code>      Bob decrypts message to: secret message from Alice</code></pre>
            </section>
        </section>
        <section aria-labelledby="head-2-189" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
            <span id="c20-sec-0017" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
            <h2 id="head-2-189" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">ENSURING WEB SECURITY<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">确保网页安全</font>
                    </font>
                </font>
            </h2>
            <p id="c20-para-0083" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">Web applications have some specific security issues you need to
                be aware of with applications that allow user input. User input cannot be trusted. Verifying input data
                on the client using JavaScript or built-in HTML5 features is only for the convenience of the user.
                Errors can be shown without making an extra network request to the server. However, the client cannot be
                trusted. HTTP requests can be intercepted, and the user (a hacker) can make different requests that
                bypass the HTML5 and JavaScript validation.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">Web
                            应用程序存在一些特定的安全问题，在使用允许用户输入的应用程序时需要特别注意。用户输入是不可信任的。在客户端使用 JavaScript 或内置的 HTML5
                            功能验证输入数据只是为了方便用户。错误可以在不向服务器发起额外网络请求的情况下显示。然而，客户端是不可信任的。HTTP 请求可能被拦截，用户（黑客）可以发起不同的请求来绕过 HTML5
                            和 JavaScript 的验证。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0084" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">This section looks at common issues with web applications and
                what you need to be aware of to avoid issues. The sample application created is based on the ASP.NET
                Core MVC template; you can use <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">dotnet new mvc</code> or
                Visual Studio to create the foundation of this application.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本节将探讨 Web
                            应用程序的常见问题以及你需要注意的事项来避免这些问题。创建的示例应用程序基于 ASP.NET Core MVC 模板；你可以使用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">dotnet new mvc</code>
                            或 Visual Studio 来创建这个应用程序的基础。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><span id="c20-sec-0018"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
                <h3 id="head-3-384" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Encoding <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">编码</font>
                        </font>
                    </font>
                </h3>
                <p id="c20-para-0085" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Never trust user input. Writing user information to a
                    database and using this information to display on a website can be the cause of a typical hack. For
                    example, a community website was showing the latest five new users on the home page. One of the new
                    users managed to add a script to the username, and the script did a redirect to a malicious website.
                    Because the user information was shown for every user coming to this site, every user was
                    redirected.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                永远不要信任用户输入。将用户信息写入数据库并使用这些信息在网站上显示可能是典型黑客攻击的原因。例如，一个社区网站在主页上显示最新的五个新用户。其中一个新用户设法在用户名中添加了一个脚本，该脚本重定向到一个恶意网站。由于用户信息对每个访问该网站的用户都可见，因此所有用户都被重定向。
                            </font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">The next example looks at how easy it is to simulate and
                    avoid such a behavior. In the following code snippet, the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">/echo</code> URL is
                    mapped to an answer that returns the input from the user assigned to the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">x</code> parameter that
                    sends the response using <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">context.Response.WriteAsync</code>
                    (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Startup.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">下一个示例展示了如何轻松模拟和避免这种行为。在以下代码片段中，
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">/echo</code>
                                URL 映射到一个返回用户输入的响应，该输入分配给 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">x</code>
                                参数，并通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">context.Response.WriteAsync</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Startup.cs</code>
                                ）发送响应：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0028"><code>endpoints.Map("/echo", async context =&gt;</code>
<code>{</code>
<code>  string data = context.Request.Query["x"];</code>
<code>  await context.Response.WriteAsync(data);</code>
<code>});</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Now it passes this request:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">现在它传递了这个请求：</font>
                        </font>
                    </font>
                </p>
                <pre
                    id="c20-code-0029"><code>http://localhost:5001/echo?x=I'm a nice user<span aria-label="577" epub:type="pagebreak" id="Page_577" role="doc-pagebreak"></span></code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">The string <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">I'm a nice user</code> is
                    returned to the browser. This is not that bad, but users may try to hack the system. For example,
                    users can input HTML code such as this:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">字符串 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">I'm a nice user</code>
                                被返回到浏览器。这并不算太糟糕，但用户可能会尝试黑入系统。例如，用户可以输入如下 HTML 代码：</font>
                        </font>
                    </font>
                </p>
                <pre
                    id="c20-code-0030"><code>http://localhost:5001/echo?x=&lt;h1&gt;Is this wanted?&lt;/h1&gt;</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">The result shows the input string is formatted with the HTML
                    <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">H1</code> tag. Users
                    can do more bad things by entering JavaScript code:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">结果显示输入的字符串被 HTML <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">H1</code>
                                标签格式化了。用户可以通过输入 JavaScript 代码做更多坏事：</font>
                        </font>
                    </font>
                </p>
                <pre
                    id="c20-code-0031"><code>localhost:5001/echo?x=&lt;script&gt;alert("this is bad");&lt;/script&gt;</code></pre>
                <p id="c20-para-0090" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">In most browsers, a pop-up window where the user entered text
                    shows up.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在大多数浏览器中，会弹出一个窗口显示用户输入的文本。</font>
                        </font>
                    </font>
                </p>
                <p id="c20-para-0091" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">If you try to avoid this issue by checking for <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;script&gt;</code>
                    elements with the input and don't return anything in that case, you'll likely fail. Instead of using
                    the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;script&gt;</code>
                    element, users can also use Unicode numbers for the angle brackets with the same result. Instead,
                    encode the user input so that it can't be interpreted by the browser.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">如果你试图通过检查输入中的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;script&gt;</code>
                                元素并在此情况下不返回任何内容来避免这个问题，你很可能会失败。用户除了使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;script&gt;</code>
                                元素外，还可以使用 Unicode 数字来表示尖括号，效果相同。相反，应该对用户输入进行编码，使其无法被浏览器解释。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">You can use the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HTMLEncoder</code> class
                    from the namespace <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">System.Text.Encodings.Web</code>
                    to encode user input:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">你可以使用来自命名空间 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">System.Text.Encodings.Web</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HTMLEncoder</code>
                                类来编码用户输入：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0032"><code>endpoints.Map("/echoenc", async context =&gt;</code>
<code>{</code>
<code>  string data = context.Request.Query["x"];</code>
<code>  await context.Response.WriteAsync(HtmlEncoder.Default.Encode(data));</code>
<code>});</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">When you use the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HtmlEncoder</code> class,
                    the user can enter <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;h1&gt;</code>
                    elements with the input <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">http://localhost:5001/echoenc?x=&lt;h1&gt;this gets converted&lt;/h1&gt;</code>.
                    As a result, <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;h1&gt;this gets converted&lt;/h1&gt;</code>
                    is shown in the browser. The <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;</code> character is
                    encoded to <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;</code>
                    and thus displayed as text. The complete encoded string is as follows:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当你使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HtmlEncoder</code>
                                类时，用户可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;h1&gt;</code>
                                元素和输入 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">http://localhost:5001/echoenc?x=&lt;h1&gt;this gets converted&lt;/h1&gt;</code>
                                。因此， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;h1&gt;this gets converted&lt;/h1&gt;</code>
                                在浏览器中显示。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;</code>
                                字符被编码为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;</code>
                                ，因此显示为文本。完整的编码字符串如下：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0033"><code>&lt;h1&gt;this gets converted&lt;/h1&gt;</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Similarly, the script element is converted and doesn't run as
                    a script in the browser.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">类似地，脚本元素被转换，不会在浏览器中作为脚本运行。</font>
                        </font>
                    </font>
                </p>
                <aside data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <div class="top hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <p id="c20-para-0095" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">NOTE</b> <i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">You can use the
                            </i><code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HtmlEncoder</code><i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"> class to allow
                                specific inputs to go through. For example, you might allow the user to add </i><code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;b&gt;</code><i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"> elements. You
                                can create an encoder with accepted inputs using the </i><code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HtmlEncoder.Create</code><i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"> method. Today, a
                                preferred method is to allow the user to include some formatting by using Markdown and
                                converting Markdown to HTML. You can read my blog article about Markdown at </i><code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://csharp.christiannagel.com/2016/07/03/markdown/">https://csharp.christiannagel.com/2016/07/03/markdown/</a></code><i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 你可以使用 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HtmlEncoder</code>
                                        类来允许特定的输入通过。例如，你可以允许用户添加 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">&lt;b&gt;</code>
                                        元素。你可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HtmlEncoder.Create</code>
                                        方法创建一个接受输入的编码器。如今，一种更受欢迎的方法是允许用户通过使用 Markdown 来包含一些格式，并将 Markdown 转换为
                                        HTML。你可以阅读我在 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://csharp.christiannagel.com/2016/07/03/markdown/">https://csharp.christiannagel.com/2016/07/03/markdown/</a></code>
                                        上的 Markdown 博客文章。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p id="c20-para-0096" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">The sample code has so far made use of ASP.NET Core
                    functionality. When you directly return a string from an ASP.NET Core MVC controller or inside a
                    view, encoding happens by default. You need to make an extra investment not to encode the result
                    here.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">示例代码到目前为止已经使用了 ASP.NET Core
                                功能。当你直接从 ASP.NET Core MVC 控制器返回字符串或在视图中返回时，默认会进行编码。你需要额外投入以避免在此处编码结果。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Just returning a string with an ASP.NET Core controller
                    results in an encoded string (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Controllers/HomeController.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">仅使用 ASP.NET Core
                                控制器返回字符串会导致编码的字符串（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Controllers/HomeController.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0034"><code>public string Echo(string x) =&gt; x;</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">To send an unencoded string, the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Content</code> method of
                    the <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Controller</code>
                    base class can be used, and you specify that the content is returned as <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">text/html</code>
                    :<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要发送未编码的字符串，可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Controller</code>
                                基类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Content</code>
                                方法，并指定内容作为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">text/html</code>
                                返回：</font>
                        </font>
                    </font>
                </p>
                <pre
                    id="c20-code-0035"><code>public IActionResult EchoUnencoded(string x) =&gt; Content(x, "text/html");</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Let's go a step further by using Razor code in a view. Here,
                    the <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">EchoWithView</code>
                    method passes the input data from the user using <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ViewBag.SampleData</code>
                    to a view (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Controllers/HomeController.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">让我们通过在视图中使用 Razor 代码来更进一步。在这里，
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">EchoWithView</code>
                                方法使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ViewBag.SampleData</code>
                                将用户输入的数据传递给视图（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Controllers/HomeController.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0036"><code>public IActionResult EchoWithView(string x)</code>
<code>{<span aria-label="578" epub:type="pagebreak" id="Page_578" role="doc-pagebreak"></span></code>
<code>  ViewBag.SampleData = x;</code>
<code>  return View();</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">In the view, encoding happens by default when you pass the
                    input data using the Razor expression <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">@data</code>. <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">data</code> is a local
                    variable where the passed <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ViewBag</code>
                    information is assigned. For not making use of encoding, you can use the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Html</code> helper class
                    with the method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Raw</code> (code file
                    <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Views/Home/EchoWithView.cshtml</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在视图中，当你使用 Razor 表达式 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">@data</code>
                                传递输入数据时，默认会进行编码。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">data</code>
                                是一个局部变量，用于分配传递的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ViewBag</code>
                                信息。若不使用编码，可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Html</code>
                                辅助类及其 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Raw</code>
                                方法（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Views/Home/EchoWithView.cshtml</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0037"><code>@{ </code>
<code> string data = ViewBag.SampleData;</code>
<code>}</code>
<code>&lt;div&gt;</code>
<code>  this is encoded</code>
<code>&lt;/div&gt;</code>
<code>&lt;div&gt;@data&lt;/div&gt;</code>
<code> </code>
<code>&lt;br/&gt;</code>
<code>&lt;div&gt;</code>
<code>  This is not encoded</code>
<code>&lt;/div&gt;</code>
<code>&lt;div&gt;</code>
<code>  @Html.Raw(@data)</code>
<code>&lt;/div&gt;</code></pre>
                <aside data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <div class="top hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <p id="c20-para-0102" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">NOTE</b> <i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">When explicitly
                                sending unencoded data to the client, you need to make sure the input can be trusted—for
                                example, using HTML converted from Markdown instead of directly returning user
                                input.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意
                                        当明确将未编码数据发送给客户端时，需要确保输入是可信的——例如，使用从 Markdown 转换的 HTML，而不是直接返回用户输入。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                            <hr />
                        </div>
                    </section>
                </aside>
                <aside data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <div class="top hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <p id="c20-para-0103" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">NOTE</b> <i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">You can use the
                            </i> <code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">UrlEncoder</code>
                            <i data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"> class when using
                                user input for URL strings similarly to how you use the </i> <code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HtmlEncoder</code>
                            <i data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"> class when using
                                user input as HTML content.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 当使用用户输入作为 URL
                                        字符串时，你可以像使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HtmlEncoder</code>
                                        类作为 HTML 内容一样使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">UrlEncoder</code>
                                        类。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
            <section data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><span id="c20-sec-0022"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
                <h3 id="head-3-385" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Preventing SQL Injection<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">防止 SQL 注入</font>
                        </font>
                    </font>
                </h3>
                <p id="c20-para-0104" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Another common problem with web applications is SQL
                    injection. As with HTML encoding, the issue can easily be avoided by using built-in functionality.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">另一个常见的 Web 应用问题是 SQL 注入。与 HTML
                                编码一样，通过使用内置功能，这个问题很容易被避免。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">The following code snippet creates an SQL string that
                    directly assigns the input parameter in the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SqlSample</code>
                    controller method. With this, the user can enter <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">;SELECT * FROM Users</code>,
                    and the following information is shown to the user:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">以下代码片段创建了一个 SQL 字符串，直接在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">SqlSample</code>
                                控制器方法中分配输入参数。通过这种方式，用户可以输入 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">;SELECT * FROM Users</code>
                                ，并向用户显示以下信息：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0038"><code>public IActionResult SqlSample(string id) </code>
<code>{ </code>
<code>  string connectionString = GetConnectionString();</code>
<code>  SqlConnection sqlConnection = new(connectionString); </code>
<code>  SqlCommand command = sqlConnection.CreateCommand(); </code>
<code>  <b>// don't do this - string concatenation for SQL commands!</b></code>
<code>  command.CommandText = <b>"SELECT * FROM Customers WHERE City = " + id;</b>   </code>
<code>  sqlConnection.Open(); </code>
<code>  using (SqlDataReader reader = </code>
<code>    command.ExecuteReader(System.Data.CommandBehavior.CloseConnection)) </code>
<code>  { <span aria-label="579" epub:type="pagebreak" id="Page_579" role="doc-pagebreak"></span></code>
<code>    StringBuilder sb = new(); </code>
<code>    while (reader.Read()) </code>
<code>    { </code>
<code>      for (int i = 0; i &lt; reader.FieldCount; i++) </code>
<code>      { </code>
<code>        sb.Append(reader[i]); </code>
<code>      } </code>
<code>      sb.AppendLine(); </code>
<code>    } </code>
<code>    ViewBag.Data = sb.ToString(); </code>
<code>  } </code>
<code>  return View(); </code>
<code>}</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">You should never use string concatenation with SQL
                    statements. Instead, you can easily avoid this problem by using parameters or implicitly using
                    Entity Framework Core parameters.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">你永远不应该在 SQL
                                语句中使用字符串拼接。相反，你可以通过使用参数或隐式使用 Entity Framework Core 参数来轻松避免这个问题。</font>
                        </font>
                    </font>
                </p>
                <aside data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <div class="top hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <p id="c20-para-0107" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">NOTE</b> <i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Entity Framework
                                Core is covered in <a href="c21.xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Chapter
                                    21</a>, “Entity Framework Core.”</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意：Entity Framework Core
                                        在第 21 章“Entity Framework Core”中介绍。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
            <section data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><span id="c20-sec-0024"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
                <h3 id="head-3-386" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Protecting Against Cross-Site Request Forgery <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">防范跨站请求伪造</font>
                        </font>
                    </font>
                </h3>
                <p id="c20-para-0108" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Cross-site request forgery (XSRF) is an attack in which a
                    malicious website tries to simulate a user and enter data without the user knowing.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                跨站请求伪造（XSRF）是一种攻击，恶意网站试图在不用户知情的情况下模拟用户并提交数据。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">Let's get into an example where the user enters book
                    information in a form. <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Book</code> is a simple
                    model class containing <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Title</code> and <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Publisher</code>
                    properties. Within the <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HomeController</code>,
                    the <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">EditBook</code>
                    method returns a view (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Controllers/HomeController.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">让我们来看一个用户在表单中输入书籍信息的例子。 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Book</code>
                                是一个简单的模型类，包含 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Title</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Publisher</code>
                                属性。在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">HomeController</code>
                                中， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">EditBook</code>
                                方法返回一个视图（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Controllers/HomeController.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0039"><code>public IActionResult EditBook() =&gt; View();</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">The view defines simple input data where the user can enter
                    title and publisher information and pass this information to the server with an HTTP POST request
                    (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Views/EditBook.cshtml</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">视图定义了简单的输入数据，用户可以输入标题和出版社信息，并通过
                                HTTP POST 请求将这些信息传递给服务器（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Views/EditBook.cshtml</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0040"><code>@{</code>
<code>    ViewData["Title"] = "EditBook";</code>
<code>}</code>
<code>&lt;h2&gt;Edit Book&lt;/h2&gt;</code>
<code> </code>
<code>&lt;<b>form asp-controller=</b>"Home" <b>asp-action</b>="EditBook" method="post"&gt;</code>
<code>  &lt;label for="title"&gt;Title:&lt;/label&gt;</code>
<code>  &lt;input type="text" id="title" name="title"/&gt;</code>
<code>  &lt;br/&gt;</code>
<code>  &lt;label for="publisher"&gt;Publisher:&lt;/label&gt;</code>
<code>  &lt;input type="text" id="publisher" name="publisher"/&gt;</code>
<code>  &lt;br/&gt;</code>
<code>  &lt;input type="submit" value="Submit"/&gt;</code>
<code><b>&lt;/form&gt;</b></code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">With the HTTP POST request, the following <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">EditBook</code> method is
                    invoked to display a view with the entered user data (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Controllers/HomeController.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">通过 HTTP POST 请求，调用以下 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">EditBook</code>
                                方法来显示包含输入用户数据的视图（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Controllers/HomeController.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0041"><code>[HttpPost]</code>
<code>public IActionResult EditBook(Book book) =&gt; View("EditBookResult", book);</code></pre>
                <p id="c20-para-0112" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">When you run the application while opening the URL <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="http://localhost:5001/Home/EditBook">http://localhost:5001/Home/EditBook</a></code>,
                    book information can be entered, the submit button can be clicked, the information is received from
                    the controller, and the book information is shown in the view result.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当您在打开 URL <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="http://localhost:5001/Home/EditBook">http://localhost:5001/Home/EditBook</a></code>
                                时运行应用程序，可以输入书籍信息，点击提交按钮，控制器接收信息，并在视图结果中显示书籍信息。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1"><span aria-label="580" epub:type="pagebreak" id="Page_580"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>Meanwhile, a
                    malicious website just needs to use the same link to post the data in its own form. Check the
                    following code snippet with the form element that references the same URL as before. This form is
                    hosted from a different website, <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://localhost:5002/dothis.html">https://localhost:5002/dothis.html</a></code>.
                    Here it's only a different port, but it could be a different domain name as well. The user doesn't
                    need to enter anything with the form (the input elements are hidden and thus not shown to the user).
                    The user just needs to click the submit button without knowing something different happens behind
                    the scenes (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="http://HackingSite/wwwroot/dothis.html">HackingSite/wwwroot/dothis.html</a></code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                与此同时，恶意网站只需使用相同的链接在其自己的表单中提交数据。检查以下代码片段，其中包含的表单元素引用了之前相同的 URL。该表单托管在不同的网站， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://localhost:5002/dothis.html">https://localhost:5002/dothis.html</a></code>
                                。这里只是一个不同的端口，但它也可能是不同的域名。用户无需在表单中输入任何内容（输入元素被隐藏且不会显示给用户）。用户只需点击提交按钮，而无需知道幕后发生了什么不同（代码文件
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="http://HackingSite/wwwroot/dothis.html">HackingSite/wwwroot/dothis.html</a></code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0042"><code>&lt;h1&gt;Click this for a win!&lt;/h1&gt;</code>
<code> </code>
<code>&lt;!-- form has a redirect to the website being hacked --&gt;</code>
<code>&lt;form action="http://localhost:24897/Home/EditBook" method="post"&gt;</code>
<code>  &lt;input type="hidden" value="bad book title" name="title"/&gt;</code>
<code>  &lt;input type="hidden" value="bad publisher" name="publisher"/&gt;</code>
<code>  &lt;input type="submit" value="Click Now!"/&gt;</code>
<code>&lt;/form&gt;</code></pre>
                <p id="c20-para-0114" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">When you click this link, the malicious data is transmitted
                    to the website on behalf of the user. If the user is authenticated with the book website and didn't
                    sign out, the data is submitted on behalf of the user, and probably some ordering happened with a
                    different delivery address.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                当您点击此链接时，恶意数据会代表用户传输到网站。如果用户已通过书籍网站进行身份验证且未登出，数据将代表用户提交，并且可能会使用不同的配送地址进行订购。</font>
                        </font>
                    </font>
                </p>
                <p id="c20-para-0115" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">To avoid this behavior, ASP.NET Core offers antiforgery
                    tokens. Such a token needs to be created from the form that should be used from the user to enter
                    valid data and is validated on receiving the data.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">为了避免这种行为，ASP.NET Core
                                提供了防伪令牌。该令牌需要从用户应使用的表单中创建，并在接收数据时进行验证。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">The Edit Book form is now changed to include this token with
                    the HTML helper method <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AntiForgeryToken</code>
                    (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Views/EditBookSecure.cshtml</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">编辑书籍表单现已更改为包含此令牌，使用 HTML 辅助方法
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">AntiForgeryToken</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Views/EditBookSecure.cshtml</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0043"><code>&lt;<b>form asp-controller</b>="Home" <b>asp-action</b>="EditBookSecure" method="post"&gt;</code>
<code>  <b>@Html.AntiForgeryToken()</b></code>
<code> </code>
<code>  &lt;label for="title"&gt;Title:&lt;/label&gt;</code>
<code>  &lt;input type="text" id="title" name="title"/&gt;</code>
<code>  &lt;br/&gt;</code>
<code>  &lt;label for="publisher"&gt;Publisher:&lt;/label&gt;</code>
<code>  &lt;input type="text" id="publisher" name="publisher "/&gt;</code>
<code>  &lt;br/&gt;</code>
<code>  &lt;input type="submit" value="Submit "/&gt;</code>
<code><b>&lt;/form&gt;</b></code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">When you run the application, you can see a hidden form field
                    with the automatically generated token. When the data is retrieved, the token is validated using the
                    <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ValidateAntiForgeryToken</code>
                    attribute (code file <code
                        data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Controllers/HomeController.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                运行应用程序时，您可以看到一个包含自动生成的令牌的隐藏表单字段。当数据被检索时，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ValidateAntiForgeryToken</code>
                                属性（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">ASPNETCoreMVCSecurity/Controllers/HomeController.cs</code>
                                ）对令牌进行验证：</font>
                        </font>
                    </font>
                </p>
                <pre id="c20-code-0044"><code>[HttpPost]</code>
<code><b>[ValidateAntiForgeryToken]</b></code>
<code>public IActionResult EditBookSecure(Book book) =&gt; View("EditBookResult", book);</code></pre>
                <p data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                    data-immersive-translate-paragraph="1">When you run the malicious website now, a response is
                    returned without accepting invalid data.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">现在运行恶意网站时，会返回响应而不接受无效数据。 </font>
                        </font>
                    </font>
                </p>
                <aside data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                    <div class="top hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                        <p id="c20-para-0119" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">NOTE</b> <i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">The Open Web
                                Application Security Project (OWASP) foundation continuously analyzes security risks
                                with web applications and publishes the OWASP top ten (</i><code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://owasp.org/www-project-top-ten/">https://owasp.org/www-project-top-ten/</a></code><i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">). You can use
                                OWASP Zed Attack Proxy (ZAP) (</i><code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://www.zapproxy.org">https://www.zapproxy.org</a></code><i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">) within GitHub
                                actions (OWASP ZAP Full Scan) to analyze your web application and server to
                                automatically scan it for issues. For a scan of the source code analysis tools for
                                security, you can check the list of tools available at </i><code
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://owasp.org/www-community/Source:Code_Analysis_Tools">https://owasp.org/www-community/Source:Code_Analysis_Tools</a></code><i
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">
                                        注意：开放网络应用安全项目（OWASP）基金会持续分析网络应用的安全风险，并发布 OWASP 十大风险（ <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://owasp.org/www-project-top-ten/">https://owasp.org/www-project-top-ten/</a></code>
                                        ）。您可以在 GitHub actions（OWASP ZAP 全扫描）中使用 OWASP ZAP 攻击代理（ZAP）（ <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://www.zapproxy.org">https://www.zapproxy.org</a></code>
                                        ）来分析您的网络应用和服务器，自动扫描其中存在的问题。对于源代码分析工具的安全扫描，您可以查看 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"><a href="https://owasp.org/www-community/Source:Code_Analysis_Tools">https://owasp.org/www-community/Source:Code_Analysis_Tools</a></code>
                                        提供的工具列表。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
                            <hr />
                        </div>
                    </section>
                </aside>
            </section>
        </section> <span aria-label="581" epub:type="pagebreak" id="Page_581" role="doc-pagebreak"
            data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
        <section aria-labelledby="head-2-190" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">
            <span id="c20-sec-0026" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"></span>
            <h2 id="head-2-190" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">SUMMARY<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">摘要</font>
                    </font>
                </font>
            </h2>
            <p id="c20-para-0120" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">This chapter covered several aspects of security with .NET
                applications. Nowadays, we have a wide range of how users can be identified, and the Microsoft platform
                offers easy-to-use options. With web applications, you've seen the built-in functionality of ASP.NET
                Core to authenticate and authorize users with the Azure Active Directory.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本章涵盖了.NET 应用安全的多个方面。如今，我们有多种用户识别方式，而
                            Microsoft 平台提供了易于使用的选项。对于网络应用，您看到了 ASP.NET Core 内置的 Azure Active Directory 用户认证和授权功能。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0121" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">A brief overview of cryptography demonstrated how the signing and
                encrypting of data enables the exchange of keys in a secure way. .NET offers both symmetric and
                asymmetric cryptography algorithms as well as hashing and signing. You've also seen how to create an
                X.509 certificate using the Azure Key Vault.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">简述加密过程展示了如何通过数据签名和加密实现安全密钥交换。.NET
                            提供了对称和非对称加密算法，以及哈希和签名功能。您还学习了如何使用 Azure Key Vault 创建 X.509 证书。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0122" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">In many cases, you can work with security from higher abstraction
                levels. For example, when using HTTPS to access a web server, keys for encryption are exchanged behind
                the scenes. The <code data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">File</code>
                class offers an <code
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Encrypt</code> method to
                easily encrypt files. Still, it's important to know what happens behind this functionality.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">在许多情况下，你可以从更高的抽象层次处理安全问题。例如，当使用 HTTPS
                            访问 Web 服务器时，加密密钥会在后台进行交换。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">File</code>
                            类提供了一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Encrypt</code>
                            方法来轻松加密文件。然而，了解这项功能背后的运作机制仍然很重要。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0123" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">Regarding web applications, you've seen common issues with
                trusting user input that result in various attacks, including cross-site request forgery. You've seen
                how various issues can be avoided using encoding and antiforgery request tokens to avoid XSRF.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">关于 Web
                            应用程序，你已经看到过因信任用户输入而导致各种攻击的常见问题，包括跨站请求伪造。你已经了解到如何使用编码和反伪造请求令牌来避免 XSRF。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0124" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">For more features on security, read <a href="c25.xhtml"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Chapter 25</a> to
                authenticate users and client applications accessing REST services, and see <a href="c26.xhtml"
                    data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0">Chapter 26</a> to
                authenticate and authorize users from a local database.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">关于更多安全功能，请阅读第 25 章来验证访问 REST
                            服务的用户和客户端应用程序，并查看第 26 章来验证和授权来自本地数据库的用户。</font>
                    </font>
                </font>
            </p>
            <p id="c20-para-0125" data-immersive-translate-walked="093939c7-4899-4ebe-8d49-1d3f4d4e5ce0"
                data-immersive-translate-paragraph="1">The next chapter, “Entity Framework Core,” reads and writes data
                from the database, and this should be secured.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">下一章“Entity Framework
                            Core”会读取和写入数据库数据，这些操作应该得到保护。</font>
                    </font>
                </font>
            </p>
        </section>
    </section>
</body>
<div id="immersive-translate-popup" style="all: initial"></div>

</html>