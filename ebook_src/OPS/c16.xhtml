<!-- 这行注释会存在于经过翻译的源文件中。除非您获得许可请不要删除这个注释。
    翻译由 ClassicByte Org 的 higashitani yume 完成
    使用工具 沉浸式翻译 智谱GLM模型
    您可以阅读这个源代码，也可以向他人分发此源代码，但是不得用于商业用途。
    您也可以自己将这些代码打包成epub分发给别人，但是不得用于商业用途。
    如果此源代码侵犯了您的权益，请联系我我将会删除侵权内容。
    您在阅读此源代码时，可能会看到一些英文内容，这些内容是原书的内容，可能是因为翻译不准确或者是因为原书的内容没有被翻译。
    如果您发现了错误，请联系我我会进行修正。
  -->
<!--This line of comments will exist in the translated source file. Do not delete this comment unless you have permission.
    Translation is done by ClassicByte Org's higashitani yume
    Usage Tools Immersive Translation Zhipu GLM Model
    You can read this source code or distribute it to others, but it may not be used for commercial purposes.
    You can also package these codes yourself into epub and distribute them to others, but they may not be used for commercial purposes.
    If this source code infringes your rights, please contact me and I will delete the infringing content.
    When you read this source code, you may see some English content, which is the content of the original book, which may be because the translation is inaccurate or because the content of the original book has not been translated.
    If you find an error, please contact me and I will correct it.
  -->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops"
    xmlns:svg="http://www.w3.org/2000/svg" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en"
    imt-state="dual" imt-trans-position="after">

<head>
    <title>16 诊断和指标 --- 16 Diagnostics and Metrics</title>
    <link href="WileyTemplate_v5.5.css" rel="stylesheet" type="text/css" />
    <meta content="urn:uuid:e0000000-0000-0000-0000-000006715209" name="Adept.expected.resource" />
    <style data-id="immersive-translate-input-injected-css">
        .immersive-translate-input {
            position: absolute;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            z-index: 2147483647;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .immersive-translate-attach-loading::after {
            content: " ";

            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;

            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-2000%, -50%);
            z-index: 100;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .immersive-translate-input-loading {
            --loading-color: #f78fb6;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: block;
            margin: 12px auto;
            position: relative;
            color: white;
            left: -100px;
            box-sizing: border-box;
            animation: immersiveTranslateShadowRolling 1.5s linear infinite;
        }

        @keyframes immersiveTranslateShadowRolling {
            0% {
                box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            12% {
                box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            25% {
                box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color),
                    0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
            }

            36% {
                box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color),
                    100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
            }

            50% {
                box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color),
                    110px 0 var(--loading-color), 100px 0 var(--loading-color);
            }

            62% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color),
                    120px 0 var(--loading-color), 110px 0 var(--loading-color);
            }

            75% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    130px 0 var(--loading-color), 120px 0 var(--loading-color);
            }

            87% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
            }

            100% {
                box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
                    200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
            }
        }

        .immersive-translate-toast {
            display: flex;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            right: 0;
            top: 1%;
            width: fit-content;
            padding: 12px 20px;
            margin: auto;
            overflow: auto;
            background: #fef6f9;
            box-shadow: 0px 4px 10px 0px rgba(0, 10, 30, 0.06);
            font-size: 15px;
            border-radius: 8px;
            color: #333;
        }

        .immersive-translate-toast-content {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .immersive-translate-toast-hidden {
            margin: 0 20px 0 72px;
            text-decoration: underline;
            cursor: pointer;
        }

        .immersive-translate-toast-close {
            color: #666666;
            font-size: 20px;
            font-weight: bold;
            padding: 0 10px;
            cursor: pointer;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-toast {
                top: 0;
                padding: 12px 0px 0 10px;
            }

            .immersive-translate-toast-content {
                flex-direction: column;
                text-align: center;
            }

            .immersive-translate-toast-hidden {
                margin: 10px auto;
            }
        }

        .immersive-translate-modal {
            display: none;
            position: fixed;
            z-index: 2147483647;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
            font-size: 15px;
        }

        .immersive-translate-modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 40px 24px 24px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 80%;
            max-width: 270px;
            font-family: system-ui, -apple-system, "Segoe UI", "Roboto", "Ubuntu",
                "Cantarell", "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
                "Segoe UI Symbol", "Noto Color Emoji";
            position: relative;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-content {
                margin: 50% auto !important;
            }
        }

        .immersive-translate-modal .immersive-translate-modal-content-in-input {
            max-width: 500px;
        }

        .immersive-translate-modal-content-in-input .immersive-translate-modal-body {
            text-align: left;
            max-height: unset;
        }

        .immersive-translate-modal-title {
            text-align: center;
            font-size: 16px;
            font-weight: 700;
            color: #333333;
        }

        .immersive-translate-modal-body {
            text-align: center;
            font-size: 14px;
            font-weight: 400;
            color: #333333;
            word-break: break-all;
            margin-top: 24px;
        }

        @media screen and (max-width: 768px) {
            .immersive-translate-modal-body {
                max-height: 250px;
                overflow-y: auto;
            }
        }

        .immersive-translate-close {
            color: #666666;
            position: absolute;
            right: 16px;
            top: 16px;
            font-size: 20px;
            font-weight: bold;
        }

        .immersive-translate-close:hover,
        .immersive-translate-close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .immersive-translate-modal-footer {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        .immersive-translate-btn {
            width: fit-content;
            color: #fff;
            background-color: #ea4c89;
            border: none;
            font-size: 16px;
            margin: 0 8px;
            padding: 9px 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .immersive-translate-btn:hover {
            background-color: #f082ac;
        }

        .immersive-translate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .immersive-translate-btn:disabled:hover {
            background-color: #ea4c89;
        }

        .immersive-translate-cancel-btn {
            /* gray color */
            background-color: rgb(89, 107, 120);
        }

        .immersive-translate-cancel-btn:hover {
            background-color: hsl(205, 20%, 32%);
        }

        .immersive-translate-action-btn {
            background-color: transparent;
            color: #ea4c89;
            border: 1px solid #ea4c89;
        }

        .immersive-translate-btn svg {
            margin-right: 5px;
        }

        .immersive-translate-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #007bff;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-primary-link {
            cursor: pointer;
            user-select: none;
            -webkit-user-drag: none;
            text-decoration: none;
            color: #ea4c89;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }

        .immersive-translate-modal input[type="radio"] {
            margin: 0 6px;
            cursor: pointer;
        }

        .immersive-translate-modal label {
            cursor: pointer;
        }

        .immersive-translate-close-action {
            position: absolute;
            top: 2px;
            right: 0px;
            cursor: pointer;
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5) !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 16px !important;
        }

        .imt-image-status img,
        .imt-image-status svg,
        .imt-img-loading {
            width: 28px !important;
            height: 28px !important;
            margin: 0 0 8px 0 !important;
            min-height: 28px !important;
            min-width: 28px !important;
            position: relative !important;
        }

        .imt-img-loading {
            background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAtFBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////oK74hAAAAPHRSTlMABBMIDyQXHwyBfFdDMSw+OjXCb+5RG51IvV/k0rOqlGRM6KKMhdvNyZBz9MaupmxpWyj437iYd/yJVNZeuUC7AAACt0lEQVRIx53T2XKiUBCA4QYOiyCbiAsuuGBcYtxiYtT3f6/pbqoYHVFO5r+iivpo6DpAWYpqeoFfr9f90DsYAuRSWkFnPO50OgR9PwiCUFcl2GEcx+N/YBh6pvKaefHlUgZd1zVe0NbYcQjGBfzrPE8Xz8aF+71D8gG6DHFPpc4a7xFiCDuhaWgKgGIJQ3d5IMGDrpS4S5KgpIm+en9f6PlAhKby4JwEIxlYJV9h5k5nee9GoxHJ2IDSNB0dwdad1NAxDJ/uXDHYmebdk4PdbkS58CIVHdYSUHTYYRWOJblWSyu2lmy3KNFVJNBhxcuGW4YBVCbYGRZwIooipHsNqjM4FbgOQqQqSKQQU9V8xmi1QlgHqQQ6DDBvRUVCDirs+EzGDGOQTCATgtYTnbCVLgsVgRE0T1QE0qHCFAht2z6dLvJQs3Lo2FQoDxWNUiBhaP4eRgwNkI+dAjVOA/kUrIDwf3CG8NfNOE0eiFotSuo+rBiq8tD9oY4Qzc6YJw99hl1wzpQvD7ef2M8QgnOGJfJw+EltQc+oX2yn907QB22WZcvlUpd143dqQu+8pCJZuGE4xCuPXJqqcs5sNpsI93Rmzym1k4Npk+oD1SH3/a3LOK/JpUBpWfqNySxWzCfNCUITuDG5dtuphrUJ1myeIE9bIsPiKrfqTai5WZxbhtNphYx6GEIHihyGFTI69lje/rxajdh0s0msZ0zYxyPLhYCb1CyHm9Qsd2H37Y3lugVwL9kNh8Ot8cha6fUNQ8nuXi5z9/ExsAO4zQrb/ev1yrCB7lGyQzgYDGuxq1toDN/JGvN+HyWNHKB7zEoK+PX11e12G431erGYzwmytAWU56fkMHY5JJnDRR2eZji3AwtIcrEV8Cojat/BdQ7XOwGV1e1hDjGGjXbdArm8uJZtCH5MbcctVX8A1WpqumJHwckAAAAASUVORK5CYII=");
            background-size: 28px 28px;
            animation: image-loading-rotate 1s linear infinite !important;
        }

        .imt-image-status span {
            color: var(--bg-2, #fff) !important;
            font-size: 14px !important;
            line-height: 14px !important;
            font-weight: 500 !important;
            font-family: "PingFang SC", Arial, sans-serif !important;
        }

        @keyframes image-loading-rotate {
            from {
                transform: rotate(360deg);
            }

            to {
                transform: rotate(0deg);
            }
        }
    </style>
    <style data-id="immersive-translate-default-injected-css">
        :root {
            --immersive-translate-theme-underline-borderColor: #72ece9;
            --immersive-translate-theme-nativeUnderline-borderColor: #72ece9;
            --immersive-translate-theme-nativeDashed-borderColor: #72ece9;
            --immersive-translate-theme-nativeDotted-borderColor: #72ece9;
            --immersive-translate-theme-highlight-backgroundColor: #ffff00;
            --immersive-translate-theme-dashed-borderColor: #59c1bd;
            --immersive-translate-theme-blockquote-borderColor: #cc3355;
            --immersive-translate-theme-thinDashed-borderColor: #ff374f;
            --immersive-translate-theme-dashedBorder-borderColor: #94a3b8;
            --immersive-translate-theme-dashedBorder-borderRadius: 0;
            --immersive-translate-theme-solidBorder-borderColor: #94a3b8;
            --immersive-translate-theme-solidBorder-borderRadius: 0;
            --immersive-translate-theme-dotted-borderColor: #94a3b8;
            --immersive-translate-theme-wavy-borderColor: #72ece9;
            --immersive-translate-theme-dividingLine-borderColor: #94a3b8;
            --immersive-translate-theme-grey-textColor: #2f4f4f;
            --immersive-translate-theme-marker-backgroundColor: #fbda41;
            --immersive-translate-theme-marker-backgroundColor-rgb: 251, 218, 65;
            --immersive-translate-theme-marker2-backgroundColor: #ffff00;
            --immersive-translate-theme-background-backgroundColor: #dbafaf;
            --immersive-translate-theme-background-backgroundColor-rgb: 219, 175, 175;
            --immersive-translate-theme-background-backgroundOpacity: 12;
            --immersive-translate-theme-opacity-opacity: 10;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pre-whitespace {
            white-space: pre-wrap !important;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container {
            position: absolute;
            background-color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
                sans-serif;
            top: 0;
            width: 600px;
            height: 100%;
            z-index: 2;
            line-height: 1.3;
            font-size: 16px;
        }

        [imt-state="dual"] .immersive-translate-target-wrapper[dir="rtl"] {
            text-align: right;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper {
            color: rgb(0, 0, 0);
            white-space: normal;
            position: absolute;
        }

        [imt-state="dual"] .immersive-translate-pdf-target-container .immersive-translate-target-wrapper font {
            color: inherit;
            white-space: inherit;
            position: unset;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper &gt;

        br {
            display: none;
        }

        [imt-state="translation"] .immersive-translate-target-translation-block-wrapper {
            margin: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper {
            margin: 8px 0 !important;
            display: inline-block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            display: block;
        }

        [imt-trans-position="before"] .immersive-translate-target-translation-block-wrapper {
            margin-top: 0 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-pdf-block-wrapper {
            margin: 0 !important;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-grey-inner {
            color: var(--immersive-translate-theme-grey-textColor);
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-underline-inner {
            border-bottom: 1px solid var(--immersive-translate-theme-underline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeUnderline-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeUnderline-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dashedBorder {
            border: 1px dashed var(--immersive-translate-theme-dashedBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-dashedBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 6px;
            margin-top: 2px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-solidBorder {
            border: 1px solid var(--immersive-translate-theme-solidBorder-borderColor) !important;
            border-radius: var(--immersive-translate-theme-solidBorder-borderRadius) !important;
            padding: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDashed-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDashed-borderColor) !important;
            text-decoration-style: dashed !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-thinDashed-inner {
            border-bottom: 1px dashed var(--immersive-translate-theme-thinDashed-borderColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dotted-inner {
            background-image: linear-gradient(to right,
                    var(--immersive-translate-theme-dotted-borderColor) 30%,
                    rgba(255, 255, 255, 0) 0%);
            background-position: bottom;
            background-size: 5px 1px;
            background-repeat: repeat-x;
            padding-bottom: 3px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-nativeDotted-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-nativeDotted-borderColor) !important;
            text-decoration-style: dotted !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-wavy-inner {
            text-decoration: underline !important;
            text-decoration-color: var(--immersive-translate-theme-wavy-borderColor) !important;
            text-decoration-style: wavy !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-dashed-inner {
            background: linear-gradient(to right,
                    var(--immersive-translate-theme-dashed-borderColor) 0%,
                    var(--immersive-translate-theme-dashed-borderColor) 50%,
                    transparent 50%,
                    transparent 100%) repeat-x left bottom;
            background-size: 8px 2px;
            padding-bottom: 2px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            content: "";
            display: block;
            max-width: 80px;
            width: 10%;
            border-top: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            padding-top: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-inline-wrapper-theme-dividingLine::before {
            content: "";
            border-left: 1px dashed var(--immersive-translate-theme-dividingLine-borderColor);
            max-height: 16px;
            height: 16px;
            padding-left: 8px;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-highlight-inner {
            background: var(--immersive-translate-theme-highlight-backgroundColor);
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-marker {
            line-height: 1.5em;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker2-inner {
            font-weight: bold;
            text-shadow: 10px 0px 3px var(--immersive-translate-theme-marker2-backgroundColor),
                16px 3px 9px var(--immersive-translate-theme-marker2-backgroundColor),
                2px 0px 6px var(--immersive-translate-theme-marker2-backgroundColor),
                -12px 0px 12px var(--immersive-translate-theme-marker2-backgroundColor) !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-marker-inner {
            /* TODO: add more texture */
            background: linear-gradient(to right,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.1),
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 3%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 35%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.9) 70%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.8) 95%,
                    rgba(var(--immersive-translate-theme-marker-backgroundColor-rgb), 0.3));
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-weakening {
            opacity: 0.618 !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-italic {
            font-style: italic !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-bold {
            font-weight: bold !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-paper {
            margin: 8px 0;
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
            padding: 16px 32px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-blockquote {
            border-left: 4px solid var(--immersive-translate-theme-blockquote-borderColor) !important;
            padding-left: 12px !important;
            margin-top: 4px;
            margin-bottom: 4px;
            padding-top: 4px;
            padding-bottom: 4px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-mask-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner {
            filter: blur(5px) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        /* opacity theme start */

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [data-immersive-translate-root-translation-theme="none"] .immersive-translate-target-translation-theme-opacity-inner {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner,
        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: opacity(calc(var(--immersive-translate-theme-opacity-opacity) * 1%)) !important;
            transition: filter 0.3s ease !important;
            border-radius: 10px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-opacity-inner:hover {
            filter: none !important;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-mask-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="opacity"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        [data-immersive-translate-root-translation-theme="mask"] .immersive-translate-target-inner:hover {
            filter: none !important;
        }

        /* opacity theme end */

        /* background theme start */
        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper-theme-background {
            margin: 8px 0;
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            border-radius: 4px;
            box-shadow: unset !important;
            padding: 12px;
            display: inline-block;
        }

        [imt-state="dual"] .immersive-translate-target-translation-theme-background-inner {
            background: rgba(var(--immersive-translate-theme-background-backgroundColor-rgb),
                    calc(var(--immersive-translate-theme-background-backgroundOpacity) * 1%));
            padding-left: 6px;
            padding-right: 6px;
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
        }

        [imt-state="dual"] .immersive-translate-target-translation-block-wrapper .immersive-translate-target-translation-theme-background-inner {
            background: unset;
            padding-left: unset;
            padding-right: unset;
        }

        /* background theme end */

        /* vertical css , please remain it in the last one. */
        .immersive-translate-target-translation-vertical-block-wrapper {
            margin: 0px 8px !important;
        }

        .immersive-translate-text {
            font-size: 15px !important;
        }

        .immersive-translate-error-toast {
            position: fixed;
            top: 5%;
            z-index: 99999999;
            left: 0;
            right: 0;
            margin: auto;
            max-width: 300px;
            padding: 16px;
            border-radius: 12px;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        @media all and (min-width: 750px) {
            .immersive-translate-error-toast {
                max-width: 400px;
            }
        }

        .immersive-translate-clickable-button {
            cursor: pointer;
        }

        .immersive-translate-help-button {
            cursor: pointer;
        }

        .immersive-translate-loading-text:before {
            content: "...";
        }

        /* dark mode for loading */

        @media only screen and (prefers-color-scheme: dark) {
            .immersive-translate-loading {
                border: 2px rgba(255, 255, 255, 0.25) solid !important;
                border-top: 2px rgba(255, 255, 255, 1) solid !important;
            }
        }

        .immersive-translate-error-wrapper {
            position: relative;
            display: inline-flex;
            padding: 6px;
            margin: 0 12px;
            white-space: nowrap;
            font-size: 0.9em;
        }

        [lang="zh-CN"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        [lang="zh-TW"] .immersive-translate-error-wrapper {
            font-size: 0.75em;
        }

        .immersive-translate-tooltip {
            position: relative;
            display: inline-flex;
            /* little indicater to indicate it's hoverable */
        }

        .immersive-translate-tooltip-content {
            /* here's the magic */
            position: absolute;
            z-index: 100000000000;

            left: 50%;
            bottom: 0;
            transform: translate(-50%, 110%);
            line-height: 1;
            /* and add a small left margin */

            /* basic styles */
            width: max-content;
            max-width: 250px;
            word-wrap: break-word;
            white-space: pre-line;
            padding: 10px;
            border-radius: 10px;
            background: #000c;
            color: #fff;
            text-align: center;
            font-size: 14px;
            display: none;
            /* hide by default */
        }

        .immersive-translate-tooltip:hover .immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip:hover+.immersive-translate-tooltip-content {
            display: inline-block;
        }

        .immersive-translate-tooltip-content-table {
            left: unset !important;
            bottom: unset !important;
            transform: translate(-10%, 50%) !important;
        }

        .immersive-translate-tooltip:hover:before {
            display: inline-block;
        }

        .immersive-translate-loading-spinner {
            vertical-align: middle !important;
            width: 10px !important;
            height: 10px !important;
            display: inline-block !important;
            margin: 0 4px !important;
            border: 2px rgba(221, 244, 255, 0.6) solid !important;
            border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
            border-radius: 50% !important;
            padding: 0 !important;
            -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
            animation: immersive-translate-loading-animation 0.6s infinite linear !important;
        }

        @-webkit-keyframes immersive-translate-loading-animation {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(359deg);
            }
        }

        @keyframes immersive-translate-loading-animation {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(359deg);
            }
        }

        .imt-image-status {
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--bg-2, #fff);
            font-size: 14px;
        }
    </style>
    <style data-id="immersive-translate-user-custom-style">
        :root {

            .immersive-translate-target-inner {
                font-family: inherit;
            }


            .immersive-translate-target-inner {
                font-family: inherit;
            }
        }
    </style>
    <style data-id="immersive-translate-dynamic-injected-css">
        .immersive-translate-target-wrapper[dir='rtl'] {
            text-align: right;
        }

        .immersive-translate-target-wrapper[dir='rtl'] [data-immersive-translate-class-bak*='block-wrapper'] {
            display: block;
        }

        .immersive-translate-target-wrapper {
            word-break: break-word;
            user-select: text;
        }

        [imt-state="translation"] .immersive-translate-target-wrapper[dir='rtl'] {
            display: inline-block;
        }

        [dir='rtl'] .immersive-translate-target-wrapper:not([dir]) {
            text-align: left;
        }

        [imt-state=dual] .immersive-translate-target-translation-block-wrapper-theme-dividingLine::before {
            display: block;
        }

        [imt-trans-position=before] .immersive-translate-target-translation-block-wrapper {
            display: block !important;
        }

        [imt-state][data-immersive-translate_rtl] .immersive-translate-target-wrapper {
            display: block !important;
        }
    </style>
</head>

<body epub:type="bodymatter" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
    <section aria-labelledby="c16_1" epub:type="chapter" role="doc-chapter"
        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
        <header data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
            <h1 id="c16_1" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1"><span aria-label="419" epub:type="pagebreak" id="Page_419"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span><span id="c16"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span><span
                    class="chapterNumber"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">16</span><br /><span
                    class="chapterTitle"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Diagnostics and
                    Metrics</span>
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">16 诊断和指标</font>
                    </font>
                </font>
            </h1>
        </header>
        <section aria-label="chapter opening" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
            <span id="c16-sec-0001" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
            <aside data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                <div class="top hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <h3 data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1">WHAT'S IN THIS CHAPTER?<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章包含什么内容？</font>
                            </font>
                        </font>
                    </h3>
                    <ul class="check2" id="c16-list-0001"
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <li id="c16-li-0001" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1">Using the ILogger Interface<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用 ILogger 接口</font>
                                </font>
                            </font>
                        </li>
                        <li id="c16-li-0002" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1">Configuring Logging Providers<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">配置日志提供者</font>
                                </font>
                            </font>
                        </li>
                        <li id="c16-li-0003" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1">Using OpenTelemetry with .NET Logging<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用 OpenTelemetry 与.NET
                                        日志记录</font>
                                </font>
                            </font>
                        </li>
                        <li id="c16-li-0004" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1">Adding Metric Counters<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                <font class="notranslate" data-immersive-translate-translation-element-mark="1">  
                                </font>
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">添加指标计数器</font>
                                </font>
                            </font>
                        </li>
                        <li id="c16-li-0005" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1">Monitoring Metrics with .NET CLI<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用 .NET CLI 监控指标</font>
                                </font>
                            </font>
                        </li>
                        <li id="c16-li-0006" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1">Analyzing telemetry data with Visual Studio App
                            Center<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用 Visual Studio App
                                        Center 分析遥测数据</font>
                                </font>
                            </font>
                        </li>
                        <li id="c16-li-0007" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1">Working with Application Insights<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">使用 Application Insights 工作
                                    </font>
                                </font>
                            </font>
                        </li>
                    </ul>
                    <div class="bottom hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <hr />
                    </div>
                </section>
            </aside>
            <aside data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                <div class="top hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <hr />
                </div>
                <section class="feature3" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span
                        id="c16-fea-0001" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
                    <h3 id="head-2-138" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1">CODE DOWNLOADS FOR THIS CHAPTER<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">本章代码下载</font>
                            </font>
                        </font>
                    </h3>
                    <section data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span
                            id="c16-sec-0003"
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
                        <p id="c16-para-0003" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1">The source code for this chapter is available on the
                            book page at <code
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a href="http://www.wiley.com">www.wiley.com</a></code>.
                            Click the Downloads link. The code can also be found at <code
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                            in the directory <code
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">2_Libs/LoggingAndMetrics</code>.
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的源代码可在书籍页面 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a href="http://www.wiley.com">www.wiley.com</a></code>
                                        上找到。点击下载链接。代码也可以在目录 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">2_Libs/LoggingAndMetrics</code>
                                        中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a href="https://github.com/ProfessionalCSharp/ProfessionalCSharp2021">https://github.com/ProfessionalCSharp/ProfessionalCSharp2021</a></code>
                                        找到。</font>
                                </font>
                            </font>
                        </p>
                        <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1">The code for this chapter is divided into the
                            following major examples:<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">本章的代码分为以下主要示例：</font>
                                </font>
                            </font>
                        </p>
                        <ul class="check" id="c16-list-0002"
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                            <li id="c16-li-0008" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                                data-immersive-translate-paragraph="1">LoggingSample</li>
                            <li id="c16-li-0009" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                                data-immersive-translate-paragraph="1">OpenTelemetrySample</li>
                            <li id="c16-li-0010" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                                data-immersive-translate-paragraph="1">MetricsSample</li>
                            <li id="c16-li-0011" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                                data-immersive-translate-paragraph="1">WindowsAppAnalytics</li>
                            <li id="c16-li-0012" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                                data-immersive-translate-paragraph="1">WebAppWithAppInsights</li>
                        </ul>
                        <p id="c16-para-0005" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1">All the projects have nullable reference types
                            enabled.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">所有项目都启用了可空引用类型。 </font>
                                </font>
                            </font>
                        </p>
                    </section>
                    <div class="bottom hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <hr />
                    </div>
                </section>
            </aside>
        </section> <span aria-label="420" epub:type="pagebreak" id="Page_420" role="doc-pagebreak"
            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
        <section aria-labelledby="head-2-139" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
            <span id="c16-sec-0004" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
            <h2 id="head-2-139" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">DIAGNOSTICS OVERVIEW<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">诊断概览 </font>
                    </font>
                </font>
            </h2>
            <p id="c16-para-0006" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">As release cycles for applications become faster and faster, it's
                becoming more and more important to learn how the application behaves while it's running in production.
                What exceptions are occurring? Knowing what features are used is also of interest. Do users find the new
                feature of the app? How long do they stay on the page? To answer these questions, you need real-time
                information on the application.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            随着应用程序发布周期的不断加快，了解应用程序在生产环境中的运行行为变得越来越重要。哪些异常正在发生？了解哪些功能被使用也是我们的兴趣所在。用户是否发现了应用程序的新功能？他们在页面上停留了多长时间？为了回答这些问题，您需要应用程序的实时信息。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0007" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">When you get information about the application, you need to
                differentiate logging, tracing, collecting metric data, and analyzing what users are doing. With
                logging, error information is recorded in centralized places. This information is used by system
                administrators to identify issues with applications.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            当您获取应用程序信息时，您需要区分日志记录、跟踪、收集指标数据和分析用户行为。通过日志记录，错误信息被记录在集中位置。系统管理员使用这些信息来识别应用程序的问题。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0008" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Tracing helps to find out which method is called by which method.
                This information is useful for development and should be turned off when the application runs in
                production. Distributed tracing helps finding how services interact with each other to pinpoint failures
                and causes for performance issues. With .NET, the same technology can be used for logging and tracing
                using classes from the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Diagnostics</code>
                namespace. Analytics gives information about the users—where they reside, what operating system version
                they use, and what features they use in the application. This helps you find out if there are some
                issues with the application based on a location, hardware, or an operating system, and it also helps you
                understand what the users are doing. For example, you might be able to identify if users are having a
                hard time locating a new feature of the application.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            跟踪有助于找出哪个方法被哪个方法调用。这些信息对开发很有用，但在应用程序在生产环境中运行时应关闭。分布式跟踪有助于发现服务之间如何交互，以确定故障和性能问题的原因。在.NET
                            中，可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Diagnostics</code>
                            命名空间中的类来使用相同的技术进行日志记录和跟踪。分析提供了有关用户的信息——他们所在的地点、使用的操作系统版本以及使用的应用程序功能。这有助于您根据位置、硬件或操作系统确定应用程序是否存在某些问题，并帮助您了解用户在做什么。例如，您可能能够确定用户是否难以找到应用程序的新功能。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0009" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">This chapter explains how to get real-time information about your
                running application to identify any issues that it might have during production or to monitor resource
                usage to ensure that higher user loads can be accommodated. This is where the namespace <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Diagnostics.Tracing</code>
                comes into play. This namespace offers classes for tracing using Event Tracing for Windows (ETW).<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            本章解释了如何获取有关您正在运行的应用程序的实时信息，以识别其在生产过程中可能出现的任何问题，或监控资源使用情况以确保能够适应更高的用户负载。这就是 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Diagnostics.Tracing</code>
                            命名空间发挥作用的地方。该命名空间提供了使用事件跟踪 Windows（ETW）进行跟踪的类。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0010" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">One way to deal with errors in your application, of course, is by
                throwing exceptions. However, an application might not fail with an exception, but it still doesn't
                behave as expected. The application might be running well on most systems but have a problem on a few.
                On the live system, you can change the log by starting a trace collector to get detailed live
                information about what's going on in the application. You can do this using ETW.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            当然，处理应用程序中错误的一种方法是通过抛出异常。然而，应用程序可能不会因异常而失败，但它仍然表现不符合预期。应用程序可能在大多数系统上运行良好，但在少数系统上存在问题。在实时系统中，您可以通过启动跟踪收集器来更改日志，以获取有关应用程序中正在发生什么的详细实时信息。您可以使用
                            ETW 来完成此操作。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0011" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">If there are problems with applications, the system administrator
                needs to be informed. The <i
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Event Viewer</i> is a
                commonly used tool that not only the system administrator should be aware of but also the software
                developer. With the Event Viewer, you can interactively monitor problems with applications and add
                subscriptions to inform you about specific events that happen. ETW enables you to write information
                about the application.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            如果应用程序出现问题，系统管理员需要被告知。事件查看器是一个常用的工具，不仅系统管理员应该了解，软件开发者也应该知道。通过事件查看器，您可以交互式地监控应用程序的问题，并添加订阅以通知您特定事件的发生。ETW
                            使您能够编写有关应用程序的信息。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0012" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1"><i
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Application Insights</i> is a
                Microsoft Azure cloud service that enables you to monitor apps in the cloud. With just a few lines of
                code, you can get detailed information about how a web application or service is used.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">应用洞察是微软 Azure
                            云服务，使您能够监控云中的应用程序。只需几行代码，您就可以获取有关 Web 应用程序或服务如何使用的详细信息。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0013" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1"><i
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Visual Studio App Center</i>
                allows monitoring of Windows and Xamarin apps. After you've registered the app, you need just a few
                lines of code to receive useful information about the app.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">Visual Studio App Center 允许监控 Windows
                            和 Xamarin 应用程序。注册应用程序后，只需几行代码即可接收有关应用程序的有用信息。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0014" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1"><i
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetry</i> (<code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a href="https://opentelemetry.io">https://opentelemetry.io</a></code>)
                is a new standard for observing and creating telemetry data in a vendor-neutral way. This becomes
                important if you create microservices with different technologies; with OpenTelemetry, logging, metrics,
                and distributed tracing information coming from multiple services developed using different technologies
                can be collected and analyzed.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">OpenTelemetry ( <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a href="https://opentelemetry.io">https://opentelemetry.io</a></code>
                            ) 是一种新的标准，用于以供应商中立的方式观察和创建遥测数据。如果您使用不同的技术创建微服务，这一点就很重要；使用
                            OpenTelemetry，来自使用不同技术开发的多个服务的日志记录、指标和分布式跟踪信息可以被收集和分析。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0015" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">This chapter explains these facilities and demonstrates how you
                can use them for your applications.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本章解释了这些功能，并演示了您如何可以使用它们来开发应用程序。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">The .NET CLI tools used in this chapter to analyze tracing and
                metrics information are <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">dotnet trace</code> and <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">dotnet</code> counters. The
                tools are defined with the project, so you just need to restore the project local tools from a command
                prompt. Use this command while the current directory is set to the directory of the project:<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本章中用于分析跟踪和指标信息的 .NET CLI 工具是 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">dotnet trace</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">dotnet</code>
                            计数器。这些工具与项目一起定义，因此您只需要从命令提示符中恢复项目的本地工具。在当前目录设置为项目目录时，使用此命令：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0001"><code>&gt; dotnet tool restore</code></pre>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Instead of installing the tools locally, you can install them
                globally with your user profile. To install the tools globally, run these .NET CLI commands:<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            您可以选择不本地安装工具，而是使用用户配置文件全局安装它们。要全局安装这些工具，请运行以下 .NET CLI 命令：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0002"><code>&gt; dotnet tool install dotnet-trace -g</code>
<code>&gt; dotnet tool install dotnet-counters -g</code></pre>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1"><span aria-label="421" epub:type="pagebreak" id="Page_421"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>To see the .NET CLI
                tools that are installed, use this:<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">要查看已安装的 .NET CLI 工具，请使用此命令：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0003"><code>&gt; dotnet tool list -g </code></pre>
            <aside data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                <div class="top hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <p id="c16-para-0020" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NOTE</b> <i
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">The sample
                            application built in this chapter is using the </i> <code
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">HttpClient</code> <i
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> class, so you not
                            only add your own logging and metrics information but also can see what logging and metrics
                            information is offered from this class. You can read more information about using the </i>
                        <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">HttpClient</code>
                        <i data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> class and the HTTP
                            client factory in <a href="c19.xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Chapter 19</a>,
                            “Networking.”</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意 本章构建的示例应用程序使用了 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">HttpClient</code>
                                    类，因此你不仅可以添加自己的日志和指标信息，还可以看到这个类提供的日志和指标信息。你可以阅读更多关于使用 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">HttpClient</code>
                                    类和 HTTP 客户端工厂的信息，请参考第 19 章“网络”。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <hr />
                    </div>
                </section>
            </aside>
        </section>
        <section aria-labelledby="head-2-140" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
            <span id="c16-sec-0006" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
            <h2 id="head-2-140" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">LOGGING<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">日志记录 </font>
                    </font>
                </font>
            </h2>
            <p id="c16-para-0021" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Over the years, there have been several different logging and
                tracing facilities with .NET, and there are also many different third-party loggers. Trying to change an
                application from one logging technology to another one is not an easy task because the use of the
                ILogger API is spread everywhere in the source code. To make logging independent of any logging
                technology, you can use interfaces.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">多年来，.NET
                            一直有多种不同的日志记录和跟踪设施，也有许多第三方日志记录器。尝试将应用程序从一个日志记录技术切换到另一个日志记录技术并不是一件容易的事，因为 ILogger API
                            的使用遍布源代码的各个角落。为了使日志记录独立于任何日志记录技术，你可以使用接口。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Since .NET Core 1.0, .NET has defined the generic <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code> interface in
                the namespace <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.Extensions.Logging</code>.
                This interface defines a <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Log</code> method by passing
                a log level from the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogLevel</code> enumeration,
                an event ID (using the struct <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventId</code>), generic
                state information, an <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Exception</code> type to log
                exception information, and a formatter to define how the output should look with a string:<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">自 .NET Core 1.0 以来，.NET 在 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.Extensions.Logging</code>
                            命名空间中定义了通用的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code>
                            接口。这个接口通过传递一个来自 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogLevel</code>
                            枚举的日志级别、一个事件 ID（使用结构体 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventId</code>
                            ）、通用状态信息、一个用于记录异常信息的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Exception</code>
                            类型，以及一个格式化器来定义输出应该以字符串形式显示的方式：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0004"><code>void Log&lt;TState&gt;(LogLevel logLevel, EventId eventId, TState state, </code>
<code>  Exception, Func&lt;TState, Exception, string&gt; formatter);</code></pre>
            <p id="c16-para-0023" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Other than the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Log</code> method, the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code> interface also
                defines the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IsEnabled</code> method to
                check whether logging is currently enabled based on a <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogLevel</code> and the
                method <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">BeginScope</code>
                that returns a disposable scope for logging. That's practically all that's needed for logging. The <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Log</code> method has many
                parameters that need to be filled. Extension methods for the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code> interface
                exist with the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggerExtensions</code>
                class, such as <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogDebug</code>, <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogTrace</code>, <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogInformation</code>, <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogWarning</code>, <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogError</code>, <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogCritical</code>, and <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">BeginScope</code> with
                several overloads, which makes it easier to use by passing fewer arguments.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">除了 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Log</code> 方法外，
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code>
                            接口还定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IsEnabled</code>
                            方法来根据 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogLevel</code>
                            检查日志是否当前启用，以及返回用于日志的 disposable scope 的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">BeginScope</code>
                            方法。实际上这就是日志所需的所有内容。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Log</code>
                            方法有许多需要填写的参数。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code>
                            接口的扩展方法通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggerExtensions</code>
                            类存在，例如 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogDebug</code> 、
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogTrace</code> 、
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogInformation</code>
                            、 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogWarning</code>
                            、 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogError</code> 、
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogCritical</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">BeginScope</code>
                            ，它们具有多个重载版本，通过传递更少的参数使使用更简单。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">The log levels that are defined with the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogLevel</code> enum include
                the following:<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1"> <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogLevel</code>
                            枚举定义的日志级别包括以下内容：</font>
                    </font>
                </font>
            </p>
            <ul class="check" id="c16-list-0003" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                <li id="c16-li-0013" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1"><code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Trace</code> (level 0):
                    Sensitive information can be written. This should not be enabled with production systems.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Trace</code>
                                （级别 0）：可以写入敏感信息。这不应该在生产系统中启用。</font>
                        </font>
                    </font>
                </li>
                <li id="c16-li-0014" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1"><code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Debug</code> (level 1):
                    Information useful just for debugging. There's no long-term value in keeping this information.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Debug</code>
                                （级别 1）：仅用于调试的有用信息。保留这些信息没有长期价值。</font>
                        </font>
                    </font>
                </li>
                <li id="c16-li-0015" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1"><code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Information</code> (level
                    2): General flow of the application with long-time value.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Information</code>
                                (级别 2): 应用程序的整体流程，具有长期价值。</font>
                        </font>
                    </font>
                </li>
                <li id="c16-li-0016" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1"><code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Warning</code> (level 3):
                    Abnormal or unexpected events happening in the application, but the execution of the application
                    does not stop.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Warning</code>
                                (级别 3): 应用程序中发生异常或意外事件，但应用程序的执行并未停止。</font>
                        </font>
                    </font>
                </li>
                <li id="c16-li-0017" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1"><code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Error</code> (level 4):
                    An error happened with the current activity, but it's not an application-wide issue.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Error</code>
                                (级别 4): 当前活动出现了错误，但这并非全局应用问题。</font>
                        </font>
                    </font>
                </li>
                <li id="c16-li-0018" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1"><code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Critical</code> (level
                    5): Unrecoverable issue in the application or the system.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Critical</code>
                                (级别 5): 应用或系统存在不可恢复的问题。</font>
                        </font>
                    </font>
                </li>
            </ul>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Let's make use of the dependency injection and inject the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code> interface in
                the class <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NetworkService</code> as a
                generic parameter. The generic parameter defines the category of the logger. With the generic parameter,
                the category is made of the class name, including the namespace. In addition to the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code> interface, the
                <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">HttpClient</code> is <span
                    aria-label="422" epub:type="pagebreak" id="Page_422" role="doc-pagebreak"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>injected to make calls
                across the network and look at logging information offered by this class (code file <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/NetworkService.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">让我们利用依赖注入，将 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code>
                            接口注入到类 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NetworkService</code>
                            中作为泛型参数。泛型参数定义了日志记录器的类别。通过泛型参数，类别由类名组成，包括命名空间。除了注入 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code>
                            接口外，还会注入 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">HttpClient</code>
                            以实现跨网络调用，并查看该类提供的日志信息（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/NetworkService.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0005"><code>class NetworkService</code>
<code>{</code>
<code>  private readonly ILogger _logger;</code>
<code>  private readonly HttpClient _httpClient;</code>
<code>  public NetworkService(</code>
<code>    HttpClient, </code>
<code>    <b>ILogger&lt;NetworkService&gt; logger</b>)</code>
<code>  {</code>
<code>    _httpClient = httpClient;</code>
<code>    <b>_logger = logger;</b></code>
<code>    <b>_logger.LogTrace("ILogger injected into {0}", nameof(NetworkService));</b></code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
            <aside data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                <div class="top hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <p id="c16-para-0027" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NOTE</b> <i
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Instead of injecting
                            the </i> <code
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code> <i
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> interface, you can
                            also inject </i> <code
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILoggerFactory</code>
                        <i data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> and create a logger
                            from the factory. This is extremely practical if you have a hierarchy of service classes and
                            want to inject the logger in a base class but create the category name with the name of the
                            derived class.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意：除了注入 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code>
                                    接口，你也可以注入 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILoggerFactory</code>
                                    并从工厂创建日志记录器。如果你有服务类层次结构，并希望在基类中注入日志记录器，但使用派生类的名称创建类别名称，这种方法非常实用。</font>
                            </font>
                        </font>
                    </p>
                    <p id="c16-para-0028" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><i
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1">Later, in the section “Filtering,” you can read how
                            the category name can be used to filter the logs.<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">
                                        稍后，在“过滤”部分，你可以阅读如何使用类别名称来过滤日志。</font>
                                </font>
                            </font></i></p>
                    <div class="bottom hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <hr />
                    </div>
                </section>
            </aside>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">The <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code> interface can
                simply be used for invoking an extension method such as <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogInformation</code> or
                <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogTrace</code>
                :<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1"> <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code>
                            接口可以简单地用于调用扩展方法，例如 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogInformation</code>
                            或 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogTrace</code> ：
                        </font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0006"><code>_logger.LogTrace("RunAsync started");</code></pre>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">The extension methods offer overloads to pass additional
                parameters, exception information, and an event ID. For using the event ID, a list of event IDs is
                defined with the application (code file <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/LoggingEvents.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">扩展方法提供了重载功能，可以传递额外的参数、异常信息和事件 ID。要使用事件
                            ID，应用程序（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/LoggingEvents.cs</code>
                            ）中定义了一个事件 ID 列表：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0007"><code>class LoggingEvents</code>
<code>{</code>
<code>  public static EventId Injection { get; } = </code>
<code>    new EventId(2000, nameof(Injection));</code>
<code>  public static EventId Networking { get; } = </code>
<code>    new EventId(2002, nameof(Networking));</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Next, <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogInformation</code> and
                <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogError</code> extension
                methods are used to show the start of the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NetworkRequestSampleAsync</code>
                method, when it's finished, and error information in case an exception is thrown (code file <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/NetworkService.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">接下来，使用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogInformation</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogError</code>
                            扩展方法来显示 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NetworkRequestSampleAsync</code>
                            方法的开始、完成时以及异常抛出时的错误信息（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/NetworkService.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0008"><code>class NetworkService</code>
<code>{</code>
<code>  //…</code>
<code> </code>
<code>  public async Task NetworkRequestSampleAsync(Uri requestUri)</code>
<code>  {<span aria-label="423" epub:type="pagebreak" id="Page_423" role="doc-pagebreak"></span></code>
<code>    try</code>
<code>    {</code>
<code>      <b>_logger.LogInformation(LoggingEvents.Networking,</b> </code>
<code>        <b>"NetworkRequestSampleAsync started with uri {0}",</b> </code>
<code>        <b>requestUri.AbsoluteUri);</b></code>
<code> </code>
<code>      string result = await _httpClient.GetStringAsync(requestUri);</code>
<code>      Console.WriteLine($"{result[..50]}");</code>
<code>      <b>_logger.LogInformation(LoggingEvents.Networking,</b></code>
<code>        <b>"NetworkRequestSampleAsync completed, received {length} characters",</b> </code>
<code>        <b>result.Length);</b></code>
<code>    }</code>
<code>    catch (HttpRequestException ex)</code>
<code>    {</code>
<code>      <b>_logger.LogError(LoggingEvents.Networking, ex,</b> </code>
<code>        <b>"Error in NetworkRequestSampleAsync, error message: {message}, " +</b> </code>
<code>        <b>"HResult: {error}", ex.Message, ex.HResult);</b></code>
<code>    }</code>
<code>  }</code>
<code>}</code></pre>
            <aside data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                <div class="top hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <p id="c16-para-0033" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NOTE</b> <i
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Passing the message
                            to the </i> <code
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogXX</code> <i
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> methods, any number
                            of objects can be supplied that are put into the format message string. This format string
                            uses positional arguments to pass in the following objects, but neither positional numbers
                            (as with the </i> <code
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">String.Format</code>
                        <i data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> method) nor
                            interpolated strings are used. Without the </i> <code
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">$</code> <i
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> prefix to the
                            strings, you can use string keywords with the curly bracket placeholders. These keywords can
                            then be used for fast queries within log information, e.g., when using Azure Table Storage
                            to store log information.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意 将消息传递给 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogXX</code>
                                    方法时，可以提供任意数量的对象，这些对象将被放入格式化消息字符串中。此格式化字符串使用位置参数来传递以下对象，但既不使用位置编号（如 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">String.Format</code>
                                    方法那样）也不使用插值字符串。如果没有在字符串前添加 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">$</code>
                                    前缀，您可以使用花括号占位符与字符串关键字。然后，这些关键字可用于在日志信息中快速查询，例如，在使用 Azure Table Storage 存储日志信息时。
                                </font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <hr />
                    </div>
                </section>
            </aside>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">The <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Runner</code> class injects
                the <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code>
                interface in addition to the previously defined <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NetworkService</code> class
                and writes debug and error messages (code file <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/NetworkService.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1"> <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Runner</code>
                            类除了之前定义的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NetworkService</code>
                            类外，还注入了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code>
                            接口，并写入调试和错误消息（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/NetworkService.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0009"><code>class Runner</code>
<code>{</code>
<code>  <b>private readonly ILogger _logger;</b></code>
<code>  private readonly NetworkService _networkService;</code>
<code>  public Runner(NetworkService networkService, <b>ILogger&lt;Runner&gt; logger</b>)</code>
<code>  {</code>
<code>    _networkService = networkService;</code>
<code>    <b>_logger = logger;</b></code>
<code>  }</code>
<code> </code>
<code>  public async Task RunAsync()</code>
<code>  {</code>
<code>    <b>_logger.LogDebug("RunAsync started");</b></code>
<code>    bool exit = false;</code>
<code>    do</code>
<code>    {</code>
<code>      Console.Write("Please enter a URI or enter to exit: ");</code>
<code>      string? url = Console.ReadLine();</code>
<code>      if (string.IsNullOrEmpty(url))<span aria-label="424" epub:type="pagebreak" id="Page_424" role="doc-pagebreak"></span></code>
<code>      {</code>
<code>        exit = true;</code>
<code>      }</code>
<code>      else</code>
<code>      {</code>
<code>        try</code>
<code>        {</code>
<code>          Uri uri = new(url);</code>
<code>          await _networkService.NetworkRequestSampleAsync(uri);</code>
<code>        }</code>
<code>        catch (UriFormatException ex)</code>
<code>        {</code>
<code>          <b>_logger.LogError(ex, ex.Message);</b></code>
<code>        }</code>
<code>      }</code>
<code>    } while (!exit);</code>
<code>  }</code>
<code>}</code></pre>
            <p id="c16-para-0035" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Next, logging providers need to be configured to make the log
                information available.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">接下来，需要配置日志提供者以使日志信息可用。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span id="c16-sec-0009"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
                <h3 id="head-3-297" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Configuring Providers <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">配置提供者</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Host</code> class
                    discussed in <a href="c15.xhtml"
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Chapter 15</a>,
                    “Dependency Injection and Configuration,” preconfigures not only a DI container and configuration
                    providers but also logging. Using the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">CreateDefaultBuilder</code>
                    method of the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Host</code> class
                    configures these loggers:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在第 15 章“依赖注入和配置”中讨论的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Host</code>
                                类不仅预配置了依赖注入容器和配置提供者，还预配置了日志记录。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Host</code>
                                类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">CreateDefaultBuilder</code>
                                方法配置这些日志记录器：</font>
                        </font>
                    </font>
                </p>
                <ul class="check" id="c16-list-0004"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <li id="c16-li-0019" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Console:</b> This
                        provider writes log information to the console.<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">控制台：此提供者将日志信息写入控制台。</font>
                            </font>
                        </font>
                    </li>
                    <li id="c16-li-0020" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Debug:</b> This
                        provider writes log information to the <code
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Diagnotics.Debug</code>
                        class. With Visual Studio, this goes to the Output window. On Linux systems, depending on the
                        distribution, debug log messages go to /
                        <code
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">var/log/messages</code>
                        or <code
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">/var/log/syslog</code>.
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">调试：此提供者将日志信息写入 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Diagnotics.Debug</code>
                                    类。使用 Visual Studio 时，这会写入输出窗口。在 Linux 系统上，根据发行版的不同，调试日志消息会写入/ <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">var/log/messages</code>
                                    或 <code xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">/var/log/syslog</code>
                                    。</font>
                            </font>
                        </font>
                    </li>
                    <li id="c16-li-0021" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventSource:</b> This
                        provider logs with the name <code
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft-Extensions-Logging</code>.
                        On Windows, Event Tracing for Windows (ETW) is used.<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">事件源：此提供者使用 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft-Extensions-Logging</code>
                                    名称进行日志记录。在 Windows 上，使用 Windows 事件跟踪（ETW）。</font>
                            </font>
                        </font>
                    </li>
                    <li id="c16-li-0022" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventLog:</b> This
                        provider is configured only on Windows systems. It writes to the Windows EventLog. This is the
                        only provider configured to write warnings and more critical messages, and it doesn't use the
                        default logging configuration. The Windows EventLog should not be used to log verbose messaging.
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">EventLog: 此提供程序仅在 Windows
                                    系统上配置。它写入 Windows 事件日志。这是唯一配置为写入警告和更关键消息的提供程序，并且它不使用默认的日志配置。Windows 事件日志不应用于记录详细消息。
                                </font>
                            </font>
                        </font>
                    </li>
                </ul>
                <p id="c16-para-0037" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Other than the configured providers, <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">CreateDefaultBuilder</code>
                    uses the configuration from the configuration section named <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Logging</code>.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">除了配置的提供程序之外， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">CreateDefaultBuilder</code>
                                使用名为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Logging</code>
                                的配置部分的配置。</font>
                        </font>
                    </font>
                </p>
                <p id="c16-para-0038" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">For many applications, the default configuration using <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">CreateDefaultBuilder</code>
                    will be fine, and you can add more providers as needed. With the sample application, the default
                    logging configuration is not used, so you can better see what and how logging can be configured.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">对于许多应用程序，使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">CreateDefaultBuilder</code>
                                的默认配置就足够了，并且您可以根据需要添加更多提供程序。在示例应用程序中，默认的日志配置未使用，因此您可以更好地了解日志如何配置及其内容。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Logging configuration can be customized with the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IHostBuilder</code>
                    extension method <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ConfigureLogging</code>.
                    With this method, an overloaded version with two parameters is used. Here, the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">HostBuilderContext</code>
                    is the first parameter. This context is used as the sample code is extended to access application
                    configuration. The second parameter is of type <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILoggingBuilder</code>.
                    With this, you can use extension methods from different providers to customize logging. First, the
                    providers configured from the method <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">CreateDefaultBuilder</code>
                    are removed by invoking the method <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ClearProviders</code>.
                    Then logging providers for the console, debug, event source, and event log (if running on Windows)
                    are added (code file <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">日志配置可以通过 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IHostBuilder</code>
                                扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ConfigureLogging</code>
                                进行自定义。使用此方法时，会使用一个带有两个参数的重载版本。在这里， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">HostBuilderContext</code>
                                是第一个参数。此上下文用于扩展示例代码以访问应用程序配置。第二个参数的类型是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILoggingBuilder</code>
                                。通过这种方式，您可以使用来自不同提供者的扩展方法来定制日志记录。首先，通过调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">CreateDefaultBuilder</code>
                                配置的提供者会被通过方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ClearProviders</code>
                                移除。然后会添加控制台、调试、事件源和事件日志（如果运行在 Windows 上）的日志提供者（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0010"><code>using var host = Host.CreateDefaultBuilder(args)</code>
<code>  .ConfigureLogging((context, logging) =&gt;<span aria-label="425" epub:type="pagebreak" id="Page_425" role="doc-pagebreak"></span></code>
<code>  {</code>
<code>    <b>logging.ClearProviders();</b></code>
<code> </code>
<code>    <b>bool isWindows = RuntimeInformation.IsOSPlatform(OSPlatform.Windows);</b></code>
<code> </code>
<code>    <b>logging.AddConsole();</b></code>
<code>    <b>logging.AddDebug();</b></code>
<code>    <b>logging.AddEventSourceLogger();</b></code>
<code> </code>
<code>    <b>if (isWindows)</b></code>
<code>    <b>{</b></code>
<code>      <b>logging.AddEventLog(); // EventLogLoggerProvider</b></code>
<code>    <b>}</b></code>
<code> </code>
<code>    //…    </code>
<code>  })</code>
<code>  .ConfigureServices(services =&gt;</code>
<code>  {</code>
<code>    services.AddHttpClient&lt;NetworkService&gt;(client =&gt;</code>
<code>    {</code>
<code>    }).AddTypedClient&lt;NetworkService&gt;();</code>
<code>    services.AddScoped&lt;Runner&gt;();</code>
<code>  }).Build();</code></pre>
                <aside data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <div class="top hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <p id="c16-para-0041" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NOTE</b> <i
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">The </i> <code
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ConfigureServices</code>
                            <i data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> method of the
                            </i> <code
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Host</code> <i
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> class is covered
                                in detail in <a href="c15.xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Chapter
                                    15</a>.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ConfigureServices</code>
                                        类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Host</code>
                                        方法在第 15 章中有详细说明。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">When you run the application with successful and unsuccessful
                    results, you can see the following output on the console:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                当您运行应用程序并得到成功和失败的结果时，您可以在控制台上看到以下输出：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0011"><code>Please enter a URI or enter to exit: https://csharp.christiannagel.com</code>
<code>info: LoggingSample.NetworkService[2002]</code>
<code>      NetworkRequestSampleAsync started with uri https://csharp.christiannagel.com/</code>
<code>info: System.Net.Http.HttpClient.NetworkService.LogicalHandler[100]</code>
<code>      Start processing HTTP request GET https://csharp.christiannagel.com/</code>
<code>info: System.Net.Http.HttpClient.NetworkService.ClientHandler[100]</code>
<code>      Sending HTTP request GET https://csharp.christiannagel.com/</code>
<code>info: System.Net.Http.HttpClient.NetworkService.ClientHandler[101]</code>
<code>      Received HTTP response headers after 692.1021ms - 200</code>
<code>info: System.Net.Http.HttpClient.NetworkService.LogicalHandler[101]</code>
<code>      End processing HTTP request after 707.6875ms - 200</code>
<code>&lt;!DOCTYPE html&gt;</code>
<code>&lt;html lang="en"&gt;</code>
<code>&lt;head&gt;</code>
<code>&lt;meta char</code>
<code>LoggingSample.NetworkService[2002]</code>
<code>      NetworkRequestSampleAsync completed, received 97126 character</code>
<code>Please enter a URI or enter to exit: info: </code></pre>
                <p id="c16-para-0043" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">The log output and other console output may not arrive in the
                    correct order because logging is written and flushed asynchronously to increase performance and
                    reduce the logging overhead.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                由于日志记录是异步写入和刷新以提高性能并减少日志记录开销，因此日志输出和其他控制台输出可能不会按正确的顺序到达。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1"><span aria-label="426" epub:type="pagebreak" id="Page_426"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>Passing an invalid
                    hostname results in the error information as shown, including the call stack, because the exception
                    object is passed to the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogError</code> method:
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">传递无效的主机名会导致错误信息，包括调用堆栈，因为异常对象被传递到
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogError</code>
                                方法：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0012"><code>fail: LoggingSample.Runner[0]</code>
<code>      Invalid URI: The format of the URI could not be determined.</code>
<code>      System.UriFormatException: Invalid URI: The format of the URI could not be determined.</code>
<code>         at System.Uri.CreateThis(String uri, Boolean dontEscape, UriKind uriKind)</code>
<code>         at System.Uri..ctor(String uriString)</code>
<code>         at LoggingSample.Runner.RunAsync() in C:\github\ProfessionalCSharp2021\02_Libs\</code>
<code>LoggingMetricsAndTelemetry\LoggingSample\LoggingSample\Runner.cs:line 35</code>
<code>Please enter a URI or enter to exit:</code></pre>
            </section>
            <section data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span id="c16-sec-0011"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
                <h3 id="head-3-298" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Filtering <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">过滤</font>
                        </font>
                    </font>
                </h3>
                <p id="c16-para-0045" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">You don't need all log messages at all times. While the
                    application is running in the production environment, critical information and errors are of
                    interest. While debugging the application, you might set up the configuration to show trace messages
                    for specific trace sources to learn all the things going on in the application. You can define
                    filters just for the logging needs you currently have.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                你并非总需要所有日志消息。当应用程序在生产环境中运行时，关键信息和错误是值得关注的内容。在调试应用程序时，你可能会设置配置以显示特定跟踪源的跟踪消息，以了解应用程序中发生的一切。你可以只为当前的日志需求定义过滤器。
                            </font>
                        </font>
                    </font>
                </p>
                <p id="c16-para-0046" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Filtering is possible based on the logger provider and the
                    log categories.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">过滤可以根据日志提供者和日志类别进行。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">The following code snippet defines a filter for the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventLogLoggerProvider</code>
                    and the category name to filter only errors with the log level <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Warning</code> and higher
                    (code file <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">以下代码片段定义了针对 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventLogLoggerProvider</code>
                                的过滤器以及分类名称，用于仅过滤日志级别为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Warning</code>
                                及以上的错误（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0013"><code>bool isWindows = RuntimeInformation.IsOSPlatform(OSPlatform.Windows);</code>
<code>if (isWindows)</code>
<code>{</code>
<code>  <b>logging.AddFilter&lt;EventLogLoggerProvider&gt;(level =&gt;</b> </code>
<code>    <b>level &gt;= LogLevel.Warning);</b></code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span id="c16-sec-0012"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
                <h3 id="head-3-299" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Configure Logging <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">配置日志</font>
                        </font>
                    </font>
                </h3>
                <p id="c16-para-0048" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">You can configure filtering and logging using the .NET
                    configuration. By default, when you use the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">CreateDefaultBuilder</code>
                    method from the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Host</code> class,
                    configuration is retrieved from <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">appsettings.json</code>,
                    <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">appsettings.{environmentname}.json</code>,
                    environment variables, and command-line arguments, so you can override the configuration from the
                    JSON files from command-line arguments. Read <a href="c15.xhtml"
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Chapter 15</a> for more
                    information on the different configuration providers and how to add custom configuration providers.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">您可以使用.NET 配置来设置过滤和日志记录。默认情况下，当您从
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Host</code>
                                类中使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">CreateDefaultBuilder</code>
                                方法时，配置会从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">appsettings.json</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">appsettings.{environmentname}.json</code>
                                、环境变量和命令行参数中获取，因此您可以通过命令行参数覆盖 JSON 文件的配置。有关不同配置提供程序的信息以及如何添加自定义配置提供程序，请参阅第 15 章。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">To access the configuration for the logging providers, the
                    <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">AddConfiguration</code>
                    extension method is used with the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILoggingBuilder</code>
                    parameter. Configuration values are retrieved within the section <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Logging</code> (code file
                    <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要访问日志提供程序的配置，使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">AddConfiguration</code>
                                扩展方法并指定 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILoggingBuilder</code>
                                参数。配置值在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Logging</code>
                                部分中获取（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre
                    id="c16-code-0014"><code>logging.AddConfiguration(hostingContext.Configuration.GetSection("Logging"));</code></pre>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">When you add the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogLevel</code> entry to
                    the <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Logging</code>
                    section, you can configure default levels for logging. By default, as specified with the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Default</code> key, <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Information</code>
                    messages and above are logged. An exception is for all log groups that start with <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft</code>. Here,
                    only the level <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Warning</code> and above
                    is logged. Another exception is for <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.Hosting.Lifetime</code>.
                    Namely, <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Information</code> and
                    above messages are logged:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">当你将 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogLevel</code>
                                条目添加到 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Logging</code>
                                部分，可以配置日志记录的默认级别。默认情况下，根据 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Default</code>
                                键的指定， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Information</code>
                                消息及以上级别的消息将被记录。例外情况是所有以 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft</code>
                                开头的日志组。这里，仅记录 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Warning</code>
                                及以上级别的消息。另一个例外是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.Hosting.Lifetime</code>
                                。具体来说，记录 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Information</code>
                                及以上级别的消息：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0015"><code>  "Logging": {</code>
<code>    <b>"LogLevel": {</b></code>
<code>      <b>"Default": "Information",</b></code>
<code>      <b>"Microsoft": "Warning",</b><span aria-label="427" epub:type="pagebreak" id="Page_427" role="doc-pagebreak"></span></code>
<code>      <b>"Microsoft.Hosting.Lifetime": "Information"</b></code>
<code>    <b>}</b></code>
<code>  }</code></pre>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">You can specify different configuration values for a
                    provider. Here, for the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Console</code> provider
                    (which matches the simple console), the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogLevel</code> is
                    configured to other values for the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample</code>
                    logging category:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">你可以为提供者指定不同的配置值。这里，对于 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Console</code>
                                提供者（匹配简单控制台）， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LogLevel</code>
                                在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">LoggingSample</code>
                                日志类别中配置为其他值：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0016"><code>{</code>
<code>  "Logging": {</code>
<code>    <b>"Console": {</b></code>
<code>      <b>"LogLevel": {</b></code>
<code>        <b>"Default": "Information",</b></code>
<code>        <b>"LoggingSample.NetworkService": "Warning",</b></code>
<code>        <b>"LoggingSample.Runner": "Warning"</b></code>
<code>      <b>}</b></code>
<code>    <b>},</b></code>
<code>    "LogLevel": {</code>
<code>      "Default": "Warning",</code>
<code>      "Microsoft": "Information",</code>
<code>      "LoggingSample.NetworkService": "Warning"</code>
<code>    }</code>
<code>  }</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span id="c16-sec-0013"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
                <h3 id="head-3-300" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Logging and Tracing with OpenTelemetry<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 OpenTelemetry 进行日志记录和跟踪</font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">To log messages with the OpenTelemetry standard, you need to
                    configure a different logging provider by invoking the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILoggerBuilder</code>
                    extension method <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">AddOpenTelemetry</code>
                    (NuGet package <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetry</code>) and
                    pass an exporter to the options of this method. The following code snippet adds the Console Exporter
                    from the NuGet package <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetry.Exporter.Console</code>
                    to the Open Telemetry logging (code file <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetrySample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要使用 OpenTelemetry 标准记录消息，你需要通过调用
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILoggerBuilder</code>
                                扩展方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">AddOpenTelemetry</code>
                                （NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetry</code>
                                ）并传递一个导出器到该方法的选项来配置不同的日志提供者。以下代码片段将 NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetry.Exporter.Console</code>
                                中的控制台导出器添加到 OpenTelemetry 日志记录（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetrySample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0017"><code>.ConfigureLogging((hostingContext, logging) =&gt;</code>
<code>{</code>
<code>  logging.ClearProviders();</code>
<code>  logging.AddFilter(level =&gt; level&gt;= LogLevel.Trace);</code>
<code>  logging.AddOpenTelemetry(options =&gt; options.AddConsoleExporter());</code>
<code>  //…</code>
<code>})</code></pre>
                <p id="c16-para-0053" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">With this small change to the logging configuration, the log
                    output defined from the methods using the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code> interface
                    is shown with the OpenTelemetry format. The practical use of OpenTelemetry comes when using other
                    exporters such as Jaeger or Prometheus to send the log information to open source or commercial
                    backends. To do this, you just need to configure other exporters—for example, to Jaeger using the
                    NuGet package <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetry.Exporter.Jaeger</code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">通过这个对日志配置的小改动，使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code>
                                接口定义的日志输出将以 OpenTelemetry 格式显示。OpenTelemetry 的实际应用体现在使用 Jaeger 或 Prometheus
                                等其他导出器将日志信息发送到开源或商业后端时。为此，您只需配置其他导出器——例如，使用 NuGet 包 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetry.Exporter.Jaeger</code>
                                配置到 Jaeger。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">The log output shows empty values for <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TraceId</code> and <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">SpanId</code>. These
                    values are important when using distributed tracing. When you read about <i
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">tracer</i> and <i
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">span</i> with
                    OpenTelemetry, .NET uses the terms and classes <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource</code> and
                    <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Activity</code>. The
                    following code snippet creates an <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource</code>
                    with the <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Runner</code>
                    class as a static internal member that's used to create activities (or spans) for the sample
                    application. It's useful to specify one <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitiySource</code>
                    that's shared within the types of a library or a subcomponent. The <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource</code>
                    allows enabling and disabling distributed tracing based on the name passed to the constructor (code
                    file <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetrySample/Runner.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">日志输出显示 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TraceId</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">SpanId</code>
                                为空值。这些值在使用分布式追踪时非常重要。当您阅读有关 OpenTelemetry 中的追踪器和跨度时，.NET 使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Activity</code>
                                这些术语和类。以下代码片段创建了一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource</code>
                                ，将其作为静态内部成员的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Runner</code>
                                类，用于为示例应用程序创建活动（或跨度）。指定一个在库或子组件类型之间共享的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitiySource</code>
                                非常有用。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource</code>
                                允许根据传递给构造函数的名称启用和禁用分布式追踪（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetrySample/Runner.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0018"><code>class Runner</code>
<code>{<span aria-label="428" epub:type="pagebreak" id="Page_428" role="doc-pagebreak"></span></code>
<code>  internal readonly static ActivitySource ActivitySource = </code>
<code>    new("LoggingSample.DistributedTracing");</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">By using this <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource</code>,
                    you can create nested activities. With the following code snippet, an activity is created within the
                    <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">RunAsync</code> method
                    with the name <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Run</code>. You don't
                    need to pass the activity to the log methods. Instead, the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">StartActivity</code>
                    method sets the static property <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Activity.Current</code>,
                    which is used by all the following log methods to show the IDs (and the logs nested within inner
                    methods, such as the log invocations from the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NetworkService</code>
                    class). A nested activity is started within the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">do</code>
                    /
                    <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">while</code> loop (code
                    file <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetrySample/Runner.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">通过使用这个 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource</code>
                                ，你可以创建嵌套活动。使用以下代码片段，在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">RunAsync</code>
                                方法中创建了一个名为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Run</code>
                                的活动。你不需要将活动传递给日志方法。相反， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">StartActivity</code>
                                方法设置了静态属性 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Activity.Current</code>
                                ，所有后续的日志方法都使用该属性来显示 ID（以及嵌套方法中的日志，例如来自 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NetworkService</code>
                                类的日志调用）。在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">do</code> /
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">while</code>
                                循环中启动了嵌套活动（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetrySample/Runner.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0019"><code>public async Task RunAsync()</code>
<code>{</code>
<code>  <b>using var activity = ActivitySource.StartActivity("Run");</b></code>
<code>  _logger.LogDebug("RunAsync started");</code>
<code>  bool exit = false;</code>
<code>  do</code>
<code>  {</code>
<code>    Console.Write("Please enter a URI or enter to exit: ");</code>
<code>    string? url = Console.ReadLine();</code>
<code>    <b>using var urlActivity = ActivitySource.StartActivity(</b></code>
<code>      <b>"Starting URL Request");</b></code>
<code>    if (string.IsNullOrEmpty(url))</code>
<code>    {</code>
<code>      exit = true;</code>
<code>    }</code>
<code>    else</code>
<code>    {</code>
<code>      try</code>
<code>      {</code>
<code>        Uri uri = new(url);</code>
<code>        await _networkSevice.NetworkRequestSampleAsync(uri);</code>
<code>      }</code>
<code>      catch (UriFormatException ex)</code>
<code>      {</code>
<code>        _logger.LogError(ex, ex.Message);</code>
<code>      }</code>
<code>    }</code>
<code>  } while (!exit);</code>
<code>}</code></pre>
                <p id="c16-para-0056" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">If you create a library, you can use the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Activity</code> and <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource</code>
                    classes without referencing any NuGet package from the OpenTelemetry libraries. The libraries should
                    be independent of how the application collects log information.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">如果你创建一个库，你可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Activity</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource</code>
                                类，而无需引用 OpenTelemetry 库的任何 NuGet 包。库应该与应用程序收集日志信息的方式无关。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Without specifying to collect information from the activity
                    source, the method <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource.StartActivity</code>
                    returns <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">null</code>.
                    With the following code snippet, the OpenTelemetry SDK is used to configure collection of
                    distributed trace information. The tracer provider builder (as mentioned, the tracer with
                    OpenTelementry is the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource</code>) is
                    configured to collect distributed trace information from the source name that's passed to the
                    AddSource method. This needs to be the same name that you passed to the ActivitySource constructor
                    <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></code>. This code
                    requires the NuGet packages <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetry</code> and
                    <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetry.Exporter.Console</code>.
                    To log traces <span aria-label="429" epub:type="pagebreak" id="Page_429" role="doc-pagebreak"
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>coming from
                    ASP.NET Core, you can add the source with the name <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.AspNetCore</code>.
                    The logs are written to the console exporter (code file <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetrySample/Program.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">未指定从活动源收集信息时，方法 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource.StartActivity</code>
                                返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">null</code>
                                。使用以下代码片段，通过 OpenTelemetry SDK 配置分布式追踪信息的收集。追踪器提供者构建器（如前所述，OpenTelemetry 中的追踪器是 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ActivitySource</code>
                                ）被配置为从传递给 AddSource 方法的源名称收集分布式追踪信息。这必须是您传递给 ActivitySource 构造函数 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></code>
                                的相同名称。此代码需要 NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetry</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetry.Exporter.Console</code>
                                。要记录来自 ASP.NET Core 的追踪，您可以添加名称为 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.AspNetCore</code>
                                的源。日志写入控制台导出器（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OpenTelemetrySample/Program.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0020"><code>using var tracerProvider = Sdk.CreateTracerProviderBuilder()</code>
<code>  .SetResourceBuilder(ResourceBuilder.CreateDefault()</code>
<code>    .AddService("OpenTelemetrySample"))</code>
<code>  .AddSource("LoggingSample.DistributedTracing")</code>
<code>  .AddConsoleExporter()</code>
<code>  .Build();</code></pre>
                <p id="c16-para-0058" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Remember, the console exporter is useful during development
                    and testing. Other exporters such as Jaeger and Prometheus are useful in production environments.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">记住，控制台导出器在开发和测试期间很有用。Jaeger 和
                                Prometheus 等其他导出器在生产环境中很有用。</font>
                        </font>
                    </font>
                </p>
            </section>
            <section data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span id="c16-sec-0014"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
                <h3 id="head-3-301" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">More Logging Providers <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">更多日志提供者</font>
                        </font>
                    </font>
                </h3>
                <p id="c16-para-0059" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">On the NuGet server, many more logging providers are
                    available. You can add <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Serilog.Extensions.Logging</code>
                    for easy logging to files. The NuGet package <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.Extensions.Logging.AzureAppServices</code>
                    offers logging web applications hosted on Azure App Services to use the Azure App Service
                    diagnostics logs including log live streaming. With the NuGet package <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.Extensions.Logging.ApplicationInsights</code>,
                    <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code> events
                    are forwarded to Application Insights. Application Insights is covered later in this chapter in the
                    section “Application Insights.”<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在 NuGet 服务器上，有更多可用的日志提供者。你可以添加
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Serilog.Extensions.Logging</code>
                                以便轻松地将日志记录到文件中。NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.Extensions.Logging.AzureAppServices</code>
                                提供了日志记录在 Azure App Services 上托管的 Web 应用程序的功能，包括日志实时流。使用 NuGet 包 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.Extensions.Logging.ApplicationInsights</code>
                                ， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ILogger</code>
                                事件会被转发到 Application Insights。Application Insights 在本章的“Application Insights”部分中介绍。
                            </font>
                        </font>
                    </font>
                </p>
            </section>
        </section>
        <section aria-labelledby="head-2-141" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
            <span id="c16-sec-0015" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
            <h2 id="head-2-141" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">METRICS<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">指标</font>
                    </font>
                </font>
            </h2>
            <p id="c16-para-0060" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">With metrics, you can measure actual counts of collected values
                to analyze issues with the application. You can do live monitoring, collect metrics information over
                time, and write the information to a file.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            通过指标，你可以测量收集到的值的实际计数，以分析应用程序的问题。你可以进行实时监控，收集随时间变化的指标信息，并将这些信息写入文件。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0061" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">The .NET runtime offers metrics information to show CPU usage,
                heap size, number of objects and memory sizes for the different GC generations, assemblies loaded, and
                more. Libraries such as EF Core and ASP.NET Core hosting offer metrics data as well.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">.NET 运行时提供指标信息，用于显示 CPU
                            使用率、堆大小、对象数量以及不同 GC 代的内存大小、加载的程序集等。EF Core 和 ASP.NET Core 托管库也提供指标数据。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0062" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">To read metrics information, you can either access this
                information in-proc or out-of-proc. In-proc, you can use the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventListener</code> class to
                receive metrics information within the application. Out-of-proc, you can use platform-specific tools
                such as Event Tracing for Windows (ETW) on Windows systems or Linux Trace Toolkit Next Generation
                (LLTng) on Linux systems. There's also a platform-independent solution that doesn't give you events from
                the operating system; it gives you all the .NET-offered events from the .NET runtime and your
                application and doesn't require admin privileges.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">要读取指标信息，你可以选择进程内或进程外访问。进程内，你可以使用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventListener</code>
                            类在应用程序内接收指标信息。进程外，你可以使用特定平台的工具，如 Windows 系统上的事件跟踪（ETW）或 Linux 系统上的下一代 Linux
                            跟踪工具（LLTng）。还有一个平台无关的解决方案，它不提供来自操作系统的事件；它提供 .NET 运行时和你的应用程序的所有 .NET 提供的事件，并且不需要管理员权限。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0063" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">With .NET, to receive metrics information out-of-proc, you can
                use the <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventPipe</code>
                class from the NuGet package <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.Diagnostics.NETCore.Client</code>.
                In this chapter, I use the .NET CLI with the counter tool, which itself is making use of the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventPipe</code> class. You
                don't need to implement a monitoring tool on your own.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用 .NET 接收进程外指标信息，可以使用 NuGet 包 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.Diagnostics.NETCore.Client</code>
                            中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventPipe</code>
                            类。在本章中，我使用 .NET CLI 和计数器工具，而计数器工具本身也使用了 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventPipe</code>
                            类。你无需自行实现监控工具。</font>
                    </font>
                </font>
            </p>
            <section data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span id="c16-sec-0016"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
                <h3 id="head-3-302" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">EventSource Class<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">EventSource 类</font>
                        </font>
                    </font>
                </h3>
                <p id="c16-para-0064" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">So you can see metric information, the sample application
                    offering logging information is enhanced with metrics. To offer metric information, you need to
                    create a class that derives from the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventSource</code> class,
                    which is defined in the namespace <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Diagnostics.Tracing</code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                为了查看指标信息，示例应用程序通过增强日志信息来提供指标。要提供指标信息，需要创建一个从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventSource</code>
                                类派生的类，该类定义在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Diagnostics.Tracing</code>
                                命名空间中。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">The class <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MetricsSampleSource</code>
                    derives from the base class <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventSource</code> and is
                    annotated with the attribute <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventSource</code>. This
                    attribute gives a name to allow this class as an event source for ETW. To allow instantiation only
                    once, a public static <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">readonly Log</code> field
                    and a private constructor are defined (code file <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MetricsSample/ MetricsSampleSource.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MetricsSampleSource</code>
                                类从 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventSource</code>
                                基类派生，并使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventSource</code>
                                属性进行标注。该属性为该类命名，使其可以作为 ETW 的事件源。为了确保只实例化一次，定义了一个公共静态 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">readonly Log</code>
                                字段和一个私有构造函数（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MetricsSample/ MetricsSampleSource.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0021"><span aria-label="430" epub:type="pagebreak" id="Page_430" role="doc-pagebreak"></span>
<code>[EventSource(Name = "Wrox.ProCSharp.MetricsSample")]</code>
<code>internal class MetricsSampleSource : EventSource</code>
<code>{</code>
<code>  public static readonly MetricsSampleSource Log = new();</code>
<code>  private MetricsSampleSource()</code>
<code>    : base("Wrox.ProCSharp.MetricsSample") { }</code>
<code>  //…</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span id="c16-sec-0017"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
                <h3 id="head-3-303" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Metric Counters <font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">指标计数器</font>
                        </font>
                    </font>
                </h3>
                <p id="c16-para-0066" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">In the namespace <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Diagnostics.Tracing</code>,
                    four different counter types are defined—
                    <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventCounter</code>,
                    <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IncrementingEventCounter</code>,
                    <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code>,
                    and <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IncrementingPollingCounter</code>—that
                    all derive from the base class <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">DiagnosticCounter</code>.
                    The two <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">XXEventCounter</code>
                    types are the easiest ones to use. You don't need to declare a variable for storing the counter; you
                    just need to write or increment the metric values. With the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventCounter</code> type,
                    you write metrics information to invoke the method <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">WriteMetric</code>. The
                    <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IncrementingEventCounter</code>
                    class defines the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Increment</code> method
                    where you can specify a value that should be used for incrementing. With the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">XXEventCounter</code>
                    types, the values are reset depending on the refresh rate used. For example, say that the client
                    application does a refresh once per second. Using the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IncrementingEventCounter</code>
                    shows the values that have been incremented within the last second. With a refresh rate of 30
                    seconds, the incremented values within the last 30 seconds are shown.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在命名空间 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Diagnostics.Tracing</code>
                                中，定义了四种不同的计数器类型—— <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventCounter</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IncrementingEventCounter</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IncrementingPollingCounter</code>
                                ——它们都继承自基础类 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">DiagnosticCounter</code>
                                。其中两种 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">XXEventCounter</code>
                                类型是最容易使用的。你不需要声明一个变量来存储计数器；你只需要写入或增加指标值。对于 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventCounter</code>
                                类型，你需要写入指标信息来调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">WriteMetric</code>
                                。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IncrementingEventCounter</code>
                                类定义了 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Increment</code>
                                方法，你可以在其中指定一个用于增加的值。对于 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">XXEventCounter</code>
                                类型，值会根据使用的刷新率重置。例如，假设客户端应用程序每秒刷新一次。使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IncrementingEventCounter</code>
                                可以显示过去一秒内增加的值。对于 30 秒的刷新率，显示的是过去 30 秒内增加的值。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">In cases where you need more control, such as to show counter
                    values since the start of the application, you can use the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">XXPollingCounter</code>
                    types. Polling counters are also required in case the values to show are retrieved from other
                    sources, such as the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">GC</code> class. For
                    example, with the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Runtime</code>
                    counts, to show the memory size of the objects in generation 0, a <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code> is
                    used that retrieves the value using <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">GC.GetGenerationSize(0)</code>
                    :<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                在需要更多控制的情况下，例如要显示自应用程序启动以来的计数器值，您可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">XXPollingCounter</code>
                                类型。如果显示的值需要从其他来源获取，例如 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">GC</code>
                                类，则还需要轮询计数器。例如，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Runtime</code>
                                计数时，要显示 0 代对象的大小，使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code>
                                来获取值，该值通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">GC.GetGenerationSize(0)</code>
                                获取：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0022"><code>_gen0SizeCounter ??= new PollingCounter("gen-0-size", this, </code>
<code>  () =&gt; GC.GetGenerationSize(0)) </code>
<code>  { </code>
<code>    DisplayName = "Gen 0 Size", </code>
<code>    DisplayUnits = "B"</code>
<code>  };</code></pre>
                <aside data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <div class="top hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <p id="c16-para-0069" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NOTE</b> <i
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">You can see the
                                implementation of the .NET runtime event source at </i> <code
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a href="https://github.com/dotnet/coreclr/blob/master/src/System.Private.CoreLib/src/System/Diagnostics/Eventing/RuntimeEventSource.cs">https://github.com/dotnet/coreclr/blob/master/src/System.Private.CoreLib/src/System/Diagnostics/Eventing/RuntimeEventSource.cs</a></code>
                            <i data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 您可以在 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a href="https://github.com/dotnet/coreclr/blob/master/src/System.Private.CoreLib/src/System/Diagnostics/Eventing/RuntimeEventSource.cs">https://github.com/dotnet/coreclr/blob/master/src/System.Private.CoreLib/src/System/Diagnostics/Eventing/RuntimeEventSource.cs</a></code>
                                        查看.NET 运行时事件源的实现。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">With the sample application, this metrics information is
                    offered:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用示例应用程序，提供以下指标信息：</font>
                        </font>
                    </font>
                </p>
                <ul class="check" id="c16-list-0005"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <li id="c16-li-0023" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1">The number of requests based on the specified interval.
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">基于指定间隔的请求数量。</font>
                            </font>
                        </font>
                    </li>
                    <li id="c16-li-0024" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1">The number of errors based on the specified interval.
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">基于指定间隔的错误数量。</font>
                            </font>
                        </font>
                    </li>
                    <li id="c16-li-0025" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1">The time it takes to receive the HTTP request.<font
                            class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">接收 HTTP 请求所需的时间。</font>
                            </font>
                        </font>
                    </li>
                </ul>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">In the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MetricsSampleSource</code>
                    class, to create only the counter types when monitoring is going on, the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OnEventCommand</code>
                    method is overridden. This method is invoked on enabling, disabling, and updating of the event
                    source. In case monitoring is turned on, the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">DiagnosticCounter</code>
                    derived types are instantiated: two <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IncrementingEventCounter</code>
                    and one <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code>.
                    With the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code>, a
                    variable is declared that is accessed on polling the value. What's common with all the event types
                    is to specify the name and the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventSource</code>
                    instance in the constructor. The properties <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">DisplayName</code> and
                    <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">DisplayUnits</code> can
                    be set with <span aria-label="431" epub:type="pagebreak" id="Page_431" role="doc-pagebreak"
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>every <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">DiagnosticCounter</code>
                    -derived type. With the constructor of the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code>, a
                    delegate that returns a <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">double</code> needs to be
                    passed with the argument. Because several threads can access the counters simultaneously, this code
                    needs to be thread-safe; that's why the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Interlocked</code> class
                    from the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Threading</code>
                    namespace is used. With the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">XXEventCounter</code>
                    types, the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">DisplayRateTimeScale</code>
                    specifies the rate at which the value should be retrieved. If you specify 10 seconds, for example,
                    even if the refresh interval for displaying the values is set to 1 second, the values are just
                    retrieved after 10 seconds (code file <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MetricsSample/ MetricsSampleSource.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MetricsSampleSource</code>
                                类中，当监控正在进行时，仅创建计数器类型，通过重写 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">OnEventCommand</code>
                                方法。该方法在事件源启用、禁用和更新时被调用。如果监控已开启，则实例化 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">DiagnosticCounter</code>
                                派生类型：两个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IncrementingEventCounter</code>
                                和一个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code>
                                。通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code>
                                ，声明一个在轮询值时被访问的变量。所有事件类型的共同点是，在构造函数中指定名称和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventSource</code>
                                实例。每个 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">DiagnosticCounter</code>
                                派生类型都可以设置 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">DisplayName</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">DisplayUnits</code>
                                属性。通过 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code>
                                的构造函数，需要传递一个返回 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">double</code>
                                的委托作为参数。由于多个线程可以同时访问计数器，因此此代码需要线程安全；这就是为什么使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Threading</code>
                                命名空间中的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Interlocked</code>
                                类。对于 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">XXEventCounter</code>
                                类型， <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">DisplayRateTimeScale</code>
                                指定了获取值的速率。例如，如果你指定 10 秒，即使将显示值的刷新间隔设置为 1 秒，值也只是在 10 秒后被获取（代码文件 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MetricsSample/ MetricsSampleSource.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0023"><code>internal class MetricsSampleSource : EventSource</code>
<code>{</code>
<code>  //…</code>
<code>  private <b>IncrementingEventCounter</b>? _totalRequestsCounter;</code>
<code>  private <b>IncrementingEventCounter</b>? _errorCounter;</code>
<code>  private long _requestDuration;</code>
<code>  private <b>PollingCounter</b>? _requestDurationCounter;</code>
<code> </code>
<code>  protected override void <b>OnEventCommand</b>(EventCommandEventArgs command)</code>
<code>  {</code>
<code>    if (<b>command.Command == EventCommand.Enable</b>)</code>
<code>    {</code>
<code>      _totalRequestsCounter ??= new IncrementingEventCounter("requests", this)</code>
<code>      {</code>
<code>        DisplayName = "Total requests",</code>
<code>        DisplayUnits = "Count",</code>
<code>        DisplayRateTimeScale = TimeSpan.FromSeconds(1)</code>
<code>      };</code>
<code>      _errorCounter ??= new IncrementingEventCounter("errors", this)</code>
<code>      {</code>
<code>        DisplayName = "Errors",</code>
<code>        DisplayUnits = "Count",</code>
<code>        DisplayRateTimeScale = TimeSpan.FromSeconds(1)</code>
<code>      };</code>
<code>      _requestDurationCounter ??= new PollingCounter(</code>
<code>        "request-duration", this, () =&gt; Interlocked.Read(ref _requestDuration))</code>
<code>      {</code>
<code>        DisplayName = "Request duration",</code>
<code>        DisplayUnits = "ms"</code>
<code>      };</code>
<code>    }</code>
<code>  }</code>
<code>  //…</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Now just the counters need to be set. The first counter is
                    set in the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">RequestStart</code>
                    method. The <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IncrementingEventCounter</code>,
                    <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">_totalRequestsCounter</code>,
                    is incremented using the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Increment</code> method.
                    To measure the time a request takes, a new <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Stopwatch</code>
                    (namespace <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Diagnostics</code>)
                    is created, started, and returned from this method. All this happens only if monitoring is enabled
                    by checking the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IsEnabled</code> method
                    from the base class:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">现在只需要设置计数器。第一个计数器是在 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">RequestStart</code>
                                方法中设置的。 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IncrementingEventCounter</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">_totalRequestsCounter</code>
                                使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Increment</code>
                                方法进行递增。为了测量请求所花费的时间，在这个方法中创建一个新的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Stopwatch</code>
                                （命名空间 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Diagnostics</code>
                                ），启动并返回它。所有这些操作只有在通过检查基类的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">IsEnabled</code>
                                方法启用了监控时才会发生：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0024"><code>public Stopwatch? RequestStart()</code>
<code>{</code>
<code>  if (IsEnabled())</code>
<code>  {</code>
<code>    <b>_totalRequestsCounter?.Increment();</b></code>
<code>               <span aria-label="432" epub:type="pagebreak" id="Page_432" role="doc-pagebreak"></span></code>
<code>    return <b>Stopwatch.StartNew();</b></code>
<code>  }</code>
<code>  else</code>
<code>  {</code>
<code>    return default;</code>
<code>  }</code>
<code>}</code></pre>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">The <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">RequestStop</code> method
                    defines a parameter to receive the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Stopwatch</code> created
                    earlier and sets the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ElapsedMilliseconds</code>
                    with the backing field <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">_requestDuration</code>.
                    This field is used by the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code> to
                    show the elapsed time. With the nonincrementing counters, the count is set directly. The tool to
                    analyze the counts can calculate an average value based on the values set:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1"> <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">RequestStop</code>
                                方法定义了一个参数来接收先前创建的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Stopwatch</code>
                                ，并使用后备字段 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">_requestDuration</code>
                                设置 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ElapsedMilliseconds</code>
                                。这个字段被 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code>
                                用来显示经过的时间。对于非递增计数器，计数直接设置。分析计数的工具可以根据设置的值计算平均值：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0025"><code>public void RequestStop(Stopwatch? stopwatch)</code>
<code>{</code>
<code>  if (stopwatch?.IsRunning == true)</code>
<code>  {</code>
<code>    stopwatch.Stop();</code>
<code>    Interlocked.Exchange(ref _requestDuration, stopwatch.ElapsedMilliseconds);</code>
<code>  }</code>
<code>}</code></pre>
                <aside data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <div class="top hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <hr />
                    </div>
                    <section class="feature2" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <p id="c16-para-0075" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1"><b
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NOTE</b> <i
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">When you use the
                            </i> <code
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventCounter</code>
                            <i data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> for the elapsed
                                time of the request, if a refresh rate of one second is used, the count shows 0 if the
                                value was not set within the last second. When you use the </i> <code
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code>
                            <i data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">, you are in more
                                control of the value shown. When you set the value on every request, the value shown is
                                always the time of the last request.</i>
                            <font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">注意 当你使用 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventCounter</code>
                                        来表示请求的经过时间时，如果使用一秒的刷新率，如果值在过去一秒内没有被设置，计数器显示为 0。当你使用 <code
                                            xmlns="http://www.w3.org/1999/xhtml"
                                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PollingCounter</code>
                                        时，你对显示的值有更多的控制权。当你对每个请求都设置值时，显示的值始终是最后一个请求的时间。</font>
                                </font>
                            </font>
                        </p>
                        <div class="bottom hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                            <hr />
                        </div>
                    </section>
                </aside>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">You can also implement the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Error</code> method to
                    increment the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">_errorCounter</code>
                    :<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">你也可以实现 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Error</code>
                                方法来递增 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">_errorCounter</code>
                                ：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0026"><code>public void Error()</code>
<code>{</code>
<code>  if (IsEnabled())</code>
<code>  {</code>
<code>    <b>_errorCounter?.Increment();</b></code>
<code>  }</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span id="c16-sec-0020"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
                <h3 id="head-3-304" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Using MetricsSampleSource<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 MetricsSampleSource </font>
                        </font>
                    </font>
                </h3>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Next, the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NetworkService</code>
                    class is updated to invoke the members of the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MetricsSample</code>
                    class. With the following code snippet, the logging methods from before are removed for clarity, but
                    they are still available with the downloadable source code. On the start of the request, the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">RequestStart</code>
                    method that returns a <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Stopwatch</code> is
                    invoked. This stopwatch is passed as an argument to the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">RequestStop</code>
                    method. In the case of an <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">HttpRequestException</code>,
                    the <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Error</code> method
                    is invoked to increment the error count. To stop the stopwatch in every case, the code is wrapped
                    into a <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">try</code>
                    /
                    <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">finally</code> block.
                    Remember, if monitoring is not turned on, invoking the method <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">RequestStart</code> does
                    not count metrics, and the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Stopwatch</code> returned
                    is <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">null</code> (code
                    file <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MetricsSample/NetworkService.cs</code>):
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">接下来， <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NetworkService</code>
                                类被更新以调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MetricsSample</code>
                                类的成员。在以下代码片段中，为了清晰起见，之前记录方法被移除了，但它们仍然可以在可下载的源代码中找到。在请求开始时，返回 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Stopwatch</code>
                                的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">RequestStart</code>
                                方法被调用。这个秒表被作为参数传递给 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">RequestStop</code>
                                方法。在发生 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">HttpRequestException</code>
                                的情况下，会调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Error</code>
                                方法来增加错误计数。在所有情况下，为了停止秒表，代码被包装在 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">try</code> /
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">finally</code>
                                块中。记住，如果监控未开启，调用方法 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">RequestStart</code>
                                不会计入指标，返回的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Stopwatch</code>
                                是 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">null</code>
                                （代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MetricsSample/NetworkService.cs</code>
                                ）：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0027"><code>public async Task NetworkRequestSampleAsync(Uri requestUri)</code>
<code>{<span aria-label="433" epub:type="pagebreak" id="Page_433" role="doc-pagebreak"></span></code>
<code>  <b>var stopWatch = MetricsSampleSource.Log.RequestStart();</b></code>
<code>  try</code>
<code>  {</code>
<code>    string result = await _httpClient.GetStringAsync(requestUri);</code>
<code>    MetricsSampleSource.Log.RequestStop(stopWatch);</code>
<code>    Console.WriteLine($"{result[..50]}");</code>
<code>  }</code>
<code>  catch (HttpRequestException ex)</code>
<code>  {</code>
<code>    <b>MetricsSampleSource.Log.Error();</b></code>
<code>  }</code>
<code>  finally</code>
<code>  {</code>
<code>    <b>MetricsSampleSource.Log.RequestStop(stopWatch);</b></code>
<code>  }</code>
<code>}</code></pre>
            </section>
            <section data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span id="c16-sec-0021"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
                <h3 id="head-3-305" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Monitoring Metrics with .NET CLI<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用 .NET CLI 监控指标 </font>
                        </font>
                    </font>
                </h3>
                <p id="c16-para-0078" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Now that metrics information is in place, let's look at the
                    information that can be accessed with <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">dotnet-counters</code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">现在指标信息已经就绪，让我们看看可以使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">dotnet-counters</code>
                                访问哪些信息。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">To see all the counters available with .NET, use this
                    command:<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要查看 .NET 提供的所有计数器，请使用此命令：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0028"><code>dotnet counters list --runtime-version 5.0</code></pre>
                <p id="c16-para-0080" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">The .NET 5 version of <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">dotnet counters</code> by
                    default lists the counters available with .NET Core 3.1 (the LTS version). Some more metrics
                    categories are available with .NET 5, which are shown by passing <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">5.0</code> to the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">--runtime-version</code>
                    option. The additional metrics categories are <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Runtime</code>,
                    <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.AspNetCore.Hosting</code>,
                    <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft-AspNetCore-Server-Kestrel</code>,
                    and <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Net.Http</code>.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">.NET 5 版本的 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">dotnet counters</code>
                                默认列出 .NET Core 3.1（长期支持版本）提供的计数器。.NET 5 提供了更多指标类别，这些类别可以通过向 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">--runtime-version</code>
                                选项传递 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">5.0</code>
                                来显示。额外的指标类别包括 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Runtime</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.AspNetCore.Hosting</code>
                                、 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft-AspNetCore-Server-Kestrel</code>
                                和 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Net.Http</code>
                                。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">To monitor the counters from the application, first start the
                    application, and then get the process ID of the running application with the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ps</code> subcommand:
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">要从应用程序监控计数器，首先启动应用程序，然后使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ps</code>
                                子命令获取运行应用程序的进程 ID：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0029"><code>dotnet counters ps</code></pre>
                <p id="c16-para-0082" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">This command shows the running .NET applications that can be
                    monitored.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">此命令显示可以监控的正在运行的 .NET 应用程序。</font>
                        </font>
                    </font>
                </p>
                <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">To monitor the running application with the counts offered by
                    the application, use the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">monitor</code> subcommand
                    with the <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">-p</code>
                    option to pass the process ID, followed by the category names that should be monitored. Only the
                    category <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Runtime</code> is
                    monitored by default; you need to add all other categories that should be shown:<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用应用程序提供的计数来监控运行中的应用程序，使用 <code
                                    xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">monitor</code>
                                子命令配合 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">-p</code>
                                选项传递进程 ID，然后跟上要监控的类别名称。默认情况下仅监控 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">System.Runtime</code>
                                类别；你需要添加所有其他要显示的类别：</font>
                        </font>
                    </font>
                </p>
                <pre id="c16-code-0030"><code>dotnet counters monitor -p 2711 Wrox.ProCSharp.MetricsSample</code></pre>
                <p id="c16-para-0084" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Be aware that the categories specified show up only when the
                    counts are activated, so you might not see the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Wrox.ProCSharp.MetricsSample</code>
                    category on start of monitoring. To use a different refresh interval—for example, to see updates
                    after five seconds—use the option <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">--refresh-interval 5</code>.
                    <a href="#c16-fig-0001" id="R_c16-fig-0001"
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Figure 16-1</a> shows the
                    output from <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">dotnet counters</code>
                    with a running application.<font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">
                                请注意，指定的类别只有在计数激活时才会显示，所以在监控开始时你可能看不到 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Wrox.ProCSharp.MetricsSample</code>
                                类别。要使用不同的刷新间隔——例如，每五秒查看更新——使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">--refresh-interval 5</code>
                                选项。图 16-1 显示了正在运行的应用程序的 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">dotnet counters</code>
                                输出。</font>
                        </font>
                    </font>
                </p>
                <p id="c16-para-0085" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Instead of live monitoring an application, you can create a
                    file to record all counts. Start this command with <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">dotnet counters collect</code>.
                    In addition to the options you've seen with the subcommand <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">monitor</code>, you can
                    select to create a CSV or JON file with the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">--format</code> option,
                    and you can specify the name of the generated file with the <code
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">--name</code> option.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">除了实时监控应用程序，你可以创建一个文件来记录所有计数。使用
                                <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">dotnet counters collect</code>
                                命令开始此操作。除了子命令 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">monitor</code>
                                中看到的选项外，你可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">--format</code>
                                选项选择创建 CSV 或 JON 文件，并可以使用 <code xmlns="http://www.w3.org/1999/xhtml"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">--name</code>
                                选项指定生成文件的名称。</font>
                        </font>
                    </font>
                </p>
                <figure data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> <img
                        alt="Snapshot of pseudocode representing monitoring Metrics with .NET CLI." class="center"
                        src="images/c16f001.png" />
                    <figcaption data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span
                                class="figureLabel"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a
                                    href="#R_c16-fig-0001" id="c16-fig-0001" role="doc-backlink"
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><b
                                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                                        data-immersive-translate-paragraph="1">FIGURE 16-1<font
                                            class="notranslate immersive-translate-target-wrapper"
                                            data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                            <font class="notranslate"
                                                data-immersive-translate-translation-element-mark="1">  </font>
                                            <font
                                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                                data-immersive-translate-translation-element-mark="1">
                                                <font
                                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                    data-immersive-translate-translation-element-mark="1">图 16-1</font>
                                            </font>
                                        </font></b></a></span></p>
                    </figcaption>
                </figure>
            </section>
        </section> <span aria-label="434" epub:type="pagebreak" id="Page_434" role="doc-pagebreak"
            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
        <section aria-labelledby="head-2-142" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
            <span id="c16-sec-0022" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
            <h2 id="head-2-142" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">ANALYTICS WITH VISUAL STUDIO APP CENTER</h2>
            <p id="c16-para-0086" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Visual Studio App Center (<code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a href="https://appcenter.ms">https://appcenter.ms</a></code>)
                is Microsoft's entry point to build Windows and mobile apps, distribute apps to beta testers, test apps,
                extend apps with push notifications, and get user analytics for apps.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">Visual Studio App Center（ <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a href="https://appcenter.ms">https://appcenter.ms</a></code>
                            ）是微软用于构建 Windows 和移动应用、向测试者分发应用、测试应用、通过推送通知扩展应用以及获取应用用户分析的入口。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">You can get reports of users having issues with your apps—for
                example, you can find out about exceptions—and you can also find out the features users are using from
                your apps. For example, let's say you have added a new feature to your app. Are users finding the button
                to activate the feature?<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            你可以获取有关应用问题的报告——例如，你可以发现异常——你也可以了解用户在使用你的应用时使用哪些功能。例如，假设你为应用添加了一个新功能。用户是否找到了激活该功能的按钮？</font>
                    </font>
                </font>
            </p>
            <aside data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                <div class="top hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <p id="c16-para-0088" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NOTE</b> <i
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Here are some
                            examples of features that users had trouble finding from Microsoft's own products. The Xbox
                            was the first device to offer a user interface with large tiles. The search feature was
                            available directly below the tiles. Although this button was available where it seemed
                            obvious the user would find it, users didn't see it. Microsoft moved the search
                            functionality within a tile, and now users are able to find it.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意
                                    这里有一些用户在微软自家产品中难以找到的功能示例。Xbox
                                    是首个提供带有大图标的用户界面的设备。搜索功能直接位于图标下方。尽管这个按钮放在了用户看起来应该能找到它的位置，但用户还是没能发现它。微软将搜索功能移入图标内部，现在用户能够找到它了。
                                </font>
                            </font>
                        </font>
                    </p>
                    <p id="c16-para-0089" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><i
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1">Another example is the physical search button that
                            was available on the Windows Phone. This button was meant to be used to search within apps.
                            Users complained about not having an option to search within email because they didn't think
                            to press this physical button to search for emails. Microsoft changed the functionality.
                            With a newer version, the physical search button was used only to search content from the
                            Web, and the mail app had its own Search button.<font
                                class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">另一个例子是 Windows Phone
                                        上提供的物理搜索按钮。这个按钮原本用于在应用内进行搜索。用户抱怨没有邮件搜索选项，因为他们没有想到要按这个物理按钮来搜索邮件。微软改变了功能。在新版本中，物理搜索按钮仅用于搜索网络内容，而邮件应用有自己的搜索按钮。
                                    </font>
                                </font>
                            </font></i></p>
                    <p id="c16-para-0090" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><i
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                            data-immersive-translate-paragraph="1">Windows 8 had a similar issue with search; users
                            didn't use the search functionality from the charms bar to search within apps. Windows 8.1
                            changed the guideline to use search from the charms bar, and now the app contains its own
                            search box. In Windows 10, there's also an auto suggest box to be used within the app that
                            helps with searching.<font class="notranslate immersive-translate-target-wrapper"
                                data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                                <font
                                    class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                    data-immersive-translate-translation-element-mark="1">
                                    <font
                                        class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                        data-immersive-translate-translation-element-mark="1">Windows 8
                                        在搜索方面也存在类似问题；用户不使用从魔贴栏的搜索功能在应用内进行搜索。Windows 8.1 将指南改为从魔贴栏使用搜索，现在应用包含自己的搜索框。在
                                        Windows 10 中，应用内还有自动建议框可用于帮助搜索。</font>
                                </font>
                            </font></i></p>
                    <div class="bottom hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <hr />
                    </div>
                </section>
            </aside>
            <p id="c16-para-0091" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1"><span aria-label="435" epub:type="pagebreak" id="Page_435"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>To enable app
                analytics, you first need to register with the Visual Studio App Center. Don't be afraid of high costs;
                crash reporting and analytics are available for free. Next, you need to create an app and copy the app
                secret from the web portal. Then you can create a new blank app (WinUI Desktop) with Visual Studio. To
                enable analytics, add the NuGet packages <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.AppCenter</code>,
                <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.AppCenter.Analytics</code>,
                and <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.AppCenter.Crashes</code>
                to the project.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">要启用应用分析，首先需要在 Visual Studio App Center
                            注册。不要担心高成本；崩溃报告和分析是免费的。接下来，你需要创建一个应用并从网页门户复制应用密钥。然后你可以使用 Visual Studio 创建一个新的空白应用（WinUI
                            桌面）。要启用分析，将 NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.AppCenter</code>
                            、 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.AppCenter.Analytics</code>
                            和 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.AppCenter.Crashes</code>
                            添加到项目中。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">With just a few API calls, you're ready to find out issues your
                users have. In the constructor of the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">App</code> class, add <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">AppCenter.Start</code>, and
                add your previously copied app secret. To enable Analytics, you need to pass the type of the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Analytics</code> object as
                the second argument to the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Start</code> method (code
                file <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">WindowsAppAnalytics/App.xaml.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">只需几个 API 调用，你就可以发现用户的问题。在 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">App</code>
                            构造类的函数中添加 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">AppCenter.Start</code>
                            ，并添加你之前复制的应用密钥。要启用分析功能，你需要将 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Analytics</code>
                            对象的类型作为 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Start</code>
                            方法的第二个参数传递（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">WindowsAppAnalytics/App.xaml.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0031"><code>public App()</code>
<code>{</code>
<code>  this.InitializeComponent();</code>
<code>  this.Suspending += OnSuspending;</code>
<code> </code>
<code>  <b>AppCenter.Start("84df09c4-d560-4c46-a44f-a5524c3abb7f",</b> </code>
<code>    <b>typeof(Analytics), typeof(Crashes));</b></code>
<code>}</code></pre>
            <aside data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                <div class="top hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <hr />
                </div>
                <section class="feature2" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <p id="c16-para-0094" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                        data-immersive-translate-paragraph="1"><b
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">NOTE</b> <i
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Remember to add your
                            app secret from your app configuration in the Visual Studio App Center to the </i> <code
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">App</code> <i
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> constructor.</i>
                        <font class="notranslate immersive-translate-target-wrapper"
                            data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                            <font
                                class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                                data-immersive-translate-translation-element-mark="1">
                                <font
                                    class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                    data-immersive-translate-translation-element-mark="1">注意 记得将你的应用密钥从应用配置中添加到 <code
                                        xmlns="http://www.w3.org/1999/xhtml"
                                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">App</code>
                                    构造函数中。</font>
                            </font>
                        </font>
                    </p>
                    <div class="bottom hr" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                        <hr />
                    </div>
                </section>
            </aside>
            <p id="c16-para-0095" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Now when you run the application, you see user information, when
                users start the application, locations, and user devices.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            现在当你运行应用程序时，你会看到用户信息，当用户启动应用程序时，会显示位置和用户设备。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">To get some more information from users, you need to create calls
                to <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Analytics.TrackEvent</code>.
                All the possible events from the app are defined within the class <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventNames</code> (code file
                <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">WindowsAppAnalytics/EventNames.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">要从用户那里获取更多信息，你需要创建对 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Analytics.TrackEvent</code>
                            的调用。所有可能的应用事件都在类 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventNames</code>
                            (代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">WindowsAppAnalytics/EventNames.cs</code>
                            ) 中定义：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0032"><code>public class EventNames</code>
<code>{</code>
<code>  public const string ButtonClicked = nameof(ButtonClicked);</code>
<code>  public const string PageNavigation = nameof(PageNavigation);</code>
<code>  public const string CreateMenu = nameof(CreateMenu);</code>
<code>}</code></pre>
            <p id="c16-para-0097" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">The sample application contains controls to enable/disable
                analytics, enter some text, and click a button as shown in <a href="#c16-fig-0002" id="R_c16-fig-0002"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Figure 16-2</a>. Events are
                collected when the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MainWindow</code> is
                activated. The <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TrackEvent</code> method
                requires a string for the event name; this is taken from the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventNames</code> class. The
                second argument of the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TrackEvent</code> method is
                optional. Here you can pass a dictionary of strings to track additional information. In the sample code,
                when the window is opened, the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PageNavigation</code> event
                contains information about the type of the page navigated to (code file <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">WindowsAppAnalytics/MainWindow.xaml.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">示例应用程序包含启用/禁用分析、输入文本和点击按钮的控件，如图 16-2
                            所示。当 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">MainWindow</code>
                            被激活时，会收集事件。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TrackEvent</code>
                            方法需要一个事件名称的字符串；这来自 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">EventNames</code>
                            类。 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TrackEvent</code>
                            方法的第二个参数是可选的。这里你可以传递一个字符串字典来跟踪附加信息。在示例代码中，当窗口打开时， <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">PageNavigation</code>
                            事件包含有关导航到的页面类型的信息（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">WindowsAppAnalytics/MainWindow.xaml.cs</code>
                            ):</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0033"><code>public MainWindow()</code>
<code>{</code>
<code>  this.InitializeComponent();</code>
<code>  <b>Analytics.TrackEvent(EventNames.PageNavigation,</b> </code>
<code>    <b>new Dictionary&lt;string, string&gt; { ["Page"] = nameof(MainWindow) });</b></code>
<code>}</code> </pre>
            <figure data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> <img
                    alt="Snapshot of a page displaying a checkbox labeled, allow analytics with a button below. The button is labeled, send event."
                    class="center" src="images/c16f002.png" />
                <figcaption data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span class="figureLabel"
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a
                                href="#R_c16-fig-0002" id="c16-fig-0002" role="doc-backlink"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><b
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                                    data-immersive-translate-paragraph="1">FIGURE 16-2<font
                                        class="notranslate immersive-translate-target-wrapper"
                                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">
                                              </font>
                                        <font
                                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                            data-immersive-translate-translation-element-mark="1">
                                            <font
                                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                data-immersive-translate-translation-element-mark="1">图 16-2</font>
                                        </font>
                                    </font></b></a></span></p>
                </figcaption>
            </figure>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1"><span aria-label="436" epub:type="pagebreak" id="Page_436"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>With the click of the
                button, <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TrackEvent</code>
                tracks the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ButtonClick</code> event,
                with the information the user entered in the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TextBox</code> control:<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">点击按钮后， <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TrackEvent</code>
                            将跟踪 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ButtonClick</code>
                            事件，并使用用户在 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TextBox</code>
                            控件中输入的信息：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0034"><code>private void OnButtonClick(object sender, RoutedEventArgs e)</code>
<code>{</code>
<code>  <b>Analytics.TrackEvent(ButtonClicked,</b> </code>
<code>    <b>new Dictionary&lt;string, string&gt; { ["State"] = textState.Text });</b></code>
<code>}</code></pre>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Users might not agree to having information collected as the user
                wanders around the app. You can create a setting for the user where the user can enable/disable this
                functionality. If you set <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Analytics.SetEnabledAsync(false)</code>,
                the Analytics APIs no longer reports data:<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            用户可能不同意在应用中漫游时收集信息。您可以创建一个设置，让用户可以启用/禁用此功能。如果您设置 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Analytics.SetEnabledAsync(false)</code>
                            ，分析 API 将不再报告数据：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0035"><code>private async void OnAnalyticsChanged(object sender, RoutedEventArgs e)</code>
<code>{</code>
<code>  if (sender is CheckBox checkbox)</code>
<code>  {</code>
<code>    bool isChecked = checkbox?.IsChecked ?? true;</code>
<code>    <b>await Analytics.SetEnabledAsync(isChecked);</b></code>
<code>  }</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Visual Studio App Center has some limits in regard to analytics,
                as shown in this list:<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">Visual Studio App Center
                            在分析方面有一些限制，如下列表所示：</font>
                    </font>
                </font>
            </p>
            <ul class="check" id="c16-list-0006" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                <li id="c16-li-0026" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">You can have only up to 200 distinct custom events daily.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">您每天最多只能有 200 个不同的自定义事件。</font>
                        </font>
                    </font>
                </li>
                <li id="c16-li-0027" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">An event can have 20 properties (the rest are dropped).<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">一个事件最多可以有 20 个属性（其余的将被丢弃）。</font>
                        </font>
                    </font>
                </li>
                <li id="c16-li-0028" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">The event name is limited to 256 characters.<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">事件名称最多为 256 个字符。</font>
                        </font>
                    </font>
                </li>
                <li id="c16-li-0029" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Property keys and values are truncated after 128 characters.
                    <font class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">属性键和值在 128 个字符后会被截断。</font>
                        </font>
                    </font>
                </li>
            </ul>
            <p id="c16-para-0101" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">When you run the application and monitor the Visual Studio App
                Center portal, you can see the events that occurred with the number of users (see <a
                    href="#c16-fig-0003" id="R_c16-fig-0003"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Figure 16-3</a>). When you
                click in the events, you can see the event count by user, the events per session, the details of the
                dictionary properties passed, and a log flow.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">当您运行应用程序并监控 Visual Studio App Center
                            门户时，您可以看到发生的事件以及用户数量（见图 16-3）。当您点击事件时，您可以看到按用户的计数、每个会话的事件、传递的字典属性详细信息以及日志流。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Apart from this information, Visual Studio App Center Analytics
                also gives you information about the following:<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">除了这些信息之外，Visual Studio App Center
                            Analytics 还为您提供以下信息：</font>
                    </font>
                </font>
            </p>
            <ul class="check" id="c16-list-0007" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                <li id="c16-li-0030" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Number of active users<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">活跃用户数量</font>
                        </font>
                    </font>
                </li>
                <li id="c16-li-0031" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Daily sessions per user<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">每日用户会话数</font>
                        </font>
                    </font>
                </li>
                <li id="c16-li-0032" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Session duration<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">会话时长</font>
                        </font>
                    </font>
                </li>
                <li id="c16-li-0033" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1"><span aria-label="437" epub:type="pagebreak" id="Page_437"
                        role="doc-pagebreak"
                        data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>Top devices<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">顶级设备</font>
                        </font>
                    </font>
                </li>
                <li id="c16-li-0034" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">OS versions used<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">使用的操作系统版本</font>
                        </font>
                    </font>
                </li>
                <li id="c16-li-0035" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                    data-immersive-translate-paragraph="1">Languages<font
                        class="notranslate immersive-translate-target-wrapper"
                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                        <font
                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                            data-immersive-translate-translation-element-mark="1">
                            <font
                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                data-immersive-translate-translation-element-mark="1">语言</font>
                        </font>
                    </font>
                </li>
            </ul>
            <figure data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> <img
                    alt="Snapshot of a webpage viewing content related to events in app center website." class="center"
                    src="images/c16f003.png" />
                <figcaption data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span class="figureLabel"
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a
                                href="#R_c16-fig-0003" id="c16-fig-0003" role="doc-backlink"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><b
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                                    data-immersive-translate-paragraph="1">FIGURE 16-3<font
                                        class="notranslate immersive-translate-target-wrapper"
                                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">
                                              </font>
                                        <font
                                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                            data-immersive-translate-translation-element-mark="1">
                                            <font
                                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                data-immersive-translate-translation-element-mark="1">图 16-3</font>
                                        </font>
                                    </font></b></a></span></p>
                </figcaption>
            </figure>
        </section>
        <section aria-labelledby="head-2-143" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
            <span id="c16-sec-0025" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
            <h2 id="head-2-143" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">APPLICATION INSIGHTS</h2>
            <p id="c16-para-0103" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Visual Studio App Center Analytics information is based on Azure
                Application Insights. With your web or service applications, you can directly use Application Insights.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">Visual Studio App Center Analytics
                            信息基于 Azure Application Insights。对于您的 Web 或服务应用程序，您可以直接使用 Application Insights。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0104" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">The sample web app with this chapter consists of an ASP.NET Core
                Razor web app that accesses a SQL Server database. Read <a href="c26.xhtml"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Chapter 26</a>, “Razor Pages
                and MVC,” on creating Razor Pages and how to deploy the web application and the database to Microsoft
                Azure.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">本章中的示例 Web 应用是一个访问 SQL Server 数据库的
                            ASP.NET Core Razor Web 应用。请阅读第 26 章“Razor 页面和 MVC”，了解如何创建 Razor 页面以及如何将 Web 应用和数据库部署到
                            Microsoft Azure。</font>
                    </font>
                </font>
            </p>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">To use diagnostics and telemetry information with Application
                Insights, you add the NuGet package <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.ApplicationInsights.AspNetCore</code>
                to the project. If you just want to write log information to Application Insights, the NuGet package
                <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.Extensions.Logging.ApplicationInsights</code>
                can be enough. All that you need to do in the code is enable telemetry information by invoking the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">AddApplicationInsightsTelemetry</code>
                method with the configuration of the DI container (code file <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">WebAppWithAppInsights/Startup.cs</code>):
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">要使用诊断和遥测信息与 Application Insights
                            一起使用，您需要将 NuGet 包 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.ApplicationInsights.AspNetCore</code>
                            添加到项目中。如果您只想将日志信息写入 Application Insights，那么 NuGet 包 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Microsoft.Extensions.Logging.ApplicationInsights</code>
                            就足够了。在代码中，您需要做的只是在 DI 容器的配置下调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">AddApplicationInsightsTelemetry</code>
                            方法来启用遥测信息（代码文件 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">WebAppWithAppInsights/Startup.cs</code>
                            ）：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0036"><code>public void ConfigureServices(IServiceCollection services)</code>
<code>{</code>
<code>  services.AddRazorPages();</code>
<code>  services.AddDbContext&lt;BooksContext&gt;(options =&gt;</code>
<code>  {</code>
<code>    options.UseSqlServer(Configuration.GetConnectionString(</code>
<code>      "BooksConnection"));</code>
<code>  });</code>
<code>  services.AddApplicationInsightsTelemetry();</code>
<code>}</code></pre>
            <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1"><span aria-label="438" epub:type="pagebreak" id="Page_438"
                    role="doc-pagebreak"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>Without specifying any
                parameters with this method, the instrumentation key needs to be added to the configuration within the
                section <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ApplicationInsights</code>
                and the key name <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">InstrumentationKey</code>
                :<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">使用此方法时不指定任何参数，需要在 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">ApplicationInsights</code>
                            部分的配置中添加仪器化密钥，并使用键名 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">InstrumentationKey</code>
                            ：</font>
                    </font>
                </font>
            </p>
            <pre id="c16-code-0037"><code>{</code>
<code>  "ApplicationInsights": {</code>
<code>    "InstrumentationKey": "add your instrumentation key"</code>
<code>  }</code>
<code>}</code></pre>
            <p id="c16-para-0107" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">The method <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">AddApplicationInsightsTelemetry</code>
                offers overloads where you can pass the instrumentation key, or with options the connection string. With
                some Azure regions you are required to use the connection string instead of just using the key. With the
                configuration you can also specify to turn off some of the Application Insights options if you don't
                want to collect all the data. By default, adding Application Insights to the DI container also adds a
                log provider to write the warning and error messages of all containers to Application Insights.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">方法 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">AddApplicationInsightsTelemetry</code>
                            提供了重载，你可以传入仪器化密钥，或者通过选项传入连接字符串。对于某些 Azure 区域，你必须使用连接字符串而不是仅使用密钥。通过配置，你也可以指定关闭一些 Application
                            Insights 选项，如果你不想收集所有数据。默认情况下，将 Application Insights 添加到 DI 容器也会添加一个日志提供程序，用于将所有容器的警告和错误消息写入
                            Application Insights。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0108" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">What data can you see with Application Insights? <a
                    href="#c16-fig-0004" id="R_c16-fig-0004"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Figure 16-4</a> shows live
                metrics information: incoming requests, duration, failure rates, CPU and memory utilization, as well as
                telemetry information for pages that have been called. <a href="#c16-fig-0005" id="R_c16-fig-0005"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Figure 16-5</a> shows the
                application map. Here you see the different Azure resources that the application <span aria-label="439"
                    epub:type="pagebreak" id="Page_439" role="doc-pagebreak"
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>interacts with. With
                the sample application, it's an Azure SQL database. The application map shows how many times resources
                have been invoked, the duration, and the error counts. In the case of errors, you can easily see common
                properties of the errors. Application Insights makes use of artificial intelligence to learn about the
                normal behavior and timings of the application to give you information about anomalies. You can specify
                alerts to inform you in different ways. To add information that's not automatically detected, you can
                inject the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TelemetryClient</code> in
                your Razor pages, controllers, or services, and report additional information invoking the <code
                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TrackEvent</code> method.
                <font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">你能通过应用洞察看到哪些数据？图 16-4
                            显示了实时指标信息：传入请求、持续时间、失败率、CPU 和内存利用率，以及已调用页面的遥测信息。图 16-5 显示了应用地图。在这里，你可以看到应用交互的不同 Azure
                            资源。对于示例应用，它是一个 Azure SQL
                            数据库。应用地图显示了资源被调用的次数、持续时间和错误计数。在出现错误的情况下，你可以轻松查看错误的常见属性。应用洞察利用人工智能来学习应用的正常行为和时机，以提供异常信息。你可以指定警报以用不同方式通知你。要添加自动检测不到的信息，你可以在
                            Razor 页面、控制器或服务中注入 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TelemetryClient</code>
                            ，并调用 <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">TrackEvent</code>
                            方法来报告附加信息。</font>
                    </font>
                </font>
            </p>
            <figure data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> <img
                    alt="Snapshot of a webpage from portal azure." class="center" src="images/c16f004.png" />
                <figcaption data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span class="figureLabel"
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a
                                href="#R_c16-fig-0004" id="c16-fig-0004" role="doc-backlink"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><b
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                                    data-immersive-translate-paragraph="1">FIGURE 16-4<font
                                        class="notranslate immersive-translate-target-wrapper"
                                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">
                                              </font>
                                        <font
                                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                            data-immersive-translate-translation-element-mark="1">
                                            <font
                                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                data-immersive-translate-translation-element-mark="1">图 16-4</font>
                                        </font>
                                    </font></b></a></span></p>
                </figcaption>
            </figure>
            <figure data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"> <img
                    alt="Schematic illustration of the concept of procsharp webapp." class="center"
                    src="images/c16f005.png" />
                <figcaption data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
                    <p data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><span class="figureLabel"
                            data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><a
                                href="#R_c16-fig-0005" id="c16-fig-0005" role="doc-backlink"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"><b
                                    data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                                    data-immersive-translate-paragraph="1">FIGURE 16-5<font
                                        class="notranslate immersive-translate-target-wrapper"
                                        data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                                        <font class="notranslate" data-immersive-translate-translation-element-mark="1">
                                              </font>
                                        <font
                                            class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                                            data-immersive-translate-translation-element-mark="1">
                                            <font
                                                class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                                                data-immersive-translate-translation-element-mark="1">图 16-5</font>
                                        </font>
                                    </font></b></a></span></p>
                </figcaption>
            </figure>
        </section>
        <section aria-labelledby="head-2-144" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">
            <span id="c16-sec-0026" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"></span>
            <h2 id="head-2-144" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">SUMMARY<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN">
                    <font class="notranslate" data-immersive-translate-translation-element-mark="1">  </font>
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-inline-wrapper-theme-none immersive-translate-target-translation-inline-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">摘要</font>
                    </font>
                </font>
            </h2>
            <p id="c16-para-0109" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">In this chapter, you looked at logging and metrics facilities
                that can help you find intermittent problems in your applications. You should plan early and build these
                features into your applications; doing so will help you avoid many troubleshooting problems later.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            在本章中，你了解了日志记录和指标功能，这些功能可以帮助你发现应用程序中的间歇性问题。你应该尽早规划，并将这些功能集成到你的应用程序中；这样做将有助于你避免许多后期的问题排查。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0110" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">With logging, you can write messages for debugging that help with
                analyzing the application, as well as exceptions and warnings that also help with running the
                application in production. You also have the flexibility to define different logging configurations
                based on the logging category as well as the logging providers.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">
                            通过日志记录，你可以编写用于调试的消息，这些消息有助于分析应用程序，以及异常和警告，这些也有助于在生产环境中运行应用程序。你还能够根据日志记录类别以及日志记录提供者定义不同的日志记录配置。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0111" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">You can use metrics to analyze counts reported from the runtime
                as well as different .NET libraries, and you can add your own counts as well.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">你可以使用指标来分析运行时以及不同的 .NET
                            库报告的计数，你也可以添加自己的计数。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0112" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">With Visual Studio App Center Analytics, you've seen that many
                features come out of the box when you use this cloud service. You can easily get information from your
                users with just a few lines of code. If you add some more lines, you can find out if users don't use
                some new features of the app because they might have trouble finding them.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">通过 Visual Studio App Center
                            Analytics，你已经看到当你使用这项云服务时，许多功能都是开箱即用的。你只需几行代码就可以轻松获取用户信息。如果你再添加几行代码，你就可以发现用户是否没有使用应用程序的一些新功能，因为他们可能难以找到这些功能。
                        </font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0113" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">Application Insights is a great service for your Azure resources
                but can also be used from your on-premises environment to collect and analyze information about the
                application and quickly find issues.<font class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">应用洞察是您 Azure
                            资源的绝佳服务，但也可以从您的本地环境中使用，以收集和分析有关应用程序的信息，并快速发现问题。</font>
                    </font>
                </font>
            </p>
            <p id="c16-para-0114" data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762"
                data-immersive-translate-paragraph="1">The next chapter goes into the details of parallel programming
                with the <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Task</code> and
                <code data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Parallel</code> classes as
                well as synchronization objects that help you use multiple cores from the operating system. Issues that
                come up when you use multiple tasks are covered as well.<font
                    class="notranslate immersive-translate-target-wrapper"
                    data-immersive-translate-translation-element-mark="1" lang="zh-CN"><br />
                    <font
                        class="notranslate immersive-translate-target-translation-theme-none immersive-translate-target-translation-block-wrapper-theme-none immersive-translate-target-translation-block-wrapper"
                        data-immersive-translate-translation-element-mark="1">
                        <font
                            class="notranslate immersive-translate-target-inner immersive-translate-target-translation-theme-none-inner"
                            data-immersive-translate-translation-element-mark="1">下一章将详细讲解使用 <code
                                xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Task</code> 和
                            <code xmlns="http://www.w3.org/1999/xhtml"
                                data-immersive-translate-walked="10f5bb76-d980-449a-a3b3-ee0da840a762">Parallel</code>
                            类进行并行编程以及帮助您使用操作系统多个核心的同步对象。同时，还涵盖了使用多个任务时出现的问题。</font>
                    </font>
                </font>
            </p>
        </section>
    </section>
</body>
<div id="immersive-translate-popup" style="all: initial"></div>

</html>